<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Meta tags para colorir a status bar dos dispositivos m√≥veis -->
  <meta name="theme-color" content="#7C3AED">
  <meta name="msapplication-navbutton-color" content="#7C3AED">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-capable" content="yes">
  
  <title>+Milion√°ria | Dashboard Inteligente</title>
  
  <!-- Favicons otimizados para todos os dispositivos -->
  <link rel="icon" href="/static/img/Favicon_LI.png" type="image/png" sizes="32x32">
  <link rel="icon" href="/static/img/Favicon_LI.png" type="image/png" sizes="16x16">
  <link rel="icon" href="/static/img/Favicon_LI.png" type="image/png" sizes="48x48">
  <link rel="icon" href="/static/img/Favicon_LI.png" type="image/png" sizes="192x192">
  <link rel="icon" href="/static/img/Favicon_LI.png" type="image/png" sizes="512x512">
  
  <!-- Apple Touch Icons para iOS -->
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="180x180">
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="152x152">
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="144x144">
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="120x120">
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="114x114">
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="76x76">
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="72x72">
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="60x60">
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="57x57">
  
  <!-- Android Chrome Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="/static/img/Favicon_LI.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/static/img/Favicon_LI.png">
  
  <!-- Windows Tiles -->
  <meta name="msapplication-TileColor" content="#7C3AED">
  <meta name="msapplication-TileImage" content="/static/img/Favicon_LI.png">
  <meta name="msapplication-config" content="none">
  
  <!-- Manifest para PWA -->
  <link rel="manifest" href="/static/manifest.json">

  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"></noscript>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      important: false,
      corePlugins: {
        preflight: false,
      },
      theme: {
        extend: {
          colors: {
            'primary': '#00E38C',
            'secondary': '#8B5CF6',
            'background': '#000000', // Certifique-se que esta √© a cor de fundo desejada
            'card': '#1A1D25',
            'surface': '#2E303A',
          }
        }
      }
    }
  </script>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/estilo.css') }}">
  <!-- CSS Mobile Otimizado para Tour Guiado -->
  
  <!-- CSS Mobile Otimizado para Modais de Distribui√ß√£o -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/distribuicao-mobile.css') }}">
  <!-- CSS para Ajustar Posi√ß√£o do Tour Guiado no Mobile -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/tour-position-mobile.css') }}">
  <!-- CSS para Desabilitar Zoom/Pan em Gr√°ficos -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/graficos-sem-zoom.css') }}">
  <!-- CSS Mobile Otimizado para Caixas de Afinidade -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/afinidades-mobile.css') }}">
  
  <!-- üîê MODAL LOGIN/CADASTRO CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/modal-login-cadastro.css') }}">
  
  <!-- CSS do Rodap√© -->
  <style>
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .main-content {
      flex: 1;
    }
    
    .site-footer{
      background: linear-gradient(135deg, rgba(30,27,41,.95), rgba(42,35,64,.95));
      border-top: 1px solid rgba(255,255,255,0.08);
      padding: 10px 16px;
      font-size:.84rem;
      color:#cbd5e1;
      margin-top: auto;
    }
    .site-footer .footer-row{
      max-width:1200px;
      margin:0 auto;
      display:grid;
      grid-template-columns:1fr auto;
      gap:10px;
      align-items:center;
    }
    .site-footer strong{
      color:#A855F7;
      font-weight:700;
    }
    .site-footer a{
      color:#10b981;
      text-decoration:none;
      border-bottom:1px dotted rgba(16,185,129,.35);
    }
    .site-footer a:hover{
      color:#059669;
      border-bottom-color:transparent;
    }
    .footer-meta{
      opacity:.9;
    }
    .footer-toggle{
      background:transparent;
      border:1px solid rgba(168,85,247,.6);
      color:#A855F7;
      font-weight:600;
      padding:6px 10px;
      border-radius:8px;
      cursor:pointer;
      transition:transform .15s ease,background .2s,border-color .2s;
    }
    .footer-toggle:hover{
      transform:translateY(-1px);
      background:rgba(168,85,247,.1);
    }
    .footer-more{
      max-width:1200px;
      margin:8px auto 0;
      padding:10px 12px;
      background:rgba(168,85,247,.06);
      border:1px solid rgba(168,85,247,.25);
      border-radius:10px;
      line-height:1.55;
      font-size:.9rem;
    }
    @media (max-width:768px){
      .site-footer{
        padding:10px 12px;
        font-size:.8rem;
      }
      .site-footer .footer-row{
        grid-template-columns:1fr;
        gap:6px;
      }
      .footer-meta{
        font-size:.78rem;
      }
    }
    
    /* CSS do Modal */
    .footer-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .footer-modal .modal-content {
      background: linear-gradient(135deg, #1e1b29, #2a2340);
      border-radius: 15px;
      max-width: 800px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
    }
    
    .footer-modal .modal-header {
      padding: 20px 25px 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .footer-modal .modal-header h4 {
      color: #A855F7;
      font-size: 1.2rem;
      margin: 0;
    }
    
    .footer-modal .modal-close {
      background: none;
      border: none;
      color: #cbd5e1;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.2s;
    }
    
    .footer-modal .modal-close:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .footer-modal .modal-body {
      padding: 20px 25px 25px;
      color: #cbd5e1;
      line-height: 1.6;
    }
    
    .footer-modal details {
      margin: 15px 0;
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 8px;
      padding: 10px;
      background: rgba(168, 85, 247, 0.05);
    }
    
    .footer-modal details summary {
      cursor: pointer;
      padding: 8px 0;
      color: #A855F7;
      font-weight: 600;
      list-style: none;
    }
    
    .footer-modal details summary::-webkit-details-marker {
      display: none;
    }
    
    .footer-modal details summary::before {
      content: "‚ñ∂ ";
      margin-right: 8px;
      transition: transform 0.2s;
    }
    
    .footer-modal details[open] summary::before {
      transform: rotate(90deg);
    }
    
    .footer-modal details ul {
      margin: 10px 0 0 20px;
      padding: 0;
    }
    
    .footer-modal details li {
      margin: 8px 0;
      color: #e2e8f0;
    }
    
    .footer-modal a {
      color: #10b981;
      text-decoration: none;
      border-bottom: 1px dotted rgba(16, 185, 129, 0.5);
    }
    
    .footer-modal a:hover {
      color: #059669;
      border-bottom-color: transparent;
    }
    
    @media (max-width: 768px) {
      .footer-modal {
        padding: 10px;
      }
      
      .footer-modal .modal-content {
        max-height: 90vh;
      }
      
      .footer-modal .modal-header,
      .footer-modal .modal-body {
        padding: 15px 20px;
      }
      
      .footer-modal .modal-header h4 {
        font-size: 1.1rem;
      }
    }
  </style>

  <style>
    /* Moldura Neon Azul - Desktop */
    html::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      box-shadow: inset 0 0 0 4px #3B82F6, 0 0 15px #3B82F6, 0 0 30px #3B82F6;
      z-index: 9999;
      pointer-events: none;
    }

    /* Moldura Neon Azul - Mobile (mais fina) */
    @media (max-width: 768px) {
      html::before {
        box-shadow: inset 0 0 0 2px #3B82F6, 0 0 8px #3B82F6, 0 0 15px #3B82F6;
      }
    }

    /* --- AJUSTES APENAS PARA TELAS MENORES QUE 768px (CELULARES E TABLETS) --- */
    @media (max-width: 768px) {
      /* 1. T√çTULOS DOS GR√ÅFICOS PLOTLY (quebra de linha inteligente) */
      .js-plotly-plot .g-gtitle {
        font-size: 12px !important; /* Reduz ainda mais para 12px */
        text-align: left !important; /* For√ßa alinhamento √† esquerda */
        margin: 0 10px 10px !important; /* Adiciona margem lateral */
        white-space: normal !important; /* Permite quebra de linha */
        word-wrap: break-word !important; /* Quebra palavras longas */
        hyphens: auto !important; /* H√≠fens autom√°ticos */
        max-width: 100% !important; /* For√ßa largura m√°xima */
        overflow: visible !important; /* Evita truncamento */
        line-height: 1.2 !important; /* Altura de linha otimizada */
        padding: 5px 0 !important; /* Espa√ßamento vertical */
      }
      
      /* 1.1 REFOR√áO PARA T√çTULOS PLOTLY */
      .g-gtitle {
        font-size: 12px !important;
        max-width: 100% !important;
        overflow: visible !important;
        white-space: normal !important;
        word-wrap: break-word !important;
        line-height: 1.2 !important;
      }

      /* 2. T√çTULOS HTML DAS SE√á√ïES (para ficarem similares) */
      .chart-container h3 {
        font-size: 16px !important; /* Reduz de 18px para 16px */
        text-align: left !important; /* For√ßa alinhamento √† esquerda */
        margin: 0 10px 10px !important; /* Adiciona margem lateral */
      }

      /* 3. AJUSTE DE ALINHAMENTO E MARGEM DOS GR√ÅFICOS */
      .js-plotly-plot {
        margin: 0 auto !important; /* Centraliza o gr√°fico dentro do modal */
      }

      /* 4. AJUSTE PARA AS CAIXAS DE SELE√á√ÉO */
      .container-opcoes-aposta {
        display: flex;
        flex-wrap: wrap; /* Permite que os itens quebrem para a pr√≥xima linha */
        justify-content: flex-start; /* Alinha os itens √† esquerda */
        gap: 10px; /* Adiciona um espa√ßamento entre as caixas */
      }

      /* Ajuste para as caixas de sele√ß√£o individuais */
      .container-opcoes-aposta .flex {
        flex-shrink: 0; /* Impede que os itens diminuam de tamanho */
      }
      
      /* 5. CONTAINER ESPEC√çFICO PARA OP√á√ïES DE SOMA */
      .soma-opcoes-container {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 8px;
        margin-left: 24px; /* Indenta para alinhar com o checkbox */
      }
      
      .soma-opcoes-container .flex {
        flex-shrink: 0;
      }
      
      /* 6. RESPONSIVIDADE PARA TELAS MUITO PEQUENAS */
      @media (max-width: 480px) {
        .soma-opcoes-container {
          margin-left: 16px; /* Reduz indenta√ß√£o em telas muito pequenas */
        }
        
        .soma-opcoes-container input[type="number"] {
          width: 60px !important; /* Reduz largura dos inputs em mobile */
        }
      }
      
      /* 7. LOGO DA MEGA SENA - AUMENTAR APENAS NO MOBILE */
      @media (max-width: 768px) {
        /* Aumenta APENAS a logo da Mega Sena */
        .logo-mega-sena,
        .logo-megasena,
        .mega-sena-logo,
        .megasena-logo,
        img[src*="mega"],
        img[src*="Mega"],
        img[src*="MEGASENA"],
        img[src*="megasena"] {
          transform: scale(1.3) !important; /* Aumenta 30% */
          transform-origin: center !important;
        }
        
        /* Ajusta posicionamento se necess√°rio */
        .logo-mega-sena img,
        .logo-megasena img,
        .mega-sena-logo img,
        .megasena-logo img {
          margin: 0 auto !important;
        }
      }
      
      /* 8. LOGO DA MEGA SENA - AUMENTAR AINDA MAIS EM TELAS PEQUENAS */
      @media (max-width: 480px) {
        .logo-mega-sena,
        .logo-megasena,
        .mega-sena-logo,
        .megasena-logo,
        img[src*="mega"],
        img[src*="Mega"],
        img[src*="MEGASENA"],
        img[src*="megasena"] {
          transform: scale(1.5) !important; /* Aumenta 50% em telas muito pequenas */
        }
      }
    }

    /* Responsividade para smartphones - remover t√≠tulos dos eixos */
    @media (max-width: 640px) {
      .js-plotly-plot .g-gtitle {
        font-size: 14px !important;
      }
      
      /* Remover t√≠tulos dos eixos Y em smartphones */
      .js-plotly-plot .g-ytitle,
      .js-plotly-plot .g-ytitle-2 {
        display: none !important;
      }
      
      /* Ajustar margens para smartphones */
      .js-plotly-plot .plotly {
        margin-left: 20px !important;
        margin-right: 20px !important;
      }
    }
    
    /* Reduzir tamanho dos t√≠tulos dos gr√°ficos e m√≥dulos - APENAS para smartphones */
    @media (max-width: 640px) {
      .chart-container h3 {
        font-size: 14px !important;
      }
      
      .bg-dark h4 {
        font-size: 14px !important;
      }
    }
    
    /* Reduzir tamanho das fontes dos eixos do Plotly - APENAS para smartphones */
    @media (max-width: 640px) {
      .js-plotly-plot .g-xtick text,
      .js-plotly-plot .g-ytick text,
      .js-plotly-plot .g-ytick2 text,
      .js-plotly-plot .g-xtick .tick-label,
      .js-plotly-plot .g-ytick .tick-label,
      .js-plotly-plot .g-ytick2 .tick-label,
      .js-plotly-plot .g-xtick .tick-label text,
      .js-plotly-plot .g-ytick .tick-label text,
      .js-plotly-plot .g-ytick2 .tick-label text {
        font-size: 6px !important;
        font-size: 6px !important;
      }
      
      /* For√ßar tamanho da fonte para todos os elementos de texto dos eixos */
      .js-plotly-plot .g-xtick *,
      .js-plotly-plot .g-ytick *,
      .js-plotly-plot .g-ytick2 * {
        font-size: 6px !important;
      }
    }
    
    /* Cor vermelha para valores do eixo Y2 (frequ√™ncia relativa) - GLOBAL */
    .js-plotly-plot .g-ytick2 text {
      fill: red !important;
      color: red !important;
    }
    
    /* Garantir que a cor vermelha seja aplicada em todos os dispositivos */
    .js-plotly-plot .g-ytick2 text,
    .js-plotly-plot .g-ytick2 .tick text,
    .js-plotly-plot .g-ytick2 .tick-label text,
    .js-plotly-plot .g-ytick2 .tick-label,
    
    /* Estilos para a matriz visual */
    .matriz-container {
      display: flex;
      flex-direction: column;
      gap: 1px; /* Reduzido de 2px para 1px - linhas ainda mais pr√≥ximas */
      margin-top: 20px;
      /* Container com tamanho fixo para manter scrollbars sempre vis√≠veis */
      width: 100%;
      height: 650px; /* Altura para mostrar 25+ concursos simultaneamente */
      overflow: auto; /* Permite scroll vertical e horizontal */
      white-space: nowrap; /* Impede que o texto ou elementos dentro do flexbox quebrem */
      /* Melhorias visuais */
      border: 2px solid #2E303A;
      border-radius: 8px;
      background-color: rgba(255, 255, 255, 0.02);
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
      /* Garantir que as scrollbars sejam sempre vis√≠veis */
      scrollbar-width: thin; /* Firefox */
      scrollbar-color: #00E38C #2E303A; /* Firefox - thumb e track */
    }

    /* Estiliza√ß√£o das scrollbars para Webkit (Chrome, Safari, Edge) */
    .matriz-container::-webkit-scrollbar {
      width: 12px; /* Largura da scrollbar vertical */
      height: 12px; /* Altura da scrollbar horizontal */
    }

    .matriz-container::-webkit-scrollbar-track {
      background: #2E303A; /* Cor do fundo da scrollbar */
      border-radius: 6px;
    }

    .matriz-container::-webkit-scrollbar-thumb {
      background: #00E38C; /* Cor da scrollbar (verde) */
      border-radius: 6px;
      border: 2px solid #2E303A;
    }

    .matriz-container::-webkit-scrollbar-thumb:hover {
      background: #00C973; /* Cor mais escura no hover */
    }

    /* Scrollbar horizontal espec√≠fica */
    .matriz-container::-webkit-scrollbar:horizontal {
      height: 12px;
    }

    /* Solu√ß√£o espec√≠fica para mobile - scroll horizontal */
    @media (max-width: 768px) {
      .matriz-container {
        height: 600px; /* Altura para mostrar 25+ concursos no mobile */
        -webkit-overflow-scrolling: touch; /* Scroll suave no iOS */
        scroll-behavior: smooth; /* Scroll suave */
        /* Scroll em todas as dire√ß√µes */
        overflow: auto;
        /* Remove padding que pode interferir no scroll */
        padding-left: 0;
        padding-right: 0;
        /* Scrollbars mais finas no mobile */
        scrollbar-width: thin;
      }
      
      /* Scrollbars menores no mobile */
      .matriz-container::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      
      /* Garante que as linhas n√£o quebrem no mobile */
      .linha-concurso {
        min-width: max-content; /* For√ßa largura m√≠nima baseada no conte√∫do */
        width: max-content; /* Garante que a linha ocupe todo o espa√ßo necess√°rio */
      }
      
      /* C√©lulas com tamanho fixo no mobile */
      .celula-numero {
        flex-shrink: 0 !important;
        min-width: 20px !important; /* Ligeiramente menor no mobile */
        max-width: 20px !important;
        height: 20px !important;
        font-size: 8px !important;
      }
    }



    .linha-concurso {
      display: flex; /* Mant√©m as c√©lulas lado a lado */
      gap: 3px;
      padding: 1px 0; /* Reduzido de 2px para 1px - menos espa√ßo interno */
      flex-shrink: 0; /* Para garantir que n√£o haja encolhimento das c√©lulas */
      /* Melhorias para muitos concursos */
      border-bottom: 1px solid rgba(255, 255, 255, 0.03); /* Linha mais sutil */
      transition: background-color 0.2s ease; /* Transi√ß√£o suave */
    }

    /* Hover effect para melhor identifica√ß√£o das linhas */
    .linha-concurso:hover {
      background-color: rgba(0, 227, 140, 0.05); /* Verde sutil no hover */
    }

    /* Altern√¢ncia de cores para melhor visualiza√ß√£o */
    .linha-concurso:nth-child(even) {
      background-color: rgba(255, 255, 255, 0.01);
    }

    /* Estilo para o indicador de concursos */
    .matriz-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding: 8px 12px;
      background-color: rgba(46, 48, 58, 0.5);
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .matriz-navigation-hint {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }

    /* Mobile: dicas em linha √∫nica */
    @media (max-width: 768px) {
      .matriz-navigation-hint {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
    }

    /* CSS para o container do gr√°fico de frequ√™ncia */
    .grafico-frequencia-container {
      width: 100% !important; /* Ocupa 100% da largura do container pai */
      height: 400px; /* Altura fixa para o gr√°fico */
      min-width: 100%; /* Garante largura m√≠nima */
      /* Remover qualquer padding horizontal que possa ter sido adicionado */
      padding-left: 0px !important;
      padding-right: 0px !important;
    }

    /* Otimiza√ß√£o para Mobile - M√°xima Expans√£o Horizontal */
    @media (max-width: 768px) {
      .grafico-frequencia-container {
        height: 300px; /* Altura menor em mobile */
        width: 100% !important; /* Garante que ocupe toda a largura */
        padding-left: 0px !important;
        padding-right: 0px !important;
      }
      
      /* Ajuste agressivo do modal para mobile - Quase 100% da largura */
      .modal-content {
        width: 98% !important; /* Quase 100% da largura do viewport */
        max-width: 98% !important; /* Garante que n√£o haja limite de largura */
        margin: 2% auto !important; /* Reduz margem superior/inferior para ocupar mais tela */
        /* Reduzir drasticamente os paddings laterais */
        padding-left: 10px !important; 
        padding-right: 10px !important;
        /* Manter padding vertical se necess√°rio */
        padding-top: 20px !important;
        padding-bottom: 20px !important;
      }

      /* Se tiver um .modal-body dentro do modal-content, tamb√©m remover paddings */
      .modal-body {
        padding-left: 0px !important;
        padding-right: 0px !important;
      }
    }

    .celula-numero {
      font-size: 9px !important;
      font-family: 'Inter', sans-serif;
      line-height: 22px;
      text-align: center;
      min-width: 22px;
      max-width: 22px;
      height: 22px;
      border-radius: 4px;
      background-color: #222;
      color: #eee;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-shrink: 0; /* IMPEDE QUE A C√âLULA ENCOLHA */
    }

    .celula-numero.sorteado {
      background-color: #00E38C;
      color: #1A1D25;
      font-weight: bold;
    }

    .celula-numero.trevo.sorteado {
      background-color: #8B5CF6;
      color: white;
      font-weight: bold;
    }

    /* For√ßa total para sobrescrever estilos globais */
    /* Desktop */
    .celula-numero {
      font-size: 9px !important;
    }

    /* Mobile */
    @media (max-width: 768px) {
      .celula-numero {
        font-size: 8px !important;
      }
    }
    .js-plotly-plot .g-ytick2 .tick,
    .js-plotly-plot .g-ytick2 .tick text,
    .js-plotly-plot .g-ytick2 .tick-label text {
      fill: red !important;
      color: red !important;
      stroke: red !important;
    }
    
    /* For√ßar cor vermelha para todos os elementos do eixo Y2 */
    .js-plotly-plot .g-ytick2 * {
      fill: red !important;
      color: red !important;
    }
    
    /* Reduzir altura dos gr√°ficos para 70% - APENAS para smartphones */
    @media (max-width: 640px) {
      .chart-container div[id^="grafico"] {
        height: 280px !important;
      }
    }

    /* Otimiza√ß√µes espec√≠ficas para Samsung S20 e smartphones similares */
    @media (max-width: 768px) {
      /* Garantir que o gr√°fico ocupe toda a largura dispon√≠vel */
      #grafico-frequencia {
        width: 100% !important;
        min-width: 100% !important;
        max-width: 100% !important;
      }
      
      /* Remover qualquer padding que possa estar limitando a largura */
      .chart-container {
        padding-left: 0px !important;
        padding-right: 0px !important;
      }
      
      /* Otimizar o container do gr√°fico para m√°xima expans√£o */
      .grafico-frequencia-container {
        width: 100% !important;
        min-width: 100% !important;
        max-width: 100% !important;
        padding: 0px !important;
        margin: 0px !important;
      }
    }

    /* Estilos para os menus responsivos */
    /* Menu Desktop - +MILION√ÅRIA */
    .desktop-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, rgba(30, 27, 41, 0.95) 0%, rgba(42, 35, 64, 0.95) 100%);
      backdrop-filter: blur(10px);
      border-bottom: 3px solid #3B82F6;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
      z-index: 1000;
      padding: 1rem 2rem;
      display: flex;
      justify-content: flex-end;
      align-items: center;
    }

    .desktop-nav .logo {
      max-width: 150px;
      height: auto;
    }

    .desktop-nav-links {
      display: flex;
      gap: 2rem;
      align-items: center;
    }

    .desktop-nav-links a {
      color: #ffffff;
      text-decoration: none;
      font-size: 0.875rem; /* PADR√ÉO: 14px para todos os menus */
      font-weight: 500;
      transition: all 0.3s ease;
      padding: 0.5rem 1rem;
      border-radius: 6px;
    }

    .desktop-nav-links a:hover {
      color: #A855F7;
      background: rgba(168, 85, 247, 0.1);
      transform: translateY(-1px);
    }

    /* Estilo para destacar a p√°gina atual */
    .desktop-nav-links a.active {
      color: #00E38C !important;
      background: rgba(0, 227, 140, 0.15) !important;
      border: 1px solid rgba(0, 227, 140, 0.3) !important;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 227, 140, 0.2);
    }

    .desktop-nav-links a.active:hover {
      color: #00E38C !important;
      background: rgba(0, 227, 140, 0.2) !important;
    }

    /* Esconder menu desktop em mobile */
    @media (max-width: 768px) {
      .desktop-nav {
        display: none;
      }
    }

    /* Mostrar menu desktop em telas maiores */
    @media (min-width: 769px) {
      .desktop-nav {
        display: flex;
      }
    }

    /* Ajuste de espa√ßamento para telas menores */
    @media (max-width: 1200px) {
      .desktop-nav-links {
        gap: 1.5rem; /* 24px */
      }
    }

    @media (max-width: 1000px) {
      .desktop-nav-links {
        gap: 1.25rem; /* 20px */
      }
    }

    @media (max-width: 900px) {
      .desktop-nav-links {
        gap: 1rem; /* 16px */
      }
    }

    @media (max-width: 800px) {
      .desktop-nav-links {
        gap: 0.75rem; /* 12px - limite m√≠nimo */
      }
    }

    /* Estilos para o menu hamb√∫rguer */
    .hamburger-menu {
      position: fixed;
      top: 1.5rem;
      left: 1.5rem;
      z-index: 1000;
      display: none;
      background: rgba(0, 0, 0, 0.8);
      border-radius: 8px;
      padding: 8px;
    }

         .hamburger-icon {
       width: 30px;
       height: 25px;
       display: flex;
       flex-direction: column;
       justify-content: space-between;
       cursor: pointer;
       /* ‚ö° NOVO: Borda/contorno no √≠cone hamb√∫rguer */
       border: 2px solid rgba(168, 85, 247, 0.6);
       border-radius: 6px;
       padding: 4px;
       background: rgba(0, 0, 0, 0.3);
       backdrop-filter: blur(5px);
     }

    .hamburger-icon span {
      display: block;
      width: 100%;
      height: 3px;
      background-color: #A855F7;
      border-radius: 3px;
      transition: all 0.3s ease;
    }

    .hamburger-icon.open span:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }

    .hamburger-icon.open span:nth-child(2) {
      opacity: 0;
    }

    .hamburger-icon.open span:nth-child(3) {
      transform: rotate(-45deg) translate(5px, -5px);
    }

    /* Sidebar deslizante */
    .nav-panel {
      position: fixed;
      top: 0;
      left: -280px;
      width: 280px;
      height: 100%;
      background: linear-gradient(135deg, #1a1a1a 0%, #2d1b69 100%);
      display: flex;
      flex-direction: column;
      transition: left 0.3s ease-in-out;
      z-index: 999;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
      border-right: 1px solid rgba(168, 85, 247, 0.2);
    }

    .nav-panel.open {
      left: 0;
    }

    /* Header do sidebar */
    .nav-header {
      padding: 20px 25px;
      border-bottom: 1px solid rgba(168, 85, 247, 0.2);
      text-align: center;
      background: rgba(168, 85, 247, 0.05);
    }

    .nav-logo {
      width: 120px;
      height: auto;
      margin-bottom: 10px;
    }

    .nav-header h3 {
      color: #A855F7;
      margin: 0;
      font-size: 1rem; /* ‚ö° PADR√ÉO LANDING: mais compacto e profissional */
      font-weight: 600;
    }

    .nav-panel ul {
      list-style: none;
      padding: 0;
      margin: 0;
      text-align: left;
    }

    .nav-panel li {
      margin: 0;
      border-bottom: 1px solid rgba(168, 85, 247, 0.1);
    }

    .nav-panel a {
      color: #ffffff;
      text-decoration: none;
      font-size: 0.95rem; /* ‚ö° PADR√ÉO LANDING: mais compacto e profissional */
      font-weight: 500;
      transition: all 0.3s ease;
      padding: 20px 25px;
      display: block;
      border-left: 3px solid transparent;
    }

    .nav-panel a:hover {
      color: #A855F7;
      background: rgba(168, 85, 247, 0.1);
      border-left-color: #A855F7;
    }

    /* Estilo para destacar a p√°gina atual no menu mobile */
    .nav-panel a.active {
      color: #00E38C !important;
      background: rgba(0, 227, 140, 0.15) !important;
      border-left-color: #00E38C !important;
      box-shadow: 0 2px 8px rgba(0, 227, 140, 0.2);
    }

    .nav-panel a.active:hover {
      color: #00E38C !important;
      background: rgba(0, 227, 140, 0.2) !important;
    }

    /* Estilos para submenu dropdown */
    .dropdown {
      position: relative;
    }

                    .dropdown-content {
                    display: none;
                    position: absolute;
                    left: 100%;
                    top: 0;
                    background: #2a2a3e;
                    min-width: 200px;
                    box-shadow: 0 12px 24px rgba(0,0,0,0.5), 0 4px 8px rgba(168, 85, 247, 0.2);
                    border-radius: 8px;
                    z-index: 1000;
                    border: 2px solid rgba(168, 85, 247, 0.6);
                }

    .dropdown-content a {
      color: #e2e8f0;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      border-left: 3px solid transparent;
      transition: all 0.3s ease;
      font-size: 0.875rem; /* PADR√ÉO: 14px para todos os submenus */
    }

    .dropdown-content a:hover {
      color: #A855F7;
      background: rgba(168, 85, 247, 0.1);
      border-left-color: #A855F7;
    }

    .dropdown-content a.active {
      color: #00E38C !important;
      background: rgba(0, 227, 140, 0.15) !important;
      border-left-color: #00E38C !important;
    }

    .dropdown:hover .dropdown-content {
      display: block;
    }

    /* Submenu para mobile */
    .mobile-dropdown {
      display: none;
      background: rgba(168, 85, 247, 0.05);
      border-left: 3px solid rgba(168, 85, 247, 0.3);
      margin-left: 20px;
    }

    .mobile-dropdown.show {
      display: block;
    }

    .mobile-dropdown a {
      padding: 10px 20px 10px 40px;
      font-size: 0.875rem; /* ‚ö° PADR√ÉO LANDING: mais compacto e profissional */
      color: #cbd5e1;
    }

    .mobile-dropdown a:hover {
      color: #A855F7;
      background: rgba(168, 85, 247, 0.1);
    }

    .mobile-dropdown a.active {
      color: #00E38C !important;
      background: rgba(0, 227, 140, 0.15) !important;
    }

    /* Estilos para Breadcrumbs */
    .breadcrumbs-container {
      background: linear-gradient(135deg, rgba(168, 85, 247, 0.05) 0%, rgba(0, 227, 140, 0.05) 100%);
      border-bottom: 1px solid rgba(168, 85, 247, 0.2);
      padding: 8px 0;
      margin-bottom: 20px;
    }
    
    .breadcrumbs {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .breadcrumb-list {
      display: flex;
      align-items: center;
      list-style: none;
      margin: 0;
      padding: 0;
      font-size: 0.9rem;
    }
    
    .breadcrumb-item {
      display: flex;
      align-items: center;
      color: #94a3b8;
    }
    
    .breadcrumb-item:not(:last-child)::after {
      content: "‚Ä∫";
      margin: 0 8px;
      color: #64748b;
      font-weight: bold;
    }
    
    .breadcrumb-link {
      color: #cbd5e1;
      text-decoration: none;
      padding: 4px 8px;
      border-radius: 4px;
      transition: all 0.3s ease;
      font-weight: 500;
    }
    
    .breadcrumb-item:not(.active) .breadcrumb-link:hover {
      color: #A855F7;
      background: rgba(168, 85, 247, 0.1);
    }
    
    .breadcrumb-item.active .breadcrumb-link {
      color: #00E38C;
      font-weight: 600;
    }
    
    /* Responsividade para breadcrumbs */
    @media (max-width: 768px) {
      .breadcrumbs-container {
        padding: 6px 0;
        margin-bottom: 15px;
      }
      
      .breadcrumbs {
        padding: 0 15px;
      }
      
      .breadcrumb-list {
        font-size: 0.85rem;
      }
      
      .breadcrumb-item:not(:last-child)::after {
        margin: 0 6px;
      }
    }

    /* Overlay para escurecer o fundo */
    .nav-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      z-index: 998;
    }

    .nav-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    /* Mostrar menu hamb√∫rguer em mobile */
    @media (max-width: 768px) {
      .hamburger-menu {
        display: block;
      }
    }

    /* Ajuste do padding do body para o menu desktop */
    body {
      padding-top: 80px !important;
    }

    @media (max-width: 768px) {
      body {
        padding-top: 1rem !important;
      }
    }

    /* Auto-ajuste centralizado da imagem da +Milion√°ria */
    .milionaria-logo-container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      position: relative;
    }
    
    .milionaria-logo {
      max-width: 240px;
      min-width: 96px;
      height: auto;
      object-fit: contain;
      display: block;
      margin: 0 auto;
      margin-left: 15px !important;
      margin-bottom: -8px;
      transition: all 0.3s ease;
      vertical-align: bottom;
      transform: translateX(15px);
    }
    
    /* Responsividade total para mobile e tablet */
    @media (max-width: 640px) {
      .milionaria-logo {
        max-width: 144px;
        min-width: 72px;
        height: 58px;
      }
    }
    
    @media (min-width: 641px) and (max-width: 768px) {
      .milionaria-logo {
        max-width: 180px;
        min-width: 84px;
        height: 77px;
      }
    }
    
    @media (min-width: 769px) and (max-width: 1024px) {
      .milionaria-logo {
        max-width: 216px;
        min-width: 96px;
        height: 96px;
      }
    }
    
    @media (min-width: 1025px) {
      .milionaria-logo {
        max-width: 240px;
        min-width: 120px;
        height: 115px;
      }
    }

    /* MOBILE: tira o excesso no topo */
    @media (max-width: 768px){
      body { padding-top: 0 !important; }
      .breadcrumbs-container { margin-top: 6px; }
    }

    /* GRID responsivo para Top 15 afinidades */
    .afinidades-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap:12px;
    }

    @media (max-width: 768px){
      .afinidades-grid{ grid-template-columns: repeat(2, 1fr); gap:10px; }
    }
    @media (max-width: 420px){
      .afinidades-grid{ gap:8px; }
    }

    /* CARD compacto */
    .afinidade-card{
      background: linear-gradient(180deg, #0c3b2e, #0f5132);
      border:1px solid #27c499;
      color:#e8fff6;
      border-radius:14px;
      display:grid;
      grid-template-columns: 1fr auto; /* info | score */
      align-items:center;
      gap:8px;
      padding:12px 12px;
      -webkit-tap-highlight-color:transparent;
      will-change:transform;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .afinidade-card:active{ transform: scale(.98); }

    .afinidade-card .info{ min-width:0; display:grid; gap:2px; }
    .afinidade-card .par{ font-weight:800; letter-spacing:.2px; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }
    .afinidade-card .sub{ color:#c5f6e5; opacity:.85; }

    .afinidade-card .score{ font-weight:800; text-align:right; padding-left:8px; }

    .afinidade-card .chips{ display:inline-flex; gap:6px; }
    .afinidade-card .chip{
      width:28px; height:28px; display:inline-flex; align-items:center; justify-content:center;
      border-radius:8px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.14); font-weight:700;
    }

    /* Tipografia responsiva */
    .afinidade-card .par   { font-size: clamp(14px, 3.2vw, 18px); }
    .afinidade-card .score { font-size: clamp(13px, 3.0vw, 16px); }
    .afinidade-card .sub   { font-size: clamp(11px, 2.7vw, 13px); }

    @media (max-width: 768px){
      .afinidade-card{ padding:10px 10px; border-radius:12px; }
    }
    @media (max-width: 420px){
      .afinidade-card{ padding:9px 10px; }
      .afinidade-card .chip{ width:26px; height:26px; }
    }

    /* Seguran√ßa extra: nada estoura altura por texto longo */
    .afinidade-card .par,
    .afinidade-card .sub{
      min-width:0; overflow:hidden; white-space:nowrap; text-overflow:ellipsis;
    }
  </style>

  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
</head>
<body class="p-4 sm:p-6">
  <div class="main-content">
  {% if is_logged_in %}
  <!-- Indicador Visual de Status de Login (apenas para usu√°rios logados) -->
  <div style="position: fixed; top: 45px; left: 15px; background: #10B981; color: white; padding: 8px 12px; z-index: 10001; font-size: 14px; font-weight: bold; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); border: 2px solid white;">
    üîì LOGGED IN
  </div>
  {% endif %}
  
  <!-- Menu Desktop -->
  <nav class="desktop-nav">
    <div class="desktop-nav-links">
      <a href="/"><i class="fa fa-home"></i> In√≠cio</a>
      <div class="dropdown">
        <a href="#" class="dropdown-toggle active"><i class="fa fa-diamond"></i> +Milion√°ria ‚ñº</a>
        <div class="dropdown-content">
          <a href="/dashboard"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
          <a href="/aposta_inteligente_premium" class="active"><i class="fa fa-chart-line"></i> Intelig√™ncia Estat√≠stica</a>
        </div>
      </div>
      <div class="dropdown">
        <a href="#" class="dropdown-toggle"><i class="fa fa-bullseye"></i> Mega Sena ‚ñº</a>
        <div class="dropdown-content">
          <a href="/dashboard_MS"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
          <a href="/aposta_inteligente_premium_MS"><i class="fa fa-chart-line"></i> Intelig√™ncia Estat√≠stica</a>
        </div>
      </div>
      <div class="dropdown">
        <a href="#" class="dropdown-toggle"><i class="fa fa-hashtag"></i> Quina ‚ñº</a>
        <div class="dropdown-content">
          <a href="/dashboard_quina"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
          <a href="/aposta_inteligente_premium_quina"><i class="fa fa-chart-line"></i> Intelig√™ncia Estat√≠stica</a>
        </div>
      </div>
      <div class="dropdown">
        <a href="#" class="dropdown-toggle"><i class="fa fa-circle"></i> Lotomania ‚ñº</a>
        <div class="dropdown-content">
          <a href="/dashboard_lotomania"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
        </div>
      </div>
      <div class="dropdown">
        <a href="#" class="dropdown-toggle"><i class="fa fa-dice"></i> Lotof√°cil ‚ñº</a>
        <div class="dropdown-content">
          <a href="/dashboard_lotofacil"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
          <a href="/aposta_inteligente_premium_lotofacil"><i class="fa fa-chart-line"></i> Intelig√™ncia Estat√≠stica</a>
          <a href="/lotofacil_laboratorio"><i class="fa fa-flask"></i> Laborat√≥rio de Simula√ß√£o</a>
        </div>
      </div>
      <a href="/boloes_loterias"><i class="fa fa-users"></i> Bol√µes</a>
    </div>
  </nav>

  <!-- Menu Mobile (Hamb√∫rguer) -->
  <div class="hamburger-menu">
    <div class="hamburger-icon" id="hamburgerIcon">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>

  <!-- Overlay para escurecer o fundo -->
  <div class="nav-overlay" id="navOverlay"></div>

  <!-- Sidebar deslizante -->
  <nav class="nav-panel" id="navPanel">
    <div class="nav-header">
      <img src="/static/img/Logo_LoteriasIntelitente.png" alt="Logo" class="nav-logo">
      <h3>Menu</h3>
    </div>
    <ul>
      <li><a href="/"><i class="fa fa-home"></i> In√≠cio</a></li>
              <li>
          <a href="#" class="mobile-dropdown-toggle active"><i class="fa fa-diamond"></i> +Milion√°ria ‚ñº</a>
          <div class="mobile-dropdown">
            <a href="/dashboard"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
            <a href="/aposta_inteligente_premium" class="active"><i class="fa fa-chart-line"></i> Intelig√™ncia Estat√≠stica</a>
          </div>
        </li>
        <li>
          <a href="#" class="mobile-dropdown-toggle"><i class="fa fa-bullseye"></i> Mega Sena ‚ñº</a>
          <div class="mobile-dropdown">
            <a href="/dashboard_MS"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
            <a href="/aposta_inteligente_premium_MS"><i class="fa fa-chart-line"></i> Intelig√™ncia Estat√≠stica</a>
          </div>
        </li>
        <li>
          <a href="#" class="mobile-dropdown-toggle"><i class="fa fa-hashtag"></i> Quina ‚ñº</a>
          <div class="mobile-dropdown">
            <a href="/dashboard_quina"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
            <a href="/aposta_inteligente_premium_quina"><i class="fa fa-chart-line"></i> Intelig√™ncia Estat√≠stica</a>
          </div>
        </li>
        <li>
          <a href="#" class="mobile-dropdown-toggle"><i class="fa fa-circle"></i> Lotomania ‚ñº</a>
          <div class="mobile-dropdown">
            <a href="/dashboard_lotomania"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
          </div>
        </li>
        <li>
                  <a href="#" class="mobile-dropdown-toggle"><i class="fa fa-dice"></i> Lotof√°cil ‚ñº</a>
        <div class="mobile-dropdown">
          <a href="/dashboard_lotofacil"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
          <a href="/aposta_inteligente_premium_lotofacil"><i class="fa fa-chart-line"></i> Intelig√™ncia Estat√≠stica</a>
          <a href="/lotofacil_laboratorio"><i class="fa fa-flask"></i> Laborat√≥rio de Simula√ß√£o</a>
        </div>
        </li>
                      <li><a href="/boloes_loterias"><i class="fa fa-users"></i> Bol√µes</a></li>
    </ul>
  </nav>

                  <!-- Breadcrumbs -->
                <div class="breadcrumbs-container">
                    <nav class="breadcrumbs" aria-label="Breadcrumb">
                        <ol class="breadcrumb-list">
                            <li class="breadcrumb-item">
                                <a href="#" class="breadcrumb-link">üí∞ +Milion√°ria</a>
                            </li>
                            <li class="breadcrumb-item active">
                                <span class="breadcrumb-link">üìä Intelig√™ncia Estat√≠stica</span>
                            </li>
                        </ol>
                    </nav>
                </div>

  <!-- Header -->
  <header class="flex justify-between items-center mb-8">
    <!-- T√≠tulo deslocado para a direita -->
    <div class="flex-1 text-center milionaria-logo-container">
      <h1 class="text-2xl sm:text-3xl font-bold text-white mb-2 flex justify-center items-center">
        <img src="/static/img/Milionaria.png" alt="+Milion√°ria" class="milionaria-logo">
      </h1>
    </div>
    
    <!-- Logo no lado direito -->
    <div class="flex justify-end items-center">
      <img src="/static/img/Logo_LoteriasIntelitente.png" alt="Logo Loterias Inteligente" class="max-w-[120px] sm:max-w-[150px] md:max-w-[180px]">
    </div>
  </header>

  <!-- Conte√∫do Premium ser√° adicionado aqui -->
  <div class="container mx-auto">
            <h2 class="text-2xl font-bold text-[#3B82F6] mb-6 text-center">üéØ Aposta Inteligente Premium - +Milion√°ria</h2>
    
    <!-- Conte√∫do ser√° adicionado posteriormente -->
    <div class="bg-[#1A1D25] p-8 rounded-2xl shadow-md" style="border: 1px solid #3B82F6; box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.2), inset 0 0 0 1px rgba(59, 130, 246, 0.1), 0 0 20px rgba(59, 130, 246, 0.15);">
      <div class="bloco-texto-aposta">
        <p class="texto-desktop">
          Com a Aposta Inteligente Premium, voc√™ vai al√©m da sorte: voc√™ define os par√¢metros, analisa os dados reais e usa intelig√™ncia estat√≠stica e sistema de pesos computacionais para gerar apostas fundamentadas. üéØ Configure filtros, selecione padr√µes e use suas pr√≥prias decis√µes estrat√©gicas para orientar o sistema de an√°lise estat√≠stica. O controle est√° nas suas m√£os ‚Äî com o apoio da tecnologia de dados reais.
        </p>
        <p class="texto-mobile">
          Configure filtros, selecione padr√µes e use suas pr√≥prias decis√µes estrat√©gicas para orientar o sistema. O controle est√° nas suas m√£os ‚Äî com apoio dos dados reais.
        </p>
      </div>
    </div>
    
    <!-- Bloco Explicativo com Passo a Passo -->
    <div class="mt-8 bg-[#1D1D25] p-6 rounded-2xl shadow-md" style="border: 1px solid #3B82F6; box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.2), inset 0 0 0 1px rgba(59, 130, 246, 0.1), 0 0 20px rgba(59, 130, 246, 0.15);">
      <h3 class="text-xl font-bold text-white mb-6 text-center">üìò Como usar a aposta inteligente:</h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Passo 1: Frequ√™ncia -->
        <div id="passo1" class="bg-[#2E303A] p-4 rounded-xl">
          <div class="flex items-center mb-3">
            <span class="bg-[#00E38C] text-black font-bold px-3 py-1 rounded-full text-sm mr-3">Passo 1</span>
            <h4 class="text-lg font-semibold" style="color: #3B82F6;">Descubra os N√∫meros Mais Sorteados</h4>
          </div>
          <p class="text-gray-300 text-sm mb-3">Veja os n√∫meros que mais saem e use essa informa√ß√£o no seu jogo.</p>
                                     <button class="bg-gradient-to-r from-[#00E38C] to-[#3B82F6] text-black font-semibold px-4 py-2 rounded-lg hover:from-[#00C973] hover:to-[#2563EB] hover:scale-105 hover:shadow-xl hover:shadow-[#00E38C]/50 transition-all duration-300 text-sm w-full transform" onclick="abrirModal('frequencia')">
                             üîç An√°lise Frequ√™ncia
                           </button>
        </div>

        <!-- Passo 2: Distribui√ß√£o -->
        <div id="passo2" class="bg-[#2E303A] p-4 rounded-xl">
          <div class="flex items-center mb-3">
            <span class="bg-[#00E38C] text-black font-bold px-3 py-1 rounded-full text-sm mr-3">Passo 2</span>
            <h4 class="text-lg font-semibold" style="color: #3B82F6;">Entenda Como os N√∫meros se Distribuem</h4>
          </div>
          <p class="text-gray-300 text-sm mb-3">Entenda como os n√∫meros se espalham entre grupos e padr√µes.</p>
                                     <button class="bg-gradient-to-r from-[#00E38C] to-[#3B82F6] text-black font-semibold px-4 py-2 rounded-lg hover:from-[#00C973] hover:to-[#2563EB] hover:scale-105 hover:shadow-xl hover:shadow-[#00E38C]/50 transition-all duration-300 text-sm w-full transform" onclick="abrirModal('distribuicao')">
                             üìä An√°lise Distribui√ß√£o
                           </button>
        </div>

        <!-- Passo 3: Afinidades -->
        <div id="passo3" class="bg-[#2E303A] p-4 rounded-xl">
          <div class="flex items-center mb-3">
            <span class="bg-[#00E38C] text-black font-bold px-3 py-1 rounded-full text-sm mr-3">Passo 3</span>
            <h4 class="text-lg font-semibold" style="color: #3B82F6;">Encontre Combina√ß√µes que Saem Juntas</h4>
          </div>
          <p class="text-gray-300 text-sm mb-3">Descubra combina√ß√µes que costumam sair juntas.</p>
          <button class="bg-gradient-to-r from-[#00E38C] to-[#3B82F6] text-black font-semibold px-4 py-2 rounded-lg hover:from-[#00C973] hover:to-[#2563EB] hover:scale-105 hover:shadow-xl hover:shadow-[#00E38C]/50 transition-all duration-300 text-sm w-full transform" onclick="abrirModal('afinidades')">
            üîó An√°lise Afinidades
          </button>
        </div>

        <!-- Passo 4: Trevos -->
        <div id="passo4" class="bg-[#2E303A] p-4 rounded-xl">
          <div class="flex items-center mb-3">
            <span class="bg-[#00E38C] text-black font-bold px-3 py-1 rounded-full text-sm mr-3">Passo 4</span>
            <h4 class="text-lg font-semibold" style="color: #3B82F6;">Analise os Trevos da Sorte</h4>
          </div>
          <p class="text-gray-300 text-sm mb-3">Veja os trevos com maior frequ√™ncia e distribui√ß√£o.</p>
          <button class="bg-gradient-to-r from-[#00E38C] to-[#3B82F6] text-black font-semibold px-4 py-2 rounded-lg hover:from-[#00C973] hover:to-[#2563EB] hover:scale-105 hover:shadow-xl hover:shadow-[#00E38C]/50 transition-all duration-300 text-sm w-full transform" onclick="abrirModal('trevos')">
            üçÄ An√°lise Trevos
          </button>
        </div>

        <!-- Passo 5: Seca -->
        <div id="passo5" class="bg-[#2E303A] p-4 rounded-xl">
          <div class="flex items-center mb-3">
            <span class="bg-[#00E38C] text-black font-bold px-3 py-1 rounded-full text-sm mr-3">Passo 5</span>
            <h4 class="text-lg font-semibold" style="color: #3B82F6;">Identifique N√∫meros que N√£o Saem</h4>
          </div>
          <p class="text-gray-300 text-sm mb-3">Evite n√∫meros que est√£o h√° muito tempo sem sair.</p>
          <button class="bg-gradient-to-r from-[#00E38C] to-[#3B82F6] text-black font-semibold px-4 py-2 rounded-lg hover:from-[#00C973] hover:to-[#2563EB] hover:scale-105 hover:shadow-xl hover:shadow-[#00E38C]/50 transition-all duration-300 text-sm w-full transform" onclick="abrirModal('seca')">
            üö´ An√°lise Seca
          </button>
        </div>

        <!-- Passo 6: Estat√≠sticas Avan√ßadas -->
        <div class="bg-[#2E303A] p-4 rounded-xl">
          <div class="flex items-center mb-3">
            <span class="bg-[#00E38C] text-black font-bold px-3 py-1 rounded-full text-sm mr-3">Passo 6</span>
            <h4 class="text-lg font-semibold" style="color: #3B82F6;">Estat√≠stica Avan√ßada para Padr√µes Ocultos</h4>
          </div>
          <p class="text-gray-300 text-sm mb-3">Explore correla√ß√µes, padr√µes ocultos e tend√™ncias com an√°lise estat√≠stica avan√ßada.</p>
                     <button class="bg-gradient-to-r from-[#00E38C] to-[#3B82F6] text-black font-semibold px-4 py-2 rounded-lg hover:from-[#00C973] hover:to-[#2563EB] hover:scale-105 hover:shadow-xl hover:shadow-[#00E38C]/50 transition-all duration-300 text-sm w-full transform" onclick="abrirModal('estatisticas')">
             ü§ñ An√°lise Avan√ßada
           </button>
        </div>
      </div>
    </div>
    
    <!-- Bot√£o principal do Machine Learning - NO FINAL -->
    <div id="passo6" class="mt-8 text-center">
      <div class="flex items-center justify-center space-x-4 mb-4">
        <div class="bg-gradient-to-r from-[#00E38C] to-[#3B82F6] p-1 rounded-xl inline-block">
          <button class="bg-gradient-to-r from-[#00E38C] to-[#3B82F6] text-black font-bold px-8 py-4 rounded-lg hover:from-[#00C973] hover:to-[#2563EB] hover:scale-105 hover:shadow-2xl hover:shadow-[#00E38C]/50 transition-all duration-300 text-lg transform" id="abrir-modal-premium">
            üéØ Gerar Aposta Inteligente (Premium)
          </button>
        </div>
        
        <!-- Bot√£o de Informa√ß√µes -->
        <button class="bg-gray-600 hover:bg-gray-700 text-white p-3 rounded-full transition-all duration-300 hover:scale-110" 
                onclick="toggleInfoPopup()" 
                title="Como funciona a Aposta Inteligente Premium">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </button>
      </div>
      
      <p class="text-gray-400 text-sm mt-3">Ap√≥s configurar suas prefer√™ncias, clique aqui para gerar apostas com Inteligencia Estat√≠stica</p>
    </div>
    
    <!-- Popup de Informa√ß√µes -->
    <div id="info-popup" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
      <div class="bg-gray-800 rounded-xl p-6 max-w-4xl max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-white">üéØ Como Funciona a Aposta Inteligente Premium</h2>
          <button onclick="toggleInfoPopup()" class="text-gray-400 hover:text-white text-2xl font-bold">&times;</button>
        </div>
        
        <div class="space-y-6 text-gray-300">
          <div class="bg-gray-700 p-4 rounded-lg">
            <h3 class="text-xl font-semibold text-white mb-3">üìä Fundamentos Matem√°ticos</h3>
            <p class="mb-3">Nossa tecnologia utiliza <strong>an√°lise estat√≠stica avan√ßada</strong> combinada com <strong>algoritmos de machine learning</strong> para identificar padr√µes ocultos nos resultados hist√≥ricos das loterias.</p>
            <p class="mb-3">‚Ä¢ <strong>Probabilidade Condicional:</strong> Calculamos P(n√∫mero|contexto) baseado em sequ√™ncias hist√≥ricas</p>
            <p class="mb-3">‚Ä¢ <strong>An√°lise de Correla√ß√£o:</strong> Identificamos n√∫meros que tendem a aparecer juntos</p>
            <p class="mb-3">‚Ä¢ <strong>Padr√µes Temporais:</strong> Detectamos ciclos e sazonalidades nos resultados</p>
          </div>

          <div class="bg-gray-700 p-4 rounded-lg">
            <h3 class="text-xl font-semibold text-white mb-3">üîç Passo 1: An√°lise de Frequ√™ncia</h3>
            <p class="mb-3"><strong>O que faz:</strong> Analisa quantas vezes cada n√∫mero apareceu nos √∫ltimos sorteios</p>
            <p class="mb-3"><strong>Matem√°tica:</strong> Frequ√™ncia relativa = (ocorr√™ncias do n√∫mero) / (total de sorteios analisados)</p>
            <p class="mb-3"><strong>Como usar:</strong> Ajuste o peso para favorecer n√∫meros mais ou menos frequentes. N√∫meros com frequ√™ncia alta t√™m maior probabilidade hist√≥rica, mas podem estar "quentes" demais.</p>
          </div>

          <div class="bg-gray-700 p-4 rounded-lg">
            <h3 class="text-xl font-semibold text-white mb-3">üìà Passo 2: An√°lise de Distribui√ß√£o</h3>
            <p class="mb-3"><strong>O que faz:</strong> Verifica como os n√∫meros se distribuem ao longo do range (1-50 para +Milion√°ria)</p>
            <p class="mb-3"><strong>Matem√°tica:</strong> Distribui√ß√£o = an√°lise de gaps, concentra√ß√£o e dispers√£o dos n√∫meros selecionados</p>
            <p class="mb-3"><strong>Como usar:</strong> Controle se quer n√∫meros concentrados em faixas espec√≠ficas ou bem distribu√≠dos. Distribui√ß√£o equilibrada pode aumentar as chances de acerto.</p>
          </div>

          <div class="bg-gray-700 p-4 rounded-lg">
            <h3 class="text-xl font-semibold text-white mb-3">üîó Passo 3: An√°lise de Afinidades</h3>
            <p class="mb-3"><strong>O que faz:</strong> Identifica n√∫meros que historicamente aparecem juntos com mais frequ√™ncia</p>
            <p class="mb-3"><strong>Matem√°tica:</strong> Coeficiente de correla√ß√£o = Cov(X,Y) / (œÉx √ó œÉy), onde X e Y s√£o frequ√™ncias de n√∫meros</p>
            <p class="mb-3"><strong>Como usar:</strong> Ajuste para incluir ou excluir combina√ß√µes de n√∫meros que tendem a aparecer juntos. Afinidades altas podem indicar padr√µes reais ou apenas coincid√™ncias hist√≥ricas.</p>
          </div>

          <div class="bg-gray-700 p-4 rounded-lg">
            <h3 class="text-xl font-semibold text-white mb-3">üçÄ Passo 4: An√°lise de Trevos da Sorte</h3>
            <p class="mb-3"><strong>O que faz:</strong> Analisa especificamente os trevos (1-6) que mais aparecem nos sorteios</p>
            <p class="mb-3"><strong>Matem√°tica:</strong> Frequ√™ncia condicional dos trevos + an√°lise de padr√µes de altern√¢ncia</p>
            <p class="mb-3"><strong>Como usar:</strong> Controle o peso dos trevos na sele√ß√£o. Como s√£o apenas 6 op√ß√µes, pequenas varia√ß√µes podem ter grande impacto.</p>
          </div>

          <div class="bg-gray-700 p-4 rounded-lg">
            <h3 class="text-xl font-semibold text-white mb-3">üåµ Passo 5: An√°lise de Seca</h3>
            <p class="mb-3"><strong>O que faz:</strong> Identifica n√∫meros que n√£o aparecem h√° muito tempo (est√£o "secos")</p>
            <p class="mb-3"><strong>Matem√°tica:</strong> Tempo desde √∫ltimo aparecimento √ó probabilidade te√≥rica de n√£o aparecer</p>
            <p class="mb-3"><strong>Como usar:</strong> Ajuste para incluir n√∫meros que "devem" aparecer por estat√≠stica. Mas lembre-se: loterias n√£o t√™m mem√≥ria - cada sorteio √© independente.</p>
          </div>

          <div class="bg-gray-700 p-4 rounded-lg">
            <h3 class="text-xl font-semibold text-white mb-3">üß† Passo 6: Estat√≠sticas Avan√ßadas</h3>
            <p class="mb-3"><strong>O que faz:</strong> Combina todos os par√¢metros anteriores usando algoritmos de otimiza√ß√£o</p>
            <p class="mb-3"><strong>Matem√°tica:</strong> Algoritmo gen√©tico + an√°lise de clusters + machine learning para encontrar a melhor combina√ß√£o de par√¢metros</p>
            <p class="mb-3"><strong>Como usar:</strong> Este √© o cora√ß√£o do sistema. Os pesos dos passos anteriores s√£o combinados para gerar a aposta mais inteligente poss√≠vel.</p>
          </div>

          <div class="bg-blue-900 p-4 rounded-lg border-l-4 border-blue-400">
            <h3 class="text-xl font-semibold text-white mb-3">‚ö° Gera√ß√£o da Aposta</h3>
            <p class="mb-3"><strong>Processo:</strong> O sistema gera m√∫ltiplas combina√ß√µes usando diferentes combina√ß√µes dos par√¢metros ajustados</p>
            <p class="mb-3"><strong>Sele√ß√£o Final:</strong> As melhores combina√ß√µes s√£o ranqueadas por score de qualidade calculado a partir dos pesos definidos</p>
            <p class="mb-3"><strong>Resultado:</strong> Voc√™ recebe as apostas com maior probabilidade estat√≠stica baseada nos seus par√¢metros</p>
          </div>

          <div class="bg-yellow-900 p-4 rounded-lg border-l-4 border-yellow-400">
            <h3 class="text-xl font-semibold text-white mb-3">‚ö†Ô∏è Importante</h3>
            <p class="mb-3">‚Ä¢ <strong>N√£o √© garantia de vit√≥ria:</strong> Loterias s√£o baseadas em probabilidade e sorte</p>
            <p class="mb-3">‚Ä¢ <strong>Use com modera√ß√£o:</strong> Aposte apenas o que pode perder</p>
            <p class="mb-3">‚Ä¢ <strong>Experimente:</strong> Teste diferentes combina√ß√µes de par√¢metros para encontrar o que funciona melhor para voc√™</p>
          </div>
        </div>
      </div>
    </div>
  </div>





  <!-- Modal base -->
  <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="bg-[#1A1D25] p-8 rounded-2xl w-full max-w-6xl relative modal-content" style="border: 2px solid #3B82F6; box-shadow: 0 0 8px rgba(59,130,246,0.85), 0 0 16px rgba(59,130,246,0.55), 0 0 24px rgba(59,130,246,0.35), 0 12px 28px rgba(0,0,0,0.6);">
      <button class="absolute top-4 right-4 w-8 h-8 bg-[#2E303A] hover:bg-[#3E404A] text-white text-lg font-semibold rounded-full flex items-center justify-center transition-all duration-200 hover:scale-110 shadow-lg" onclick="fecharModal()" title="Fechar">‚úï</button>
      <h2 id="titulo-modal" class="text-2xl font-semibold mb-4">T√≠tulo do Modal</h2>
      <div id="conteudo-modal" class="text-gray-300">
        Carregando an√°lise...
      </div>
    </div>
  </div>

  <!-- Modal de Configura√ß√£o de Aposta -->
  <div id="modalConfiguracao" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
    <div class="bg-[#1A1D25] p-8 rounded-2xl shadow-xl w-96 text-white">
      <h3 class="text-xl font-bold mb-6 text-center text-[#00E38C]">üé≤ Configurar Aposta Aleat√≥ria</h3>

      <div class="mb-5">
        <label for="sliderNumeros" class="block text-gray-300 text-sm font-semibold mb-2">Quantos n√∫meros principais? (6-12)</label>
        <input type="range" id="sliderNumeros" min="6" max="12" value="8" class="w-full h-2 bg-[#2E303A] rounded-lg appearance-none cursor-pointer range-lg">
        <span id="valorNumeros" class="block text-center text-lg font-bold mt-2 text-[#00E38C]">8</span>
      </div>

      <div class="mb-8">
        <label for="sliderTrevos" class="block text-gray-300 text-sm font-semibold mb-2">üçÄ Quantos n√∫meros para Trevos? (2-6)</label>
        <input type="range" id="sliderTrevos" min="2" max="6" value="2" class="w-full h-2 bg-[#2E303A] rounded-lg appearance-none cursor-pointer range-lg">
        <span id="valorTrevos" class="block text-center text-lg font-bold mt-2 text-[#8B5CF6]">2</span>
      </div>

      <div class="flex justify-end space-x-4">
        <button id="btnCancelarModal" class="bg-gray-600 text-white px-4 py-2 rounded-xl font-semibold hover:opacity-80 transition-all">Cancelar</button>
        <button id="btnGerarNoModal" class="bg-[#00E38C] text-black px-4 py-2 rounded-xl font-semibold hover:opacity-80 transition-all">Gerar Aposta</button>
      </div>
    </div>
  </div>

  <!-- Modal Premium - An√°lise Estat√≠stica Premium -->
  <div id="modal-premium" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-[#1A1D25] rounded-lg shadow-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto text-white relative" style="border: 2px solid #3B82F6; box-shadow: 0 0 8px rgba(59,130,246,0.85), 0 0 16px rgba(59,130,246,0.55), 0 0 24px rgba(59,130,246,0.35), 0 12px 28px rgba(0,0,0,0.6);">
        <h3 class="text-[#00E38C] text-2xl font-semibold mb-4 text-center">üéØ Gerar Aposta Inteligente (Premium)</h3>

        <p class="text-gray-300 text-sm mb-4">Revise e ajuste os par√¢metros selecionados nas an√°lises. Estes ser√£o usados para gerar sua aposta inteligente:</p>

        <div id="resumo-parametros-premium" class="bg-[#2E303A] p-4 rounded-md mb-6">
            <h4 class="text-white text-lg font-semibold mb-3">üìä Par√¢metros Ativos:</h4>
            <div id="lista-parametros" class="space-y-2 text-sm text-gray-300">
                <p class="text-gray-400">Nenhum par√¢metro selecionado ainda.</p>
            </div>
        </div>

        <div class="bg-[#2E303A] p-4 rounded-md mb-6">
            <h4 class="text-white text-lg font-semibold mb-3">‚öôÔ∏è Configura√ß√£o da Aposta Gerada:</h4>
            <div class="flex flex-col sm:flex-row sm:items-center space-y-3 sm:space-y-0 sm:space-x-4 mb-4">
                <label for="qtde-numeros-aposta" class="text-gray-300">Quantos n√∫meros na aposta?</label>
                <input type="number" id="qtde-numeros-aposta" class="w-20 bg-[#1A1D25] border border-gray-600 text-white rounded px-2 py-1 text-sm" value="6" min="6" max="12">
                <label for="qtde-trevos-aposta" class="text-gray-300">Quantos trevos na aposta?</label>
                <input type="number" id="qtde-trevos-aposta" class="w-20 bg-[#1A1D25] border border-gray-600 text-white rounded px-2 py-1 text-sm" value="2" min="2" max="6">
            </div>
            <div class="flex items-center">
                <label for="num-apostas-gerar" class="text-gray-300">Quantas apostas gerar?</label>
                <input type="number" id="num-apostas-gerar" class="w-20 bg-[#1A1D25] border border-gray-600 text-white rounded px-2 py-1 text-sm ml-2" value="1" min="1" max="10">
            </div>
        </div>

        <button id="gerar-sugestao-btn" class="bg-[#00E38C] text-black font-bold py-3 px-6 rounded-lg w-full hover:bg-green-600 transition-colors text-lg">
            üé≤ Gerar Sugest√£o de N√∫meros
        </button>

        <div id="resultado-sugestao" class="bg-[#2E303A] p-4 rounded-md mt-6 hidden">
            <h4 class="text-[#00E38C] text-xl font-semibold mb-3 text-center">üéØ Sua Aposta Sugerida:</h4>
            <div id="lista-apostas-geradas" class="space-y-4">
            </div>
        </div>

        <button id="fechar-modal-premium" class="absolute top-4 right-4 text-gray-400 hover:text-white text-3xl">&times;</button>
    </div>
  </div>

  <!-- Tour Guiado -->
  <div id="tour-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[9999]">
    <div id="tour-tip" class="absolute bg-[#2a2a3e] border-2 border-[rgba(168,85,247,0.6)] rounded-lg p-4 shadow-2xl max-w-sm text-white" style="box-shadow: 0 12px 24px rgba(0,0,0,0.5), 0 4px 8px rgba(168, 85, 247, 0.2);">
      <div id="tour-content" class="mb-4">
        <!-- Conte√∫do do tip ser√° inserido dinamicamente -->
      </div>
      <div class="flex justify-between items-center">
        <button id="tour-prev" class="bg-[#2E303A] hover:bg-[#3E404A] text-white px-3 py-2 rounded-lg transition-colors">
          ‚Üê Anterior
        </button>
        <div class="flex items-center space-x-2">
          <span id="tour-progress" class="text-sm text-gray-400">1/9</span>
          <button id="tour-skip" class="text-gray-400 hover:text-white text-sm">Pular Tour</button>
        </div>
        <button id="tour-next" class="bg-[#00E38C] hover:bg-[#00C973] text-black px-3 py-2 rounded-lg transition-colors">
          Pr√≥ximo ‚Üí
        </button>
      </div>
    </div>
  </div>
  
  <!-- Bot√£o de ativa√ß√£o do Tour -->
  <button id="tour-activate" class="fixed top-20 right-4 bg-[#00E38C] hover:bg-[#00C973] text-black px-4 py-2 rounded-lg shadow-lg z-50 transition-all duration-200 hover:scale-105">
    üéØ Tour Guiado
  </button>

  <!-- Scripts -->
  <script>
    // Dados simulados (ser√£o substitu√≠dos pelos dados reais)
    const dadosMilionaria = {
      frequencia: {
        numeros: {
          quentes: [21, 41, 50, 23, 44, 16, 35, 42, 47, 48],
          frios: [49, 43, 45, 46, 40, 39, 38, 37, 36, 34]
        },
        trevos: {
          frequentes: [2, 4, 1, 6, 3, 5]
        }
      },
      distribuicao: {
        pares: 3.04,
        impares: 2.96,
        faixas: {
          "1-10": 0.8,
          "11-20": 1.2,
          "21-30": 1.1,
          "31-40": 1.3,
          "41-50": 1.6
        }
      },
      afinidades: {
        positivas: [
          { num1: 21, num2: 22, correlacao: 0.182 },
          { num1: 17, num2: 46, correlacao: 0.173 },
          { num1: 4, num2: 38, correlacao: 0.155 }
        ],
        negativas: [
          { num1: 24, num2: 25, correlacao: -0.159 },
          { num1: 20, num2: 41, correlacao: -0.155 }
        ]
      },
      seca: {
        maior: [49, 43, 45, 46, 40],
        recentes: [21, 41, 50, 23, 44]
      }
    };

    // Vari√°veis globais
    let numerosSelecionados = [];
    let trevosSelecionados = []; // Array √∫nico para os 2 trevos selecionados

    // Tour Guiado - Intelig√™ncia Estat√≠stica
    let currentTourStep = 0;
    const tourSteps = [
      {
        target: 'h1',
        content: '<strong>Bem-vindo √† Aposta Inteligente Premium!</strong><br><br>Descubra o cora√ß√£o da nossa intelig√™ncia aqui! Esta p√°gina combina m√∫ltiplas an√°lises estat√≠sticas e algoritmos avan√ßados para transformar seus "achismos" em decis√µes de aposta fundamentadas em dados. Vamos come√ßar?',
        position: 'bottom'
      },
      {
        target: '#passo1',
        content: '<strong>Passo 1: An√°lises Estat√≠sticas de Frequ√™ncia e Tend√™ncias</strong><br><br>Explore os N√∫meros Quentes e Frios, visualize a Matriz de Frequ√™ncia dos concursos e veja o "tempo de seca" de cada n√∫mero e trevo. Voc√™ controla o per√≠odo temporal de an√°lise para identificar tend√™ncias recentes ou hist√≥ricas.',
        position: 'left'
      },
      {
        target: '#passo2',
        content: '<strong>Passo 2: Mergulhe na Distribui√ß√£o Estat√≠stica dos Sorteios</strong><br><br>V√° al√©m da frequ√™ncia! Analise padr√µes de pares/√≠mpares, faixas num√©ricas e a soma dos n√∫meros sorteados. Entenda como as distribui√ß√µes se comportam ao longo do tempo.',
        position: 'left'
      },
      {
        target: '#passo3',
        content: '<strong>Passo 3: Encontre Combina√ß√µes que Saem Juntas</strong><br><br>Descubra combina√ß√µes que costumam sair juntas atrav√©s de an√°lise estat√≠stica avan√ßada. Identifique padr√µes de afinidade entre n√∫meros e trevos.',
        position: 'left'
      },
      {
        target: '#passo4',
        content: '<strong>Passo 4: Analise os Trevos da Sorte</strong><br><br>Veja os trevos com maior frequ√™ncia e distribui√ß√£o. Analise padr√µes estat√≠sticos espec√≠ficos dos trevos para otimizar suas escolhas.',
        position: 'left'
      },
      {
        target: '#passo5',
        content: '<strong>Passo 5: Identifique N√∫meros que N√£o Saem</strong><br><br>Evite n√∫meros que est√£o h√° muito tempo sem sair. Analise estatisticamente os per√≠odos de "seca" para tomar decis√µes mais informadas.',
        position: 'left'
      },
      {
        target: '#passo6',
        content: '<strong>Passo 6: Estat√≠stica Avan√ßada para Padr√µes Ocultos</strong><br><br>Explore correla√ß√µes, padr√µes ocultos e tend√™ncias com an√°lise estat√≠stica avan√ßada. Descubra rela√ß√µes complexas entre n√∫meros e trevos.',
        position: 'bottom'
      },
      {
        target: '#abrir-modal-premium',
        content: '<strong>Gerador de Aposta Inteligente: Sua Estrat√©gia em A√ß√£o</strong><br><br>Ap√≥s suas an√°lises, use nosso Gerador de Aposta Inteligente. Com base em suas prefer√™ncias, ele combina m√∫ltiplas an√°lises estat√≠sticas e gera at√© 10 apostas otimizadas.',
        position: 'left'
      },
      {
        target: 'h1',
        content: '<strong>Sua Vantagem Premium: An√°lise Estat√≠stica Avan√ßada</strong><br><br>Esta ferramenta Premium oferece an√°lise estat√≠stica avan√ßada e algoritmos propriet√°rios que voc√™ n√£o encontra em outro lugar. Personalize sua estrat√©gia e use dados reais para ir al√©m do palpite aleat√≥rio. O futuro das suas apostas come√ßa aqui!',
        position: 'center'
      }
    ];

    // Fun√ß√£o para mostrar o tour
    function showTour() {
      document.getElementById('tour-overlay').classList.remove('hidden');
      currentTourStep = 0;
      showStep();
    }

    // Fun√ß√£o para mostrar cada passo do tour
    function showStep() {
      const step = tourSteps[currentTourStep];
      const target = document.querySelector(step.target);
      const tip = document.getElementById('tour-tip');
      const content = document.getElementById('tour-content');
      const progress = document.getElementById('tour-progress');

      if (!target) {
        console.error('Target n√£o encontrado:', step.target);
        return;
      }

      content.innerHTML = step.content;
      progress.textContent = `${currentTourStep + 1}/${tourSteps.length}`;

      const targetRect = target.getBoundingClientRect();
      const tipRect = tip.getBoundingClientRect();

      let left, top;

      switch (step.position) {
        case 'left':
          left = targetRect.left - tipRect.width - 20;
          top = targetRect.top + (targetRect.height / 2) - (tipRect.height / 2);
          break;
        case 'bottom':
          left = targetRect.left + (targetRect.width / 2) - (tipRect.width / 2);
          top = targetRect.bottom + 20;
          break;
        case 'center':
          left = (window.innerWidth / 2) - (tipRect.width / 2);
          top = (window.innerHeight / 2) - (tipRect.height / 2);
          break;
        default:
          left = targetRect.left + (targetRect.width / 2) - (tipRect.width / 2);
          top = targetRect.top - tipRect.height - 20;
      }

      // Garantir que a dica n√£o saia da tela
      if (left < 20) left = 20;
      if (left + tipRect.width > window.innerWidth - 20) {
        left = window.innerWidth - tipRect.width - 20;
      }
      if (top < 20) top = 20;
      if (top + tipRect.height > window.innerHeight - 20) {
        top = window.innerHeight - tipRect.height - 20;
      }

      tip.style.left = left + 'px';
      tip.style.top = top + 'px';

      // Atualizar bot√µes
      document.getElementById('tour-prev').disabled = currentTourStep === 0;
      document.getElementById('tour-next').textContent = currentTourStep === tourSteps.length - 1 ? 'Finalizar' : 'Pr√≥ximo ‚Üí';
    }

    // Fun√ß√£o para mostrar mensagem de conclus√£o
    function showCompletionMessage() {
      const tip = document.getElementById('tour-tip');
      const content = document.getElementById('tour-content');
      
      content.innerHTML = '<strong>üéâ Tour Conclu√≠do!</strong><br><br>Agora voc√™ conhece todas as funcionalidades da nossa Intelig√™ncia Estat√≠stica Premium. Comece a explorar e transforme suas apostas com dados e algoritmos avan√ßados!';
      
      document.getElementById('tour-prev').style.display = 'none';
      document.getElementById('tour-next').style.display = 'none';
      document.getElementById('tour-skip').textContent = 'Fechar';
      
      // Centralizar a mensagem
      const tipRect = tip.getBoundingClientRect();
      tip.style.left = (window.innerWidth / 2) - (tipRect.width / 2) + 'px';
      tip.style.top = (window.innerHeight / 2) - (tipRect.height / 2) + 'px';
    }

    // Event listeners para o tour
    document.addEventListener('DOMContentLoaded', function() {
      // Bot√£o de ativa√ß√£o
      const tourActivate = document.getElementById('tour-activate');
      if (tourActivate) {
        tourActivate.addEventListener('click', showTour);
      }

      // Navega√ß√£o do tour
      const tourNext = document.getElementById('tour-next');
      if (tourNext) {
        tourNext.addEventListener('click', function() {
          if (currentTourStep < tourSteps.length - 1) {
            currentTourStep++;
            showStep();
          } else {
            showCompletionMessage();
          }
        });
      }

      const tourPrev = document.getElementById('tour-prev');
      if (tourPrev) {
        tourPrev.addEventListener('click', function() {
          if (currentTourStep > 0) {
            currentTourStep--;
            showStep();
          }
        });
      }

      const tourSkip = document.getElementById('tour-skip');
      if (tourSkip) {
        tourSkip.addEventListener('click', function() {
          document.getElementById('tour-overlay').classList.add('hidden');
          // Resetar bot√µes
          document.getElementById('tour-prev').style.display = 'block';
          document.getElementById('tour-next').style.display = 'block';
          document.getElementById('tour-skip').textContent = 'Pular Tour';
        });
      }

      // Fechar tour clicando fora
      const tourOverlay = document.getElementById('tour-overlay');
      if (tourOverlay) {
        tourOverlay.addEventListener('click', function(e) {
          if (e.target.id === 'tour-overlay') {
            document.getElementById('tour-overlay').classList.add('hidden');
          }
        });
      }

      // Verificar se √© a primeira visita
      if (!localStorage.getItem('tourCompleted')) {
        setTimeout(() => {
          showTour();
        }, 2000);
      }
    });

    // Marcar tour como conclu√≠do
    function completeTour() {
      localStorage.setItem('tourCompleted', 'true');
    }

    // Inicializa√ß√£o - Aguarda carregamento completo dos estilos
    function inicializarAplicacao() {
      gerarNumeros();
      gerarTrevos();
      carregarEstatisticasRapidas();
      

    }

    // Aguarda tanto DOM quanto estilos carregados
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', inicializarAplicacao);
    } else {
      // DOM j√° carregado, aguarda estilos
      window.addEventListener('load', inicializarAplicacao);
    }
    


    // Gerar n√∫meros de 1 a 50 - DESABILITADO NA P√ÅGINA PREMIUM
    function gerarNumeros() {
      // Fun√ß√£o desabilitada na p√°gina premium - n√£o h√° grid de n√∫meros
      console.log('Fun√ß√£o gerarNumeros() desabilitada na p√°gina premium');
    }

    // Gerar trevos (container √∫nico) - DESABILITADO NA P√ÅGINA PREMIUM
    function gerarTrevos() {
      // Fun√ß√£o desabilitada na p√°gina premium - n√£o h√° container de trevos
      console.log('Fun√ß√£o gerarTrevos() desabilitada na p√°gina premium');
    }

    // Selecionar n√∫mero (manual - limite de 12)
    function selecionarNumero(numero, elemento) {
      // Verificar se j√° atingiu o limite antes de qualquer a√ß√£o
      if (numerosSelecionados.length >= 12 && !numerosSelecionados.includes(numero)) {
        alert('Voc√™ j√° selecionou 12 n√∫meros! Limite m√°ximo para sele√ß√£o manual.');
        // Garantir que o elemento N√ÉO seja marcado visualmente
        elemento.classList.remove('selecionado');
        // For√ßar remo√ß√£o de qualquer estado tempor√°rio
        elemento.blur();
        elemento.style.pointerEvents = 'none';
        setTimeout(() => {
          elemento.style.pointerEvents = 'auto';
        }, 100);
        return;
      }
      
      if (numerosSelecionados.includes(numero)) {
        numerosSelecionados = numerosSelecionados.filter(n => n !== numero);
        elemento.classList.remove('selecionado');
      } else {
        numerosSelecionados.push(numero);
        elemento.classList.add('selecionado');
      }
      atualizarNumerosSelecionados();
      calcularEAtualizarValorAposta(); // NOVA: Calcular valor ap√≥s cada sele√ß√£o
    }

    // Selecionar n√∫mero automaticamente (sem limite)
    function selecionarNumeroAutomatico(numero, elemento) {
      if (!numerosSelecionados.includes(numero)) {
        numerosSelecionados.push(numero);
        elemento.classList.add('selecionado');
      }
      atualizarNumerosSelecionados();
    }

    // Selecionar trevo (manual - limite de 6 trevos)
    function selecionarTrevo(trevo, elemento) {
      // Verificar se j√° atingiu o limite antes de qualquer a√ß√£o
      if (trevosSelecionados.length >= 6 && !trevosSelecionados.includes(trevo)) {
        alert('Voc√™ j√° selecionou 6 trevos! Limite m√°ximo para sele√ß√£o manual.');
        // Garantir que o elemento N√ÉO seja marcado visualmente
        elemento.classList.remove('selecionado');
        // For√ßar remo√ß√£o de qualquer estado tempor√°rio
        elemento.blur();
        elemento.style.pointerEvents = 'none';
        setTimeout(() => {
          elemento.style.pointerEvents = 'auto';
        }, 100);
        return;
      }
      
      if (trevosSelecionados.includes(trevo)) {
        trevosSelecionados = trevosSelecionados.filter(t => t !== trevo);
        elemento.classList.remove('selecionado');
      } else {
        trevosSelecionados.push(trevo);
        elemento.classList.add('selecionado');
      }
      atualizarTrevosSelecionados();
      calcularEAtualizarValorAposta(); // NOVA: Calcular valor ap√≥s cada sele√ß√£o
    }

    // Atualizar display dos n√∫meros selecionados
    function atualizarNumerosSelecionados() {
      const container = document.getElementById('numeros-selecionados');
      if (numerosSelecionados.length === 0) {
        container.innerHTML = '<span class="text-gray-400">Nenhum n√∫mero selecionado</span>';
      } else {
        container.innerHTML = numerosSelecionados
          .sort((a, b) => a - b)
          .map(n => `<span class="bg-[#00E38C] text-black px-2 py-1 rounded font-semibold">${n.toString().padStart(2, '0')}</span>`)
          .join('');
      }
    }

    // Atualizar display dos trevos selecionados
    function atualizarTrevosSelecionados() {
      const container = document.getElementById('trevos-selecionados');
      if (trevosSelecionados.length === 0) {
        container.innerHTML = '<span class="text-gray-400">Nenhum trevo selecionado</span>';
      } else {
        container.innerHTML = trevosSelecionados
          .sort((a, b) => a - b)
          .map(t => `<span class="bg-[#8B5CF6] text-white px-2 py-1 rounded font-semibold">${t}</span>`)
          .join('');
      }
    }

    // Atualizar display do valor da aposta
    function atualizarValorAposta(valor, qtdeApostas, qtdeNum, qtdeTrevos) {
      const container = document.getElementById('valor-aposta-container');
      if (valor && qtdeApostas) {
        const valorFormatado = new Intl.NumberFormat('pt-BR', {
          style: 'currency',
          currency: 'BRL'
        }).format(valor);
        
        container.innerHTML = `
          <div class="bg-[#00E38C] text-black p-3 rounded-xl font-bold text-lg mb-2">
            ${valorFormatado}
          </div>
          <div class="text-sm text-gray-300 mb-1">
            <strong>${qtdeApostas}</strong> combina√ß√µes
          </div>
          <div class="text-xs text-gray-400">
            ${qtdeNum} n√∫meros + ${qtdeTrevos} trevos
          </div>
        `;
      } else {
        container.innerHTML = '<div class="text-gray-400 text-sm">Aposta n√£o configurada</div>';
      }
    }

    // NOVA: Calcular e atualizar valor da aposta baseado nas sele√ß√µes manuais
    function calcularEAtualizarValorAposta() {
      const qtdeNum = numerosSelecionados.length;
      const qtdeTrevos = trevosSelecionados.length;
      
      // S√≥ calcular se tiver sele√ß√£o m√≠nima (6 n√∫meros + 2 trevos)
      if (qtdeNum >= 6 && qtdeTrevos >= 2) {
        // Tabela de pre√ßos simplificada para sele√ß√£o manual
        const tabelaPrecos = {
          "6,2": {apostas: 1, valor: 6.00},
          "6,3": {apostas: 3, valor: 18.00},
          "6,4": {apostas: 6, valor: 36.00},
          "6,5": {apostas: 10, valor: 60.00},
          "6,6": {apostas: 15, valor: 90.00},
          "7,2": {apostas: 7, valor: 42.00},
          "7,3": {apostas: 21, valor: 126.00},
          "7,4": {apostas: 42, valor: 252.00},
          "7,5": {apostas: 70, valor: 420.00},
          "7,6": {apostas: 105, valor: 630.00},
          "8,2": {apostas: 28, valor: 168.00},
          "8,3": {apostas: 84, valor: 504.00},
          "8,4": {apostas: 168, valor: 1008.00},
          "8,5": {apostas: 280, valor: 1680.00},
          "8,6": {apostas: 420, valor: 2520.00},
          "9,2": {apostas: 84, valor: 504.00},
          "9,3": {apostas: 252, valor: 1512.00},
          "9,4": {apostas: 504, valor: 3024.00},
          "9,5": {apostas: 840, valor: 5040.00},
          "9,6": {apostas: 1260, valor: 7560.00},
          "10,2": {apostas: 210, valor: 1260.00},
          "10,3": {apostas: 630, valor: 3780.00},
          "10,4": {apostas: 1260, valor: 7560.00},
          "10,5": {apostas: 2100, valor: 12600.00},
          "10,6": {apostas: 3150, valor: 18900.00},
          "11,2": {apostas: 462, valor: 2772.00},
          "11,3": {apostas: 1386, valor: 8316.00},
          "11,4": {apostas: 2772, valor: 16632.00},
          "11,5": {apostas: 4620, valor: 27720.00},
          "11,6": {apostas: 6930, valor: 41580.00},
          "12,2": {apostas: 924, valor: 5544.00},
          "12,3": {apostas: 2772, valor: 16632.00},
          "12,4": {apostas: 5544, valor: 33264.00},
          "12,5": {apostas: 9240, valor: 55440.00},
          "12,6": {apostas: 13860, valor: 83160.00}
        };
        
        const chave = `${qtdeNum},${qtdeTrevos}`;
        const infoAposta = tabelaPrecos[chave];
        
        if (infoAposta) {
          atualizarValorAposta(infoAposta.valor, infoAposta.apostas, qtdeNum, qtdeTrevos);
        } else {
          // Se n√£o encontrar na tabela, mostrar mensagem
          atualizarValorAposta(null, null, null, null);
        }
      } else {
        // Se n√£o tiver sele√ß√£o m√≠nima, limpar valor
        atualizarValorAposta(null, null, null, null);
      }
    }

    // Carregar estat√≠sticas r√°pidas - DESABILITADO NA P√ÅGINA PREMIUM
    function carregarEstatisticasRapidas() {
      // Fun√ß√£o desabilitada na p√°gina premium - n√£o h√° se√ß√£o de estat√≠sticas r√°pidas
      console.log('Fun√ß√£o carregarEstatisticasRapidas() desabilitada na p√°gina premium');
    }



    // Abrir modal
    function abrirModal(tipo) {
      // Esconder todos os popups de ajuda primeiro
      const popups = document.querySelectorAll('.modal-ajuda');
      popups.forEach(popup => {
        popup.style.display = 'none';
      });
      
      // Usar modal gen√©rico para todos
      const modal = document.getElementById('modal');
      const titulo = document.getElementById('titulo-modal');
      const conteudo = document.getElementById('conteudo-modal');
      
      modal.classList.remove('hidden');
      
      switch(tipo) {
        case 'frequencia':
          titulo.textContent = 'üìä An√°lise de Frequ√™ncia';
          carregarAnaliseFrequencia(conteudo);
          // Carregar prefer√™ncias salvas ap√≥s o modal ser carregado
          setTimeout(() => {
            if (typeof carregarPreferenciasFrequencia === 'function') {
              carregarPreferenciasFrequencia();
            }
          }, 500);
          break;
        case 'distribuicao':
          titulo.textContent = 'üî¢ An√°lise de Distribui√ß√£o';
          carregarAnaliseDistribuicao(conteudo, null);
          // Carregar prefer√™ncias salvas ap√≥s o modal ser carregado
          setTimeout(() => {
            if (typeof carregarPreferenciasDistribuicao === 'function') {
              carregarPreferenciasDistribuicao();
            }
          }, 1000); // Aumentado de 500ms para 1000ms
          break;
        case 'afinidades':
          titulo.textContent = 'ü§ù An√°lise de Afinidades';
          carregarAnaliseAfinidades(conteudo);
          // Carregar prefer√™ncias salvas ap√≥s o modal ser carregado
          setTimeout(() => {
            if (typeof carregarPreferenciasAfinidades === 'function') {
              carregarPreferenciasAfinidades();
            }
          }, 1000); // Aumentado de 500ms para 1000ms
          break;
        case 'trevos':
          titulo.textContent = 'üçÄ An√°lise dos Trevos';
          carregarAnaliseTrevos(conteudo);
          // Carregar prefer√™ncias salvas ap√≥s o modal ser carregado
          setTimeout(() => {
            if (typeof carregarPreferenciasTrevos === 'function') {
              carregarPreferenciasTrevos();
            }
          }, 1000); // Aumentado de 500ms para 1000ms
          break;
        case 'seca':
          titulo.textContent = 'üåµ An√°lise de Seca';
          carregarAnaliseSeca(conteudo);
          // Carregar prefer√™ncias salvas ap√≥s o modal ser carregado
          setTimeout(() => {
            if (typeof carregarPreferenciasSeca === 'function') {
              carregarPreferenciasSeca();
            }
          }, 1000); // Aumentado de 500ms para 1000ms
          break;
        case 'estatisticas':
          titulo.textContent = 'üìà Estat√≠sticas Avan√ßadas';
          carregarAnaliseEstatisticasAvancadas(conteudo);
          // Carregar prefer√™ncias salvas ap√≥s o modal ser carregado
          setTimeout(() => {
            if (typeof carregarPreferenciasAvancadas === 'function') {
              carregarPreferenciasAvancadas();
            }
          }, 500);
          break;
      }
    }

    // Fechar modal
    function fecharModal(modalId = null) {
      if (modalId) {
        // Fechar modal espec√≠fico
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.classList.add('hidden');
        }
      } else {
        // Fechar modal gen√©rico
        document.getElementById('modal').classList.add('hidden');
        
        // Salvar prefer√™ncias do modal que est√° sendo fechado
        // Determinar qual modal est√° sendo fechado baseado no t√≠tulo
        const tituloModal = document.getElementById('titulo-modal');
        if (tituloModal) {
          const titulo = tituloModal.textContent.toLowerCase();
          let modalPrefix = '';
          
          if (titulo.includes('frequ√™ncia') || titulo.includes('frequencia')) {
            modalPrefix = 'freq';
          } else if (titulo.includes('distribui√ß√£o') || titulo.includes('distribuicao')) {
            modalPrefix = 'dist';
          } else if (titulo.includes('afinidades')) {
            modalPrefix = 'afinidade';
          } else if (titulo.includes('sequ√™ncias') || titulo.includes('sequencias') || titulo.includes('padr√µes') || titulo.includes('padroes')) {
            modalPrefix = 'padrao';
          } else if (titulo.includes('seca')) {
            modalPrefix = 'seca';
          } else if (titulo.includes('estat√≠sticas') || titulo.includes('estatisticas') || titulo.includes('avan√ßadas') || titulo.includes('avancadas')) {
            modalPrefix = 'avancada';
          } else if (titulo.includes('trevos')) {
            modalPrefix = 'trevo';
          }
          
          // Salvar prefer√™ncias se identificou o modal
          if (modalPrefix && typeof salvarPreferenciasDoPassoMIL === 'function') {
            console.log(`üíæ Salvando prefer√™ncias do modal (+MIL): ${modalPrefix}`);
            salvarPreferenciasDoPassoMIL(modalPrefix);
          }
        }
      }
    }

    // Carregar an√°lise de frequ√™ncia
    async function carregarAnaliseFrequencia(container) {
      container.innerHTML = "üîÑ Carregando an√°lise de frequ√™ncia...";

      try {
        const response = await fetch('/api/analise-frequencia');
        const data = await response.json();

        if (data.error) {
          container.innerHTML = `<p style="color: red;">Erro: ${data.error}</p>`;
          return;
        }

        container.innerHTML = `
          <div class="space-y-6">
            <!-- Cabe√ßalho com t√≠tulo e ajuda -->
            <div class="flex justify-between items-start">
              <div class="bg-[#2E303A] p-4 rounded-xl flex-1">
                <h3 class="text-lg font-semibold mb-3 text-[#00E38C]">üéØ Janela de An√°lise Temporal</h3>
                <div class="flex flex-wrap gap-3 items-center">
                  <label class="text-sm text-gray-300">Per√≠odo:</label>
                  <select id="janela-analise" class="bg-[#1A1D25] text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-[#00E38C] focus:outline-none" onchange="atualizarAnaliseFrequencia()">
                    <option value="">Todos os concursos</option>
                    <option value="25">√öltimos 25 concursos</option>
                    <option value="50">√öltimos 50 concursos</option>
                    <option value="100">√öltimos 100 concursos</option>
                    <option value="200">√öltimos 200 concursos</option>
                  </select>
                  <span class="text-xs text-gray-400">(Selecione para atualizar a an√°lise)</span>
                </div>
              </div>
              <button onclick="abrirPopupAjuda()" class="ml-4 bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition-colors duration-200" title="Como usar estes gr√°ficos?">
                ‚ùì
              </button>
            </div>
            
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üî• N√∫meros Mais Quentes (Top 10)</h3>
              <div class="grid grid-cols-5 gap-2">
                ${((data.numeros_quentes_frios && data.numeros_quentes_frios.quentes) ? data.numeros_quentes_frios.quentes : []).slice(0, 10).map(n => 
                  `<div class="bg-[#00E38C] text-black p-3 rounded text-center font-semibold">${Array.isArray(n) ? n[0] : n}</div>`
                ).join('')}
              </div>
            </div>
            
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">‚ùÑÔ∏è N√∫meros Mais Frios (Top 10)</h3>
              <div class="grid grid-cols-5 gap-2">
                ${((data.numeros_quentes_frios && data.numeros_quentes_frios.frios) ? data.numeros_quentes_frios.frios : []).slice(0, 10).map(n => 
                  `<div class="bg-gray-600 text-white p-3 rounded text-center font-semibold">${Array.isArray(n) ? n[0] : n}</div>`
                ).join('')}
              </div>
            </div>
            
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üìä Frequ√™ncia Absoluta  vs  Relativa <span style="color: red;">(%)</span>  </h3>
              <div id="grafico-frequencia" class="grafico-frequencia-container"></div>
            </div>
            
            <div class="chart-container">
              <h3 class="titulo-matriz">üî¢ Matriz Visual dos √öltimos Concursos</h3>
              <div class="matriz-info">
                <span id="matriz-concursos-count" class="text-sm text-gray-400">Carregando...</span>
                <div class="matriz-navigation-hint">
                  <span class="text-xs text-gray-500">üñ±Ô∏è Desktop: Use as barras de rolagem</span>
                  <span class="text-xs text-gray-500 ml-2">üì± Mobile: Deslize o dedo em qualquer dire√ß√£o</span>
                </div>
              </div>
              <div id="matriz-frequencia" class="matriz-container"></div>
            </div>
            
            <!-- SUGEST√ïES PARA APOSTA PREMIUM -->
            <div class="mt-8 bg-[#2E303A] p-4 rounded-lg shadow-md">
              <h4 class="text-[#00E38C] text-xl font-semibold mb-4">üéØ Sugest√µes para Aposta Inteligente</h4>
              <div class="space-y-3">
                <div class="flex items-center">
                  <input type="checkbox" id="freq-priorizar-quentes" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="frequencia" data-pref-name="priorizarQuentes" data-pref-period="completa">
                  <label for="freq-priorizar-quentes" class="text-white">Priorizar N√∫meros MAIS Frequentes</label>
                  <input type="number" id="freq-qtde-quentes" class="ml-auto w-16 bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" value="10" min="1" max="50">
                </div>
                <div class="flex items-center">
                  <input type="checkbox" id="freq-priorizar-frios" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="frequencia" data-pref-name="priorizarFrios" data-pref-period="completa">
                  <label for="freq-priorizar-frios" class="text-white">Priorizar N√∫meros MENOS Frequentes</label>
                  <input type="number" id="freq-qtde-frios" class="ml-auto w-16 bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" value="10" min="1" max="50">
                </div>
                <div class="flex items-center">
                  <label for="freq-periodo" class="text-white">Considerar per√≠odo:</label>
                  <select id="freq-periodo" class="select-premium-pref ml-2 bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" data-pref-type="frequencia" data-pref-name="considerarPeriodo">
                    <option value="completa">Todos os Concursos</option>
                    <option value="25">√öltimos 25 Concursos</option>
                    <option value="50">√öltimos 50 Concursos</option>
                  </select>
                </div>
              </div>
              <div class="mt-4 p-3 bg-[#1A1D25] rounded border-l-4 border-[#00E38C]">
                <p class="text-sm text-[#00E38C] font-medium">üí° Dica:</p>
                <p class="text-xs text-gray-300">Marque as op√ß√µes que fazem sentido para sua estrat√©gia. Elas ser√£o usadas na An√°lise Premium.</p>
              </div>
            </div>
          </div>
        `;
        
        // Criar gr√°fico combinado: Absoluta vs Relativa
        const xNumeros = data.frequencia_absoluta_numeros.map(e => e.numero);
        const yFreqAbs = data.frequencia_absoluta_numeros.map(e => e.frequencia);
        const yFreqRelComb = data.frequencia_relativa_numeros.map(e => e.frequencia);
        const linhaEsperadaComb = Array(50).fill(2); // Linha de refer√™ncia 2%
        
        // Detectar se √© smartphone para ajustar tamanho da fonte
        const isMobile = window.innerWidth <= 640;
        const fontSize = isMobile ? 6 : 12; // 6px para mobile, 12px para desktop

        Plotly.newPlot('grafico-frequencia', [
          {
            x: xNumeros,
            y: yFreqAbs,
            type: 'bar',
            name: '',
            marker: { color: 'deepskyblue' },
            yaxis: 'y',
            showlegend: false
          },
          {
            x: xNumeros,
            y: yFreqRelComb,
            type: 'scatter',
            mode: 'lines+markers',
            name: '',
            line: { color: 'red', width: 2 },
            marker: { color: 'red', size: 4 },
            yaxis: 'y2',
            showlegend: false
          },
          {
            x: xNumeros,
            y: linhaEsperadaComb,
            type: 'scatter',
            mode: 'lines',
            name: 'Freq. esperada',
            line: { color: 'white', dash: 'dash', width: 2 },
            yaxis: 'y2'
          }
        ], {
          title: {
            text: 'Freq. N√∫meros', // T√≠tulo principal mais conciso para mobile
            font: { size: 14 } // Tamanho da fonte menor para o t√≠tulo do gr√°fico
          },
          paper_bgcolor: '#1a1a1a',
          plot_bgcolor: '#1a1a1a',
          font: { color: 'white' },
          autosize: true,
          responsive: true,
          // Reduzir as margens ao m√≠nimo necess√°rio para os r√≥tulos dos eixos
          margin: { 
            l: 25, // Margem esquerda m√≠nima
            r: 25, // Margem direita m√≠nima
            b: 70, // Ajuste para acomodar r√≥tulos inclinados do eixo X
            t: 40, // Margem superior
            pad: 0 // Sem padding extra interno ao gr√°fico
          },
          xaxis: { 
            automargin: true,
            // CHAVE PARA OS R√ìTULOS SOBREPOSTOS:
            tickangle: 45, // Incline os r√≥tulos em 45 graus
            tickfont: { size: 8 }, // Diminua o tamanho da fonte dos r√≥tulos para que caibam melhor
            // showgrid: false // Remover grade vertical para menos polui√ß√£o visual se n√£o for essencial
          },
          yaxis: { 
            automargin: true,
            title: {
              text: 'Abs.', // T√≠tulo do eixo Y mais curto para economizar espa√ßo
              font: { size: 9 } // Fonte menor para o t√≠tulo do eixo Y
            },
            tickfont: { size: 9 } // Fonte menor para os r√≥tulos do eixo Y
          },
          yaxis2: { 
            side: 'right',
            overlaying: 'y',
            automargin: true,
            title: {
              text: 'Rel. (%)', // T√≠tulo do eixo Y2 mais curto
              font: { size: 9, color: 'red' }
            },
            tickfont: { color: 'red', size: 9 }
          },
          showlegend: false
        }, { displayModeBar: false });

        // Garantir que o gr√°fico se redimensione quando a janela mudar
        window.addEventListener('resize', () => {
          Plotly.relayout('grafico-frequencia', { 'autosize': true });
        });

        // Aguardar um pouco para garantir que o DOM foi renderizado
        setTimeout(() => {
          if (data.analise_temporal && Array.isArray(data.analise_temporal)) {
            montarMatriz(data.analise_temporal);
          } else {
            montarMatriz(concursosMock); // fallback para teste
          }
        }, 100);

      } catch (error) {
        container.innerHTML = `<p style="color: red;">Erro ao carregar dados: ${error.message}</p>`;
      }
    }

    // Mock JS com dados fict√≠cios (at√© conectar com a API real)
    const concursosMock = [
      { numeros: [12, 23, 35, 44, 46, 50], trevos: [1, 6] },
      { numeros: [3, 15, 21, 33, 42, 49], trevos: [2, 4] },
      { numeros: [7, 9, 11, 20, 37, 40], trevos: [3, 5] },
      { numeros: [5, 8, 18, 26, 39, 43], trevos: [1, 2] }
    ];

    function aplicarEstiloCelula(div) {
      // Removido: div.style.fontSize = '9px';
      // Removido: div.style.fontFamily = 'Arial, sans-serif';
      // Removido: div.style.lineHeight = '22px';
      // Removido: div.style.textAlign = 'center';
      // Removido: div.style.width = '22px';
      // Removido: div.style.height = '22px';
    }
    function montarMatriz(concursos) {
      console.log('montarMatriz chamada com:', concursos);
      const container = document.getElementById('matriz-frequencia');
      if (!container) {
        console.error('Elemento matriz-frequencia n√£o encontrado');
        return;
      }
      console.log('Container encontrado, limpando...');
      container.innerHTML = '';

      concursos.forEach((concurso, index) => { // Itera por cada concurso
        console.log(`Processando concurso ${index + 1}:`, concurso);
        
        // --- UMA √öNICA LINHA POR CONCURSO ---
        const linhaConcurso = document.createElement('div');
        linhaConcurso.className = 'linha-concurso';
        
        // Adicionar todos os 50 n√∫meros na mesma linha
        for (let i = 1; i <= 50; i++) {
          const celula = document.createElement('div');
          celula.className = 'celula-numero';
          celula.textContent = i;
          if (concurso.numeros.includes(i)) {
            celula.classList.add('sorteado');
          }
          linhaConcurso.appendChild(celula);
        }
        
        // Adicionar os 6 trevos na mesma linha
        for (let t = 1; t <= 6; t++) {
          const celula = document.createElement('div');
          celula.className = 'celula-numero trevo';
          celula.textContent = `T${t}`;
          if (concurso.trevos.includes(t)) {
            celula.classList.add('sorteado');
          }
          linhaConcurso.appendChild(celula);
        }
        
        container.appendChild(linhaConcurso);
      });
      console.log('Matriz montada com sucesso!');
      
      // Atualizar contador de concursos
      const contadorElement = document.getElementById('matriz-concursos-count');
      if (contadorElement) {
        contadorElement.textContent = `${concursos.length} concursos exibidos`;
      }
      
      // Configura√ß√£o adicional para melhor experi√™ncia de scroll
      const matrizContainer = document.getElementById('matriz-frequencia');
      if (matrizContainer) {
        // Garantir que o scroll funcione bem em todos os dispositivos
        matrizContainer.style.webkitOverflowScrolling = 'touch';
        matrizContainer.style.scrollBehavior = 'smooth';
      }
    }



    // Fun√ß√£o para atualizar an√°lise quando mudar a janela
    async function atualizarAnaliseFrequencia() {
      const janela = document.getElementById('janela-analise').value;
      const container = document.getElementById('conteudo-modal');
      
      container.innerHTML = "üîÑ Atualizando an√°lise...";

      try {
        const url = janela ? `/api/analise-frequencia?qtd_concursos=${janela}` : '/api/analise-frequencia';
        const response = await fetch(url);
        const data = await response.json();

        if (data.error) {
          container.innerHTML = `<p style="color: red;">Erro: ${data.error}</p>`;
          return;
        }

        // Recriar o conte√∫do com os novos dados
        container.innerHTML = `
          <div class="space-y-6">
            <!-- Cabe√ßalho com t√≠tulo e ajuda -->
            <div class="flex justify-between items-start">
              <div class="bg-[#2E303A] p-4 rounded-xl flex-1">
                <h3 class="text-lg font-semibold mb-3 text-[#00E38C]">üéØ Janela de An√°lise</h3>
                <div class="flex flex-wrap gap-3 items-center">
                  <label class="text-sm text-gray-300">Per√≠odo:</label>
                  <select id="janela-analise" class="bg-[#1A1D25] text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-[#00E38C] focus:outline-none" onchange="atualizarAnaliseFrequencia()">
                    <option value="" ${janela === '' ? 'selected' : ''}>Todos os concursos</option>
                    <option value="25" ${janela === '25' ? 'selected' : ''}>√öltimos 25 concursos</option>
                    <option value="50" ${janela === '50' ? 'selected' : ''}>√öltimos 50 concursos</option>
                    <option value="100" ${janela === '100' ? 'selected' : ''}>√öltimos 100 concursos</option>
                    <option value="200" ${janela === '200' ? 'selected' : ''}>√öltimos 200 concursos</option>
                  </select>
                  <span class="text-xs text-gray-400">(Selecione para atualizar a an√°lise)</span>
                </div>
              </div>
              <button onclick="abrirPopupAjuda()" class="ml-4 bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition-colors duration-200" title="Como usar estes gr√°ficos?">
                ‚ùì
              </button>
            </div>
            
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üî• N√∫meros Mais Quentes (Top 10)</h3>
              <div class="grid grid-cols-5 gap-2">
                ${data.numeros_quentes.slice(0, 10).map(n => 
                  `<div class="bg-[#00E38C] text-black p-3 rounded text-center font-semibold">${n[0]}</div>`
                ).join('')}
              </div>
            </div>
            
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">‚ùÑÔ∏è N√∫meros Mais Frios (Top 10)</h3>
              <div class="grid grid-cols-5 gap-2">
                ${data.numeros_frios.slice(0, 10).map(n => 
                  `<div class="bg-gray-600 text-white p-3 rounded text-center font-semibold">${n[0]}</div>`
                ).join('')}
              </div>
            </div>
            
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üìä Frequ√™ncia Absoluta  vs  Relativa <span style="color: red;">(%)</span>  </h3>
              <div id="grafico-frequencia" class="grafico-frequencia-container"></div>
            </div>
            
            <h3 class="titulo-matriz">üî¢ Matriz Visual dos √öltimos Concursos</h3>
            <div class="matriz-info">
              <span id="matriz-concursos-count" class="text-sm text-gray-400">Carregando...</span>
              <div class="matriz-navigation-hint">
                <span class="text-xs text-gray-500">üñ±Ô∏è Desktop: Use as barras de rolagem</span>
                <span class="text-xs text-gray-500 ml-2">üì± Mobile: Deslize o dedo em qualquer dire√ß√£o</span>
              </div>
            </div>
            <div id="matriz-frequencia" class="matriz-container"></div>
            
            <!-- SUGEST√ïES PARA APOSTA PREMIUM -->
            <div class="mt-8 bg-[#2E303A] p-4 rounded-lg shadow-md">
              <h4 class="text-[#00E38C] text-xl font-semibold mb-4">üéØ Sugest√µes para Aposta Inteligente</h4>
              <div class="space-y-3">
                <div class="flex items-center">
                  <input type="checkbox" id="freq-priorizar-quentes" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="frequencia" data-pref-name="priorizarQuentes" data-pref-period="completa">
                  <label for="freq-priorizar-quentes" class="text-white">Priorizar N√∫meros MAIS Frequentes</label>
                  <input type="number" id="freq-qtde-quentes" class="ml-auto w-16 bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" value="10" min="1" max="50">
                </div>
                <div class="flex items-center">
                  <input type="checkbox" id="freq-priorizar-frios" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="frequencia" data-pref-name="priorizarFrios" data-pref-period="completa">
                  <label for="freq-priorizar-frios" class="text-white">Priorizar N√∫meros MENOS Frequentes</label>
                  <input type="number" id="freq-qtde-frios" class="ml-auto w-16 bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" value="10" min="1" max="50">
                </div>
                <div class="flex items-center">
                  <label for="freq-periodo" class="text-white">Considerar per√≠odo:</label>
                  <select id="freq-periodo" class="select-premium-pref ml-2 bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" data-pref-type="frequencia" data-pref-name="considerarPeriodo">
                    <option value="completa">Todos os Concursos</option>
                    <option value="25">√öltimos 25 Concursos</option>
                    <option value="50">√öltimos 50 Concursos</option>
                  </select>
                </div>
              </div>
              <div class="mt-4 p-3 bg-[#1A1D25] rounded border-l-4 border-[#00E38C]">
                <p class="text-sm text-[#00E38C] font-medium">üí° Dica:</p>
                <p class="text-xs text-gray-300">Marque as op√ß√µes que fazem sentido para sua estrat√©gia. Elas ser√£o usadas na An√°lise Premium.</p>
              </div>
            </div>
          </div>
        `;
        
        // Criar gr√°fico combinado: Absoluta vs Relativa
        const xNumeros = data.frequencia_absoluta_numeros.map(e => e.numero);
        const yFreqAbs = data.frequencia_absoluta_numeros.map(e => e.frequencia);
        const yFreqRelComb = data.frequencia_relativa_numeros.map(e => e.frequencia);
        const linhaEsperadaComb = Array(50).fill(2); // Linha de refer√™ncia 2%
        
        // Detectar se √© smartphone para ajustar tamanho da fonte
        const isMobile = window.innerWidth <= 640;
        const fontSize = isMobile ? 6 : 12; // 6px para mobile, 12px para desktop

        Plotly.newPlot('grafico-frequencia', [
          {
            x: xNumeros,
            y: yFreqAbs,
            type: 'bar',
            name: '',
            marker: { color: 'deepskyblue' },
            yaxis: 'y',
            showlegend: false
          },
          {
            x: xNumeros,
            y: yFreqRelComb,
            type: 'scatter',
            mode: 'lines+markers',
            name: '',
            line: { color: 'red', width: 2 },
            marker: { color: 'red', size: 4 },
            yaxis: 'y2',
            showlegend: false
          },
          {
            x: xNumeros,
            y: linhaEsperadaComb,
            type: 'scatter',
            mode: 'lines',
            name: 'Freq. esperada',
            line: { color: 'white', dash: 'dash', width: 2 },
            yaxis: 'y2'
          }
        ], {
          title: {
            text: 'Freq. N√∫meros', // T√≠tulo principal mais conciso para mobile
            font: { size: 14 } // Tamanho da fonte menor para o t√≠tulo do gr√°fico
          },
          paper_bgcolor: '#1a1a1a',
          plot_bgcolor: '#1a1a1a',
          font: { color: 'white' },
          autosize: true,
          responsive: true,
          // Reduzir as margens ao m√≠nimo necess√°rio para os r√≥tulos dos eixos
          margin: { 
            l: 25, // Margem esquerda m√≠nima
            r: 25, // Margem direita m√≠nima
            b: 70, // Ajuste para acomodar r√≥tulos inclinados do eixo X
            t: 40, // Margem superior
            pad: 0 // Sem padding extra interno ao gr√°fico
          },
          xaxis: { 
            automargin: true,
            // CHAVE PARA OS R√ìTULOS SOBREPOSTOS:
            tickangle: 45, // Incline os r√≥tulos em 45 graus
            tickfont: { size: 8 }, // Diminua o tamanho da fonte dos r√≥tulos para que caibam melhor
            // showgrid: false // Remover grade vertical para menos polui√ß√£o visual se n√£o for essencial
          },
          yaxis: { 
            automargin: true,
            title: {
              text: 'Abs.', // T√≠tulo do eixo Y mais curto para economizar espa√ßo
              font: { size: 9 } // Fonte menor para o t√≠tulo do eixo Y
            },
            tickfont: { size: 9 } // Fonte menor para os r√≥tulos do eixo Y
          },
          yaxis2: { 
            side: 'right',
            overlaying: 'y',
            automargin: true,
            title: {
              text: 'Rel. (%)', // T√≠tulo do eixo Y2 mais curto
              font: { size: 9, color: 'red' }
            },
            tickfont: { color: 'red', size: 9 }
          },
          showlegend: false
        }, { displayModeBar: false });

        // Garantir que o gr√°fico se redimensione quando a janela mudar
        window.addEventListener('resize', () => {
          Plotly.relayout('grafico-frequencia', { 'autosize': true });
        });

        // Carregar matriz visual com dados reais
        setTimeout(() => {
          console.log('Tentando carregar matriz...');
          console.log('data.analise_temporal:', data.analise_temporal);
          console.log('concursosMock:', concursosMock);
          
          if (data.analise_temporal && Array.isArray(data.analise_temporal)) {
            console.log('Usando dados reais da API');
            montarMatriz(data.analise_temporal);
          } else {
            console.log('Usando dados mock');
            montarMatriz(concursosMock); // fallback para teste
          }
        }, 100);

              } catch (error) {
          container.innerHTML = `<p style="color: red;">Erro ao atualizar dados: ${error.message}</p>`;
        }
      }

      // Fun√ß√µes para o popup de ajuda
      function abrirPopupAjuda() {
        document.getElementById("popupAjuda").style.display = "block";
      }

      function fecharPopupAjuda() {
        document.getElementById("popupAjuda").style.display = "none";
      }

      // Fun√ß√µes para o popup de ajuda de distribui√ß√£o
      function abrirPopupAjudaDistribuicao() {
        document.getElementById("popupAjudaDistribuicao").style.display = "block";
      }

      function fecharPopupAjudaDistribuicao() {
        document.getElementById("popupAjudaDistribuicao").style.display = "none";
      }

      // Fun√ß√µes para o popup de ajuda de afinidades
      function abrirPopupAjudaAfinidades() {
        document.getElementById("popupAjudaAfinidades").style.display = "block";
      }

      function fecharPopupAjudaAfinidades() {
        document.getElementById("popupAjudaAfinidades").style.display = "none";
      }

      // Fun√ß√µes para o popup de ajuda de trevos
      function abrirPopupAjudaTrevos() {
        document.getElementById("popupAjudaTrevos").style.display = "block";
      }

      function fecharPopupAjudaTrevos() {
        document.getElementById("popupAjudaTrevos").style.display = "none";
      }

    // Carregar an√°lise de distribui√ß√£o
    async function carregarAnaliseDistribuicao(container, qtdConcursos = null) {
      container.innerHTML = "üîÑ Carregando an√°lise de distribui√ß√£o...";

      try {
        console.log("Iniciando fetch para /api/analise_de_distribuicao...");
        const url = qtdConcursos ? `/api/analise_de_distribuicao?qtd_concursos=${qtdConcursos}` : '/api/analise_de_distribuicao';
        const response = await fetch(url);
        console.log("Response status:", response.status);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log("Dados recebidos:", data);

        if (data.error) {
          container.innerHTML = `<p style="color: red;">Erro: ${data.error}</p>`;
          return;
        }

        // Renderizar gr√°ficos de distribui√ß√£o
        container.innerHTML = `
          <div class="space-y-6">
            <!-- Cabe√ßalho com t√≠tulo e ajuda -->
            <div class="flex justify-between items-start">
              <div class="bg-[#2E303A] p-4 rounded-xl flex-1">
                <h3 class="text-lg font-semibold mb-3 text-[#00E38C]">üéØ Janela de An√°lise Temporal</h3>
                <div class="flex flex-wrap gap-3 items-center">
                  <label class="text-sm text-gray-300">Per√≠odo:</label>
                  <select id="selectDistribuicaoPeriodo" class="bg-[#1A1D25] text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-[#00E38C] focus:outline-none" onchange="updateDistribuicaoModal()">
                    <option value="" ${qtdConcursos === '' || !qtdConcursos ? 'selected' : ''}>Todos os concursos</option>
                    <option value="10" ${qtdConcursos === '10' ? 'selected' : ''}>√öltimos 10 concursos</option>
                    <option value="25" ${qtdConcursos === '25' ? 'selected' : ''}>√öltimos 25 concursos</option>
                    <option value="50" ${qtdConcursos === '50' ? 'selected' : ''}>√öltimos 50 concursos</option>
                    <option value="100" ${qtdConcursos === '100' ? 'selected' : ''}>√öltimos 100 concursos</option>
                    <option value="200" ${qtdConcursos === '200' ? 'selected' : ''}>√öltimos 200 concursos</option>
                  </select>
                  <span class="text-xs text-gray-400">(Selecione para atualizar a an√°lise)</span>
                </div>
                <div class="mt-2 text-xs text-gray-400" id="distribuicaoPeriodoDisplay">
                  ${qtdConcursos ? `An√°lise dos √∫ltimos ${qtdConcursos} concursos.` : 'An√°lise de todos os concursos dispon√≠veis.'}
                </div>
              </div>
              <button onclick="abrirPopupAjudaDistribuicao()" class="ml-4 bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition-colors duration-200" title="Como usar estes gr√°ficos?">
                ‚ùì
              </button>
            </div>
            
            <!-- Gr√°fico de Paridade - N√∫meros Principais -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üî¢ Paridade - N√∫meros Principais${qtdConcursos ? ` (√öltimos ${qtdConcursos} concursos)` : ''}</h3>
              <div id="grafico-paridade-numeros" style="height: 400px;"></div>
            </div>
            
            <!-- Gr√°fico de Paridade - Trevos -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üçÄ Paridade - Trevos${qtdConcursos ? ` (√öltimos ${qtdConcursos} concursos)` : ''}</h3>
              <div id="grafico-paridade-trevos" style="height: 400px;"></div>
            </div>
            
            <!-- Estat√≠sticas de Paridade -->
            <div class="grid grid-cols-2 gap-4">
              <div class="stat-card p-4">
                <h4 class="font-semibold mb-2">üìä N√∫meros Principais${qtdConcursos ? ` (√öltimos ${qtdConcursos} concursos)` : ''}</h4>
                <p class="text-sm text-gray-400">M√©dia de Pares: <span class="text-[#00E38C]">${data.paridade.numeros_principais.media_pares.toFixed(2)}</span></p>
                <p class="text-sm text-gray-400">M√©dia de √çmpares: <span class="text-[#00E38C]">${data.paridade.numeros_principais.media_impares.toFixed(2)}</span></p>
              </div>
              <div class="stat-card p-4">
                <h4 class="font-semibold mb-2">üçÄ Trevos${qtdConcursos ? ` (√öltimos ${qtdConcursos} concursos)` : ''}</h4>
                <p class="text-sm text-gray-400">M√©dia de Pares: <span class="text-[#00E38C]">${data.paridade.trevos.media_pares.toFixed(2)}</span></p>
                <p class="text-sm text-gray-400">M√©dia de √çmpares: <span class="text-[#00E38C]">${data.paridade.trevos.media_impares.toFixed(2)}</span></p>
              </div>
            </div>
            
            <!-- Gr√°fico de Soma - N√∫meros Principais -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üìä Soma dos N√∫meros Principais${qtdConcursos ? ` (√öltimos ${qtdConcursos} concursos)` : ''}</h3>
              <div id="grafico-soma-numeros" style="height: 400px;"></div>
            </div>
            
            <!-- Gr√°fico de Soma - Trevos -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üçÄ Soma dos Trevos${qtdConcursos ? ` (√öltimos ${qtdConcursos} concursos)` : ''}</h3>
              <div id="grafico-soma-trevos" style="height: 400px;"></div>
            </div>
            
            <!-- Estat√≠sticas de Soma -->
            <div class="grid grid-cols-2 gap-4">
              <div class="stat-card p-4">
                <h4 class="font-semibold mb-2">üìä Soma N√∫meros Principais${qtdConcursos ? ` (√öltimos ${qtdConcursos} concursos)` : ''}</h4>
                <p class="text-sm text-gray-400">M√≠n: <span class="text-[#00E38C]">${data.soma_dos_numeros.numeros_principais.min}</span></p>
                <p class="text-sm text-gray-400">M√°x: <span class="text-[#00E38C]">${data.soma_dos_numeros.numeros_principais.max}</span></p>
                <p class="text-sm text-gray-400">M√©dia: <span class="text-[#00E38C]">${data.soma_dos_numeros.numeros_principais.media}</span></p>
                <p class="text-sm text-gray-400">Moda: <span class="text-[#00E38C]">${data.soma_dos_numeros.numeros_principais.moda}</span></p>
              </div>
              <div class="stat-card p-4">
                <h4 class="font-semibold mb-2">üçÄ Soma Trevos${qtdConcursos ? ` (√öltimos ${qtdConcursos} concursos)` : ''}</h4>
                <p class="text-sm text-gray-400">M√≠n: <span class="text-[#00E38C]">${data.soma_dos_numeros.trevos.min}</span></p>
                <p class="text-sm text-gray-400">M√°x: <span class="text-[#00E38C]">${data.soma_dos_numeros.trevos.max}</span></p>
                <p class="text-sm text-gray-400">M√©dia: <span class="text-[#00E38C]">${data.soma_dos_numeros.trevos.media}</span></p>
                <p class="text-sm text-gray-400">Moda: <span class="text-[#00E38C]">${data.soma_dos_numeros.trevos.moda}</span></p>
              </div>
            </div>
            
            <!-- Gr√°fico de Amplitude - N√∫meros Principais -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üìè Amplitude dos N√∫meros Principais${qtdConcursos ? ` (√öltimos ${qtdConcursos} concursos)` : ''}</h3>
              <div id="grafico-amplitude-numeros" style="height: 400px;"></div>
            </div>
            
            <!-- Estat√≠sticas de Amplitude -->
            <div class="grid grid-cols-1 gap-4">
              <div class="stat-card p-4">
                <h4 class="font-semibold mb-2">üìè Amplitude (Maior - Menor N√∫mero)</h4>
                <p class="text-sm text-gray-400">M√≠n: <span class="text-[#00E38C]">${data.amplitude_dos_numeros.min}</span></p>
                <p class="text-sm text-gray-400">M√°x: <span class="text-[#00E38C]">${data.amplitude_dos_numeros.max}</span></p>
                <p class="text-sm text-gray-400">M√©dia: <span class="text-[#00E38C]">${data.amplitude_dos_numeros.media}</span></p>
                <p class="text-sm text-gray-400">Moda: <span class="text-[#00E38C]">${data.amplitude_dos_numeros.moda}</span></p>
              </div>
            </div>
            
            <!-- SUGEST√ïES PARA APOSTA PREMIUM -->
            <div class="mt-8 bg-[#2E303A] p-4 rounded-lg shadow-md">
              <h4 class="text-[#00E38C] text-xl font-semibold mb-4">üéØ Sugest√µes para Aposta Inteligente</h4>
              <div class="container-opcoes-aposta space-y-3">
                <div class="flex items-center">
                  <input type="checkbox" id="dist-priorizar-pares-impares" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="distribuicao" data-pref-name="priorizarParesImpares">
                  <label for="dist-priorizar-pares-impares" class="text-white">Priorizar Paridade (Pares/√çmpares)</label>
                  <select id="dist-paridade-desejada" class="select-premium-pref ml-auto bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" data-pref-type="distribuicao" data-pref-name="paridadeDesejada">
                    <option value="equilibrado">Equilibrada (3 pares/3 √≠mpares)</option>
                    <option value="mais_pares">Mais Pares</option>
                    <option value="mais_impares">Mais √çmpares</option>
                  </select>
                </div>
                <div class="flex items-center">
                  <input type="checkbox" id="dist-priorizar-soma" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="distribuicao" data-pref-name="priorizarSoma">
                  <label for="dist-priorizar-soma" class="text-white">Priorizar Soma dos N√∫meros</label>
                </div>
                <div class="soma-opcoes-container">
                  <div class="flex items-center mb-2">
                    <label for="dist-soma-min" class="text-gray-300 text-sm mr-2">Soma Min:</label>
                    <input type="number" id="dist-soma-min" class="w-20 bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" value="100" min="21" max="285">
                  </div>
                  <div class="flex items-center">
                    <label for="dist-soma-max" class="text-gray-300 text-sm mr-2">Soma Max:</label>
                    <input type="number" id="dist-soma-max" class="w-20 bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" value="200" min="21" max="285">
                  </div>
                </div>
              </div>
              <div class="mt-4 p-3 bg-[#1A1D25] rounded border-l-4 border-[#00E38C]">
                <p class="text-sm text-[#00E38C] font-medium">üí° Dica:</p>
                <p class="text-xs text-gray-300">Marque as op√ß√µes que fazem sentido para sua estrat√©gia. Elas ser√£o usadas na An√°lise Premium.</p>
              </div>
            </div>
          </div>
        `;

        // Verificar estrutura dos dados
        console.log("Estrutura dos dados:", {
          temParidade: !!data.paridade,
          paridadeKeys: data.paridade ? Object.keys(data.paridade) : 'N/A',
          numerosPrincipais: data.paridade?.numeros_principais,
          trevos: data.paridade?.trevos
        });

        // Criar gr√°ficos
        criarGraficoParidadeNumeros(data.paridade.numeros_principais.distribuicao);
        criarGraficoParidadeTrevos(data.paridade.trevos.distribuicao);
        criarGraficoSomaNumeros(data.soma_dos_numeros.numeros_principais);
        criarGraficoSomaTrevos(data.soma_dos_numeros.trevos);
        criarGraficoAmplitude(data.amplitude_dos_numeros);

        console.log("Dados de distribui√ß√£o recebidos:", data);
        
      } catch (error) {
        console.error('Erro ao carregar an√°lise de distribui√ß√£o:', error);
        container.innerHTML = '<p class="text-center text-red-500 mt-4">Erro ao carregar a an√°lise de distribui√ß√£o. Verifique o console para detalhes.</p>';
      }
    }

    // Fun√ß√£o para criar o Gr√°fico de Barras de Paridade dos N√∫meros Principais
    function criarGraficoParidadeNumeros(dataDistribuicao) {
      // Converte o objeto de distribui√ß√£o em arrays para Plotly
      const labels = Object.keys(dataDistribuicao);
      const values = Object.values(dataDistribuicao);

      const data = [{
        x: labels,
        y: values,
        type: 'bar',
        marker: {
          color: labels.map(label => {
            // Cores baseadas nas combina√ß√µes P/I
            if (label.includes('6P')) return '#4CAF50'; // Mais pares
            if (label.includes('0P')) return '#F44336'; // Mais √≠mpares
            if (label.includes('3P-3I')) return '#2196F3'; // Equil√≠brio
            return '#9C27B0'; // Outros
          })
        }
      }];

      const layout = {
        title: 'Distribui√ß√£o de Paridade (N√∫meros Principais)',
        xaxis: { title: 'Combina√ß√£o Par/√çmpar', automargin: true },
        yaxis: { title: 'Contagem', automargin: true },
        plot_bgcolor: '#1a1d25',
        paper_bgcolor: '#1a1d25',
        font: {
          color: '#FFFFFF'
        },
        responsive: true,
        margin: { t: 50, b: 50, l: 50, r: 20 }
      };

      Plotly.newPlot('grafico-paridade-numeros', data, layout);
    }

    // Fun√ß√£o para criar o Gr√°fico de Pizza de Paridade dos Trevos
    function criarGraficoParidadeTrevos(dataDistribuicao) {
      // Converte o objeto de distribui√ß√£o em arrays para Plotly
      const labels = Object.keys(dataDistribuicao);
      const values = Object.values(dataDistribuicao);

      const data = [{
        labels: labels,
        values: values,
        type: 'pie',
        marker: {
          colors: ['#8B5CF6', '#A78BFA', '#C4B5FD', '#DDD6FE']
        },
        hoverinfo: 'label+percent',
        textinfo: 'percent',
        textposition: 'inside'
      }];

      const layout = {
        title: 'Distribui√ß√£o de Paridade (Trevos da Sorte)',
        plot_bgcolor: '#1a1d25',
        paper_bgcolor: '#1a1d25',
        font: {
          color: '#FFFFFF'
        },
        responsive: true,
        margin: { t: 50, b: 50, l: 50, r: 20 }
      };

      Plotly.newPlot('grafico-paridade-trevos', data, layout);
    }

    // Fun√ß√£o para criar o Gr√°fico de Soma dos N√∫meros Principais
    function criarGraficoSomaNumeros(dadosSoma) {
      const minSoma = dadosSoma.min;
      const maxSoma = dadosSoma.max;
      const mediaSoma = dadosSoma.media;
      const modaSoma = dadosSoma.moda;
      const somas = dadosSoma.somas; // Lista real de somas hist√≥ricas

      const data = [{
        x: somas,
        type: 'histogram',
        marker: {
          color: '#8B5CF6'
        },
        xbins: {
          size: 5
        },
        opacity: 0.75,
        name: 'Contagem de Somas'
      }];

      const layout = {
        title: 'Distribui√ß√£o da Soma dos 6 N√∫meros Principais',
        xaxis: { title: 'Soma dos N√∫meros', automargin: true },
        yaxis: { title: 'Frequ√™ncia', automargin: true },
        plot_bgcolor: '#1a1d25',
        paper_bgcolor: '#1a1d25',
        font: {
          color: '#FFFFFF'
        },
        responsive: true,
        margin: { t: 50, b: 50, l: 50, r: 20 },
        annotations: [
          {
            xref: 'paper', yref: 'paper',
            x: 0.05, y: 0.95,
            text: `Min: ${minSoma}<br>Max: ${maxSoma}<br>M√©dia: ${mediaSoma}<br>Moda: ${modaSoma}`,
            showarrow: false,
            align: 'left',
            font: { color: '#FFFFFF', size: 10 },
            bgcolor: 'rgba(0,0,0,0.5)',
            bordercolor: '#8B5CF6',
            borderwidth: 1,
            borderpad: 4
          }
        ]
      };

      Plotly.newPlot('grafico-soma-numeros', data, layout);
    }

    // Fun√ß√£o para criar o Gr√°fico de Soma dos Trevos
    function criarGraficoSomaTrevos(dadosSomaTrevos) {
      const minSomaTrevos = dadosSomaTrevos.min;
      const maxSomaTrevos = dadosSomaTrevos.max;
      const mediaSomaTrevos = dadosSomaTrevos.media;
      const modaSomaTrevos = dadosSomaTrevos.moda;
      const somasTrevos = dadosSomaTrevos.somas; // Lista real de somas hist√≥ricas

      const data = [{
        x: somasTrevos,
        type: 'histogram',
        marker: {
          color: '#FFD700'
        },
        xbins: {
          size: 1
        },
        opacity: 0.75,
        name: 'Contagem de Somas de Trevos'
      }];

      const layout = {
        title: 'Distribui√ß√£o da Soma dos 2 Trevos da Sorte',
        xaxis: { title: 'Soma dos Trevos', automargin: true },
        yaxis: { title: 'Frequ√™ncia', automargin: true },
        plot_bgcolor: '#1a1d25',
        paper_bgcolor: '#1a1d25',
        font: {
          color: '#FFFFFF'
        },
        responsive: true,
        margin: { t: 50, b: 50, l: 50, r: 20 },
        annotations: [
          {
            xref: 'paper', yref: 'paper',
            x: 0.05, y: 0.95,
            text: `Min: ${minSomaTrevos}<br>Max: ${maxSomaTrevos}<br>M√©dia: ${mediaSomaTrevos}<br>Moda: ${modaSomaTrevos}`,
            showarrow: false,
            align: 'left',
            font: { color: '#FFFFFF', size: 10 },
            bgcolor: 'rgba(0,0,0,0.5)',
            bordercolor: '#FFD700',
            borderwidth: 1,
            borderpad: 4
          }
        ]
      };

      Plotly.newPlot('grafico-soma-trevos', data, layout);
    }

    // Fun√ß√£o para criar o Gr√°fico de Amplitude dos N√∫meros Principais
    function criarGraficoAmplitude(dadosAmplitude) {
      const amplitudes = dadosAmplitude.amplitudes; // Lista de todas as amplitudes
      const minAmplitude = dadosAmplitude.min;
      const maxAmplitude = dadosAmplitude.max;
      const mediaAmplitude = dadosAmplitude.media;
      const modaAmplitude = dadosAmplitude.moda;

      const data = [{
        x: amplitudes,
        type: 'histogram',
        marker: {
          color: '#00BFFF' // Um tom de azul claro
        },
        xbins: {
          size: 2 // Agrupa amplitudes em intervalos de 2, ajuste conforme necess√°rio
        },
        opacity: 0.75,
        name: 'Contagem de Amplitudes'
      }];

      const layout = {
        title: 'Distribui√ß√£o da Amplitude dos 6 N√∫meros Principais',
        xaxis: { title: 'Amplitude (Maior - Menor N√∫mero)', automargin: true },
        yaxis: { title: 'Frequ√™ncia', automargin: true },
        plot_bgcolor: '#1a1d25',
        paper_bgcolor: '#1a1d25',
        font: {
          color: '#FFFFFF'
        },
        responsive: true,
        margin: { t: 50, b: 50, l: 50, r: 20 },
        annotations: [
          {
            xref: 'paper', yref: 'paper',
            x: 0.05, y: 0.95, // Posi√ß√£o superior esquerda
            text: `Min: ${minAmplitude}<br>Max: ${maxAmplitude}<br>M√©dia: ${mediaAmplitude.toFixed(2)}<br>Moda: ${modaAmplitude}`,
            showarrow: false,
            align: 'left',
            font: { color: '#FFFFFF', size: 10 },
            bgcolor: 'rgba(0,0,0,0.5)',
            bordercolor: '#00BFFF',
            borderwidth: 1,
            borderpad: 4
          }
        ]
      };

      Plotly.newPlot('grafico-amplitude-numeros', data, layout);
    }
    // Carregar an√°lise de afinidades
    async function carregarAnaliseAfinidades(container, qtdConcursos = null) {
      container.innerHTML = "üîÑ Carregando an√°lise de afinidades...";

      try {
        let url = '/api/analise_de_combinacoes';
        if (qtdConcursos !== null && qtdConcursos !== '') {
          url += `?qtd_concursos=${qtdConcursos}`;
        }

        console.log("=== REQUISI√á√ÉO AFINIDADES ===");
        console.log("URL:", url);
        console.log("qtdConcursos:", qtdConcursos);

        const response = await fetch(url);
        const data = await response.json();

        console.log("=== DADOS RECEBIDOS DO BACKEND ===");
        console.log("Data completo:", data);
        console.log("Afinidade entre n√∫meros:", data.afinidade_entre_numeros);

        if (data.error) {
          container.innerHTML = `<p style="color: red;">Erro: ${data.error}</p>`;
          return;
        }

        const afinidades = data.afinidade_entre_numeros;
        const periodoInfo = data.periodo_analisado;
        
        // Debug espec√≠fico da tabela
        // console.log("=== DEBUG TABELA DETALHADA ===");  // DEBUG - COMENTADO
        // console.log("Per√≠odo solicitado:", qtdConcursos);  // DEBUG - COMENTADO
        // console.log("Per√≠odo analisado:", periodoInfo);  // DEBUG - COMENTADO
        // console.log("Pares com maior afinidade:", afinidades.pares_com_maior_afinidade);  // DEBUG - COMENTADO
        // console.log("Primeiros 5 pares:", afinidades.pares_com_maior_afinidade.slice(0, 5));  // DEBUG - COMENTADO
        // console.log("Frequ√™ncias dos primeiros 5 pares:", afinidades.pares_com_maior_afinidade.slice(0, 5).map(p => p[1]));  // DEBUG - COMENTADO
        
        // Verificar se os dados est√£o no formato correto
        if (!afinidades || !afinidades.pares_com_maior_afinidade || !afinidades.numeros_com_maior_afinidade_geral) {
          container.innerHTML = `<p style="color: red;">Erro: Dados de afinidade incompletos ou em formato incorreto.</p>`;
          return;
        }

        container.innerHTML = `
          <div class="space-y-6">
            <!-- Cabe√ßalho com t√≠tulo e ajuda -->
            <div class="flex justify-between items-start">
              <div class="bg-[#2E303A] p-4 rounded-xl flex-1">
                <h3 class="text-lg font-semibold mb-3 text-[#00E38C]">üéØ Janela de An√°lise Temporal</h3>
                <div class="flex flex-wrap gap-3 items-center">
                  <label class="text-sm text-gray-300">Per√≠odo:</label>
                  <select id="janela-analise-afinidades" class="bg-[#1A1D25] text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-[#00E38C] focus:outline-none" onchange="updateAfinidadeModal()">
                    <option value="25" ${qtdConcursos === '25' ? 'selected' : ''}>√öltimos 25 concursos</option>
                    <option value="50" ${qtdConcursos === '50' ? 'selected' : ''}>√öltimos 50 concursos</option>
                    <option value="100" ${qtdConcursos === '100' ? 'selected' : ''}>√öltimos 100 concursos</option>
                    <option value="130" ${qtdConcursos === '130' ? 'selected' : ''}>√öltimos 130 concursos</option>
                  </select>
                  <span class="text-xs text-gray-400">(Selecione para atualizar a an√°lise)</span>
                </div>
              </div>
              <button onclick="abrirPopupAjudaAfinidades()" class="ml-4 bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition-colors duration-200" title="Como usar esta an√°lise?">
                ‚ùì
              </button>
            </div>
            
            <!-- Top 15 Pares com Maior Afinidade -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üîó Pares com Maior Afinidade (Top 15)</h3>
              <div class="afinidades-grid">
                ${afinidades.pares_com_maior_afinidade.slice(0, 15).map(par => 
                  `<div class="afinidade-card">
                    <div class="info">
                      <div class="par">${par[0][0]} ‚Ä¢ ${par[0][1]}</div>
                      <div class="sub">Top 15 ‚Ä¢ co-ocorr√™ncia</div>
                    </div>
                    <div class="score">${par[1]}x</div>
                  </div>`
                ).join('')}
              </div>
            </div>
            
            <!-- Top 15 N√∫meros com Maior Afinidade Geral -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">‚≠ê N√∫meros com Maior Afinidade Geral (Top 15)</h3>
              <div class="afinidades-grid">
                ${afinidades.numeros_com_maior_afinidade_geral.slice(0, 15).map(num => 
                  `<div class="afinidade-card" style="background: linear-gradient(180deg, #4c1d95, #6d28d9); border-color: #a855f7;">
                    <div class="info">
                      <div class="par">${num[0]}</div>
                      <div class="sub">Top 15 ‚Ä¢ pontos</div>
                    </div>
                    <div class="score">${num[1]} pts</div>
                  </div>`
                ).join('')}
              </div>
            </div>
            
            <!-- Tabela Detalhada de Pares -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üìã Tabela Detalhada - Pares com Maior Afinidade</h3>
              <div class="overflow-x-auto">
                <table class="w-full text-left table-auto border-collapse rounded-lg overflow-hidden">
                  <thead>
                    <tr class="bg-gray-800 text-gray-300 uppercase text-xs">
                      <th class="px-4 py-3 text-center">#</th>
                      <th class="px-4 py-3 text-center">Par</th>
                      <th class="px-4 py-3 text-center">Frequ√™ncia</th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-gray-700">
                    ${afinidades.pares_com_maior_afinidade.slice(0, 25).map((par, i) => {
                      // Debug individual de cada par
                      console.log(`Par ${i + 1}:`, par, `Estrutura: [${par[0][0]}, ${par[0][1]}], Frequ√™ncia: ${par[1]}`);
                      return `<tr class="${i % 2 === 0 ? 'bg-gray-800' : 'bg-gray-700'} hover:bg-gray-600">
                        <td class="px-4 py-2 text-center text-gray-300">${i + 1}</td>
                        <td class="px-4 py-2 text-center text-white font-bold">${par[0][0]} ‚Üî ${par[0][1]}</td>
                        <td class="px-4 py-2 text-center text-[#00E38C] font-semibold">${par[1]} vezes</td>
                      </tr>`;
                    }).join('')}
                  </tbody>
                </table>
              </div>
            </div>
            
            <!-- Debug da Tabela -->
            <div class="mt-4 p-3 bg-gray-800 rounded text-xs text-gray-300">
              <strong>Debug Tabela:</strong> 
              Per√≠odo: ${qtdConcursos || 'Todos'}, 
              Total de pares: ${afinidades.pares_com_maior_afinidade.length}, 
              Primeiros 3 pares: ${afinidades.pares_com_maior_afinidade.slice(0, 3).map(p => `${p[0][0]}-${p[0][1]}(${p[1]})`).join(', ')}
            </div>
            
            <!-- Gr√°fico de Pares com Maior Afinidade -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üìä Gr√°fico de Pares com Maior Afinidade</h3>
              <div id="grafico-pares-afinidade" style="height: 400px;"></div>
            </div>
            
            <!-- Gr√°fico de N√∫meros com Maior Afinidade Geral -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üìà Gr√°fico de Afinidade Geral por N√∫mero</h3>
              <div id="grafico-afinidade-geral" style="height: 400px;"></div>
            </div>
            
            <!-- Gr√°fico de Rede de Afinidade -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üï∏Ô∏è Rede de Afinidade entre N√∫meros</h3>
              <p class="text-sm text-gray-400 mb-4">Visualize as conex√µes entre n√∫meros. Linhas mais grossas = maior afinidade</p>
              
              <!-- Legenda das cores -->
              <div class="flex justify-center gap-6 mb-4 text-xs">
                <div class="flex items-center gap-2">
                  <div class="w-4 h-1 bg-[#8B5CF6]"></div>
                  <span class="text-gray-300">Baixa afinidade</span>
                </div>
                <div class="flex items-center gap-2">
                  <div class="w-4 h-1 bg-[#FFA500]"></div>
                  <span class="text-gray-300">M√©dia afinidade</span>
                </div>
                <div class="flex items-center gap-2">
                  <div class="w-4 h-1 bg-[#00E38C]"></div>
                  <span class="text-gray-300">Alta afinidade</span>
                </div>
              </div>
              
              <div id="grafico-rede-afinidade" style="height: 500px;"></div>
            </div>
            
            <!-- Dica Estrat√©gica -->
            <div class="mt-8 p-4 bg-blue-900 bg-opacity-30 rounded-lg text-center text-blue-300 border border-blue-800 shadow">
              <span class="font-semibold">üí° Dica Estrat√©gica:</span> Combine n√∫meros com forte afinidade e alta conex√£o geral para aumentar suas chances de formar grupos vencedores!
            </div>
            
            <!-- SUGEST√ïES PARA APOSTA PREMIUM -->
            <div class="mt-8 bg-[#2E303A] p-4 rounded-lg shadow-md">
              <h4 class="text-[#00E38C] text-xl font-semibold mb-4">üéØ Sugest√£o para Aposta Inteligente (Afinidades)</h4>
              <div class="space-y-3">
                  <div class="flex items-center">
                      <input type="checkbox" id="afinidade-priorizar-pares-fortes" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="afinidades" data-pref-name="priorizarParesFortes">
                      <label for="afinidade-priorizar-pares-fortes" class="text-white">Priorizar Pares com Forte Afinidade</label>
                      <input type="number" id="afinidade-qtde-pares" class="ml-auto w-16 bg-[#1A1D25] border border-gray-600 text-white rounded px-2 py-1 text-sm" value="3" min="1" max="10">
                  </div>
                  <div class="flex items-center">
                      <input type="checkbox" id="afinidade-priorizar-numeros-conectados" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="afinidades" data-pref-name="priorizarNumerosConectados">
                      <label for="afinidade-priorizar-numeros-conectados" class="text-white">Priorizar N√∫meros com Alta Conex√£o Geral</label>
                      <input type="number" id="afinidade-qtde-numeros" class="ml-auto w-16 bg-[#1A1D25] border border-gray-600 text-white rounded px-2 py-1 text-sm" value="4" min="1" max="10">
                  </div>
                  <div class="flex items-center">
                      <input type="checkbox" id="afinidade-evitar-pares-fracos" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="afinidades" data-pref-name="evitarParesFracos">
                      <label for="afinidade-evitar-pares-fracos" class="text-white">Evitar Pares com Afinidade Fraca</label>
                  </div>
              </div>
            </div>
          </div>
        `;
        
        // Criar gr√°fico de pares com maior afinidade
        console.log("Dados de afinidade:", afinidades);
        console.log("Pares com maior afinidade:", afinidades.pares_com_maior_afinidade);
        console.log("Primeiro par:", afinidades.pares_com_maior_afinidade[0]);
        console.log("Tipo do primeiro par:", typeof afinidades.pares_com_maior_afinidade[0]);
        console.log("√â array?", Array.isArray(afinidades.pares_com_maior_afinidade[0]));
        
        // Verificar se h√° dados v√°lidos para o gr√°fico
        if (afinidades.pares_com_maior_afinidade && afinidades.pares_com_maior_afinidade.length > 0) {
          const paresLabels = afinidades.pares_com_maior_afinidade.slice(0, 15).map((par, index) => {
            console.log(`Par ${index}:`, par);
            // Verificar se o par tem a estrutura correta
            if (Array.isArray(par) && par.length >= 2 && Array.isArray(par[0])) {
              return `${par[0][0]}-${par[0][1]}`;
            } else if (Array.isArray(par) && par.length >= 2) {
              // Estrutura alternativa: [num1, num2, count]
              return `${par[0]}-${par[1]}`;
            } else {
              console.error("Estrutura de par inv√°lida:", par);
              return `Erro-${index}`;
            }
          });
          
          const paresValues = afinidades.pares_com_maior_afinidade.slice(0, 15).map((par, index) => {
            if (Array.isArray(par) && par.length >= 2 && Array.isArray(par[0])) {
              return par[1];
            } else if (Array.isArray(par) && par.length >= 3) {
              // Estrutura alternativa: [num1, num2, count]
              return par[2];
            } else {
              console.error("Valor de par inv√°lido:", par);
              return 0;
            }
          });
          
          console.log("Labels dos pares:", paresLabels);
          console.log("Valores dos pares:", paresValues);

          Plotly.newPlot('grafico-pares-afinidade', [{
            x: paresLabels,
            y: paresValues,
            type: 'bar',
            marker: { color: '#00E38C' }
          }], {
            title: 'Pares com Maior Afinidade',
            paper_bgcolor: '#1a1a1a',
            plot_bgcolor: '#1a1a1a',
            font: { color: 'white' },
            xaxis: { 
              automargin: true,
              title: 'Pares (N√∫mero-N√∫mero)',
              tickformat: ',d'
            },
            yaxis: { 
              automargin: true,
              title: 'Frequ√™ncia (x)',
              tickformat: ',d'
            },
            showlegend: false,
            autosize: true,
            responsive: true,
            margin: { l: 40, r: 20, t: 40, b: 40, pad: 5 }
          }, { displayModeBar: false });
        } else {
          console.error("Nenhum dado de pares encontrado");
          document.getElementById('grafico-pares-afinidade').innerHTML = '<p style="color: red; text-align: center;">Erro: Dados de pares n√£o encontrados</p>';
        }

        // Criar gr√°fico de afinidade geral por n√∫mero
        const numerosLabels = afinidades.numeros_com_maior_afinidade_geral.slice(0, 20).map(num => num[0]);
        const numerosValues = afinidades.numeros_com_maior_afinidade_geral.slice(0, 20).map(num => num[1]);

        Plotly.newPlot('grafico-afinidade-geral', [{
          x: numerosLabels,
          y: numerosValues,
          type: 'bar',
          marker: { color: '#8B5CF6' }
        }], {
          title: 'Afinidade Geral por N√∫mero',
          paper_bgcolor: '#1a1a1a',
          plot_bgcolor: '#1a1a1a',
          font: { color: 'white' },
          xaxis: { automargin: true },
          yaxis: { automargin: true },
          showlegend: false,
          autosize: true,
          responsive: true,
          margin: { l: 40, r: 20, t: 40, b: 40, pad: 5 }
        }, { displayModeBar: false });

        // Criar gr√°fico de rede de afinidade
        console.log("=== CRIANDO GR√ÅFICO DE REDE ===");
        
        // Pegar TODOS os pares para a rede (ou usar top 30 se n√£o houver todos_pares_afinidade)
        const todosParesRede = afinidades.todos_pares_afinidade || afinidades.pares_com_maior_afinidade;
        const topParesRede = todosParesRede.slice(0, 30); // Usar top 30 para n√£o sobrecarregar
        console.log("Total de pares dispon√≠veis:", todosParesRede.length);
        console.log("Pares para rede (top 30):", topParesRede.length);
        
        // Criar n√≥s (n√∫meros √∫nicos)
        const numerosUnicos = new Set();
        topParesRede.forEach(par => {
          numerosUnicos.add(par[0][0]);
          numerosUnicos.add(par[0][1]);
        });
        
        const nodes = Array.from(numerosUnicos).map(num => ({
          id: num,
          label: num.toString(),
          size: 20 + (afinidades.numeros_com_maior_afinidade_geral.find(n => n[0] === num)?.[1] || 0) / 10
        }));
        
        // Criar arestas (conex√µes)
        const edges = topParesRede.map((par, index) => ({
          from: par[0][0],
          to: par[0][1],
          value: par[1],
          title: `${par[0][0]} ‚Üî ${par[0][1]}: ${par[1]} vezes`
        }));
        
        console.log("N√≥s da rede:", nodes);
        console.log("Arestas da rede:", edges);
        
        // Criar dados para Plotly
        const nodeX = [];
        const nodeY = [];
        const nodeText = [];
        const nodeSize = [];
        const nodeColor = [];
        
        // Posicionar n√≥s em c√≠rculo
        const radius = 200;
        const centerX = 0;
        const centerY = 0;
        
        nodes.forEach((node, i) => {
          const angle = (i / nodes.length) * 2 * Math.PI;
          nodeX.push(centerX + radius * Math.cos(angle));
          nodeY.push(centerY + radius * Math.sin(angle));
          nodeText.push(node.label);
          nodeSize.push(node.size);
          nodeColor.push('#00E38C');
        });
        
        // Criar arestas
        const edgeX = [];
        const edgeY = [];
        const edgeWidth = [];
        const edgeColors = [];
        
        // Calcular valores m√≠nimos e m√°ximos para normaliza√ß√£o
        const maxFreq = Math.max(...edges.map(e => e.value));
        const minFreq = Math.min(...edges.map(e => e.value));
        const freqRange = maxFreq - minFreq;
        
        console.log("=== DEBUG ESPESSURA DAS LINHAS ===");
        console.log("Frequ√™ncia m√°xima:", maxFreq);
        console.log("Frequ√™ncia m√≠nima:", minFreq);
        console.log("Range de frequ√™ncias:", freqRange);
        
        edges.forEach(edge => {
          const fromNode = nodes.find(n => n.id === edge.from);
          const toNode = nodes.find(n => n.id === edge.to);
          
          if (fromNode && toNode) {
            const fromIndex = nodes.indexOf(fromNode);
            const toIndex = nodes.indexOf(toNode);
            
            edgeX.push([nodeX[fromIndex], nodeX[toIndex], null]);
            edgeY.push([nodeY[fromIndex], nodeY[toIndex], null]);
            
            // Normalizar a espessura baseada na frequ√™ncia
            let normalizedWidth;
            if (freqRange === 0) {
              normalizedWidth = 3; // Se todas as frequ√™ncias s√£o iguais
            } else {
              const normalizedFreq = (edge.value - minFreq) / freqRange;
              normalizedWidth = 2 + (normalizedFreq * 8); // Espessura de 2 a 10
            }
            
            edgeWidth.push(normalizedWidth);
            
            // Cor baseada na intensidade da afinidade
            const intensity = (edge.value - minFreq) / freqRange;
            const color = intensity > 0.7 ? '#00E38C' : intensity > 0.4 ? '#FFA500' : '#8B5CF6';
            edgeColors.push(color);
            
            console.log(`Par ${edge.from}-${edge.to}: Frequ√™ncia=${edge.value}, Espessura=${normalizedWidth.toFixed(2)}, Cor=${color}`);
          }
        });
        
        // Criar trace das arestas
        const edgeTraces = edgeX.map((x, i) => ({
          x: x,
          y: edgeY[i],
          mode: 'lines',
          line: {
            color: edgeColors[i],
            width: edgeWidth[i],
            opacity: 0.8
          },
          hoverinfo: 'text',
          hovertext: edges[i].title,
          showlegend: false
        }));
        
        // Criar trace dos n√≥s
        const nodeTrace = {
          x: nodeX,
          y: nodeY,
          mode: 'markers+text',
          type: 'scatter',
          text: nodeText,
          textposition: 'middle center',
          marker: {
            size: nodeSize,
            color: nodeColor,
            line: {
              color: '#ffffff',
              width: 2
            }
          },
          textfont: {
            color: '#000000',
            size: 12,
            weight: 'bold'
          },
          hoverinfo: 'text',
          hovertext: nodeText.map((text, i) => `N√∫mero ${text}<br>Tamanho: ${nodeSize[i].toFixed(1)}`),
          showlegend: false
        };
        
        // Layout do gr√°fico
        const layout = {
          title: `Rede de Afinidade ${qtdConcursos ? `(√öltimos ${qtdConcursos} concursos)` : '(An√°lise completa)'}`,
          paper_bgcolor: '#1a1a1a',
          plot_bgcolor: '#1a1a1a',
          font: { color: 'white' },
          xaxis: {
            showgrid: false,
            zeroline: false,
            showticklabels: false,
            range: [-250, 250]
          },
          yaxis: {
            showgrid: false,
            zeroline: false,
            showticklabels: false,
            range: [-250, 250]
          },
          showlegend: false,
          autosize: true,
          responsive: true,
          margin: { l: 20, r: 20, t: 40, b: 20, pad: 5 }
        };
        
        // Plotar o gr√°fico
        Plotly.newPlot('grafico-rede-afinidade', [nodeTrace, ...edgeTraces], layout, { displayModeBar: false });

      } catch (error) {
        container.innerHTML = `<p style="color: red;">Erro ao carregar dados: ${error.message}</p>`;
      }
    }



    // Fun√ß√£o para atualizar o modal quando o filtro de per√≠odo √© alterado
    function updateAfinidadeModal() {
      const selectElement = document.getElementById('janela-analise-afinidades');
      const selectedQtd = selectElement.value;
      const container = document.getElementById('conteudo-modal');
      if (container) {
        carregarAnaliseAfinidades(container, selectedQtd);
      }
    }

    // Carregar an√°lise de trevos
    async function carregarAnaliseTrevos(container, qtdConcursos = null) {
      container.innerHTML = "üîÑ Carregando an√°lise dos Trevos da Sorte...";

      try {
        let url = '/api/analise_trevos_da_sorte';
        if (qtdConcursos !== null && qtdConcursos !== '') {
          url += `?qtd_concursos=${qtdConcursos}`;
        }

        console.log("=== REQUISI√á√ÉO TREVOS ===");
        console.log("URL:", url);
        console.log("qtdConcursos:", qtdConcursos);

        const response = await fetch(url);
        const data = await response.json();

        console.log("=== DADOS RECEBIDOS DO BACKEND ===");
        console.log("Data completo:", data);

        if (data.error) {
          container.innerHTML = `<p style="color: red;">Erro: ${data.error}</p>`;
          return;
        }

        // Extrair dados da resposta da API
        const frequenciaTrevos = data.frequencia_trevos || {};
        const combinacoesTrevos = data.combinacoes_trevos || {};
        const correlacaoTrevosBolas = data.correlacao_trevos_bolas || {};
        const periodoInfo = data.periodo_analisado || {};

        console.log("=== DEBUG TREVOS ===");
        console.log("Frequ√™ncia trevos:", frequenciaTrevos);
        console.log("Combina√ß√µes trevos:", combinacoesTrevos);
        console.log("Correla√ß√£o trevos-bolas:", correlacaoTrevosBolas);

        // Converter dados para arrays ordenados
        const trevosOrdenados = Object.entries(frequenciaTrevos)
          .sort((a, b) => b[1] - a[1])
          .map(([trevo, freq]) => ({ trevo: parseInt(trevo), frequencia: freq }));

        const combinacoesOrdenadas = Object.entries(combinacoesTrevos)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 10);

        container.innerHTML = `
          <div class="space-y-6">
            <!-- Cabe√ßalho com t√≠tulo e ajuda -->
            <div class="flex justify-between items-start">
              <div class="bg-[#2E303A] p-4 rounded-xl flex-1">
                <h3 class="text-lg font-semibold mb-3 text-[#00E38C]">üéØ Janela de An√°lise Temporal</h3>
                <div class="flex flex-wrap gap-3 items-center">
                  <label class="text-sm text-gray-300">Per√≠odo:</label>
                  <select id="janela-analise-trevos" class="bg-[#1A1D25] text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-[#00E38C] focus:outline-none" onchange="updateTrevosModal()">
                    <option value="" ${qtdConcursos === '' || !qtdConcursos ? 'selected' : ''}>Todos os concursos</option>
                    <option value="25" ${qtdConcursos === '25' ? 'selected' : ''}>√öltimos 25 concursos</option>
                    <option value="50" ${qtdConcursos === '50' ? 'selected' : ''}>√öltimos 50 concursos</option>
                    <option value="100" ${qtdConcursos === '100' ? 'selected' : ''}>√öltimos 100 concursos</option>
                    <option value="200" ${qtdConcursos === '200' ? 'selected' : ''}>√öltimos 200 concursos</option>
                  </select>
                  <span class="text-xs text-gray-400">(Selecione para atualizar a an√°lise)</span>
                </div>
              </div>
              <button onclick="abrirPopupAjudaTrevos()" class="ml-4 bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition-colors duration-200" title="Como usar esta an√°lise?">
                ‚ùì
              </button>
            </div>
            
            <!-- Frequ√™ncia dos Trevos -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üçÄ Frequ√™ncia dos Trevos (1-6)</h3>
              <div class="grid grid-cols-6 gap-4">
                ${trevosOrdenados.map((item, index) => 
                  `<div class="bg-[#8B5CF6] text-white p-4 rounded text-center">
                    <div class="text-2xl font-bold">${item.trevo}</div>
                    <div class="text-sm">${item.frequencia} vezes</div>
                    <div class="text-xs">${index + 1}¬∫ mais frequente</div>
                  </div>`
                ).join('')}
              </div>
            </div>
            
            <!-- Combina√ß√µes de Trevos -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">ü§ù Combina√ß√µes de Trevos Mais Frequentes</h3>
              
              <!-- Cards visuais das top 5 combina√ß√µes -->
              <div class="grid grid-cols-5 gap-3 mb-6">
                ${combinacoesOrdenadas.slice(0, 5).map((combinacao, index) => {
                  const [trevo1, trevo2] = combinacao[0].split(',');
                  const cores = ['#00E38C', '#8B5CF6', '#F59E0B', '#EF4444', '#06B6D4'];
                  return `<div class="bg-gradient-to-br ${index === 0 ? 'from-yellow-400 to-orange-500' : 'from-gray-700 to-gray-800'} text-white p-4 rounded-lg text-center font-bold shadow-lg transform hover:scale-105 transition-transform duration-200">
                    <div class="text-2xl mb-1">${trevo1} + ${trevo2}</div>
                    <div class="text-sm opacity-90">${combinacao[1]} vezes</div>
                    <div class="text-xs opacity-75 mt-1">${index === 0 ? 'ü•á 1¬∫ lugar' : index === 1 ? 'ü•à 2¬∫ lugar' : index === 2 ? 'ü•â 3¬∫ lugar' : `${index + 1}¬∫ lugar`}</div>
                  </div>`;
                }).join('')}
              </div>
              
              <!-- Tabela detalhada das top 10 combina√ß√µes -->
              <div class="bg-[#1A1D25] p-4 rounded-lg">
                <h4 class="text-md font-semibold mb-3 text-[#00E38C]">üìã Ranking Completo das Combina√ß√µes</h4>
                <div class="overflow-x-auto">
                  <table class="w-full text-sm">
                    <thead>
                      <tr class="border-b border-gray-700">
                        <th class="text-left py-2 text-gray-300">#</th>
                        <th class="text-left py-2 text-gray-300">Combina√ß√£o</th>
                        <th class="text-left py-2 text-gray-300">Frequ√™ncia</th>
                        <th class="text-left py-2 text-gray-300">% dos Concursos</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${combinacoesOrdenadas.slice(0, 10).map((combinacao, index) => {
                        const [trevo1, trevo2] = combinacao[0].split(',');
                        const percentual = ((combinacao[1] / periodoInfo.concursos_analisados) * 100).toFixed(1);
                        return `<tr class="border-b border-gray-800 hover:bg-gray-800 transition-colors">
                          <td class="py-2 text-gray-400">${index + 1}</td>
                          <td class="py-2 font-semibold text-white">${trevo1} + ${trevo2}</td>
                          <td class="py-2 text-[#00E38C] font-bold">${combinacao[1]} vezes</td>
                          <td class="py-2 text-gray-300">${percentual}%</td>
                        </tr>`;
                      }).join('')}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            
            <!-- Gr√°fico de Frequ√™ncia dos Trevos -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üìä Gr√°fico de Frequ√™ncia dos Trevos</h3>
              <div id="grafico-frequencia-trevos" style="height: 400px;"></div>
            </div>
            
            <!-- Gr√°fico de Combina√ß√µes de Trevos -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">ü§ù Gr√°fico de Combina√ß√µes de Trevos</h3>
              <div id="grafico-combinacoes-trevos" style="height: 400px;"></div>
            </div>
            
            <!-- Correla√ß√£o Trevos ‚Üî Bolas -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üîó Correla√ß√£o Trevos ‚Üî N√∫meros Principais</h3>
              <div id="grafico-correlacao-trevos-bolas" style="height: 400px;"></div>
            </div>
            
            <!-- Insights Estrat√©gicos -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üí° Insights Estrat√©gicos</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                
                <!-- Trevo Mais Frequente -->
                <div class="bg-gradient-to-r from-purple-600 to-purple-800 p-4 rounded-lg">
                  <h4 class="font-bold text-white mb-2">ü•á Trevo Mais Quente</h4>
                  <div class="text-2xl font-bold text-yellow-300 mb-1">
                    ${trevosOrdenados.length > 0 ? `Trevo ${trevosOrdenados[0].trevo}` : 'N/A'}
                  </div>
                  <div class="text-sm text-purple-200">
                    ${trevosOrdenados.length > 0 ? `${trevosOrdenados[0].frequencia} vezes (${((trevosOrdenados[0].frequencia / periodoInfo.concursos_analisados) * 100).toFixed(1)}%)` : 'Dados insuficientes'}
                  </div>
                </div>
                
                <!-- Combina√ß√£o Mais Frequente -->
                <div class="bg-gradient-to-r from-green-600 to-green-800 p-4 rounded-lg">
                  <h4 class="font-bold text-white mb-2">ü§ù Dupla Mais Poderosa</h4>
                  <div class="text-2xl font-bold text-yellow-300 mb-1">
                    ${combinacoesOrdenadas.length > 0 ? combinacoesOrdenadas[0][0].replace(',', ' + ') : 'N/A'}
                  </div>
                  <div class="text-sm text-green-200">
                    ${combinacoesOrdenadas.length > 0 ? `${combinacoesOrdenadas[0][1]} vezes (${((combinacoesOrdenadas[0][1] / periodoInfo.concursos_analisados) * 100).toFixed(1)}%)` : 'Dados insuficientes'}
                  </div>
                </div>
                
                <!-- Trevo Mais Frio -->
                <div class="bg-gradient-to-r from-red-600 to-red-800 p-4 rounded-lg">
                  <h4 class="font-bold text-white mb-2">‚ùÑÔ∏è Trevo Mais Frio</h4>
                  <div class="text-2xl font-bold text-yellow-300 mb-1">
                    ${trevosOrdenados.length > 0 ? `Trevo ${trevosOrdenados[trevosOrdenados.length - 1].trevo}` : 'N/A'}
                  </div>
                  <div class="text-sm text-red-200">
                    ${trevosOrdenados.length > 0 ? `${trevosOrdenados[trevosOrdenados.length - 1].frequencia} vezes (${((trevosOrdenados[trevosOrdenados.length - 1].frequencia / periodoInfo.concursos_analisados) * 100).toFixed(1)}%)` : 'Dados insuficientes'}
                  </div>
                </div>
                
                <!-- Estat√≠sticas Gerais -->
                <div class="bg-gradient-to-r from-blue-600 to-blue-800 p-4 rounded-lg">
                  <h4 class="font-bold text-white mb-2">üìä Estat√≠sticas</h4>
                  <div class="text-sm text-blue-200 space-y-1">
                    <div>‚Ä¢ ${periodoInfo.concursos_analisados} concursos analisados</div>
                    <div>‚Ä¢ ${Object.keys(combinacoesTrevos).length} combina√ß√µes √∫nicas</div>
                    <div>‚Ä¢ M√©dia: ${(periodoInfo.concursos_analisados / 6).toFixed(1)} por trevo</div>
                  </div>
                </div>
              </div>
              
              <!-- Dicas de Estrat√©gia -->
              <div class="mt-6 bg-gradient-to-r from-gray-800 to-gray-900 p-4 rounded-lg border-l-4 border-[#00E38C]">
                <h4 class="font-bold text-[#00E38C] mb-3">üéØ Dicas de Estrat√©gia</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-300">
                  <div>
                    <div class="font-semibold text-white mb-2">‚úÖ Estrat√©gia Conservadora:</div>
                    <ul class="list-disc list-inside space-y-1 text-gray-400">
                      <li>Use o trevo mais frequente como base</li>
                      <li>Combine com n√∫meros que t√™m alta correla√ß√£o</li>
                      <li>Inclua a dupla mais poderosa</li>
                    </ul>
                  </div>
                  <div>
                    <div class="font-semibold text-white mb-2">üé≤ Estrat√©gia Balanceada:</div>
                    <ul class="list-disc list-inside space-y-1 text-gray-400">
                      <li>Misture trevos quentes e frios</li>
                      <li>Use combina√ß√µes de m√©dia frequ√™ncia</li>
                      <li>Diversifique as correla√ß√µes</li>
                    </ul>
                  </div>
                </div>
              </div>
              
              <!-- SUGEST√ïES PARA APOSTA PREMIUM -->
              <div class="mt-8 bg-[#2E303A] p-4 rounded-lg shadow-md">
                <h4 class="text-[#00E38C] text-xl font-semibold mb-4">üéØ Sugest√£o para Aposta Inteligente (Trevos)</h4>
                <div class="space-y-3">
                    <div class="flex items-center">
                        <input type="checkbox" id="trevo-priorizar-quentes" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="trevos" data-pref-name="priorizarQuentesTrevos">
                        <label for="trevo-priorizar-quentes" class="text-white">Priorizar Trevos MAIS Frequentes</label>
                        <input type="number" id="trevo-qtde-quentes" class="ml-auto w-16 bg-[#1A1D25] border border-gray-600 text-white rounded px-2 py-1 text-sm" value="2" min="1" max="6">
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="trevo-priorizar-frios" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="trevos" data-pref-name="priorizarFriosTrevos">
                        <label for="trevo-priorizar-frios" class="text-white">Priorizar Trevos MENOS Frequentes</label>
                        <input type="number" id="trevo-qtde-frios" class="ml-auto w-16 bg-[#1A1D25] border border-gray-600 text-white rounded px-2 py-1 text-sm" value="2" min="1" max="6">
                    </div>
                </div>
              </div>
            </div>
          </div>
        `;

        // Criar gr√°ficos Plotly
        criarGraficoFrequenciaTrevos(trevosOrdenados);
        criarGraficoCombinacoesTrevos(combinacoesOrdenadas);
        criarGraficoCorrelacaoTrevosBolas(correlacaoTrevosBolas);

      } catch (error) {
        console.error('Erro ao carregar dados de trevos:', error);
        container.innerHTML = `<p style="color: red;">Erro ao carregar dados: ${error.message}</p>`;
      }
    }

    // Fun√ß√£o para atualizar o modal de trevos quando o per√≠odo √© alterado
    function updateTrevosModal() {
      const selectElement = document.getElementById('janela-analise-trevos');
      const selectedQtd = selectElement.value;
      const container = document.getElementById('conteudo-modal');
      carregarAnaliseTrevos(container, selectedQtd);
    }

    // Fun√ß√µes para criar gr√°ficos Plotly dos trevos
    function criarGraficoFrequenciaTrevos(trevosOrdenados) {
      const labels = trevosOrdenados.map(item => `üçÄ ${item.trevo}`);
      const values = trevosOrdenados.map(item => item.frequencia);
      
      // Cores gradientes baseadas na posi√ß√£o (1¬∫ lugar = dourado, etc.)
      const cores = ['#FFD700', '#C0C0C0', '#CD7F32', '#8B5CF6', '#F59E0B', '#EF4444'];

      const data = [{
        x: labels,
        y: values,
        type: 'bar',
        marker: {
          color: cores,
          opacity: 0.9,
          line: {
            color: 'white',
            width: 2
          }
        },
        text: values.map((val, idx) => `${val} vezes`),
        textposition: 'auto',
        textfont: {
          color: 'white',
          size: 12,
          weight: 'bold'
        },
        hovertemplate: '<b>%{x}</b><br>Frequ√™ncia: %{y} vezes<br>Ranking: %{customdata}<extra></extra>',
        customdata: trevosOrdenados.map((_, idx) => `${idx + 1}¬∫ lugar`)
      }];

      const layout = {
        title: {
          text: 'üçÄ Frequ√™ncia dos Trevos da Sorte',
          font: { size: 18, color: 'white' }
        },
        xaxis: { 
          title: 'Trevo',
          titlefont: { color: 'white' },
          tickfont: { color: 'white', size: 14 }
        },
        yaxis: { 
          title: 'Frequ√™ncia',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        margin: { l: 80, r: 30, t: 80, b: 80, pad: 5 },
        annotations: [{
          text: 'Trevos ordenados por frequ√™ncia (mais frequente ‚Üí menos frequente)',
          showarrow: false,
          xref: 'paper',
          yref: 'paper',
          x: 0.5,
          y: -0.15,
          font: { color: 'gray', size: 12 }
        }]
      };

      Plotly.newPlot('grafico-frequencia-trevos', data, layout, { 
        displayModeBar: false,
        responsive: true
      });
    }
    function criarGraficoCombinacoesTrevos(combinacoesOrdenadas) {
      const labels = combinacoesOrdenadas.map(combinacao => {
        // Combinacao[0] agora √© uma string como "2,4", ent√£o precisamos dividir
        const [trevo1, trevo2] = combinacao[0].split(',');
        return `üçÄ ${trevo1} + ${trevo2}`;
      });
      const values = combinacoesOrdenadas.map(combinacao => combinacao[1]);
      
      // Cores gradientes para as top combina√ß√µes
      const cores = values.map((_, idx) => {
        if (idx === 0) return '#FFD700'; // Dourado para 1¬∫
        if (idx === 1) return '#C0C0C0'; // Prata para 2¬∫
        if (idx === 2) return '#CD7F32'; // Bronze para 3¬∫
        return '#00E38C'; // Verde para os demais
      });

      const data = [{
        x: values,
        y: labels,
        type: 'bar',
        orientation: 'h',
        marker: {
          color: cores,
          opacity: 0.9,
          line: {
            color: 'white',
            width: 1
          }
        },
        text: values.map((val, idx) => `${val} vezes`),
        textposition: 'auto',
        textfont: {
          color: 'white',
          size: 11,
          weight: 'bold'
        },
        hovertemplate: '<b>%{y}</b><br>Frequ√™ncia: %{x} vezes<br>Ranking: %{customdata}<extra></extra>',
        customdata: combinacoesOrdenadas.map((_, idx) => `${idx + 1}¬∫ lugar`)
      }];

      const layout = {
        title: {
          text: 'ü§ù Combina√ß√µes de Trevos Mais Frequentes',
          font: { size: 18, color: 'white' }
        },
        xaxis: { 
          title: 'Frequ√™ncia',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        yaxis: { 
          title: 'Combina√ß√£o de Trevos',
          titlefont: { color: 'white' },
          tickfont: { color: 'white', size: 12 },
          automargin: true
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        margin: { l: 140, r: 30, t: 80, b: 80, pad: 5 },
        annotations: [{
          text: 'Duplas de trevos que mais saem juntas nos sorteios',
          showarrow: false,
          xref: 'paper',
          yref: 'paper',
          x: 0.5,
          y: -0.15,
          font: { color: 'gray', size: 12 }
        }]
      };

      Plotly.newPlot('grafico-combinacoes-trevos', data, layout, { 
        displayModeBar: false,
        responsive: true
      });
    }

    function criarGraficoCorrelacaoTrevosBolas(correlacaoTrevosBolas) {
      // Criar matriz de correla√ß√£o para visualiza√ß√£o
      const trevos = [1, 2, 3, 4, 5, 6];
      const cores = ['#00E38C', '#8B5CF6', '#F59E0B', '#EF4444', '#06B6D4', '#10B981'];
      
      // Pegar apenas as top 8 bolas mais correlacionadas para cada trevo (para melhor visualiza√ß√£o)
      const topBolasPorTrevo = {};
      trevos.forEach(trevo => {
        if (correlacaoTrevosBolas[trevo]) {
          const bolasOrdenadas = Object.entries(correlacaoTrevosBolas[trevo])
            .sort((a, b) => b[1] - a[1])
            .slice(0, 8);
          topBolasPorTrevo[trevo] = bolasOrdenadas;
        }
      });

      // Criar dados para o gr√°fico de barras agrupadas
      const data = trevos.map((trevo, index) => {
        if (topBolasPorTrevo[trevo] && topBolasPorTrevo[trevo].length > 0) {
          return {
            x: topBolasPorTrevo[trevo].map(item => item[0]),
            y: topBolasPorTrevo[trevo].map(item => item[1]),
            type: 'bar',
            name: `üçÄ Trevo ${trevo}`,
            marker: {
              color: cores[index],
              opacity: 0.8
            },
            hovertemplate: `<b>üçÄ Trevo ${trevo}</b><br>N√∫mero %{x}<br>Co-ocorr√™ncia: %{y} vezes<extra></extra>`,
            showlegend: true
          };
        }
        return null;
      }).filter(item => item !== null);

      const layout = {
        title: {
          text: 'üîó Correla√ß√£o Trevos ‚Üî N√∫meros Principais',
          font: { size: 18, color: 'white' }
        },
        xaxis: { 
          title: 'N√∫mero Principal (1-50)',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        yaxis: { 
          title: 'Frequ√™ncia de Co-ocorr√™ncia',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        barmode: 'group',
        margin: { l: 80, r: 30, t: 80, b: 100, pad: 5 },
        legend: {
          orientation: 'h',
          y: -0.25,
          x: 0.5,
          xanchor: 'center',
          yanchor: 'top',
          bgcolor: 'rgba(0,0,0,0.8)',
          bordercolor: '#333',
          borderwidth: 1,
          font: { color: 'white', size: 10 }
        },
        annotations: [{
          text: 'Top 8 n√∫meros que mais saem com cada trevo',
          showarrow: false,
          xref: 'paper',
          yref: 'paper',
          x: 0.5,
          y: -0.15,
          font: { color: 'gray', size: 12 }
        }]
      };

      Plotly.newPlot('grafico-correlacao-trevos-bolas', data, layout, { 
        displayModeBar: false,
        responsive: true
      });
    }

        // Carregar an√°lise de seca
    async function carregarAnaliseSeca(container, qtdConcursos = null) {
      container.innerHTML = `<p class="text-center text-gray-400">üîÑ Carregando an√°lise de seca...</p>`;
      
        try {
          let url = '/api/analise_seca';
          if (qtdConcursos !== null && qtdConcursos !== '') {
            url += `?qtd_concursos=${qtdConcursos}`;
          }
          
          const response = await fetch(url);
          const data = await response.json();
        
        if (data.error) {
          container.innerHTML = `<p class="text-red-500 text-center">Erro: ${data.error}</p>`;
          return;
        }
        
        const numerosSeca = data.numeros_seca;
        const trevosSeca = data.trevos_seca;
        
        if (!numerosSeca || !trevosSeca) {
          container.innerHTML = `<p class="text-red-500 text-center">Dados de seca incompletos ou n√£o encontrados.</p>`;
          return;
        }
        
        // Preparar dados para exibi√ß√£o
        const maiorSecaNumeros = numerosSeca.numeros_maior_seca && numerosSeca.numeros_maior_seca.length > 0 
          ? `${numerosSeca.numeros_maior_seca[0][0]} (${numerosSeca.numeros_maior_seca[0][1].seca_atual} concursos)`
          : 'N/A';
        
        const recentesNumeros = numerosSeca.numeros_recentes && numerosSeca.numeros_recentes.length > 0
          ? numerosSeca.numeros_recentes.slice(0, 3).join(', ')
          : 'N/A';
        
        const maiorSecaTrevos = trevosSeca.trevos_maior_seca && trevosSeca.trevos_maior_seca.length > 0
          ? `${trevosSeca.trevos_maior_seca[0][0]} (${trevosSeca.trevos_maior_seca[0][1].seca_atual} concursos)`
          : 'N/A';
        
        const recentesTrevos = trevosSeca.trevos_recentes && trevosSeca.trevos_recentes.length > 0
          ? trevosSeca.trevos_recentes.slice(0, 3).join(', ')
          : 'N/A';
        
        // Criar HTML completo para o modal gen√©rico
        container.innerHTML = `
          <div class="space-y-6">
            <!-- Explica√ß√£o -->
            <div class="bg-gray-800 p-4 rounded-lg border-l-4 border-[#00E38C]">
              <h3 class="text-xl font-semibold text-[#00E38C] mb-2">Entendendo a An√°lise de Seca üåµ</h3>
              <p class="text-gray-300 mb-2">
                A an√°lise de seca identifica h√° quantos concursos um determinado n√∫mero ou trevo n√£o √© sorteado.
              </p>
              <p class="text-gray-300">
                <span class="font-bold text-red-400">"Maior Seca"</span> indica os que est√£o h√° mais tempo sem aparecer.
                <span class="font-bold text-green-400">"Recentemente Sorteados"</span> s√£o os que sa√≠ram nos √∫ltimos concursos.
              </p>
            </div>

            <!-- Cabe√ßalho com t√≠tulo e ajuda -->
            <div class="flex justify-between items-start">
              <div class="bg-[#2E303A] p-4 rounded-xl flex-1">
                <h3 class="text-lg font-semibold mb-3 text-[#00E38C]">üéØ Janela de An√°lise Temporal</h3>
                <div class="flex flex-wrap gap-3 items-center">
                  <label class="text-sm text-gray-300">Per√≠odo:</label>
                  <select id="selectSecaPeriodo" class="bg-[#1A1D25] text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-[#00E38C] focus:outline-none" onchange="updateSecaModal()">
                    <option value="" ${qtdConcursos === '' || !qtdConcursos ? 'selected' : ''}>Todos os concursos</option>
                    <option value="25" ${qtdConcursos === '25' ? 'selected' : ''}>√öltimos 25 concursos</option>
                    <option value="50" ${qtdConcursos === '50' ? 'selected' : ''}>√öltimos 50 concursos</option>
                    <option value="100" ${qtdConcursos === '100' ? 'selected' : ''}>√öltimos 100 concursos</option>
                    <option value="200" ${qtdConcursos === '200' ? 'selected' : ''}>√öltimos 200 concursos</option>
                  </select>
                  <span class="text-xs text-gray-400">(Selecione para atualizar a an√°lise)</span>
                </div>
                <div class="mt-2 text-xs text-gray-400" id="secaPeriodoDisplay">
                  ${qtdConcursos ? `An√°lise dos √∫ltimos ${qtdConcursos} concursos.` : 'An√°lise de todos os concursos dispon√≠veis.'}
                </div>
              </div>
              <button onclick="abrirPopupAjudaSeca()" class="ml-4 bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition-colors duration-200" title="Como usar esta an√°lise?">
                ‚ùì
              </button>
            </div>

            <!-- N√∫meros e Trevos -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- N√∫meros -->
              <div class="bg-gray-800 p-4 rounded-lg shadow">
                <h3 class="text-xl font-semibold text-[#00E38C] mb-4 text-center">N√∫meros Principais (1-50)</h3>
                <div class="text-gray-300 mb-4">
                  <p class="mb-2"><strong>Em Maior Seca:</strong> <span class="font-bold text-lg text-red-400">${maiorSecaNumeros}</span></p>
                  <p class="mb-2"><strong>Recentemente Sorteados:</strong> <span class="font-bold text-lg text-green-400">${recentesNumeros}</span></p>
                  <div class="mb-2">
                    <strong>Estat√≠sticas:</strong>
                    <ul class="list-disc list-inside ml-4 text-sm">
                      <li>M√©dia de seca: ${numerosSeca.estatisticas?.seca_media || 'N/A'} concursos</li>
                      <li>Maior seca: ${numerosSeca.estatisticas?.seca_maxima || 'N/A'} concursos</li>
                      <li>Menor seca: ${numerosSeca.estatisticas?.seca_mediana || 'N/A'} concursos</li>
                    </ul>
                  </div>
                </div>
                <div id="graficoSecaNumeros" class="w-full h-80 bg-gray-700 rounded"></div>
              </div>

              <!-- Trevos -->
              <div class="bg-gray-800 p-4 rounded-lg shadow">
                <h3 class="text-xl font-semibold text-[#00E38C] mb-4 text-center">Trevos da Sorte (1-6)</h3>
                <div class="text-gray-300 mb-4">
                  <p class="mb-2"><strong>Em Maior Seca:</strong> <span class="font-bold text-lg text-red-400">${maiorSecaTrevos}</span></p>
                  <p class="mb-2"><strong>Recentemente Sorteados:</strong> <span class="font-bold text-lg text-green-400">${recentesTrevos}</span></p>
                  <div class="mb-2">
                    <strong>Estat√≠sticas:</strong>
                    <ul class="list-disc list-inside ml-4 text-sm">
                      <li>M√©dia de seca: ${trevosSeca.estatisticas?.seca_media || 'N/A'} concursos</li>
                      <li>Maior seca: ${trevosSeca.estatisticas?.seca_maxima || 'N/A'} concursos</li>
                      <li>Menor seca: ${trevosSeca.estatisticas?.seca_mediana || 'N/A'} concursos</li>
                    </ul>
                  </div>
                </div>
                <div id="graficoSecaTrevos" class="w-full h-80 bg-gray-700 rounded"></div>
              </div>
            </div>

            <!-- Interpreta√ß√£o -->
            <div class="bg-gray-800 p-4 rounded-lg border-l-4 border-[#8B5CF6]">
              <h3 class="text-xl font-semibold text-[#8B5CF6] mb-2">Interpreta√ß√£o dos Gr√°ficos de Seca üìä</h3>
              <ul class="list-disc list-inside text-gray-300 ml-4">
                <li><strong>Eixo X:</strong> N√∫meros (1-50) ou trevos (1-6).</li>
                <li><strong>Eixo Y:</strong> Concursos em que est√£o sem sair.</li>
                <li><strong>Barras altas:</strong> Maior tempo de seca.</li>
                <li><strong>Barras baixas:</strong> Sorteados recentemente.</li>
              </ul>
            </div>

            <!-- Estrat√©gias -->
            <div class="bg-gray-800 p-4 rounded-lg border-l-4 border-green-400">
              <h3 class="text-xl font-semibold text-green-400 mb-2">Estrat√©gias com a Seca ‚úÖ</h3>
              <ul class="list-disc list-inside text-gray-300 ml-4">
                <li><strong>Atrasados:</strong> Apostar nos que est√£o em seca.</li>
                <li><strong>Recentes:</strong> Apostar nos que sa√≠ram h√° pouco.</li>
                <li><strong>Misto:</strong> Combinar os dois.</li>
                <li><strong>Aleatoriedade:</strong> N√£o √© garantia. Combine com frequ√™ncia.</li>
              </ul>
            </div>

            <!-- Alerta Final -->
            <div class="mt-8 text-center text-gray-400">
              <p>‚ö†Ô∏è <strong>Importante:</strong> Esta √© uma an√°lise estat√≠stica hist√≥rica. N√£o garante resultados futuros. Aposte com responsabilidade.</p>
            </div>
            
            <!-- SUGEST√ïES PARA APOSTA PREMIUM -->
            <div class="mt-8 bg-[#2E303A] p-4 rounded-lg shadow-md">
              <h4 class="text-[#00E38C] text-xl font-semibold mb-4">üéØ Sugest√µes para Aposta Inteligente</h4>
              <div class="space-y-3">
                <div class="flex items-center">
                  <input type="checkbox" id="padrao-evitar-consecutivos" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="padroes" data-pref-name="evitarConsecutivos">
                  <label for="padrao-evitar-consecutivos" class="text-white">Evitar N√∫meros Consecutivos (ex: 23-24)</label>
                </div>
                <div class="flex items-center">
                  <input type="checkbox" id="padrao-priorizar-atrasados" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="padroes" data-pref-name="priorizarAtrasados">
                  <label for="padrao-priorizar-atrasados" class="text-white">Priorizar N√∫meros MUITO Atrasados</label>
                  <label for="padrao-min-atraso" class="text-gray-300 text-sm ml-auto mr-2">M√≠nimo de concursos sem sair:</label>
                  <input type="number" id="padrao-min-atraso" class="w-16 bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" value="20" min="1" max="100">
                </div>
                <div class="flex items-center">
                  <input type="checkbox" id="padrao-evitar-repeticoes-seguidas" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="padroes" data-pref-name="evitarRepeticoesSeguidas">
                  <label for="padrao-evitar-repeticoes-seguidas" class="text-white">Evitar N√∫meros Repetidos do √öltimo Concurso</label>
                </div>
              </div>
              <div class="mt-4 p-3 bg-[#1A1D25] rounded border-l-4 border-[#00E38C]">
                <p class="text-sm text-[#00E38C] font-medium">üí° Dica:</p>
                <p class="text-xs text-gray-300">Marque as op√ß√µes que fazem sentido para sua estrat√©gia. Elas ser√£o usadas na An√°lise Premium.</p>
              </div>
            </div>
          </div>
        `;
        
        // Criar gr√°ficos ap√≥s o HTML ser inserido
        setTimeout(() => {
          plotGraficoSecaNumeros(numerosSeca);
          plotGraficoSecaTrevos(trevosSeca);
        }, 100);
        
      } catch (error) {
        console.error('‚ùå Erro ao carregar dados de seca:', error);
        console.error('‚ùå Stack trace:', error.stack);
        if (container) {
          container.innerHTML = `<p class="text-red-500 text-center">Erro ao carregar dados: ${error.message}. Verifique a conex√£o com o servidor.</p>`;
        } else {
          // Atualizar elementos do modal diretamente
          const secaNumerosMaior = document.getElementById('secaNumerosMaior');
          const secaNumerosRecentes = document.getElementById('secaNumerosRecentes');
          const secaTrevosMaior = document.getElementById('secaTrevosMaior');
          const secaTrevosRecentes = document.getElementById('secaTrevosRecentes');
          
          if (secaNumerosMaior) secaNumerosMaior.textContent = `Erro: ${error.message}`;
          if (secaNumerosRecentes) secaNumerosRecentes.textContent = `Erro: ${error.message}`;
          if (secaTrevosMaior) secaTrevosMaior.textContent = `Erro: ${error.message}`;
          if (secaTrevosRecentes) secaTrevosRecentes.textContent = `Erro: ${error.message}`;
        }
      }
    }
    

    
    // Fun√ß√£o para atualizar o modal quando o filtro de per√≠odo √© alterado
    function updateSecaModal() {
      const selectElement = document.getElementById('selectSecaPeriodo');
      const selectedQtd = selectElement.value;
      
      // Carregar dados no modal gen√©rico
      const conteudo = document.getElementById('conteudo-modal');
      if (conteudo) {
        carregarAnaliseSeca(conteudo, selectedQtd);
      }
    }
    
    // Fun√ß√£o para abrir popup de ajuda da an√°lise de seca
    function abrirPopupAjudaSeca() {
      document.getElementById("popupAjudaSeca").style.display = "block";
    }

    function fecharPopupAjudaSeca() {
      document.getElementById("popupAjudaSeca").style.display = "none";
    }
    
    // Fun√ß√£o para criar gr√°fico de seca dos n√∫meros principais
    function plotGraficoSecaNumeros(numerosSeca) {
      if (!numerosSeca || !numerosSeca.seca_por_numero) {
        console.error('Dados de seca dos n√∫meros n√£o dispon√≠veis');
        return;
      }
      
      // Converter seca_por_numero em arrays para o gr√°fico
      const secaPorNumero = numerosSeca.seca_por_numero;
      const labels = Object.keys(secaPorNumero).map(num => parseInt(num)).sort((a, b) => a - b);
      const valores = labels.map(num => secaPorNumero[num].seca_atual);
      
      // Cores baseadas na seca (vermelho para maior seca, verde para menor)
      const cores = valores.map(valor => {
        const maxSeca = Math.max(...valores);
        const minSeca = Math.min(...valores);
        const normalized = (valor - minSeca) / (maxSeca - minSeca);
        
        if (normalized > 0.8) return '#EF4444'; // Vermelho (maior seca)
        if (normalized > 0.6) return '#F97316'; // Laranja
        if (normalized > 0.4) return '#EAB308'; // Amarelo
        if (normalized > 0.2) return '#22C55E'; // Verde claro
        return '#00E38C'; // Verde (menor seca)
      });
      
      const data = [{
        x: labels,
        y: valores,
        type: 'bar',
        marker: {
          color: cores,
          opacity: 0.9,
          line: {
            color: 'white',
            width: 1
          }
        },
        text: valores.map(val => `${val} concursos`),
        textposition: 'auto',
        textfont: {
          color: 'white',
          size: 10,
          weight: 'bold'
        },
        hovertemplate: '<b>N√∫mero %{x}</b><br>Em seca h√°: %{y} concursos<extra></extra>'
      }];
      
      const layout = {
        title: {
          text: 'üåµ Seca dos N√∫meros Principais (1-50)',
          font: { size: 18, color: 'white' }
        },
        xaxis: { 
          title: 'N√∫mero',
          titlefont: { color: 'white' },
          tickfont: { color: 'white', size: 12 },
          tickmode: 'linear',
          tick0: 1,
          dtick: 5
        },
        yaxis: { 
          title: 'Concursos em Seca',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        margin: { l: 80, r: 30, t: 80, b: 80, pad: 5 },
        annotations: [{
          text: 'Barras vermelhas = maior seca | Barras verdes = menor seca',
          showarrow: false,
          xref: 'paper',
          yref: 'paper',
          x: 0.5,
          y: -0.15,
          font: { color: 'gray', size: 12 }
        }]
      };
      
      Plotly.newPlot('graficoSecaNumeros', data, layout, { 
        displayModeBar: false,
        responsive: true
      });
    }
    
    // Fun√ß√£o para criar gr√°fico de seca dos trevos
    function plotGraficoSecaTrevos(trevosSeca) {
      if (!trevosSeca || !trevosSeca.seca_por_trevo) {
        console.error('Dados de seca dos trevos n√£o dispon√≠veis');
        return;
      }
      
      // Converter seca_por_trevo em arrays para o gr√°fico
      const secaPorTrevo = trevosSeca.seca_por_trevo;
      const labels = Object.keys(secaPorTrevo).map(trevo => `üçÄ ${trevo}`);
      const valores = Object.keys(secaPorTrevo).map(trevo => secaPorTrevo[trevo].seca_atual);
      
      // Cores baseadas na seca (vermelho para maior seca, verde para menor)
      const cores = valores.map(valor => {
        const maxSeca = Math.max(...valores);
        const minSeca = Math.min(...valores);
        const normalized = (valor - minSeca) / (maxSeca - minSeca);
        
        if (normalized > 0.8) return '#EF4444'; // Vermelho (maior seca)
        if (normalized > 0.6) return '#F97316'; // Laranja
        if (normalized > 0.4) return '#EAB308'; // Amarelo
        if (normalized > 0.2) return '#22C55E'; // Verde claro
        return '#00E38C'; // Verde (menor seca)
      });
      
      const data = [{
        x: labels,
        y: valores,
        type: 'bar',
        marker: {
          color: cores,
          opacity: 0.9,
          line: {
            color: 'white',
            width: 2
          }
        },
        text: valores.map(val => `${val} concursos`),
        textposition: 'auto',
        textfont: {
          color: 'white',
          size: 12,
          weight: 'bold'
        },
        hovertemplate: '<b>%{x}</b><br>Em seca h√°: %{y} concursos<extra></extra>'
      }];
      
      const layout = {
        title: {
          text: 'üçÄ Seca dos Trevos da Sorte (1-6)',
          font: { size: 18, color: 'white' }
        },
        xaxis: { 
          title: 'Trevo',
          titlefont: { color: 'white' },
          tickfont: { color: 'white', size: 14 }
        },
        yaxis: { 
          title: 'Concursos em Seca',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        margin: { l: 80, r: 30, t: 80, b: 80, pad: 5 },
        annotations: [{
          text: 'Barras vermelhas = maior seca | Barras verdes = menor seca',
          showarrow: false,
          xref: 'paper',
          yref: 'paper',
          x: 0.5,
          y: -0.15,
          font: { color: 'gray', size: 12 }
        }]
      };
      
      Plotly.newPlot('graficoSecaTrevos', data, layout, { 
        displayModeBar: false,
        responsive: true
      });
    }

    // Carregar an√°lise de estat√≠sticas avan√ßadas
    async function carregarAnaliseEstatisticasAvancadas(container, qtdConcursos = null) {
      container.innerHTML = "üîÑ Carregando an√°lise de estat√≠sticas avan√ßadas...";

      try {
        // Construir URL com par√¢metro de concursos se fornecido
        let url = '/api/estatisticas_avancadas';
        if (qtdConcursos) {
          url += `?qtd_concursos=${qtdConcursos}`;
        }

        const response = await fetch(url);
        const data = await response.json();

        if (data.error) {
          container.innerHTML = `<p style="color: red;">Erro: ${data.error}</p>`;
          return;
        }

        // Extrair dados das estat√≠sticas
        const testeAleatoriedade = data.teste_aleatoriedade || {};
        const desvioPadrao = data.desvio_padrao_distribuicao || {};
        const clusters = data.analise_clusters || {};
        const correlacao = data.analise_correlacao_numeros || {};
        const probabilidades = data.probabilidades_condicionais || {};

        container.innerHTML = `
          <div class="space-y-6">
            <!-- Cabe√ßalho com t√≠tulo e ajuda -->
            <div class="flex justify-between items-start">
              <div class="bg-[#2E303A] p-4 rounded-xl flex-1">
                <h3 class="text-lg font-semibold mb-3 text-[#00E38C]">üéØ Janela de An√°lise Temporal</h3>
                <div class="flex flex-wrap gap-3 items-center">
                  <label class="text-sm text-gray-300">Per√≠odo:</label>
                  <select id="selectEstatisticasAvancadasPeriodo" class="bg-[#1A1D25] text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-[#00E38C] focus:outline-none" onchange="updateEstatisticasAvancadasModal()">
                    <option value="" ${qtdConcursos === '' || !qtdConcursos ? 'selected' : ''}>Todos os concursos</option>
                    <option value="10" ${qtdConcursos === '10' ? 'selected' : ''}>√öltimos 10 concursos</option>
                    <option value="25" ${qtdConcursos === '25' ? 'selected' : ''}>√öltimos 25 concursos</option>
                    <option value="50" ${qtdConcursos === '50' ? 'selected' : ''}>√öltimos 50 concursos</option>
                    <option value="100" ${qtdConcursos === '100' ? 'selected' : ''}>√öltimos 100 concursos</option>
                    <option value="200" ${qtdConcursos === '200' ? 'selected' : ''}>√öltimos 200 concursos</option>
                  </select>
                  <span class="text-xs text-gray-400">(Selecione para atualizar a an√°lise)</span>
                </div>
                <div class="mt-2 text-xs text-gray-400" id="estatisticasAvancadasPeriodoDisplay">
                  ${qtdConcursos ? `An√°lise dos √∫ltimos ${qtdConcursos} concursos.` : 'An√°lise de todos os concursos dispon√≠veis.'}
                </div>
              </div>
              <button onclick="abrirPopupAjudaEstatisticasAvancadas()" class="ml-4 bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition-colors duration-200" title="Como usar esta an√°lise?">
                ‚ùì
              </button>
            </div>

            <!-- Estat√≠sticas Principais -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="stat-card p-4">
                <h4 class="font-semibold mb-2">üé≤ Teste de Aleatoriedade${qtdConcursos ? ` (√öltimos ${qtdConcursos} concursos)` : ''}</h4>
                <p class="text-lg font-bold text-[#00E38C]">${testeAleatoriedade.teste_chi_quadrado?.interpretacao || 'N/A'}</p>
                <p class="text-sm text-gray-400">P-valor: ${testeAleatoriedade.teste_chi_quadrado?.p_value?.toFixed(4) || 'N/A'}</p>
                <p class="text-sm text-gray-400">Chi¬≤: ${testeAleatoriedade.teste_chi_quadrado?.chi2?.toFixed(4) || 'N/A'}</p>
              </div>
              <div class="stat-card p-4">
                <h4 class="font-semibold mb-2">üìä Desvio Padr√£o da Distribui√ß√£o${qtdConcursos ? ` (√öltimos ${qtdConcursos} concursos)` : ''}</h4>
                <p class="text-lg font-bold text-[#00E38C]">${desvioPadrao.estatisticas_gerais?.desvio_padrao?.toFixed(2) || 'N/A'}</p>
                <p class="text-sm text-gray-400">Coeficiente: ${desvioPadrao.estatisticas_gerais?.coeficiente_variacao?.toFixed(2) || 'N/A'}%</p>
                <p class="text-sm text-gray-400">M√©dia: ${desvioPadrao.estatisticas_gerais?.media_frequencia?.toFixed(2) || 'N/A'}</p>
              </div>
            </div>

            <!-- Gr√°fico de Distribui√ß√£o -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üìä Distribui√ß√£o de Frequ√™ncia dos N√∫meros${qtdConcursos ? ` (√öltimos ${qtdConcursos} concursos)` : ''}</h3>
              
              <!-- Controles de Ordena√ß√£o -->
              <div class="flex justify-center items-center mb-4 gap-4">
                <span class="text-gray-300 text-sm">Ordenar por:</span>
                <button id="btn-ordenar-numerica" class="px-4 py-2 rounded-lg bg-[#00E38C] text-black font-semibold hover:opacity-80 transition-all">
                  üî¢ Ordem Num√©rica
                </button>
                <button id="btn-ordenar-frequencia" class="px-4 py-2 rounded-lg bg-[#2E303A] text-white hover:bg-[#3E404A] transition-all">
                  üìä Por Frequ√™ncia
                </button>
              </div>
              
              <!-- Estat√≠sticas R√°pidas -->
              <div class="text-center text-xs text-gray-400 mb-2">
                <span id="stats-distribuicao">
                  Total: <span id="total-numeros">0</span> | 
                  M√©dia: <span id="media-frequencia">0</span> | 
                  M√°ximo: <span id="max-frequencia">0</span>
                </span>
              </div>
              
              <div id="grafico-estatisticas-distribuicao" style="height: 400px;"></div>
            </div>

            <!-- Gr√°ficos -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="chart-container">
                <h3 class="text-lg font-semibold mb-4">üîó An√°lise de Clusters${qtdConcursos ? ` (√öltimos ${qtdConcursos} concursos)` : ''}</h3>
                <div id="grafico-estatisticas-clusters" style="height: 400px;"></div>
              </div>
              <div class="chart-container">
                <h3 class="text-lg font-semibold mb-4">üìà Correla√ß√£o entre N√∫meros${qtdConcursos ? ` (√öltimos ${qtdConcursos} concursos)` : ''}</h3>
                <div id="grafico-estatisticas-correlacao" style="height: 400px;"></div>
              </div>
            </div>

            <!-- Interpreta√ß√£o dos Clusters -->
            <div class="mt-8">
              <h4 class="text-primary text-xl font-semibold mb-4 text-center">üìä Interpreta√ß√£o dos Grupos de N√∫meros</h4>
              <div id="interpretacao-clusters" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                <p class="text-textSecondary text-center col-span-full">Carregando detalhes dos clusters...</p>
              </div>
            </div>

            <!-- Probabilidades Condicionais -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">üéØ Probabilidades Condicionais${qtdConcursos ? ` (√öltimos ${qtdConcursos} concursos)` : ''}</h3>
              <div id="grafico-estatisticas-probabilidades" style="height: 400px;"></div>
            </div>

            <!-- Interpreta√ß√£o -->
            <div class="bg-gray-800 p-4 rounded-lg border-l-4 border-[#8B5CF6]">
              <h3 class="text-xl font-semibold text-[#8B5CF6] mb-2">Interpreta√ß√£o das Estat√≠sticas Avan√ßadas üìä</h3>
              
              <div class="mb-4">
                <h4 class="text-lg font-semibold text-[#8B5CF6] mb-2">üß™ Teste de Aleatoriedade</h4>
                <p class="text-gray-300 mb-3">
                  Esse teste verifica se os sorteios seguem um padr√£o realmente aleat√≥rio ou se apresentam algum tipo de regularidade estat√≠stica.
                </p>
                <p class="text-gray-300 mb-3">
                  Ele usa um p-valor (probabilidade) para indicar o grau de aleatoriedade dos resultados:
                </p>
                <ul class="list-disc list-inside text-gray-300 ml-4 mb-3">
                  <li><strong>p < 0.05:</strong> Sugere que h√° padr√µes n√£o aleat√≥rios, ou seja, comportamentos que se repetem mais do que o acaso explicaria.</li>
                  <li><strong>p > 0.05:</strong> Indica que os resultados s√£o compat√≠veis com sorteios aleat√≥rios.</li>
                  <li><strong>Quanto mais pr√≥ximo de 1.0,</strong> maior a evid√™ncia de que os resultados seguem o acaso puro.</li>
                </ul>
                <p class="text-gray-300 italic">
                  üîç Em outras palavras, esse teste ajuda a descobrir se h√° algum "sinal escondido" nos sorteios, ou se tudo est√° mesmo no reino da sorte e do acaso.
                </p>
              </div>
              
              <div class="border-t border-gray-600 pt-4">
                <h4 class="text-lg font-semibold text-[#8B5CF6] mb-2">Outras An√°lises:</h4>
                <ul class="list-disc list-inside text-gray-300 ml-4">
                  <li><strong>Desvio Padr√£o:</strong> Mede a dispers√£o dos n√∫meros sorteados.</li>
                  <li><strong>Clusters:</strong> Identifica grupos de n√∫meros que aparecem juntos.</li>
                  <li><strong>Correla√ß√£o:</strong> Mostra rela√ß√µes entre diferentes n√∫meros.</li>
                  <li><strong>Probabilidades Condicionais:</strong> Probabilidade de um n√∫mero sair dado que outro saiu.</li>
                </ul>
              </div>
            </div>

            <!-- Estrat√©gias -->
            <div class="bg-gray-800 p-4 rounded-lg border-l-4 border-green-400">
              <h3 class="text-xl font-semibold text-green-400 mb-2">Estrat√©gias com Estat√≠sticas Avan√ßadas ‚úÖ</h3>
              <ul class="list-disc list-inside text-gray-300 ml-4">
                <li><strong>Aleatoriedade:</strong> Se confirmada, use estrat√©gias balanceadas.</li>
                <li><strong>Clusters:</strong> Evite ou explore grupos de n√∫meros relacionados.</li>
                <li><strong>Correla√ß√µes:</strong> Use pares de n√∫meros que se relacionam.</li>
                <li><strong>Probabilidades:</strong> Aproveite as rela√ß√µes condicionais.</li>
                <li><strong>Combina√ß√£o:</strong> Integre com an√°lises de frequ√™ncia e seca.</li>
              </ul>
            </div>

            <!-- Alerta Final -->
            <div class="mt-8 text-center text-gray-400">
              <p>‚ö†Ô∏è <strong>Importante:</strong> Esta √© uma an√°lise estat√≠stica avan√ßada. N√£o garante resultados futuros. Aposte com responsabilidade.</p>
            </div>
            
            <!-- SUGEST√ïES PARA APOSTA PREMIUM -->
            <div class="mt-8 bg-[#2E303A] p-4 rounded-lg shadow-md">
              <h4 class="text-[#00E38C] text-xl font-semibold mb-4">üéØ Sugest√µes para Aposta Inteligente (Clusters)</h4>
              <p class="text-gray-300 text-sm mb-3">Selecione os clusters cujos n√∫meros voc√™ deseja priorizar:</p>
              <div id="avancada-opcoes-clusters" class="grid grid-cols-2 gap-2 text-white">
                <p class="col-span-2 text-gray-300">Carregando op√ß√µes de clusters...</p>
              </div>
            </div>
          </div>
        `;
        
        // Armazenar dados da distribui√ß√£o globalmente para os controles de ordena√ß√£o
        window.ultimaDistribuicaoNumeros = data.distribuicao_numeros;
        window.ultimoPeriodoEstatisticas = qtdConcursos;
        
        // Armazenar dados dos clusters globalmente para as prefer√™ncias premium
        window.analiseResultados = {
            avancada: {
                clusters: clusters
            }
        };
        
        // Debug: verificar se os dados est√£o sendo armazenados corretamente
        console.log('Dados dos clusters armazenados:', window.analiseResultados.avancada.clusters);
        console.log('Resumo dos clusters:', window.analiseResultados.avancada.clusters?.resumo_clusters);
        
        // Criar gr√°ficos ap√≥s o HTML ser inserido
        setTimeout(() => {
          plotGraficoEstatisticasDistribuicao(data.distribuicao_numeros, 'numerica', qtdConcursos);
          plotGraficoEstatisticasClusters(clusters, qtdConcursos);
          plotGraficoEstatisticasCorrelacao(correlacao, qtdConcursos);
          plotGraficoEstatisticasProbabilidades(probabilidades, qtdConcursos);
          
          // Adicionar logs para debug
          console.log("üîç Dados de correla√ß√£o para gr√°fico:", correlacao);
          console.log("üîç Container do gr√°fico existe:", !!document.getElementById('grafico-estatisticas-correlacao'));
          
          // Configurar event listeners para os bot√µes de ordena√ß√£o
          configurarControlesOrdenacao();
          
          // Renderizar checkboxes de clusters para as prefer√™ncias premium
          if (typeof renderClusterCheckboxes === 'function') {
            renderClusterCheckboxes();
          }
        }, 100);
        
      } catch (error) {
        console.error('Erro ao carregar estat√≠sticas avan√ßadas:', error);
        container.innerHTML = `<p style="color: red;">Erro ao carregar dados: ${error.message}</p>`;
      }
    }

    // Fun√ß√µes para criar gr√°ficos (simuladas)
    function criarGraficoFrequencia() {
      // Implementar gr√°fico real com Plotly
      console.log('Criando gr√°fico de frequ√™ncia...');
    }

    function criarGraficoDistribuicao() {
      console.log('Criando gr√°fico de distribui√ß√£o...');
    }

    function criarGraficoCorrelacao() {
      console.log('Criando gr√°fico de correla√ß√£o...');
    }

    function criarGraficoTrevos() {
      console.log('Criando gr√°fico de trevos...');
    }

    function criarGraficoSeca() {
      console.log('Criando gr√°fico de seca...');
    }
    // Fun√ß√£o para atualizar o modal quando o filtro de per√≠odo √© alterado
    function updateEstatisticasAvancadasModal() {
      const selectElement = document.getElementById('selectEstatisticasAvancadasPeriodo');
      const selectedQtd = selectElement.value;
      
      // Atualizar o texto do per√≠odo
      const periodoDisplay = document.getElementById('estatisticasAvancadasPeriodoDisplay');
      if (periodoDisplay) {
        if (selectedQtd) {
          periodoDisplay.textContent = `An√°lise dos √∫ltimos ${selectedQtd} concursos.`;
        } else {
          periodoDisplay.textContent = 'An√°lise de todos os concursos dispon√≠veis.';
        }
      }
      
      // Carregar dados no modal gen√©rico
      const conteudo = document.getElementById('conteudo-modal');
      if (conteudo) {
        carregarAnaliseEstatisticasAvancadas(conteudo, selectedQtd);
      }
    }
    
    // Fun√ß√£o para abrir popup de ajuda das estat√≠sticas avan√ßadas
    function abrirPopupAjudaEstatisticasAvancadas() {
      document.getElementById("popupAjudaEstatisticasAvancadas").style.display = "block";
    }

    function fecharPopupAjudaEstatisticasAvancadas() {
      document.getElementById("popupAjudaEstatisticasAvancadas").style.display = "none";
    }
    
    // Fun√ß√£o para criar gr√°fico de clusters com interface melhorada
    function plotGraficoEstatisticasClusters(clusters, periodo = null) {
      console.log('Dados de clusters recebidos:', clusters);
      if (!clusters || !clusters.estatisticas_clusters) {
        console.error('Dados de clusters n√£o dispon√≠veis');
        return;
      }
      
      const clusterData = clusters.estatisticas_clusters;
      const resumoClusters = clusters.resumo_clusters || {};
      console.log('Resumo clusters:', resumoClusters);
      const labels = Object.keys(clusterData);
      const valores = Object.values(clusterData).map(cluster => cluster.quantidade);
      
      // Criar t√≠tulo com per√≠odo
      let titulo = 'üîó Clusters de N√∫meros Identificados';
      if (periodo) {
        titulo += `<br>(√öltimos ${periodo} concursos)`;
      }
      
      // Usar cores dos clusters se dispon√≠veis
      const cores = labels.map(label => {
        const resumo = resumoClusters[label];
        return resumo && resumo.cor ? resumo.cor : '#00E38C';
      });
      
      const data = [{
        x: labels,
        y: valores,
        type: 'bar',
        marker: {
          color: cores,
          opacity: 0.9,
          line: {
            color: 'white',
            width: 1
          }
        },
        text: valores.map(val => `${val} n√∫meros`),
        textposition: 'auto',
        textfont: {
          color: 'white',
          size: 10,
          weight: 'bold'
        },
        hovertemplate: '<b>Cluster %{x}</b><br>N√∫meros: %{y}<extra></extra>'
      }];
      
      const layout = {
        title: {
          text: titulo,
          font: { size: 14, color: 'white' }
        },
        xaxis: { 
          title: 'Cluster',
          titlefont: { color: 'white' },
          tickfont: { color: 'white', size: 12 }
        },
        yaxis: { 
          title: 'Quantidade de N√∫meros',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        margin: { l: 80, r: 30, t: 70, b: 80, pad: 5 }
      };
      
      Plotly.newPlot('grafico-estatisticas-clusters', data, layout, { displayModeBar: false });
      
      // Criar cards de interpreta√ß√£o dos clusters
      criarCardsInterpretacaoClusters(resumoClusters);
    }
    
    // Fun√ß√£o para criar cards de interpreta√ß√£o dos clusters
    function criarCardsInterpretacaoClusters(resumoClusters) {
      console.log('Criando cards de interpreta√ß√£o:', resumoClusters);
      const container = document.getElementById('interpretacao-clusters');
      if (!container || !resumoClusters) {
        console.log('Container ou resumoClusters n√£o encontrado:', { container: !!container, resumoClusters: !!resumoClusters });
        return;
      }
      
      container.innerHTML = '';
      
      Object.values(resumoClusters).forEach(cluster => {
        const card = document.createElement('div');
        card.className = 'bg-card p-4 rounded-lg border-l-4 shadow-lg hover:shadow-xl transition-shadow duration-300';
        card.style.borderLeftColor = cluster.cor;
        
        card.innerHTML = `
          <div class="flex items-center justify-between mb-3">
            <h4 class="text-lg font-semibold text-text">${cluster.id}</h4>
            <span class="px-2 py-1 rounded text-xs font-bold cursor-pointer hover:opacity-80 transition-opacity click-cluster-badge" data-cluster-id="${cluster.id}" style="background-color: ${cluster.cor}; color: white;">
              ${cluster.tipo}
            </span>
          </div>
          
          <div class="text-sm text-textSecondary mb-3">
            <p class="mb-2 leading-relaxed">${cluster.descricao_curta}</p>
            <p class="text-yellow-400 font-semibold text-sm">${cluster.recomendacao}</p>
          </div>
          
          <div class="text-xs text-textSecondary mb-3 bg-surface p-2 rounded">
            <div class="grid grid-cols-2 gap-2">
              <div><strong>Freq:</strong> ${cluster.caracteristicas_principais.frequencia_media}</div>
              <div><strong>Intervalo:</strong> ${cluster.caracteristicas_principais.intervalo_medio}</div>
              <div><strong>Atraso:</strong> ${cluster.caracteristicas_principais.score_atraso}</div>
              <div><strong>Volatilidade:</strong> ${cluster.caracteristicas_principais.volatilidade}</div>
            </div>
          </div>
        `;
        
        container.appendChild(card);
      });
      
      // Adicionar event listeners para as caixinhas clic√°veis
      const clusterBadges = document.querySelectorAll('.click-cluster-badge');
      clusterBadges.forEach(badge => {
        badge.addEventListener('click', () => {
          const clusterId = badge.dataset.clusterId;
          const clusterData = Object.values(resumoClusters).find(cluster => cluster.id === clusterId);
          if (clusterData && clusterData.todos_numeros_do_cluster) {
            exibirNumerosDoCluster(clusterData.id, clusterData.todos_numeros_do_cluster);
          } else {
            console.error('Dados completos do cluster n√£o encontrados para:', clusterId);
          }
        });
      });
    }
    
    // Fun√ß√£o para exibir n√∫meros do cluster em popup
    function exibirNumerosDoCluster(titulo, numeros) {
      const modal = document.getElementById('modal-numeros-cluster');
      const modalTitulo = document.getElementById('modal-numeros-cluster-titulo');
      const modalConteudo = document.getElementById('modal-numeros-cluster-conteudo');
      const fecharBtn = document.getElementById('fechar-modal-numeros-cluster');

      modalTitulo.innerText = `${titulo}: N√∫meros`;

      // Limpar conte√∫do anterior
      modalConteudo.innerHTML = ''; 

      // Adicionar os n√∫meros formatados
      numeros.forEach(num => {
        const numDiv = document.createElement('div');
        numDiv.className = 'bg-surface text-text px-2 py-1 rounded-md';
        numDiv.innerText = num;
        modalConteudo.appendChild(numDiv);
      });

      modal.classList.remove('hidden'); // Mostra o modal

      // Adicionar listener para fechar o modal
      fecharBtn.onclick = () => {
        modal.classList.add('hidden');
      };

      // Fechar ao clicar fora do conte√∫do do modal
      modal.onclick = (event) => {
        if (event.target === modal) {
          modal.classList.add('hidden');
        }
      };
    }
    
    // Fun√ß√£o para criar gr√°fico de correla√ß√£o
    function plotGraficoEstatisticasCorrelacao(correlacao, periodo = null) {
      console.log("üîç plotGraficoEstatisticasCorrelacao chamada com:", { correlacao, periodo });
      
      if (!correlacao || !correlacao.correlacoes_positivas) {
        console.error('‚ùå Dados de correla√ß√£o n√£o dispon√≠veis:', correlacao);
        const container = document.getElementById('grafico-estatisticas-correlacao');
        if (container) {
          container.innerHTML = '<p class="text-center text-gray-400 p-4">Dados de correla√ß√£o n√£o dispon√≠veis para este per√≠odo.</p>';
        }
        return;
      }
      
      console.log("üìä Correla√ß√µes positivas:", correlacao.correlacoes_positivas);
      console.log("üìä Correla√ß√µes negativas:", correlacao.correlacoes_negativas);
      
      // Combinar correla√ß√µes positivas e negativas
      const todasCorrelacoes = [...(correlacao.correlacoes_positivas || []), ...(correlacao.correlacoes_negativas || [])];
      
      console.log("üìä Todas as correla√ß√µes combinadas:", todasCorrelacoes);
      
      // Verificar se h√° dados suficientes para plotar
      if (todasCorrelacoes.length === 0) {
        console.warn('‚ö†Ô∏è Nenhuma correla√ß√£o significativa encontrada para este per√≠odo');
        const container = document.getElementById('grafico-estatisticas-correlacao');
        if (container) {
          container.innerHTML = '<p class="text-center text-gray-400 p-4">Nenhuma correla√ß√£o significativa encontrada para este per√≠odo.<br><small>Isso pode indicar que os n√∫meros s√£o bem distribu√≠dos e independentes.</small></p>';
        }
        return;
      }
      
      const pares = todasCorrelacoes.map(pair => `${pair[0]}-${pair[1]}`);
      const valores = todasCorrelacoes.map(pair => pair[2]);
      
      console.log("üìä Pares criados:", pares);
      console.log("üìä Valores criados:", valores);
      
      // Criar t√≠tulo com per√≠odo
      let titulo = 'üìà Correla√ß√µes Significativas<br>entre N√∫meros';
      if (periodo) {
        titulo += `<br>(√öltimos ${periodo} concursos)`;
      }
      
      const data = [{
        x: pares,
        y: valores,
        type: 'bar',
        marker: {
          color: valores.map(val => val > 0 ? '#22C55E' : '#EF4444'),
          opacity: 0.9,
          line: {
            color: 'white',
            width: 1
          }
        },
        text: valores.map(val => val.toFixed(3)),
        textposition: 'auto',
        textfont: {
          color: 'white',
          size: 10,
          weight: 'bold'
        },
        hovertemplate: '<b>%{x}</b><br>Correla√ß√£o: %{y}<extra></extra>'
      }];
      
      const layout = {
        title: {
          text: titulo,
          font: { size: 14, color: 'white' }
        },
        xaxis: { 
          title: 'Pares de N√∫meros',
          titlefont: { color: 'white' },
          tickfont: { color: 'white', size: 10 },
          type: 'category', // For√ßa o eixo X a ser categ√≥rico
          automargin: true // Ajuda com labels longos
        },
        yaxis: { 
          title: 'Coeficiente de Correla√ß√£o',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        margin: { l: 40, r: 40, t: 70, b: 80, pad: 5 }
      };
      
      console.log("üéØ Tentando criar gr√°fico Plotly...");
      console.log("üìä Data para Plotly:", data);
      console.log("üìä Layout para Plotly:", layout);
      
      try {
        Plotly.newPlot('grafico-estatisticas-correlacao', data, layout, { displayModeBar: false });
        console.log(`‚úÖ Gr√°fico de correla√ß√£o criado com ${todasCorrelacoes.length} pares significativos`);
      } catch (error) {
        console.error("‚ùå Erro ao criar gr√°fico Plotly:", error);
        console.error("‚ùå Detalhes do erro:", error.message);
      }
    }
    
    // Fun√ß√£o para criar gr√°fico de probabilidades condicionais
    function plotGraficoEstatisticasProbabilidades(probabilidades, periodo = null) {
      console.log('üîç DEBUG - Dados recebidos em plotGraficoEstatisticasProbabilidades:', probabilidades);
      
      if (!probabilidades || !probabilidades.dependencias_fortes) {
        console.error('Dados de probabilidades condicionais n√£o dispon√≠veis');
        const container = document.getElementById('grafico-estatisticas-probabilidades');
        if (container) {
          container.innerHTML = '<p class="text-center text-gray-400 p-4">Dados de probabilidades condicionais n√£o dispon√≠veis para este per√≠odo.</p>';
        }
        return;
      }
      
      const dependencias = probabilidades.dependencias_fortes || [];
      console.log('üîç DEBUG - Depend√™ncias encontradas:', dependencias);
      
      // Verificar se h√° dados suficientes para plotar
      if (dependencias.length === 0) {
        console.warn('Nenhuma depend√™ncia forte encontrada para este per√≠odo');
        const container = document.getElementById('grafico-estatisticas-probabilidades');
        if (container) {
          container.innerHTML = '<p class="text-center text-gray-400 p-4">Nenhuma depend√™ncia forte encontrada para este per√≠odo.<br><small>Isso pode indicar que os n√∫meros s√£o bem independentes.</small></p>';
        }
        return;
      }
      
      const pares = dependencias.map(dep => `${dep[0]}-${dep[1]}`);
      const valores = dependencias.map(dep => dep[2]);
      
      console.log('üîç DEBUG - Pares processados:', pares);
      console.log('üîç DEBUG - Valores processados:', valores);
      
      // Criar t√≠tulo com per√≠odo
      let titulo = 'üéØ Probabilidades Condicionais';
      if (periodo) {
        titulo += `<br>(√öltimos ${periodo} concursos)`;
      }
      
      const data = [{
        x: pares,
        y: valores,
        type: 'bar',
        marker: {
          color: '#8B5CF6',
          opacity: 0.9,
          line: {
            color: 'white',
            width: 1
          }
        },
        text: valores.map(val => `${(val * 100).toFixed(1)}%`),
        textposition: 'auto',
        textfont: {
          color: 'white',
          size: 10,
          weight: 'bold'
        },
        hovertemplate: '<b>%{x}</b><br>Probabilidade: %{y}<extra></extra>'
      }];
      
      console.log('üîç DEBUG - Dados finais para Plotly:', data);
      
      const layout = {
        title: {
          text: titulo,
          font: { size: 14, color: 'white' }
        },
        xaxis: { 
          title: 'Pares de N√∫meros',
          titlefont: { color: 'white' },
          tickfont: { color: 'white', size: 10 },
          type: 'category', // For√ßa o eixo X a ser categ√≥rico
          automargin: true // Ajuda com labels longos
        },
        yaxis: { 
          title: 'Probabilidade',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        margin: { l: 40, r: 40, t: 70, b: 80, pad: 5 }
      };
      
      Plotly.newPlot('grafico-estatisticas-probabilidades', data, layout, { displayModeBar: false });
      console.log(`‚úÖ Gr√°fico de probabilidades condicionais criado com ${dependencias.length} depend√™ncias`);
    }

    // Fun√ß√£o para criar gr√°fico de distribui√ß√£o com ordena√ß√£o
    function plotGraficoEstatisticasDistribuicao(distribuicaoNumerosOriginal, ordenacao = 'numerica', periodo = null) {
      if (!distribuicaoNumerosOriginal || distribuicaoNumerosOriginal.length === 0) {
        console.warn('Dados de distribui√ß√£o de n√∫meros vazios ou inv√°lidos.');
        Plotly.purge('grafico-estatisticas-distribuicao');
        document.getElementById('grafico-estatisticas-distribuicao').innerHTML = '<p class="text-center text-gray-400">Dados de distribui√ß√£o n√£o dispon√≠veis para este per√≠odo.</p>';
        return;
      }

      // 1. Criar uma c√≥pia dos dados para n√£o alterar o original
      let distribuicaoParaPlotar = [...distribuicaoNumerosOriginal];

      // 2. Aplicar a ordena√ß√£o
      if (ordenacao === 'frequencia') {
        distribuicaoParaPlotar.sort((a, b) => b.frequencia - a.frequencia); // Do maior para o menor
      } else { // 'numerica' ou qualquer outro valor, mant√©m a ordem original (1 a 50)
        distribuicaoParaPlotar.sort((a, b) => a.numero - b.numero);
      }

      const numeros = distribuicaoParaPlotar.map(item => item.numero);
      const frequencias = distribuicaoParaPlotar.map(item => item.frequencia);

      // Calcular estat√≠sticas para exibir
      const total = frequencias.reduce((a, b) => a + b, 0);
      const media = total / frequencias.length;
      const maximo = Math.max(...frequencias);

      // Atualizar estat√≠sticas r√°pidas
      const totalElement = document.getElementById('total-numeros');
      const mediaElement = document.getElementById('media-frequencia');
      const maximoElement = document.getElementById('max-frequencia');
      
      if (totalElement) totalElement.textContent = total;
      if (mediaElement) mediaElement.textContent = media.toFixed(1);
      if (maximoElement) maximoElement.textContent = maximo;

      // Criar t√≠tulo com per√≠odo e ordena√ß√£o
      let titulo = 'üìä Distribui√ß√£o de Frequ√™ncia<br>dos N√∫meros';
      if (periodo) {
        titulo += `<br>(√öltimos ${periodo} concursos)`;
      }
      titulo += ordenacao === 'frequencia' ? '<br>- Ordenado por Frequ√™ncia' : '<br>- Ordem Num√©rica';

      const data = [{
        x: numeros,
        y: frequencias,
        type: 'bar',
        marker: {
          color: '#00E38C',
          opacity: 0.9,
          line: {
            color: 'white',
            width: 1
          }
        },
        text: frequencias.map(val => val.toString()),
        textposition: 'auto',
        textfont: {
          color: 'white',
          size: 8,
          weight: 'bold'
        },
        hovertemplate: ordenacao === 'frequencia' 
          ? '<b>N√∫mero %{x}</b><br>Frequ√™ncia: %{y}<br><i>Ordenado por frequ√™ncia</i><extra></extra>'
          : '<b>N√∫mero %{x}</b><br>Frequ√™ncia: %{y}<extra></extra>'
      }];

      // Adicionar linha de m√©dia quando ordenado por frequ√™ncia
      if (ordenacao === 'frequencia') {
        data.push({
          x: [numeros[0].toString(), numeros[numeros.length - 1].toString()], // Converter para string para eixo categ√≥rico
          y: [media, media],
          type: 'scatter',
          mode: 'lines',
          line: { color: 'red', dash: 'dash', width: 2 },
          name: 'M√©dia',
          showlegend: true,
          hoverinfo: 'skip'
        });
      }

      const layout = {
        title: {
          text: titulo,
          font: { size: 14, color: 'white' }
        },
        xaxis: {
          title: { text: 'N√∫mero', font: { color: 'white' } },
          // *** MUDAN√áA ESSENCIAL AQUI: DEFINIR O TIPO DO EIXO COMO 'category' ***
          type: 'category', // For√ßa o Plotly a tratar 'x' como categorias ordenadas
          gridcolor: '#2E303A',
          tickfont: { color: 'white', size: 10 },
          linecolor: '#2E303A',
          automargin: true // Ajuda a evitar cortes de labels quando h√° muitos ticks
        },
        yaxis: { 
          title: 'Frequ√™ncia',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        margin: { l: 40, r: 40, t: 70, b: 80, pad: 5 },
        showlegend: ordenacao === 'frequencia'
      };

      Plotly.newPlot('grafico-estatisticas-distribuicao', data, layout, { displayModeBar: false });
      console.log(`‚úÖ Gr√°fico de distribui√ß√£o criado com ordena√ß√£o: ${ordenacao}!`);
    }

    // Fun√ß√£o para atualizar estados dos bot√µes de ordena√ß√£o
    function atualizarBotoesOrdenacao(ordenacaoAtiva) {
      const btnNumerica = document.getElementById('btn-ordenar-numerica');
      const btnFrequencia = document.getElementById('btn-ordenar-frequencia');
      
      if (btnNumerica && btnFrequencia) {
        if (ordenacaoAtiva === 'numerica') {
          btnNumerica.className = 'px-4 py-2 rounded-lg bg-[#00E38C] text-black font-semibold hover:opacity-80 transition-all';
          btnFrequencia.className = 'px-4 py-2 rounded-lg bg-[#2E303A] text-white hover:bg-[#3E404A] transition-all';
        } else {
          btnFrequencia.className = 'px-4 py-2 rounded-lg bg-[#00E38C] text-black font-semibold hover:opacity-80 transition-all';
          btnNumerica.className = 'px-4 py-2 rounded-lg bg-[#2E303A] text-white hover:bg-[#3E404A] transition-all';
        }
      }
    }

    // Fun√ß√£o para configurar event listeners dos controles de ordena√ß√£o
    function configurarControlesOrdenacao() {
      const btnOrdenarNumerica = document.getElementById('btn-ordenar-numerica');
      const btnOrdenarFrequencia = document.getElementById('btn-ordenar-frequencia');

      if (btnOrdenarNumerica && btnOrdenarFrequencia && window.ultimaDistribuicaoNumeros) {
        // Remover event listeners anteriores para evitar duplica√ß√£o
        btnOrdenarNumerica.replaceWith(btnOrdenarNumerica.cloneNode(true));
        btnOrdenarFrequencia.replaceWith(btnOrdenarFrequencia.cloneNode(true));
        
        // Recuperar refer√™ncias ap√≥s clonagem
        const btnNumerica = document.getElementById('btn-ordenar-numerica');
        const btnFrequencia = document.getElementById('btn-ordenar-frequencia');

        btnNumerica.addEventListener('click', () => {
          plotGraficoEstatisticasDistribuicao(window.ultimaDistribuicaoNumeros, 'numerica', window.ultimoPeriodoEstatisticas);
          atualizarBotoesOrdenacao('numerica');
        });

        btnFrequencia.addEventListener('click', () => {
          plotGraficoEstatisticasDistribuicao(window.ultimaDistribuicaoNumeros, 'frequencia', window.ultimoPeriodoEstatisticas);
          atualizarBotoesOrdenacao('frequencia');
        });

        // Definir estado inicial (ordem num√©rica ativa)
        atualizarBotoesOrdenacao('numerica');
        
        console.log('‚úÖ Controles de ordena√ß√£o configurados!');
      }
    }

    function criarGraficoClusters() {
      console.log('Criando gr√°fico de clusters...');
    }

    // Fun√ß√£o para gerar n√∫meros aleat√≥rios (GRATUITO)
    async function gerarNumerosAleatorios() {
      // Capturar o bot√£o no in√≠cio da fun√ß√£o
      const botao = event.target;
      const textoOriginal = botao.innerHTML;
      
      try {
        // Mostrar loading
        botao.innerHTML = 'üçÄ Gerando Palpite...';
        botao.disabled = true;
        
        // Chamar API para gerar n√∫meros aleat√≥rios
        const response = await fetch('/api/gerar-numeros-aleatorios');
        const dados = await response.json();
        
        if (dados.success) {
          // Limpar sele√ß√µes anteriores (sem mostrar mensagem)
          limparSelecaoSilenciosa();
          
          // Selecionar n√∫meros aleat√≥rios
          dados.numeros.forEach(numero => {
            const elementos = document.querySelectorAll('#numeros-container .numero');
            const elemento = Array.from(elementos).find(el => el.textContent.trim() === numero.toString().padStart(2, '0'));
            if (elemento) {
              selecionarNumero(numero, elemento);
            }
          });
          
          // Selecionar trevos (corrigido para usar a nova estrutura)
          const trevoElementos = document.querySelectorAll('#trevos-container .trevo-icon-container');
          
          // Fun√ß√£o para selecionar trevo sem valida√ß√£o de limite (para gera√ß√£o autom√°tica)
          function selecionarTrevoAutomatico(trevo, elemento) {
            if (!trevosSelecionados.includes(trevo)) {
              trevosSelecionados.push(trevo);
              elemento.classList.add('selecionado');
            }
            atualizarTrevosSelecionados();
          }
          
          // Selecionar primeiro trevo
          const trevo1Elemento = Array.from(trevoElementos).find(el => 
            el.querySelector('.trevo-number').textContent.trim() === dados.trevo1.toString()
          );
          if (trevo1Elemento) {
            selecionarTrevoAutomatico(dados.trevo1, trevo1Elemento);
          }
          
          // Selecionar segundo trevo
          const trevo2Elemento = Array.from(trevoElementos).find(el => 
            el.querySelector('.trevo-number').textContent.trim() === dados.trevo2.toString()
          );
          if (trevo2Elemento) {
            selecionarTrevoAutomatico(dados.trevo2, trevo2Elemento);
          }
          
          // Mostrar sucesso
          mostrarMensagem('üçÄ Palpite da Sorte gerado com sucesso!', 'success');
        } else {
          throw new Error(dados.error || 'Erro ao gerar n√∫meros');
        }
      } catch (error) {
        console.error('Erro:', error);
        mostrarMensagem('‚ùå Erro ao gerar n√∫meros. Tente novamente.', 'error');
      } finally {
        // Restaurar bot√£o usando a refer√™ncia capturada
        botao.innerHTML = 'üçÄ Gerar Palpite da Sorte';
        botao.disabled = false;
      }
    }

    // Fun√ß√£o para limpar todas as sele√ß√µes (silenciosa - sem mensagem)
    function limparSelecaoSilenciosa() {
      // Limpar n√∫meros selecionados
      numerosSelecionados = [];
      document.querySelectorAll('#numeros-container .numero').forEach(el => {
        el.classList.remove('selecionado');
      });
      
      // Limpar trevos (corrigido para usar a nova classe)
      trevosSelecionados = [];
      document.querySelectorAll('#trevos-container .trevo-icon-container').forEach(el => {
        el.classList.remove('selecionado');
      });
      
      // Atualizar displays
      atualizarNumerosSelecionados();
      atualizarTrevosSelecionados();
      calcularEAtualizarValorAposta(); // NOVA: Recalcular valor ap√≥s limpeza
    }

    // Fun√ß√£o para limpar todas as sele√ß√µes (com mensagem)
    function limparSelecao() {
      limparSelecaoSilenciosa();
      mostrarMensagem('üóëÔ∏è Sele√ß√£o limpa com sucesso!', 'info');
    }

    // Fun√ß√£o para mostrar mensagens
    function mostrarMensagem(texto, tipo) {
      // Criar elemento de mensagem
      const mensagem = document.createElement('div');
      mensagem.className = `fixed top-4 right-4 p-4 rounded-xl text-white font-semibold z-50 transition-all duration-300 ${
        tipo === 'success' ? 'bg-green-600' :
        tipo === 'error' ? 'bg-red-600' :
        'bg-blue-600'
      }`;
      mensagem.textContent = texto;
      
      // Adicionar ao DOM
      document.body.appendChild(mensagem);
      
      // Remover ap√≥s 3 segundos
      setTimeout(() => {
        mensagem.remove();
      }, 3000);
    }

    // ===== MODAL DE CONFIGURA√á√ÉO DE APOSTA =====
    
    // Elementos do modal
    const modalConfiguracao = document.getElementById('modalConfiguracao');
    const btnCancelarModal = document.getElementById('btnCancelarModal');
    const btnGerarNoModal = document.getElementById('btnGerarNoModal');
    const sliderNumeros = document.getElementById('sliderNumeros');
    const valorNumeros = document.getElementById('valorNumeros');
    const sliderTrevos = document.getElementById('sliderTrevos');
    const valorTrevos = document.getElementById('valorTrevos');

    // Atualiza os valores exibidos pelos sliders
    sliderNumeros.oninput = () => {
      valorNumeros.textContent = sliderNumeros.value;
      atualizarCorSlider(sliderNumeros);
    };
    sliderTrevos.oninput = () => {
      valorTrevos.textContent = sliderTrevos.value;
      atualizarCorSlider(sliderTrevos);
    };

    // Fun√ß√£o para atualizar a cor da barra do slider dinamicamente
    function atualizarCorSlider(slider) {
      const value = (slider.value - slider.min) / (slider.max - slider.min) * 100;
      
      // Atualiza o gradiente da barra baseado no valor
      slider.style.background = `linear-gradient(to right, #00E38C 0%, #00E38C ${value}%, #2E303A ${value}%, #2E303A 100%)`;
      
      // Adiciona efeito de brilho sutil
      slider.style.boxShadow = `inset 0 1px 3px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(0, 227, 140, ${value * 0.01})`;
    }

    // Inicializa a cor do slider ao carregar a p√°gina
    document.addEventListener('DOMContentLoaded', () => {
      if (sliderNumeros) {
        atualizarCorSlider(sliderNumeros);
      }
      if (sliderTrevos) {
        atualizarCorSlider(sliderTrevos);
      }
    });

    // Abrir o modal
    function abrirModalConfiguracao() {
      modalConfiguracao.classList.remove('hidden');
    }

    // Fechar o modal
    btnCancelarModal.addEventListener('click', () => {
      modalConfiguracao.classList.add('hidden');
    });

    // Gerar aposta ao clicar no bot√£o dentro do modal
    btnGerarNoModal.addEventListener('click', () => {
      const qtdeNum = parseInt(sliderNumeros.value);
      const qtdeTrevos = parseInt(sliderTrevos.value);
      gerarApostaAleatoria(qtdeNum, qtdeTrevos);
      modalConfiguracao.classList.add('hidden'); // Fecha o modal ap√≥s gerar
    });
    // Fun√ß√£o para chamar o backend Flask
    async function gerarApostaAleatoria(qtdeNum, qtdeTrevos) {
      try {
        mostrarMensagem('üé≤ Gerando sua aposta...', 'info');
        
        // Para compatibilidade com o backend, dividimos os trevos em 2 grupos
        const qtdeTrevo1 = Math.ceil(qtdeTrevos / 2);
        const qtdeTrevo2 = Math.floor(qtdeTrevos / 2);
        
        const response = await fetch('/api/gerar-aposta-milionaria', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            qtde_num: qtdeNum,
            qtde_trevo1: qtdeTrevo1,
            qtde_trevo2: qtdeTrevo2
          })
        });

        if (!response.ok) {
          throw new Error(`Erro HTTP: ${response.status}`);
        }

        const data = await response.json();
        console.log("Aposta Gerada:", data);
        
        // Limpar sele√ß√µes anteriores
        limparSelecaoSilenciosa();
        
        // Atualizar limite de trevos baseado no modal
        const limiteTrevos = qtdeTrevos;
        
        // Selecionar n√∫meros aleat√≥rios automaticamente
        data.numeros.forEach(numero => {
          const elementos = document.querySelectorAll('#numeros-container .numero');
          const elemento = Array.from(elementos).find(el => el.textContent.trim() === numero.toString().padStart(2, '0'));
          if (elemento) {
            selecionarNumeroAutomatico(numero, elemento);
          }
        });
        
        // Selecionar m√∫ltiplos n√∫meros para Trevos (corrigido para usar a nova estrutura)
        const trevoElementos = document.querySelectorAll('#trevos-container .trevo-icon-container');
        
        // Fun√ß√£o para selecionar trevo sem valida√ß√£o de limite (para gera√ß√£o autom√°tica)
        function selecionarTrevoAutomatico(trevo, elemento) {
          if (!trevosSelecionados.includes(trevo)) {
            trevosSelecionados.push(trevo);
            elemento.classList.add('selecionado');
          }
          atualizarTrevosSelecionados();
        }
        
        // Selecionar m√∫ltiplos n√∫meros para Trevo 1
        if (Array.isArray(data.trevo1)) {
          data.trevo1.forEach(trevo => {
            const trevoElemento = Array.from(trevoElementos).find(el => 
              el.querySelector('.trevo-number').textContent.trim() === trevo.toString()
            );
            if (trevoElemento) {
              selecionarTrevoAutomatico(trevo, trevoElemento);
            }
          });
        } else {
          // Fallback para compatibilidade (trevo √∫nico)
          const trevoElemento = Array.from(trevoElementos).find(el => 
            el.querySelector('.trevo-number').textContent.trim() === data.trevo1.toString()
          );
          if (trevoElemento) {
            selecionarTrevoAutomatico(data.trevo1, trevoElemento);
          }
        }
        
        // Selecionar m√∫ltiplos n√∫meros para Trevo 2
        if (Array.isArray(data.trevo2)) {
          data.trevo2.forEach(trevo => {
            const trevoElemento = Array.from(trevoElementos).find(el => 
              el.querySelector('.trevo-number').textContent.trim() === trevo.toString()
            );
            if (trevoElemento) {
              selecionarTrevoAutomatico(trevo, trevoElemento);
            }
          });
        } else {
          // Fallback para compatibilidade (trevo √∫nico)
          const trevoElemento = Array.from(trevoElementos).find(el => 
            el.querySelector('.trevo-number').textContent.trim() === data.trevo2.toString()
          );
          if (trevoElemento) {
            selecionarTrevoAutomatico(data.trevo2, trevoElemento);
          }
        }
        
        // Atualizar valor da aposta
        atualizarValorAposta(data.valor, data.qtde_apostas, qtdeNum, qtdeTrevos, qtdeTrevos);
        
        mostrarMensagem(`‚úÖ Aposta gerada com sucesso! ${data.qtde_apostas} combina√ß√µes`, 'success');

      } catch (error) {
        console.error("Erro ao gerar aposta:", error);
        mostrarMensagem(`‚ùå Erro ao gerar aposta: ${error.message}`, 'error');
      }
    }

    // Fun√ß√£o para atualizar o modal quando o filtro de per√≠odo √© alterado
    function updateDistribuicaoModal() {
      const selectElement = document.getElementById('selectDistribuicaoPeriodo');
      const selectedQtd = selectElement.value;
      
      // Carregar dados no modal gen√©rico
      const conteudo = document.getElementById('conteudo-modal');
      if (conteudo) {
        carregarAnaliseDistribuicao(conteudo, selectedQtd);
      }
    }
  </script>







  <!-- Popup de Ajuda -->
  <div id="popupAjuda" class="modal-ajuda">
    <div class="modal-content">
      <span class="close" onclick="fecharPopupAjuda()">√ó</span>
      <h2>üß† Entendendo os Gr√°ficos e a Matriz</h2>
      <p>Esses gr√°ficos e a matriz visual mostram padr√µes que podem te ajudar a escolher seus n√∫meros com mais estrat√©gia.</p>

      <h3>üìä Frequ√™ncia Absoluta</h3>
      <p>
        Quantas vezes cada n√∫mero ou trevo foi sorteado.<br>
        <strong>‚úî √ötil para:</strong> ver os mais e menos sorteados at√© hoje.
      </p>

      <h3>üìà Frequ√™ncia Relativa</h3>
      <p>
        Mostra a frequ√™ncia em porcentagem, comparando com o esperado em sorteios aleat√≥rios.<br>
        <strong>‚úî √ötil para:</strong> saber se um n√∫mero saiu mais ou menos do que o "normal".
      </p>

      <h3>üî• N√∫meros Quentes</h3>
      <p>
        S√£o os que mais sa√≠ram recentemente. Alguns jogadores acreditam que est√£o em "alta".
      </p>

      <h3>‚ùÑÔ∏è N√∫meros Frios</h3>
      <p>
        S√£o os que h√° tempos n√£o aparecem. Alguns apostadores preferem dar chance a eles.
      </p>

      <h3>üïí An√°lise Temporal</h3>
      <p>
        Compara os n√∫meros mais frequentes em blocos (√∫ltimos 10%, 20%, 30% dos concursos).<br>
        <strong>‚úî √ötil para:</strong> detectar tend√™ncias mais recentes.
      </p>

      <h3>üî¢ Matriz Visual dos Concursos</h3>
      <p>
        Esta grade mostra os resultados dos √∫ltimos concursos de forma visual e compacta. Cada linha representa um sorteio, com os n√∫meros e trevos sorteados destacados.<br>
        <strong>‚úî √ötil para:</strong><br>
        ‚Ä¢ <strong>Identificar padr√µes visuais:</strong> ver se h√° aglomerados de n√∫meros, sequ√™ncias (ex: 1, 2, 3), ou se a distribui√ß√£o est√° mais dispersa.<br>
        ‚Ä¢ <strong>Observar "buracos":</strong> identificar √°reas da matriz que parecem "vazias" (n√∫meros que n√£o foram sorteados em uma sequ√™ncia de concursos).<br>
        ‚Ä¢ <strong>Revis√£o r√°pida:</strong> ter uma vis√£o geral dos n√∫meros e trevos que sa√≠ram nos sorteios recentes.
      </p>

      <p style="margin-top: 20px; font-style: italic;">
        <strong‚ö†Ô∏è Lembre-se:</strong> Estes gr√°ficos e a matriz n√£o garantem acertos, mas ajudam a apostar com mais consci√™ncia estat√≠stica e a explorar os dados hist√≥ricos do jogo.
      </p>
    </div>
  </div>

  <!-- Popup de Ajuda para Distribui√ß√£o -->
  <div id="popupAjudaDistribuicao" class="modal-ajuda">
    <div class="modal-content">
      <span class="close" onclick="fecharPopupAjudaDistribuicao()">√ó</span>
      <h2>üß† Entendendo a An√°lise de Distribui√ß√£o</h2>
      <p>Esta an√°lise revela a "forma" como os n√∫meros e trevos se comportam, mostrando padr√µes estat√≠sticos, desequil√≠brios, aglomerados e dispers√£o. Compreender esses padr√µes pode guiar suas escolhas com mais estrat√©gia.</p>

      <h3>üìä Paridade (Pares vs √çmpares)</h3>
      <p>
        O que mostra: A frequ√™ncia de sorteios com diferentes combina√ß√µes de n√∫meros pares e √≠mpares para os n√∫meros principais e trevos. (Ex: 3 Pares-3 √çmpares, 4 Pares-2 √çmpares, etc.).<br>
        <strong>‚úî √ötil para:</strong> Equilibrar sua aposta e identificar padr√µes comuns ou combina√ß√µes historicamente raras.<br>
        <strongüí° Dica:</strong> A maioria dos sorteios tem 3 n√∫meros pares e 3 n√∫meros √≠mpares.
      </p>

      <h3>üî¢ Distribui√ß√£o por Faixas Num√©ricas</h3>
      <p>
        O que mostra: Quantas vezes os n√∫meros sorteados caem em diferentes faixas num√©ricas (1-10, 11-20, etc.). Tamb√©m exibe a m√©dia e a moda de ocorr√™ncias por faixa.<br>
        <strong>‚úî √ötil para:</strong> Observar se algumas faixas s√£o historicamente mais sorteadas do que outras.<br>
        <strongüí° Dica:</strong> Ajuda a balancear sua aposta para incluir n√∫meros de faixas mais ativas ou, se preferir, de faixas menos exploradas.
      </p>

      <h3>‚ûï Soma dos N√∫meros Principais</h3>
      <p>
        O que mostra: Um histograma da frequ√™ncia da soma total dos 6 n√∫meros principais sorteados. Apresenta tamb√©m o valor m√≠nimo, m√°ximo, a m√©dia e a(s) moda(s) das somas.<br>
        <strong>‚úî √ötil para:</strong> Escolher combina√ß√µes com somas que estejam dentro da faixa de valores mais comuns historicamente.<br>
        <strongüí° Dica:</strong> Evite somas muito altas ou muito baixas, que s√£o estatisticamente menos frequentes.
      </p>

      <h3>üçÄ Soma dos Trevos da Sorte</h3>
      <p>
        O que mostra: Um histograma da distribui√ß√£o das somas dos 2 trevos da sorte. Exibe o m√≠nimo, m√°ximo, m√©dia e a(s) moda(s) das somas dos trevos.<br>
        <strong>‚úî √ötil para:</strong> Escolher trevos que somem valores que ocorrem com mais frequ√™ncia nos sorteios.<br>
        <strongüí° Dica:</strong> Trevos com soma entre 3 e 7 s√£o historicamente mais comuns.
      </p>

      <h3>‚ÜîÔ∏è Amplitude dos N√∫meros Principais</h3>
      <p>
        O que mostra: Um histograma da frequ√™ncia da diferen√ßa entre o maior e o menor n√∫mero sorteado em cada concurso. (Ex: N√∫meros 1 e 50 = amplitude 49).<br>
        <strong>‚úî √ötil para:</strong> Avaliar a "dispers√£o" dos n√∫meros sorteados e evitar apostar em n√∫meros muito pr√≥ximos ou muito distantes entre si.<br>
        <strongüí° Dica:</strong> Amplitudes entre 30 e 45 s√£o as mais frequentes historicamente.
      </p>

      <h3>üéØ Como Usar na Pr√°tica</h3>
      <p>
        <strong>Observe os picos nos histogramas:</strong> Eles indicam as faixas de valores mais comuns (para somas e amplitudes).<br>
        <strong>Busque o equil√≠brio:</strong> Evite combina√ß√µes muito extremas (ex: muitos pares/√≠mpares, somas muito altas/baixas, amplitudes incomuns) que s√£o menos frequentes historicamente.<br>
        <strong>Use como refer√™ncia, n√£o como regra absoluta:</strong> As estat√≠sticas s√£o ferramentas para auxiliar, n√£o garantias.<br>
        <strong>Combine com outras an√°lises:</strong> Para uma estrat√©gia mais robusta, utilize estas informa√ß√µes em conjunto com a An√°lise de Frequ√™ncia e outras ferramentas dispon√≠veis.
      </p>

      <p style="margin-top: 20px; font-style: italic;">
        <strongImportante:</strong> A Loteria √© um jogo de probabilidades onde a sorte √© protagonista. Estas an√°lises estat√≠sticas n√£o garantem acertos, mas ajudam voc√™ a criar apostas mais equilibradas e estatisticamente mais prov√°veis, baseadas em dados hist√≥ricos reais.
      </p>
    </div>
  </div>

  <!-- Popup de Ajuda para Afinidades -->
  <div id="popupAjudaAfinidades" class="modal-ajuda">
    <div class="modal-content">
      <span class="close" onclick="fecharPopupAjudaAfinidades()">√ó</span>
      <h2>ü§ù Entendendo a An√°lise de Afinidade entre N√∫meros</h2>
      <p>Esta an√°lise revela quais n√∫meros t√™m maior tend√™ncia de aparecer juntos nos sorteios, baseada em dados hist√≥ricos reais. Compreender essas afinidades auxilia na cria√ß√£o de combina√ß√µes estrat√©gicas.</p>

      <h3>üîó Pares com Maior Afinidade</h3>
      <p>
        <strong>O que mostra:</strong> Os pares de n√∫meros que mais frequentemente saem juntos nos sorteios. Por exemplo, se os n√∫meros 21 e 22 aparecem juntos 15 vezes, eles t√™m alta afinidade.<br>
        <strong>‚úî √ötil para:</strong> Identificar n√∫meros que "gostam" de sair juntos, podendo incluir ambos ou evitar ambos em sua aposta.
      </p>

      <h3>‚≠ê Afinidade Geral por N√∫mero</h3>
      <p>
        <strong>O que mostra:</strong> A pontua√ß√£o total de afinidade de cada n√∫mero com todos os outros. Por exemplo, o n√∫mero 7 tem uma pontua√ß√£o de afinidade geral de 250, indicando que ele apareceu com muitos outros n√∫meros.<br>
        <strong>‚úî √ötil para:</strong> Identificar n√∫meros que s√£o mais "ativos" nos sorteios e podem ser bons candidatos para suas apostas.
      </p>

      <h3>üåê Gr√°fico de Rede de Afinidade</h3>
      <p>
        <strong>O que mostra:</strong> Visualiza√ß√£o interativa das conex√µes entre n√∫meros. N√≥s maiores representam n√∫meros com maior afinidade geral, e linhas mais grossas indicam pares com maior afinidade.<br>
        <strong>‚úî √ötil para:</strong> Identificar clusters de n√∫meros que tendem a sair juntos e visualizar padr√µes de conex√£o.
      </p>

      <h3>üìä Interpretando os Gr√°ficos</h3>
      <p>
        <strong>üìà Gr√°fico de Pares:</strong> Mostra os pares com maior afinidade em ordem decrescente. Barras mais altas indicam pares que saem juntos com mais frequ√™ncia.<br>
        <strong‚≠ê Gr√°fico de Afinidade Geral:</strong> Mostra a pontua√ß√£o total de cada n√∫mero. N√∫meros com barras mais altas s√£o mais "sociais" nos sorteios.<br>
        <strongüåê Rede de Afinidade:</strong> Linhas mais grossas e coloridas (vermelho = alta afinidade, laranja = m√©dia, roxo = baixa) mostram a intensidade das conex√µes.
      </p>

      <h3>üéØ Estrat√©gias de Uso</h3>
      <p>
        <strong‚úÖ Estrat√©gia de Inclus√£o:</strong> Incluir pares com alta afinidade em sua aposta, pois eles t√™m hist√≥rico de sair juntos.<br>
        <strong‚ùå Estrat√©gia de Evita√ß√£o:</strong> Evitar pares com alta afinidade para n√£o "concentrar" demais sua aposta.<br>
        <strongüîÑ Estrat√©gia Mista:</strong> Usar n√∫meros com alta afinidade geral como base e complementar com n√∫meros menos frequentes.<br>
        <strong‚öñÔ∏è Balanceamento:</strong> Combinar n√∫meros com diferentes n√≠veis de afinidade para criar apostas mais equilibradas.
      </p>

      <h3>‚ö†Ô∏è Considera√ß√µes Importantes</h3>
      <p>
        <strongüîç Correla√ß√£o n√£o √© causalidade:</strong> N√∫meros com alta afinidade n√£o "causam" o sorteio um do outro, apenas t√™m hist√≥rico de aparecer juntos.<br>
        <strongüîÑ Padr√µes podem mudar:</strong> Afinidades baseadas em dados hist√≥ricos podem n√£o se repetir no futuro.<br>
        <strongüéØ Use com modera√ß√£o:</strong> N√£o dependa exclusivamente da afinidade, combine com outras an√°lises.
      </p>

      <p style="margin-top: 20px; font-style: italic;">
        <strong‚ö†Ô∏è Importante:</strong> A Loteria √© um jogo de probabilidades onde a sorte √© protagonista. Estas an√°lises de afinidade n√£o garantem acertos, mas ajudam voc√™ a entender padr√µes hist√≥ricos e criar apostas mais informadas, baseadas em dados reais dos sorteios.
      </p>
    </div>
  </div>

  <!-- Popup de Ajuda para Trevos -->
  <div id="popupAjudaTrevos" class="modal-ajuda">
    <div class="modal-content">
      <span class="close" onclick="fecharPopupAjudaTrevos()">√ó</span>
      <h2>üçÄ Entendendo a An√°lise dos Trevos da Sorte</h2>
      <p>Esta an√°lise revela os padr√µes dos Trevos da Sorte (n√∫meros de 1 a 6) baseada em dados hist√≥ricos reais. Compreender esses padr√µes auxilia na escolha estrat√©gica dos trevos.</p>

      <h3>üçÄ Frequ√™ncia dos Trevos</h3>
      <p>
        <strong>O que mostra:</strong> Quantas vezes cada trevo (1 a 6) foi sorteado historicamente. Por exemplo, se o Trevo 3 saiu 45 vezes, ele tem alta frequ√™ncia.<br>
        <strong>‚úî √ötil para:</strong> Identificar quais trevos s√£o mais "quentes" e quais s√£o mais "frios" nos sorteios.
      </p>

      <h3>ü§ù Combina√ß√µes de Trevos</h3>
      <p>
        <strong>O que mostra:</strong> As duplas de trevos que mais frequentemente saem juntas. Por exemplo, se Trevo 2 + Trevo 4 saem juntos 15 vezes, eles t√™m alta afinidade.<br>
        <strong>‚úî √ötil para:</strong> Identificar combina√ß√µes de trevos que "gostam" de sair juntos.
      </p>

      <h3>üîó Correla√ß√£o Trevos ‚Üî N√∫meros Principais</h3>
      <p>
        <strong>O que mostra:</strong> Quais n√∫meros principais (1-50) mais frequentemente saem junto com cada trevo espec√≠fico.<br>
        <strong>‚úî √ötil para:</strong> Identificar padr√µes entre trevos e n√∫meros principais, criando combina√ß√µes mais estrat√©gicas.
      </p>

      <h3>üìä Interpretando os Gr√°ficos</h3>
      <p>
        <strong>üìà Gr√°fico de Frequ√™ncia:</strong> Mostra a frequ√™ncia de cada trevo em ordem decrescente. Barras mais altas indicam trevos mais sorteados.<br>
        <strongü§ù Gr√°fico de Combina√ß√µes:</strong> Mostra as duplas de trevos mais frequentes. Barras mais altas indicam combina√ß√µes que saem juntas mais vezes.<br>
        <strongüîó Gr√°fico de Correla√ß√£o:</strong> Mostra quais n√∫meros principais mais saem com cada trevo, facilitando a cria√ß√£o de combina√ß√µes.
      </p>

      <h3>üéØ Estrat√©gias de Uso</h3>
      <p>
        <strong‚úÖ Estrat√©gia de Frequ√™ncia:</strong> Escolher trevos com alta frequ√™ncia hist√≥rica.<br>
        <strongü§ù Estrat√©gia de Combina√ß√£o:</strong> Usar duplas de trevos que t√™m hist√≥rico de sair juntas.<br>
        <strongüîó Estrat√©gia de Correla√ß√£o:</strong> Combinar trevos com n√∫meros principais que t√™m alta correla√ß√£o.<br>
        <strong‚öñÔ∏è Estrat√©gia Balanceada:</strong> Misturar trevos quentes e frios para diversificar.
      </p>

      <h3>‚ö†Ô∏è Considera√ß√µes Importantes</h3>
      <p>
        <strongüîç Padr√µes podem variar:</strong> Frequ√™ncias hist√≥ricas n√£o garantem repeti√ß√£o no futuro.<br>
        <strongüîÑ An√°lise temporal:</strong> Use a janela de an√°lise para ver padr√µes recentes vs. hist√≥ricos.<br>
        <strongüéØ Use com modera√ß√£o:</strong> Combine com outras an√°lises para estrat√©gias mais robustas.
      </p>

      <p style="margin-top: 20px; font-style: italic;">
        <strong‚ö†Ô∏è Importante:</strong> A Loteria √© um jogo de probabilidades onde a sorte √© protagonista. Estas an√°lises dos trevos n√£o garantem acertos, mas ajudam voc√™ a entender padr√µes hist√≥ricos e criar apostas mais informadas, baseadas em dados reais dos sorteios.
      </p>
    </div>
  </div>

  <!-- Popup de Ajuda para Seca -->
  <div id="popupAjudaSeca" class="modal-ajuda">
    <div class="modal-content">
      <span class="close" onclick="fecharPopupAjudaSeca()">√ó</span>
      <h2>üåµ Entendendo a An√°lise de Seca</h2>
      <p>Esta an√°lise identifica h√° quantos concursos um determinado n√∫mero ou trevo n√£o foi sorteado, revelando padr√µes de "seca" que podem orientar suas estrat√©gias de aposta.</p>

      <h3>üìä O que √© a An√°lise de Seca?</h3>
      <p>
        A an√°lise de seca calcula o per√≠odo em que cada n√∫mero ou trevo n√£o foi sorteado.<br>
        <strong>Maior Seca:</strong> N√∫meros/trevos que est√£o h√° mais tempo sem aparecer.<br>
        <strong>Recentemente Sorteados:</strong> N√∫meros/trevos que sa√≠ram nos √∫ltimos concursos.<br>
        <strongüí° Dica:</strong> N√∫meros em seca prolongada podem estar "atrasados" para sair.
      </p>

      <h3>üéØ Janela de An√°lise Temporal</h3>
      <p>
        Use o seletor de per√≠odo para analisar diferentes janelas de tempo:<br>
        <strong>Todos os concursos:</strong> An√°lise completa do hist√≥rico dispon√≠vel.<br>
        <strong√öltimos 25/50/100/200:</strong> Foco em per√≠odos mais recentes.<br>
        <strongüí° Dica:</strong> Per√≠odos menores mostram tend√™ncias mais recentes, per√≠odos maiores mostram padr√µes hist√≥ricos consolidados.
      </p>

      <h3>üìà Interpretando os Gr√°ficos</h3>
      <p>
        <strong>Eixo X:</strong> N√∫meros (1-50) ou trevos (1-6).<br>
        <strong>Eixo Y:</strong> Concursos em que est√£o sem sair.<br>
        <strongBarras vermelhas:</strong> Maior tempo de seca (mais "atrasados").<br>
        <strongBarras verdes:</strong> Sorteados recentemente.<br>
        <strongüí° Dica:</strong> As cores indicam a intensidade da seca, facilitando a identifica√ß√£o visual.
      </p>

      <h3>üí° Estrat√©gias de Aposta</h3>
      <p>
        <strongAtrasados:</strong> Apostar nos n√∫meros em maior seca, baseado na teoria de que est√£o "devendo" sair.<br>
        <strongRecentes:</strong> Apostar nos que sa√≠ram h√° pouco, seguindo a tend√™ncia de "momentum".<br>
        <strongMisto:</strong> Combinar ambas as estrat√©gias para diversificar sua aposta.<br>
        <strongAleatoriedade:</strong> Lembre-se: n√£o h√° garantias! A loteria √© um jogo de probabilidades onde a sorte √© protagonista.
      </p>

      <h3>üéØ Como Usar na Pr√°tica</h3>
      <p>
        <strongObserve as barras altas:</strong> Elas indicam n√∫meros em maior seca.<br>
        <strongAnalise as barras baixas:</strong> Mostram n√∫meros sorteados recentemente.<br>
        <strongCompare per√≠odos:</strong> Use diferentes janelas temporais para identificar tend√™ncias.<br>
        <strongCombine estrat√©gias:</strong> Use a seca em conjunto com outras an√°lises dispon√≠veis.
      </p>

      <h3>‚ö†Ô∏è Considera√ß√µes Importantes</h3>
      <p>
        <strongN√£o √© garantia:</strong> A an√°lise de seca √© uma ferramenta estat√≠stica, n√£o uma previs√£o.<br>
        <strongAleatoriedade:</strong> Cada sorteio √© independente, n√£o h√° "d√≠vida" real dos n√∫meros.<br>
        <strongResponsabilidade:</strong> Aposte apenas o que pode perder, dentro dos seus limites financeiros.<br>
        <strongDiversifica√ß√£o:</strong> N√£o aposte apenas em n√∫meros em seca, diversifique suas escolhas.
      </p>

      <p style="margin-top: 20px; font-style: italic;">
        <strongImportante:</strong> Esta √© uma an√°lise estat√≠stica hist√≥rica que n√£o garante resultados futuros. Use como ferramenta de orienta√ß√£o, mas sempre aposte com responsabilidade e consci√™ncia de que a loteria √© um jogo de probabilidades onde a sorte √© protagonista.
      </p>
    </div>
  </div>

  <!-- Popup de Ajuda para Estat√≠sticas Avan√ßadas -->
  <div id="popupAjudaEstatisticasAvancadas" class="modal-ajuda">
    <div class="modal-content">
      <span class="close" onclick="fecharPopupAjudaEstatisticasAvancadas()">√ó</span>
      <h2>üìà Entendendo as Estat√≠sticas Avan√ßadas</h2>
      <p>Esta an√°lise utiliza m√©todos estat√≠sticos avan√ßados para identificar padr√µes complexos nos sorteios da +Milion√°ria, oferecendo insights profundos sobre a aleatoriedade e distribui√ß√£o dos n√∫meros.</p>

      <h3>üß™ Teste de Aleatoriedade</h3>
      <p>
        Esse teste verifica se os sorteios seguem um padr√£o realmente aleat√≥rio ou se apresentam algum tipo de regularidade estat√≠stica.<br>
        <strong>O que faz:</strong> Usa um p-valor (probabilidade) para indicar o grau de aleatoriedade dos resultados:<br>
        <strong>p < 0.05:</strong> Sugere que h√° padr√µes n√£o aleat√≥rios, ou seja, comportamentos que se repetem mais do que o acaso explicaria.<br>
        <strong>p > 0.05:</strong> Indica que os resultados s√£o compat√≠veis com sorteios aleat√≥rios.<br>
        <strong>Quanto mais pr√≥ximo de 1.0,</strong> maior a evid√™ncia de que os resultados seguem o acaso puro.<br>
        <strongüí° Dica:</strong> Em outras palavras, esse teste ajuda a descobrir se h√° algum "sinal escondido" nos sorteios, ou se tudo est√° mesmo no reino da sorte e do acaso.
      </p>

      <h3>üìä Desvio Padr√£o da Distribui√ß√£o</h3>
      <p>
        Mede a dispers√£o dos n√∫meros sorteados em rela√ß√£o √† m√©dia esperada.<br>
        <strongDesvio Padr√£o:</strong> Indica o qu√£o espalhados est√£o os n√∫meros.<br>
        <strongCoeficiente de Varia√ß√£o:</strong> Desvio padr√£o relativo √† m√©dia (em %).<br>
        <strongüí° Dica:</strong> Valores altos indicam maior variabilidade nos sorteios.
      </p>

      <h3>üîó An√°lise de Clusters</h3>
      <p>
        T√©cnica de minera√ß√£o de dados e aprendizado de m√°quina n√£o supervisionado que tem como objetivo agrupar objetos (ou dados) em conjuntos, identificando grupos naturais de n√∫meros que apresentam comportamentos semelhantes ou tendem a aparecer juntos nos sorteios.<br>
        <strongSignificado:</strong> Revela associa√ß√µes ocultas entre n√∫meros, agrupando aqueles que compartilham caracter√≠sticas ou padr√µes de frequ√™ncia.<br>
        <strongBenef√≠cio:</strong> Permite identificar combina√ß√µes promissoras ou tend√™ncias inesperadas nos sorteios, oferecendo uma nova perspectiva para suas apostas.
      </p>

      <h3>üìà Correla√ß√£o entre N√∫meros</h3>
      <p>
        Analisa as rela√ß√µes estat√≠sticas entre diferentes n√∫meros, mostrando apenas os <strong>extremos mais significativos</strong>.<br>
        <strongüî¢ Por que apenas os extremos:</strong> Com 50 n√∫meros, existem 1.225 combina√ß√µes poss√≠veis (50√ó49√∑2). Mostrar todas seria impratic√°vel e confuso visualmente.<br>
        <strongüìä O que o gr√°fico mostra:</strong><br>
        ‚Ä¢ <strong>Correla√ß√µes positivas:</strong> Apenas os 10 pares mais correlacionados (correla√ß√£o > 0.1)<br>
        ‚Ä¢ <strong>Correla√ß√µes negativas:</strong> Apenas os 10 pares menos correlacionados (correla√ß√£o < -0.1)<br>
        <strongüéØ Foco nos extremos:</strong> Os extremos s√£o os mais significativos para an√°lise, mostrando n√∫meros que realmente tendem a sair juntos (positivas) ou raramente aparecem juntos (negativas).<br>
        <strongüí° Dica:</strong> Use essas correla√ß√µes extremas para identificar combina√ß√µes promissoras ou evitar n√∫meros que raramente saem juntos.
      </p>

      <h3>üéØ Probabilidades Condicionais</h3>
      <p>
        Esse gr√°fico mostra a chance de um n√∫mero ser sorteado quando outro j√° foi. √â como observar se certos n√∫meros t√™m uma tend√™ncia a aparecer juntos com frequ√™ncia.<br><br>
        <strong>üîó Essas s√£o chamadas de probabilidades condicionais</strong> ‚Äî ou seja, "Dado que o n√∫mero X saiu, qual a chance de Y tamb√©m sair?".<br><br>
        <strong>üìä Os valores s√£o apresentados em porcentagem</strong>, mostrando a for√ßa dessa rela√ß√£o entre os pares.<br><br>
        <strong>üí° Use essa an√°lise para identificar n√∫meros que "se atraem" estatisticamente</strong>, e que podem surgir juntos com mais frequ√™ncia do que o acaso sugeriria.<br><br>
        <strong>üß† √â uma ferramenta poderosa para quem busca padr√µes sutis e conex√µes escondidas entre os n√∫meros.</strong>
      </p>

      <h3>üéØ Janela de An√°lise Temporal</h3>
      <p>
        Use o seletor de per√≠odo para analisar diferentes janelas de tempo:<br>
        <strongTodos os concursos:</strong> An√°lise completa do hist√≥rico dispon√≠vel.<br>
        <strong√öltimos 25/50/100/200:</strong> Foco em per√≠odos mais recentes.<br>
        <strongüí° Dica:</strong> Per√≠odos menores mostram tend√™ncias mais recentes, per√≠odos maiores mostram padr√µes hist√≥ricos consolidados.
      </p>

      <h3>üí° Estrat√©gias de Aposta</h3>
      <p>
        <strongAleatoriedade Confirmada:</strong> Use estrat√©gias balanceadas e diversificadas.<br>
        <strongClusters Identificados:</strong> Evite ou explore grupos de n√∫meros relacionados.<br>
        <strongCorrela√ß√µes:</strong> Use pares de n√∫meros que se relacionam estatisticamente.<br>
        <strongProbabilidades:</strong> Aproveite as rela√ß√µes condicionais identificadas.<br>
        <strongCombina√ß√£o:</strong> Integre com an√°lises de frequ√™ncia e seca.
      </p>

      <h3>üéØ Como Usar na Pr√°tica</h3>
      <p>
        <strongObserve o teste de aleatoriedade:</strong> Confirma se h√° padr√µes nos dados.<br>
        <strongAnalise os clusters:</strong> Identifique grupos de n√∫meros relacionados.<br>
        <strongEstude as correla√ß√µes:</strong> Use pares de n√∫meros que se relacionam.<br>
        <strongConsidere as probabilidades:</strong> Aproveite as rela√ß√µes condicionais.<br>
        <strongCompare per√≠odos:</strong> Use diferentes janelas temporais para identificar tend√™ncias.
      </p>

      <h3>‚ö†Ô∏è Considera√ß√µes Importantes</h3>
      <p>
        <strongComplexidade:</strong> Esta an√°lise usa m√©todos estat√≠sticos avan√ßados.<br>
        <strongInterpreta√ß√£o:</strong> Requer conhecimento b√°sico de estat√≠stica.<br>
        <strongLimita√ß√µes:</strong> Padr√µes passados n√£o garantem resultados futuros.<br>
        <strongResponsabilidade:</strong> Aposte apenas o que pode perder, dentro dos seus limites financeiros.<br>
        <strongDiversifica√ß√£o:</strong> N√£o aposte apenas baseado em uma an√°lise, diversifique suas escolhas.
      </p>

      <p style="margin-top: 20px; font-style: italic;">
        <strongImportante:</strong> Esta √© uma an√°lise estat√≠stica avan√ßada que n√£o garante resultados futuros. Use como ferramenta de orienta√ß√£o, mas sempre aposte com responsabilidade e consci√™ncia de que a loteria √© um jogo de probabilidades onde a sorte √© protagonista.
      </p>
    </div>
  </div>

  <!-- CSS para o popup de ajuda e gr√°ficos responsivos -->
  <style>
  .modal-ajuda {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.85);
  }

  .modal-principal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.85);
  }

  /* Gr√°ficos responsivos */
  .chart-container {
    padding: 10px;
    margin: 10px 0;
  }

  @media (max-width: 768px) {
    .chart-container {
      padding: 5px;
      margin: 5px 0;
    }
    
    .chart-container h3 {
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }
    
    .chart-container div[id^="grafico-"] {
      height: 350px !important; /* Aumenta ainda mais sem t√≠tulos de eixo */
      width: 100% !important;
    }
  }

  @media (max-width: 640px) {
    .chart-container div[id^="grafico-"] {
      height: 310px !important; /* Aumenta ainda mais sem t√≠tulos de eixo */
    }
    
    /* Otimiza√ß√µes espec√≠ficas para gr√°ficos Plotly em mobile */
    .js-plotly-plot .plotly .modebar {
      display: none !important;
    }
    
    /* Esconde legendas em mobile para economizar espa√ßo */
    .js-plotly-plot .plotly .legend {
      display: none !important;
    }
    
    .js-plotly-plot .plotly .legend .traces {
      display: none !important;
    }
  }

  /* Mostra legendas em desktop */
  @media (min-width: 769px) {
    .js-plotly-plot .plotly .legend {
      display: block !important;
      font-size: 11px !important;
    }
    
    .js-plotly-plot .plotly .legend .traces {
      display: block !important;
      font-size: 11px !important;
    }
  }

  .modal-ajuda .modal-content {
    background-color: #1c1c1c;
    color: #eee;
    margin: 10% auto;
    padding: 20px;
    border-radius: 12px;
    width: 90%;
    max-width: 600px;
    max-height: 90vh; /* Limita altura m√°xima */
    overflow-y: auto; /* Permite rolagem vertical */
    -webkit-overflow-scrolling: touch; /* Melhora rolagem em iOS */
    scroll-behavior: smooth; /* Scroll suave */
    font-family: 'Inter', sans-serif;
    box-shadow: 0 0 20px #000;
  }

  .modal-principal .modal-content {
    background-color: #1c1c1c;
    color: #eee;
    margin: 5% auto;
    padding: 20px;
    border-radius: 12px;
    width: 95%;
    max-width: 1200px;
    max-height: 90vh; /* Limita altura m√°xima */
    overflow-y: auto; /* Permite rolagem vertical */
    -webkit-overflow-scrolling: touch; /* Melhora rolagem em iOS */
    scroll-behavior: smooth; /* Scroll suave */
    font-family: 'Inter', sans-serif;
    box-shadow: 0 0 20px #000;
  }

  .modal-ajuda .close {
    color: #aaa;
    float: right;
    font-size: 26px;
    cursor: pointer;
  }

  .modal-ajuda .close:hover {
    color: red;
  }

  .modal-principal .close {
    color: #aaa;
    float: right;
    font-size: 26px;
    cursor: pointer;
  }

  .modal-principal .close:hover {
    color: red;
  }

  .modal-ajuda h2 {
    color: #00E38C;
    margin-bottom: 15px;
  }

  .modal-ajuda h3 {
    color: #00E38C;
    margin-top: 20px;
    margin-bottom: 10px;
  }

  .modal-ajuda p {
    line-height: 1.6;
    margin-bottom: 10px;
  }

  .modal-principal h2 {
    color: #00E38C;
    margin-bottom: 15px;
  }

  .modal-principal h3 {
    color: #00E38C;
    margin-top: 20px;
    margin-bottom: 10px;
  }

  .modal-principal p {
    line-height: 1.6;
    margin-bottom: 10px;
  }

  /* Otimiza√ß√µes mobile para modal de ajuda */
  @media (max-width: 768px) {
    .modal-ajuda .modal-content {
      margin: 5% auto; /* Reduz margem superior */
      width: 95%; /* Ocupa mais largura */
      padding: 15px; /* Reduz padding */
    }
  }

  @media (max-width: 640px) {
    .modal-ajuda .modal-content {
      margin: 3% auto; /* Margem ainda menor */
      width: 98%; /* Quase toda a largura */
      padding: 12px; /* Padding menor */
    }
  }

  /* Otimiza√ß√µes mobile para modal principal */
  @media (max-width: 768px) {
    .modal-principal .modal-content {
      margin: 3% auto; /* Reduz margem superior */
      width: 98%; /* Ocupa mais largura */
      padding: 15px; /* Reduz padding */
    }
  }

  @media (max-width: 640px) {
    .modal-principal .modal-content {
      margin: 2% auto; /* Margem ainda menor */
      width: 99%; /* Quase toda a largura */
      padding: 12px; /* Padding menor */
    }
  }
  </style>

  <script src="{{ url_for('static', filename='js/graficos_milionaria.js') }}"></script>
  


  <!-- Script para controlar os menus responsivos -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const hamburgerIcon = document.getElementById('hamburgerIcon');
      const navPanel = document.getElementById('navPanel');
      const navOverlay = document.getElementById('navOverlay');

      if (hamburgerIcon && navPanel && navOverlay) {
        hamburgerIcon.addEventListener('click', () => {
          hamburgerIcon.classList.toggle('open');
          navPanel.classList.toggle('open');
          navOverlay.classList.toggle('open');
          
          // Previne scroll do body quando menu est√° aberto
          document.body.style.overflow = navPanel.classList.contains('open') ? 'hidden' : '';
        });

        // Controle do submenu mobile
        const mobileDropdownToggles = document.querySelectorAll('.mobile-dropdown-toggle');
        mobileDropdownToggles.forEach(toggle => {
          toggle.addEventListener('click', (e) => {
            e.preventDefault();
            const dropdown = toggle.nextElementSibling;
            dropdown.classList.toggle('show');
          });
        });

        // Fechar o menu ao clicar em um link (exceto dropdown toggles)
        navPanel.querySelectorAll('a:not(.mobile-dropdown-toggle)').forEach(link => {
          link.addEventListener('click', () => {
            hamburgerIcon.classList.remove('open');
            navPanel.classList.remove('open');
            navOverlay.classList.remove('open');
            document.body.style.overflow = '';
          });
        });

        // Fechar o menu ao clicar no overlay
        navOverlay.addEventListener('click', () => {
          hamburgerIcon.classList.remove('open');
          navPanel.classList.remove('open');
          navOverlay.classList.remove('open');
          document.body.style.overflow = '';
        });

        // Fechar o menu com tecla ESC
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && navPanel.classList.contains('open')) {
            hamburgerIcon.classList.remove('open');
            navPanel.classList.remove('open');
            navOverlay.classList.remove('open');
            document.body.style.overflow = '';
          }
        });
      }
    });
  </script>

  <!-- Modal para N√∫meros do Cluster -->
  <div id="modal-numeros-cluster" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-card rounded-lg shadow-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto text-text relative">
      <h3 id="modal-numeros-cluster-titulo" class="text-primary text-2xl font-semibold mb-4 text-center">N√∫meros do Cluster</h3>
      <div id="modal-numeros-cluster-conteudo" class="grid grid-cols-5 sm:grid-cols-6 md:grid-cols-7 lg:grid-cols-8 gap-2 text-center text-lg font-bold">
      </div>
      <button id="fechar-modal-numeros-cluster" class="absolute top-4 right-4 text-textSecondary hover:text-primary transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>

  <script>
  (function MILPreferenciasIsoladas() {
    if (window.__MIL_PREFS_INIT__) return;
    window.__MIL_PREFS_INIT__ = true;
    const STORAGE_KEY = 'milionariaPremiumPreferences';

    function getPrefsMIL() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; } catch (_) { return {}; }
    }

    function setPrefsMIL(p) {
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(p || {})); } catch (_) {}
    }

    // Salva SOMENTE o passo informado, preservando os demais (merge incremental)
    window.salvarPreferenciasDoPassoMIL = function(prefix) {
      const prefs = getPrefsMIL();
      let sub = {};

      switch (prefix) {
        case 'freq': {
          const elPeriodo = document.getElementById('freq-periodo');
          const elQuentes = document.getElementById('freq-priorizar-quentes');
          const elQtdeQuentes = document.getElementById('freq-qtde-quentes');
          const elFrios = document.getElementById('freq-priorizar-frios');
          const elQtdeFrios = document.getElementById('freq-qtde-frios');
          // Se nenhum campo do passo existir no DOM, n√£o sobrescreva o storage
          if (!elPeriodo && !elQuentes && !elQtdeQuentes && !elFrios && !elQtdeFrios) return;
          const next = {};
          if (elPeriodo) next.janelaAnalise = elPeriodo.value || '';
          if (elQuentes) next.priorizarQuentes = Array.from(document.querySelectorAll('#freq-priorizar-quentes')).some(el => el.checked);
          if (elQtdeQuentes) next.qtdeQuentes = parseInt(elQtdeQuentes.value || '0', 10);
          if (elFrios) next.priorizarFrios = Array.from(document.querySelectorAll('#freq-priorizar-frios')).some(el => el.checked);
          if (elQtdeFrios) next.qtdeFrios = parseInt(elQtdeFrios.value || '0', 10);
          if (!Object.keys(next).length) return;
          sub = next;
          break; }
        case 'dist': {
          const elParidade = document.getElementById('dist-priorizar-pares-impares');
          const elParidadeDesejada = document.getElementById('dist-paridade-desejada');
          const elSoma = document.getElementById('dist-priorizar-soma');
          const elSomaMin = document.getElementById('dist-soma-min');
          const elSomaMax = document.getElementById('dist-soma-max');
          if (!elParidade && !elParidadeDesejada && !elSoma && !elSomaMin && !elSomaMax) return;
          const next = {};
          if (elParidade) next.priorizarParidade = !!elParidade.checked;
          if (elParidadeDesejada) next.paridadeDesejada = elParidadeDesejada.value || 'equilibrado';
          if (elSoma) next.priorizarSoma = !!elSoma.checked;
          if (elSomaMin) next.somaMin = parseInt(elSomaMin.value || '0', 10);
          if (elSomaMax) next.somaMax = parseInt(elSomaMax.value || '0', 10);
          if (!Object.keys(next).length) return;
          sub = next;
          break; }
        case 'afinidade': {
          const all = document.querySelectorAll('input[name="par-afinidade"]');
          if (!all || all.length === 0) return;
          sub = {
            paresFavoritos: Array.from(document.querySelectorAll('input[name="par-afinidade"]:checked')).map(i => i.value)
          };
          break; }
        case 'padrao': {
          const anySeq = document.querySelectorAll('input[name="padrao-seq"]');
          const elEvCon = document.getElementById('evitar-consecutivos');
          const elEvRep = document.getElementById('evitar-repeticoes');
          if ((!anySeq || anySeq.length === 0) && !elEvCon && !elEvRep) return;
          const next = {};
          if (anySeq && anySeq.length) next.sequencias = Array.from(document.querySelectorAll('input[name="padrao-seq"]:checked')).map(i => i.value);
          if (elEvCon) next.evitarConsecutivos = !!elEvCon.checked;
          if (elEvRep) next.evitarRepeticoesSeguidas = !!elEvRep.checked;
          sub = next;
          break; }
        case 'trevo': {
          const all = document.querySelectorAll('input[name="trevo-pref"]');
          if (!all || all.length === 0) return;
          sub = {
            preferenciaTrevos: Array.from(document.querySelectorAll('input[name="trevo-pref"]:checked')).map(i => i.value)
          };
          break; }
        case 'seca': {
          const el = document.getElementById('limite-seca');
          if (!el) return;
          sub = { maxSeca: el.value || '' };
          break; }
        case 'avancada': {
          const all = document.querySelectorAll('input[name="cluster-opt"]');
          if (!all || all.length === 0) return;
          sub = {
            clusters: Array.from(document.querySelectorAll('input[name="cluster-opt"]:checked')).map(i => i.value)
          };
          break; }
        default:
          return;
      }

      // Merge incremental no passo para n√£o apagar campos anteriores do mesmo passo
      const mergedStep = { ...(prefs[prefix] || {}), ...(sub || {}) };
      setPrefsMIL({ ...prefs, [prefix]: mergedStep });
    };

    // Hidrata o objeto global do modal com o que foi salvo por passo
    window.hidratarPreferenciasDoModalMIL = function() {
      const byStep = getPrefsMIL();
      const map = {
        freq: 'frequencia',
        dist: 'distribuicao',
        afinidade: 'afinidades',
        padrao: 'padroes',
        trevo: 'trevos',
        seca: 'seca',
        avancada: 'clusters'
      };

      const g = window.userPremiumPreferences || {};
      for (const [prefix, sub] of Object.entries(byStep)) {
        const key = map[prefix];
        if (!key) continue;
        if (key === 'clusters') {
          const arr = Array.isArray(sub?.clusters) ? sub.clusters : (Array.isArray(sub) ? sub : []);
          g.clusters = Array.isArray(g.clusters) ? Array.from(new Set([...(g.clusters || []), ...arr])) : arr;
        } else {
          g[key] = { ...(g[key] || {}), ...(sub || {}) };
        }
      }
      window.userPremiumPreferences = g;
    };

    // Monta o resumo "Par√¢metros Ativos" do Premium a partir do storage
    window.montarResumoParametrosAtivosMIL = function() {
      try {
        const prefs = getPrefsMIL();
        const linhas = [];
        if (prefs.freq) {
          linhas.push(`üìä Frequ√™ncia: janela=${prefs.freq.janelaAnalise || '-'}; quentes=${prefs.freq.qtdeQuentes ?? '-'}; frios=${prefs.freq.qtdeFrios ?? '-'}`);
        }
        if (prefs.dist) {
          const parts = [];
          if (prefs.dist.priorizarParidade) {
            const mapa = { equilibrado: 'Equilibrada', mais_pares: 'Mais Pares', mais_impares: 'Mais √çmpares' };
            parts.push(`Paridade: ${mapa[prefs.dist.paridadeDesejada] || '-'}`);
          }
          if (prefs.dist.priorizarSoma) {
            parts.push(`Soma: ${prefs.dist.somaMin ?? '-'}‚Äì${prefs.dist.somaMax ?? '-'}`);
          }
          if (parts.length) linhas.push(`üî¢ Distribui√ß√£o: ${parts.join(' ¬∑ ')}`);
        }
        if (prefs.afinidade && Array.isArray(prefs.afinidade.paresFavoritos) && prefs.afinidade.paresFavoritos.length) linhas.push(`ü§ù Afinidades: ${prefs.afinidade.paresFavoritos.join(', ')}`);
        if (prefs.padrao && Array.isArray(prefs.padrao.sequencias) && prefs.padrao.sequencias.length) linhas.push(`üß© Padr√µes: ${prefs.padrao.sequencias.join(', ')}`);
        if (prefs.trevo && Array.isArray(prefs.trevo.preferenciaTrevos) && prefs.trevo.preferenciaTrevos.length) linhas.push(`üçÄ Trevos: ${prefs.trevo.preferenciaTrevos.join(', ')}`);
        if (prefs.seca) linhas.push(`üåµ Seca: m√°x=${(prefs.seca.maxSeca ?? '-')}`);
        if (prefs.avancada && Array.isArray(prefs.avancada.clusters) && prefs.avancada.clusters.length) linhas.push(`ü§ñ Avan√ßadas: ${prefs.avancada.clusters.join(', ')}`);
        const html = linhas.length
          ? `<ul class="list-disc pl-5 space-y-1">${linhas.map(li => `<li>${li}</li>`).join('')}</ul>`
          : `<p class="text-gray-400">Nenhum par√¢metro selecionado ainda.</p>`;
        const destinos = document.querySelectorAll('#lista-parametros');
        destinos.forEach(el => { el.innerHTML = html; });
      } catch (_) {}
    };

    function attachChange(prefix, selector) {
      try {
        document.querySelectorAll(selector).forEach(el => {
          el.addEventListener('change', () => window.salvarPreferenciasDoPassoMIL(prefix));
          el.addEventListener('input', () => window.salvarPreferenciasDoPassoMIL(prefix));
        });
      } catch (_) {}
    }

    document.addEventListener('DOMContentLoaded', function() {
      // Loaders por passo: rep√µem o que j√° foi salvo
      function carregarPreferenciasFrequenciaMIL() {
        const prefs = getPrefsMIL().freq || {};
        try {
          const ja = document.getElementById('janela-analise');
          const tn = document.getElementById('top-n');
          const q = document.getElementById('freq-priorizar-quentes');
          const f = document.getElementById('freq-priorizar-frios');
          if (prefs.janelaAnalise && ja) ja.value = prefs.janelaAnalise;
          if (prefs.considerarTopN && tn) tn.value = prefs.considerarTopN;
          if (typeof prefs.priorizarQuentes === 'boolean' && q) q.checked = !!prefs.priorizarQuentes;
          if (typeof prefs.priorizarFrios === 'boolean' && f) f.checked = !!prefs.priorizarFrios;
        } catch (_) {}
      }

      function carregarPreferenciasDistribuicaoMIL() {
        const prefs = getPrefsMIL().dist || {};
        try {
          (prefs.buckets || []).forEach(v => {
            const el = document.querySelector(`input[name="bucket-dist"][value="${v}"]`);
            if (el) el.checked = true;
          });
        } catch (_) {}
      }

      function carregarPreferenciasAfinidadeMIL() {
        const prefs = getPrefsMIL().afinidade || {};
        try {
          (prefs.paresFavoritos || []).forEach(v => {
            const el = document.querySelector(`input[name="par-afinidade"][value="${v}"]`);
            if (el) el.checked = true;
          });
        } catch (_) {}
      }

      function carregarPreferenciasTrevoMIL() {
        const prefs = getPrefsMIL().trevo || {};
        try {
          (prefs.preferenciaTrevos || []).forEach(v => {
            const el = document.querySelector(`input[name="trevo-pref"][value="${v}"]`);
            if (el) el.checked = true;
          });
        } catch (_) {}
      }

      function carregarPreferenciasSecaMIL() {
        const prefs = getPrefsMIL().seca || {};
        try {
          const el = document.getElementById('limite-seca');
          if (el && (prefs.maxSeca || prefs.maxSeca === 0)) el.value = prefs.maxSeca;
        } catch (_) {}
      }

      function carregarPreferenciasAvancadaMIL() {
        const prefs = getPrefsMIL().avancada || {};
        try {
          (prefs.clusters || []).forEach(v => {
            const el = document.querySelector(`input[name="cluster-opt"][value="${v}"]`);
            if (el) el.checked = true;
          });
        } catch (_) {}
      }

      // Executa loaders na inicializa√ß√£o (idempotente)
      try {
        carregarPreferenciasFrequenciaMIL();
        carregarPreferenciasDistribuicaoMIL();
        carregarPreferenciasAfinidadeMIL();
        carregarPreferenciasTrevoMIL();
        carregarPreferenciasSecaMIL();
        carregarPreferenciasAvancadaMIL();
      } catch (_) {}

      // Liga salvamento incremental por passo
      attachChange('freq', '#freq-periodo, #freq-priorizar-quentes, #freq-qtde-quentes, #freq-priorizar-frios, #freq-qtde-frios');
      attachChange('dist', '#dist-priorizar-pares-impares, #dist-paridade-desejada, #dist-priorizar-soma, #dist-soma-min, #dist-soma-max');
      attachChange('afinidade', 'input[name="par-afinidade"]');
      attachChange('padrao', 'input[name="padrao-seq"], #evitar-consecutivos, #evitar-repeticoes');
      attachChange('trevo', 'input[name="trevo-pref"]');
      attachChange('seca', '#limite-seca');
      attachChange('avancada', 'input[name="cluster-opt"]');

      // Delega√ß√£o global para campos din√¢micos (evita perder eventos em conte√∫do injetado)
      try {
        document.addEventListener('change', function(e) {
          try {
            if (e.target && (e.target.closest && e.target.closest('#freq-periodo, #freq-qtde-quentes, #freq-qtde-frios, #freq-priorizar-quentes, #freq-priorizar-frios'))) {
              window.salvarPreferenciasDoPassoMIL('freq');
            }
            if (e.target && (e.target.closest && e.target.closest('#dist-priorizar-pares-impares, #dist-paridade-desejada, #dist-priorizar-soma, #dist-soma-min, #dist-soma-max'))) {
              window.salvarPreferenciasDoPassoMIL('dist');
            }
          } catch (_) {}
        });
        document.addEventListener('input', function(e) {
          try {
            if (!e.target) return;
            const el = e.target;
            if (el.closest && el.closest('#freq-qtde-quentes, #freq-qtde-frios')) {
              window.salvarPreferenciasDoPassoMIL('freq');
            } else if (el.closest && el.closest('#dist-soma-min, #dist-soma-max')) {
              window.salvarPreferenciasDoPassoMIL('dist');
            }
          } catch (_) {}
        });
      } catch (_) {}

      // Exclus√£o m√∫tua Quentes/Frios (somente +Milion√°ria)
      try {
        // Pode haver duplicatas dos checkboxes na p√°gina; trate todas
        const allQuentes = Array.from(document.querySelectorAll('#freq-priorizar-quentes'));
        const allFrios = Array.from(document.querySelectorAll('#freq-priorizar-frios'));
        if (allQuentes.length && allFrios.length) {
          const syncExclusao = (tipo) => {
            const isQuentes = tipo === 'quentes';
            const fontes = isQuentes ? allQuentes : allFrios;
            const opostas = isQuentes ? allFrios : allQuentes;
            // Se qualquer fonte ficar marcada, desmarca todas as opostas
            if (fontes.some(el => el.checked)) {
              opostas.forEach(el => { el.checked = false; });
            }
            window.salvarPreferenciasDoPassoMIL('freq');
          };
          allQuentes.forEach(el => el.addEventListener('change', () => syncExclusao('quentes')));
          allFrios.forEach(el => el.addEventListener('change', () => syncExclusao('frios')));
          // Estado inicial consistente
          if (allQuentes.some(el => el.checked) && allFrios.some(el => el.checked)) {
            allFrios.forEach(el => { el.checked = false; });
          }
        }
      } catch (_) {}

      // REMOVIDO: Event listener conflitante que sobrescrevia o bot√£o do modal

      // REMOVIDO: Event listener conflitante do bot√£o gerar sugest√£o
      
      // Fun√ß√£o para controlar o popup de informa√ß√µes
      window.toggleInfoPopup = function() {
        const popup = document.getElementById('info-popup');
        if (popup) {
          if (popup.classList.contains('hidden')) {
            popup.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Previne scroll da p√°gina
          } else {
            popup.classList.add('hidden');
            document.body.style.overflow = 'auto'; // Restaura scroll da p√°gina
          }
        }
      }
      
      // Fechar popup ao clicar fora dele
      document.addEventListener('click', function(e) {
        const popup = document.getElementById('info-popup');
        if (popup && !popup.classList.contains('hidden')) {
          if (e.target === popup) {
            toggleInfoPopup();
          }
        }
      });
      
      // Fechar popup com tecla ESC
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          const popup = document.getElementById('info-popup');
          if (popup && !popup.classList.contains('hidden')) {
            toggleInfoPopup();
          }
        }
      });
    });

    // ==== FUN√á√ÉO PARA CORRIGIR GR√ÅFICOS PLOTLY NO MOBILE ====
    function fixPlotlyMobile() {
      if (window.innerWidth <= 768) { // Mudou para 768px para combinar com CSS
        console.log('fixPlotlyMobile executando...'); // Debug
        document.querySelectorAll('.js-plotly-plot').forEach((el) => {
          console.log('Aplicando relayout em:', el); // Debug
          Plotly.relayout(el, {
            margin: { l: 42, r: 18, t: 60, b: 32 }, // Aumenta top para t√≠tulos quebrados
            'title.x': 0,                            // ancora t√≠tulo √† esquerda
            'title.xanchor': 'left',
            'title.yanchor': 'top',                   // ancora t√≠tulo ao topo
            'title.y': 0.98                          // posiciona t√≠tulo no topo
          });
        });
      }
    }
    
    // Executa imediatamente e em eventos
    fixPlotlyMobile(); // Executa imediatamente
    window.addEventListener('load', fixPlotlyMobile);
    window.addEventListener('resize', fixPlotlyMobile);
    
    // Executa tamb√©m ap√≥s um delay para garantir que Plotly carregou
    setTimeout(fixPlotlyMobile, 1000);
    setTimeout(fixPlotlyMobile, 2000);
  })();
  </script>
  
  <!-- Scripts de verifica√ß√£o de acesso -->
  <script src="/static/js/premium_access_modal.js"></script>
  <script src="/static/js/access_checker.js"></script>
  
  <!-- üîê MODAL LOGIN/CADASTRO JAVASCRIPT -->
  <script src="{{ url_for('static', filename='js/modal-login-cadastro.js') }}" defer></script>
  </div> <!-- Fim do main-content -->
  
  <!-- RODAP√â -->
  <footer class="site-footer" role="contentinfo">
    <div class="footer-row">
      <div class="footer-text">
        <strong>Pol√≠tica de Honestidade & Jogo Respons√°vel.</strong>
        Loterias Inteligentes √© uma plataforma independente de an√°lise estat√≠stica,
        sem v√≠nculo com a Caixa Econ√¥mica Federal. Nossas ferramentas oferecem
        insights baseados em dados, mas loterias envolvem sorte e aleatoriedade ‚Äî
        n√£o h√° garantias de ganhos. Jogue com responsabilidade.
      </div>
      <div class="footer-actions">
        <button class="footer-toggle" id="footerToggle" onclick="openFooterModal()">
          Ver detalhes
        </button>
      </div>
    </div>
  </footer>

  <!-- MODAL DO RODAP√â -->
  <div id="footer-modal" class="footer-modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h4 style="margin:0 0 .6rem 0;">Pol√≠tica de Honestidade & Jogo Respons√°vel ‚Äî Detalhes</h4>
        <button class="modal-close" onclick="closeFooterModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p style="opacity:.9;margin:.3rem 0 1rem 0;">
          Somos uma plataforma independente de <strong>an√°lise estat√≠stica</strong> para loterias. 
          Nosso objetivo √© oferecer <em>insights</em> √∫teis ‚Äî sem prometer resultados. Jogue com responsabilidade.
        </p>

        <details>
          <summary><strong>1) Como nossas ferramentas funcionam</strong></summary>
          <ul>
            <li><strong>Fontes de dados:</strong> resultados oficiais p√∫blicos.</li>
            <li><strong>M√©todos estat√≠sticos:</strong> frequ√™ncia, distribui√ß√£o, padr√µes sequenciais, correla√ß√µes/clusteriza√ß√£o, sazonalidade e testes simples de aleatoriedade.</li>
            <li><strong>Atualiza√ß√£o:</strong> os pain√©is s√£o atualizados periodicamente conforme novos concursos s√£o publicados.</li>
            <li><strong>Objetivo:</strong> reduzir ru√≠dos e apoiar escolhas mais conscientes; <u>n√£o</u> prever o futuro.</li>
          </ul>
        </details>

        <details>
          <summary><strong>2) Limites e incertezas (disclaimer)</strong></summary>
          <ul>
            <li>Loterias s√£o jogos de <strong>sorte e aleatoriedade</strong>. N√£o existe garantia de acerto ou lucro.</li>
            <li>An√°lises baseadas em dados passados <strong>n√£o determinam</strong> resultados futuros.</li>
            <li>Use as ferramentas como <em>apoio</em> √† decis√£o ‚Äî a escolha final e os riscos s√£o seus.</li>
          </ul>
        </details>

        <details>
          <summary><strong>3) Jogo respons√°vel</strong></summary>
          <ul>
            <li>Defina <strong>limite de gasto</strong> e <strong>frequ√™ncia</strong> antes de apostar; n√£o tente "recuperar perdas".</li>
            <li><strong>Sinais de alerta:</strong> apostar com dinheiro reservado a contas essenciais; esconder gastos; ansiedade ao n√£o apostar; comprometer rela√ß√µes/prazo de trabalho.</li>
            <li><strong>Se precisar de apoio:</strong> procure servi√ßos de sa√∫de locais ou grupos de ajuda para comportamentos de jogo. Cuidar de si √© prioridade.</li>
          </ul>
        </details>

        <details>
          <summary><strong>4) Privacidade & LGPD</strong></summary>
          <ul>
            <li>Tratamos dados pessoais conforme a <strong>LGPD</strong> (Lei 13.709/2018).</li>
            <li>Usamos cookies para funcionalidades essenciais e m√©tricas de uso do site.</li>
            <li><strong>Seus direitos:</strong> confirma√ß√£o de tratamento, acesso, corre√ß√£o, anonimiza√ß√£o/elimina√ß√£o, portabilidade e revoga√ß√£o de consentimento.</li>
            <li><strong>Contato do DPO/Suporte:</strong> <a href="mailto:support@seudominio.com">support@seudominio.com</a></li>
          </ul>
        </details>

        <details>
          <summary><strong>5) Independ√™ncia e marcas</strong></summary>
          <ul>
            <li>Plataforma <strong>independente</strong>, sem v√≠nculo, patroc√≠nio ou endosso da Caixa Econ√¥mica Federal.</li>
            <li>Marcas e logos de terceiros pertencem aos seus respectivos propriet√°rios.</li>
          </ul>
        </details>

        <details>
          <summary><strong>6) Transpar√™ncia t√©cnica</strong></summary>
          <ul>
            <li><strong>Metodologia:</strong> cada estudo mostra o <em>crit√©rio</em> usado (ex.: janela de concursos, regras de c√°lculo, filtros aplicados).</li>
            <li><strong>Relato de desempenho:</strong> quando exibimos acertos ou simula√ß√µes, indicamos o <em>per√≠odo</em>, <em>par√¢metros</em> e <em>limita√ß√µes</em> ‚Äî sem "cherry-picking".</li>
          </ul>
        </details>

        <details>
          <summary><strong>7) Documentos legais & contato</strong></summary>
          <ul>
            <li><a href="/politica-de-honestidade">Pol√≠tica de Honestidade</a> ‚Ä¢ <a href="/termos">Termos de Uso</a> ‚Ä¢ <a href="/privacidade">Pol√≠tica de Privacidade</a></li>
            <li><strong>CNPJ:</strong> 00.000.000/0000-00 ‚Ä¢ <strong>WhatsApp:</strong> <a href="https://wa.me/55SEUNUMERO" target="_blank" rel="noopener">fale com a equipe</a></li>
            <li><strong>Atendimento:</strong> seg‚Äìsex, 9h‚Äì18h (hor√°rio local)</li>
          </ul>
        </details>

        <p style="opacity:.7;margin-top:.8rem;font-size:.9em;">√öltima atualiza√ß√£o: <em>agosto/2025</em></p>
      </div>
    </div>
  </div>

  <!-- JavaScript do modal do rodap√© -->
  <script>
    function openFooterModal() {
      const modal = document.getElementById('footer-modal');
      if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden'; // Previne scroll do body
      }
    }
    
    function closeFooterModal() {
      const modal = document.getElementById('footer-modal');
      if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto'; // Restaura scroll do body
      }
    }
    
    // Fechar modal ao clicar fora dele
    document.addEventListener('click', function(event) {
      const modal = document.getElementById('footer-modal');
      if (event.target === modal) {
        closeFooterModal();
      }
    });
    
    // Fechar modal com tecla ESC
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        closeFooterModal();
      }
    });
  </script>
</body>
</html> 