<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Meta tags para colorir a status bar dos dispositivos móveis -->
  <meta name="theme-color" content="#7C3AED">
  <meta name="msapplication-navbutton-color" content="#7C3AED">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <title>Lotofácil | Inteligência Estatística</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="{{ url_for('static', filename='js/graficos_lotofacil.js') }}" defer></script>
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/estilo.css') }}">

  <!-- Favicons otimizados para todos os dispositivos -->
  <link rel="icon" href="/static/img/Favicon_LI.png" type="image/png" sizes="32x32">
  <link rel="icon" href="/static/img/Favicon_LI.png" type="image/png" sizes="16x16">
  <link rel="icon" href="/static/img/Favicon_LI.png" type="image/png" sizes="48x48">
  <link rel="icon" href="/static/img/Favicon_LI.png" type="image/png" sizes="192x192">
  <link rel="icon" href="/static/img/Favicon_LI.png" type="image/png" sizes="512x512">

  <!-- Apple Touch Icons para iOS -->
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="180x180">
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="152x152">
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="144x144">
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="120x120">
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="114x114">
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="76x76">
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="72x72">
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="60x60">
  <link rel="apple-touch-icon" href="/static/img/Favicon_LI.png" sizes="57x57">

  <!-- Android Chrome Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="/static/img/Favicon_LI.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/static/img/Favicon_LI.png">

  <!-- Windows Tiles -->
  <meta name="msapplication-TileColor" content="#7C3AED">
  <meta name="msapplication-TileImage" content="/static/img/Favicon_LI.png">
  <meta name="msapplication-config" content="none">

  <!-- Manifest para PWA -->
  <link rel="manifest" href="/static/manifest.json">

  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"></noscript>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    // Definição antecipada (HEAD) para evitar ReferenceError em qualquer ponto
    if (typeof window.armazenarAnalise !== 'function') {
      window.armazenarAnalise = function(tipo, dados) {
        try {
          const key = 'analisesSelecionadas_LF';
          const existentes = JSON.parse(localStorage.getItem(key)) || {};
          existentes[tipo] = dados;
          localStorage.setItem(key, JSON.stringify(existentes));
        } catch (e) {
          // Silencioso para não quebrar a UI
        }
      };
    }

    // === Preferências LF (fallback local) ===
    const PREFS_KEY_LF = 'userPremiumPreferencesLF';
    const getPrefsLF = () => JSON.parse(localStorage.getItem(PREFS_KEY_LF) || '{}');
    const savePrefsLF = (p) => localStorage.setItem(PREFS_KEY_LF, JSON.stringify(p));

    function collectCurrentPrefsLF() {
      const scope = document;
      const pick = (sel) => scope.querySelector(sel);
      const checked = (sel) => !!pick(sel)?.checked;
      const intVal = (sel, def=0) => parseInt(pick(sel)?.value || def, 10);
      const txtVal = (sel, def='') => pick(sel)?.value || def;

      const prefs = getPrefsLF();

      const freq = prefs.frequencia = prefs.frequencia || {};
      freq.priorizarQuentes = checked('[data-pref-type="frequencia"][data-pref-name="priorizarQuentes"]');
      freq.qtdeQuentes      = intVal('#freq-qtde-quentes', 10);
      freq.priorizarFrios   = checked('[data-pref-type="frequencia"][data-pref-name="priorizarFrios"]');
      freq.qtdeFrios        = intVal('#freq-qtde-frios', 10);
      freq.considerarPeriodo= txtVal('#freq-periodo', 'completa');

      const afi = prefs.afinidades = prefs.afinidades || {};
      afi.priorizarParesFortes       = checked('[data-pref-type="afinidades"][data-pref-name="priorizarParesFortes"]');
      afi.qtdePares                  = intVal('#afinidade-qtde-pares', 3);
      afi.priorizarNumerosConectados = checked('[data-pref-type="afinidades"][data-pref-name="priorizarNumerosConectados"]');
      afi.qtdeNumeros                = intVal('#afinidade-qtde-numeros', 4);

      const pad = prefs.padroes = prefs.padroes || {};
      pad.evitarConsecutivos       = checked('[data-pref-type="padroes"][data-pref-name="evitarConsecutivos"]');
      pad.priorizarAtrasados       = checked('[data-pref-type="padroes"][data-pref-name="priorizarAtrasados"]');
      pad.minAtraso                = intVal('#padrao-min-atraso', 20);
      pad.evitarRepeticoesSeguidas = checked('[data-pref-type="padroes"][data-pref-name="evitarRepeticoesSeguidas"]');

      prefs.qtdeNumerosAposta = intVal('#qtde-numeros-aposta', 15);
      prefs.numApostasGerar   = intVal('#num-apostas-gerar', 1);
      prefs.qtd_concursos     = freq.considerarPeriodo;

      return prefs;
    }

    // renderPremiumPreferencesSummary: usar versão do graficos_lotofacil.js

    // Ação premium: consolidar preferências e gerar pela rota da Lotofácil
    // Handler do botão premium: usar versão do graficos_lotofacil.js
    tailwind.config = {
      important: false,
      corePlugins: {
        preflight: false,
      },
      theme: {
        extend: {
          colors: {
            'primary': '#00E38C',
            'secondary': '#8B5CF6',
            'background': '#000000', // Certifique-se que esta é a cor de fundo desejada
            'card': '#1A1D25',
            'surface': '#2E303A',
          }
        }
      }
    }
  </script>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/estilo.css') }}">

  <style>
    /* Moldura Neon Lilás - Desktop */
    html::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      box-shadow: inset 0 0 0 4px #B96AFF, 0 0 15px #B96AFF, 0 0 30px #B96AFF;
      z-index: 9999;
      pointer-events: none;
    }

    /* Moldura Neon Lilás - Mobile (mais fina) */
    @media (max-width: 768px) {
      html::before {
        box-shadow: inset 0 0 0 2px #B96AFF, 0 0 8px #B96AFF, 0 0 15px #B96AFF;
      }
    }

    /* Auto-ajuste centralizado da imagem da Lotofácil */
    .lotofacil-logo-container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      position: relative;
    }

    .lotofacil-logo {
      max-width: 240px;
      min-width: 96px;
      height: auto;
      object-fit: contain;
      display: block;
      margin: 0 auto;
      margin-left: 15px !important;
      margin-bottom: -8px;
      transition: all 0.3s ease;
      vertical-align: bottom;
      transform: translateX(15px);
    }

    /* Responsividade total para mobile e tablet */
    @media (max-width: 640px) {
      .lotofacil-logo {
        max-width: 144px;
        min-width: 72px;
        height: 58px;
      }
    }

    @media (min-width: 641px) and (max-width: 768px) {
      .lotofacil-logo {
        max-width: 180px;
        min-width: 84px;
        height: 77px;
      }
    }

    @media (min-width: 769px) and (max-width: 1024px) {
      .lotofacil-logo {
        max-width: 216px;
        min-width: 96px;
        height: 96px;
      }
    }

    @media (min-width: 1025px) {
      .lotofacil-logo {
        max-width: 240px;
        min-width: 120px;
        height: 115px;
      }
    }

    /* Responsividade para smartphones - remover títulos dos eixos */
    @media (max-width: 640px) {
      .js-plotly-plot .g-gtitle {
        font-size: 14px !important;
      }

      /* Remover títulos dos eixos Y em smartphones */
      .js-plotly-plot .g-ytitle,
      .js-plotly-plot .g-ytitle-2 {
        display: none !important;
      }

      /* Ajustar margens para smartphones */
      .js-plotly-plot .plotly {
        margin-left: 20px !important;
        margin-right: 20px !important;
      }
    }

    /* Reduzir tamanho dos títulos dos gráficos e módulos - APENAS para smartphones */
    @media (max-width: 640px) {
      .chart-container h3 {
        font-size: 14px !important;
      }

      .bg-dark h4 {
        font-size: 14px !important;
      }
    }

    /* Reduzir tamanho das fontes dos eixos do Plotly - APENAS para smartphones */
    @media (max-width: 640px) {
      .js-plotly-plot .g-xtick text,
      .js-plotly-plot .g-ytick text,
      .js-plotly-plot .g-ytick2 text,
      .js-plotly-plot .g-xtick .tick-label,
      .js-plotly-plot .g-ytick .tick-label,
      .js-plotly-plot .g-ytick2 .tick-label,
      .js-plotly-plot .g-xtick .tick-label text,
      .js-plotly-plot .g-ytick .tick-label text,
      .js-plotly-plot .g-ytick2 .tick-label text {
        font-size: 6px !important;
        font-size: 6px !important;
      }

      /* Forçar tamanho da fonte para todos os elementos de texto dos eixos */
      .js-plotly-plot .g-xtick *,
      .js-plotly-plot .g-ytick *,
      .js-plotly-plot .g-ytick2 * {
        font-size: 6px !important;
      }
    }

    /* Cor vermelha para valores do eixo Y2 (frequência relativa) - GLOBAL */
    .js-plotly-plot .g-ytick2 text {
      fill: red !important;
      color: red !important;
    }

    /* Garantir que a cor vermelha seja aplicada em todos os dispositivos */
    .js-plotly-plot .g-ytick2 text,
    .js-plotly-plot .g-ytick2 .tick text,
    .js-plotly-plot .g-ytick2 .tick-label text,
    .js-plotly-plot .g-ytick2 .tick-label {
      fill: red !important;
      color: red !important;
    }

    /* Estilos para a matriz visual */
    .matriz-container {
      display: flex;
      flex-direction: column;
      gap: 1px; /* Reduzido de 2px para 1px - linhas ainda mais próximas */
      margin-top: 20px;
      /* Container com tamanho fixo para manter scrollbars sempre visíveis */
      width: 100%;
      height: 650px; /* Altura para mostrar 25+ concursos simultaneamente */
      overflow: auto; /* Permite scroll vertical e horizontal */
      white-space: nowrap; /* Impede que o texto ou elementos dentro do flexbox quebrem */
      /* Melhorias visuais */
      border: 2px solid #2E303A;
      border-radius: 8px;
      background-color: rgba(255, 255, 255, 0.02);
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
      /* Garantir que as scrollbars sejam sempre visíveis */
      scrollbar-width: thin; /* Firefox */
      scrollbar-color: #00E38C #2E303A; /* Firefox - thumb e track */
    }

    /* Estilização das scrollbars para Webkit (Chrome, Safari, Edge) */
    .matriz-container::-webkit-scrollbar {
      width: 12px; /* Largura da scrollbar vertical */
      height: 12px; /* Altura da scrollbar horizontal */
    }

    .matriz-container::-webkit-scrollbar-track {
      background: #2E303A; /* Cor do fundo da scrollbar */
      border-radius: 6px;
    }

    .matriz-container::-webkit-scrollbar-thumb {
      background: #00E38C; /* Cor da scrollbar (verde) */
      border-radius: 6px;
      border: 2px solid #2E303A;
    }

    .matriz-container::-webkit-scrollbar-thumb:hover {
      background: #00C973; /* Cor mais escura no hover */
    }

    /* Scrollbar horizontal específica */
    .matriz-container::-webkit-scrollbar:horizontal {
      height: 12px;
    }

    /* Solução específica para mobile - scroll horizontal */
    @media (max-width: 768px) {
      .matriz-container {
        height: 600px; /* Altura para mostrar 25+ concursos no mobile */
        -webkit-overflow-scrolling: touch; /* Scroll suave no iOS */
        scroll-behavior: smooth; /* Scroll suave */
        /* Scroll em todas as direções */
        overflow: auto;
        /* Remove padding que pode interferir no scroll */
        padding-left: 0;
        padding-right: 0;
        /* Scrollbars mais finas no mobile */
        scrollbar-width: thin;
      }

      /* Scrollbars menores no mobile */
      .matriz-container::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      /* Garante que as linhas não quebrem no mobile */
      .linha-concurso {
        min-width: max-content; /* Força largura mínima baseada no conteúdo */
        width: max-content; /* Garante que a linha ocupe todo o espaço necessário */
      }

      /* Células com tamanho fixo no mobile */
      .celula-numero {
        flex-shrink: 0 !important;
        min-width: 20px !important; /* Ligeiramente menor no mobile */
        max-width: 20px !important;
        height: 20px !important;
        font-size: 8px !important;
      }
    }



    .linha-concurso {
      display: grid; /* Preenche toda a largura do container */
      grid-template-columns: repeat(25, 1fr); /* 25 colunas iguais (1-25) */
      gap: 4px;
      padding: 2px 0;
      width: 100%;
      border-bottom: 1px solid rgba(255, 255, 255, 0.03);
      transition: background-color 0.2s ease;
    }

    /* Hover effect para melhor identificação das linhas */
    .linha-concurso:hover {
      background-color: rgba(0, 227, 140, 0.05); /* Verde sutil no hover */
    }

    /* Alternância de cores para melhor visualização */
    .linha-concurso:nth-child(even) {
      background-color: rgba(255, 255, 255, 0.01);
    }

    /* Estilo para o indicador de concursos */
    .matriz-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding: 8px 12px;
      background-color: rgba(46, 48, 58, 0.5);
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .matriz-navigation-hint {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }

    /* Mobile: dicas em linha única */
    @media (max-width: 768px) {
      .matriz-navigation-hint {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
    }

    /* CSS para o container do gráfico de frequência */
    .grafico-frequencia-container {
      width: 100% !important; /* Ocupa 100% da largura do container pai */
      height: 400px; /* Altura fixa para o gráfico */
      min-width: 100%; /* Garante largura mínima */
      /* Remover qualquer padding horizontal que possa ter sido adicionado */
      padding-left: 0px !important;
      padding-right: 0px !important;
    }

    /* Otimização para Mobile - Máxima Expansão Horizontal */
    @media (max-width: 768px) {
      .grafico-frequencia-container {
        height: 300px; /* Altura menor em mobile */
        width: 100% !important; /* Garante que ocupe toda a largura */
        padding-left: 0px !important;
        padding-right: 0px !important;
      }

      /* Ajuste agressivo do modal para mobile - Quase 100% da largura */
      .modal-content {
        width: 98% !important; /* Quase 100% da largura do viewport */
        max-width: 98% !important; /* Garante que não haja limite de largura */
        margin: 2% auto !important; /* Reduz margem superior/inferior para ocupar mais tela */
        /* Reduzir drasticamente os paddings laterais */
        padding-left: 10px !important;
        padding-right: 10px !important;
        /* Manter padding vertical se necessário */
        padding-top: 20px !important;
        padding-bottom: 20px !important;
      }

      /* Se tiver um .modal-body dentro do modal-content, também remover paddings */
      .modal-body {
        padding-left: 0px !important;
        padding-right: 0px !important;
      }
    }

    .celula-numero {
      font-size: clamp(8px, 0.8vw, 12px) !important;
      font-family: 'Inter', sans-serif;
      text-align: center;
      width: 100% !important;
      min-width: 0 !important;
      max-width: none !important;
      height: auto !important;
      aspect-ratio: 1 / 1; /* Mantém quadrado e usa 100% da coluna */
      line-height: 1; /* Evita estourar verticalmente */
      border-radius: 4px;
      background-color: #222;
      color: #eee;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .celula-numero.sorteado {
      background-color: #00E38C;
      color: #1A1D25;
      font-weight: bold;
    }

    .celula-numero.trevo.sorteado {
      background-color: #8B5CF6;
      color: white;
      font-weight: bold;
    }

    /* Força total para sobrescrever estilos globais */
    /* Desktop */
    .celula-numero {
      font-size: 9px !important;
    }

    /* Mobile */
    @media (max-width: 768px) {
      .celula-numero {
        font-size: 8px !important;
      }
    }
    .js-plotly-plot .g-ytick2 .tick,
    .js-plotly-plot .g-ytick2 .tick text,
    .js-plotly-plot .g-ytick2 .tick-label text {
      fill: red !important;
      color: red !important;
      stroke: red !important;
    }

    /* Forçar cor vermelha para todos os elementos do eixo Y2 */
    .js-plotly-plot .g-ytick2 * {
      fill: red !important;
      color: red !important;
    }

    /* Reduzir altura dos gráficos para 70% - APENAS para smartphones */
    @media (max-width: 640px) {
      .chart-container div[id^="grafico"] {
        height: 280px !important;
      }
    }

    /* Otimizações específicas para Samsung S20 e smartphones similares */
    @media (max-width: 768px) {
      /* Garantir que o gráfico ocupe toda a largura disponível */
      #grafico-frequencia {
        width: 100% !important;
        min-width: 100% !important;
        max-width: 100% !important;
      }

      /* Remover qualquer padding que possa estar limitando a largura */
      .chart-container {
        padding-left: 0px !important;
        padding-right: 0px !important;
      }

      /* Otimizar o container do gráfico para máxima expansão */
      .grafico-frequencia-container {
        width: 100% !important;
        min-width: 100% !important;
        max-width: 100% !important;
        padding: 0px !important;
        margin: 0px !important;
      }
    }

    /* Estilos para os menus responsivos */
    /* Menu Desktop */
    .desktop-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, rgba(30, 27, 41, 0.95) 0%, rgba(42, 35, 64, 0.95) 100%);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 1000;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .desktop-nav .logo {
      max-width: 150px;
      height: auto;
    }

    .desktop-nav-links {
      display: flex;
      gap: 2rem;
      align-items: center;
    }

    .desktop-nav-links a {
      color: #ffffff;
      text-decoration: none;
      font-size: 0.95rem;
      font-weight: 500;
      transition: all 0.3s ease;
      padding: 0.5rem 1rem;
      border-radius: 6px;
    }

    .desktop-nav-links a:hover {
      color: #A855F7;
      background: rgba(168, 85, 247, 0.1);
      transform: translateY(-1px);
    }

    /* Estilo para destacar a página atual */
    .desktop-nav-links a.active {
      color: #00E38C !important;
      background: rgba(0, 227, 140, 0.15) !important;
      border: 1px solid rgba(0, 227, 140, 0.3) !important;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 227, 140, 0.2);
    }

    .desktop-nav-links a.active:hover {
      color: #00E38C !important;
      background: rgba(0, 227, 140, 0.2) !important;
    }

    /* Esconder menu desktop em mobile */
    @media (max-width: 768px) {
      .desktop-nav {
        display: none;
      }
    }

    /* Mostrar menu desktop em telas maiores */
    @media (min-width: 769px) {
      .desktop-nav {
        display: flex;
      }
    }

    /* Estilos para o menu hambúrguer */
    .hamburger-menu {
      position: fixed;
      top: 1.5rem;
      left: 1.5rem;
      z-index: 1000;
      display: none;
      background: rgba(0, 0, 0, 0.8);
      border-radius: 8px;
      padding: 8px;
    }

    .hamburger-icon {
      width: 30px;
      height: 25px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
    }

    .hamburger-icon span {
      display: block;
      width: 100%;
      height: 3px;
      background-color: #A855F7;
      border-radius: 3px;
      transition: all 0.3s ease;
    }

    .hamburger-icon.open span:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }

    .hamburger-icon.open span:nth-child(2) {
      opacity: 0;
    }

    .hamburger-icon.open span:nth-child(3) {
      transform: rotate(-45deg) translate(5px, -5px);
    }

    /* Sidebar deslizante */
    .nav-panel {
      position: fixed;
      top: 0;
      left: -280px;
      width: 280px;
      height: 100%;
      background: linear-gradient(135deg, #1a1a1a 0%, #2d1b69 100%);
      display: flex;
      flex-direction: column;
      transition: left 0.3s ease-in-out;
      z-index: 999;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
      border-right: 1px solid rgba(168, 85, 247, 0.2);
    }

    .nav-panel.open {
      left: 0;
    }

    /* Header do sidebar */
    .nav-header {
      padding: 20px 25px;
      border-bottom: 1px solid rgba(168, 85, 247, 0.2);
      text-align: center;
      background: rgba(168, 85, 247, 0.05);
    }

    .nav-logo {
      width: 120px;
      height: auto;
      margin-bottom: 10px;
    }

    .nav-header h3 {
      color: #A855F7;
      margin: 0;
      font-size: 1.2rem;
      font-weight: 600;
    }

    .nav-panel ul {
      list-style: none;
      padding: 0;
      margin: 0;
      text-align: left;
    }

    .nav-panel li {
      margin: 0;
      border-bottom: 1px solid rgba(168, 85, 247, 0.1);
    }

    .nav-panel a {
      color: #ffffff;
      text-decoration: none;
      font-size: 1.1rem;
      font-weight: 500;
      transition: all 0.3s ease;
      padding: 20px 25px;
      display: block;
      border-left: 3px solid transparent;
    }

    .nav-panel a:hover {
      color: #A855F7;
      background: rgba(168, 85, 247, 0.1);
      border-left-color: #A855F7;
    }

    /* Estilo para destacar a página atual no menu mobile */
    .nav-panel a.active {
      color: #00E38C !important;
      background: rgba(0, 227, 140, 0.15) !important;
      border-left-color: #00E38C !important;
      box-shadow: 0 2px 8px rgba(0, 227, 140, 0.2);
    }

    .nav-panel a.active:hover {
      color: #00E38C !important;
      background: rgba(0, 227, 140, 0.2) !important;
    }

    /* Estilos para submenu dropdown */
    .dropdown {
      position: relative;
    }

                    .dropdown-content {
                    display: none;
                    position: absolute;
                    left: 0;
                    top: 100%;
                    margin-top: 8px;
                    background: #2a2a3e;
                    min-width: 200px;
                    box-shadow: 0 12px 24px rgba(0,0,0,0.5), 0 4px 8px rgba(168, 85, 247, 0.2);
                    border-radius: 8px;
                    z-index: 1000;
                    border: 2px solid rgba(168, 85, 247, 0.6);
                    transition: all 0.2s ease;
                    opacity: 0;
                    visibility: hidden;
                }

    .dropdown-content a {
      color: #e2e8f0;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      border-left: 3px solid transparent;
      transition: all 0.3s ease;
      font-size: 0.95rem;
    }

    .dropdown-content a:hover {
      color: #A855F7;
      background: rgba(168, 85, 247, 0.1);
      border-left-color: #A855F7;
    }

    .dropdown-content a.active {
      color: #00E38C !important;
      background: rgba(0, 227, 140, 0.15) !important;
      border-left-color: #00E38C !important;
    }

    .dropdown:hover .dropdown-content {
      display: block;
      opacity: 1;
      visibility: visible;
    }

    /* Submenu para mobile */
    .mobile-dropdown {
      display: none;
      background: rgba(168, 85, 247, 0.05);
      border-left: 3px solid rgba(168, 85, 247, 0.3);
      margin-left: 20px;
    }

    .mobile-dropdown.show {
      display: block;
    }

    .mobile-dropdown a {
      padding: 10px 20px 10px 40px;
      font-size: 0.9rem;
      color: #cbd5e1;
    }

    .mobile-dropdown a:hover {
      color: #A855F7;
      background: rgba(168, 85, 247, 0.1);
    }

    .mobile-dropdown a.active {
      color: #00E38C !important;
      background: rgba(0, 227, 140, 0.15) !important;
    }

    /* Estilos para Breadcrumbs */
    .breadcrumbs-container {
      background: linear-gradient(135deg, rgba(168, 85, 247, 0.05) 0%, rgba(0, 227, 140, 0.05) 100%);
      border-bottom: 1px solid rgba(168, 85, 247, 0.2);
      padding: 8px 0;
      margin-bottom: 20px;
    }

    .breadcrumbs {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .breadcrumb-list {
      display: flex;
      align-items: center;
      list-style: none;
      margin: 0;
      padding: 0;
      font-size: 0.9rem;
    }

    .breadcrumb-item {
      display: flex;
      align-items: center;
      color: #94a3b8;
    }

    .breadcrumb-item:not(:last-child)::after {
      content: "›";
      margin: 0 8px;
      color: #64748b;
      font-weight: bold;
    }

    .breadcrumb-link {
      color: #cbd5e1;
      text-decoration: none;
      padding: 4px 8px;
      border-radius: 4px;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .breadcrumb-item:not(.active) .breadcrumb-link:hover {
      color: #A855F7;
      background: rgba(168, 85, 247, 0.1);
    }

    .breadcrumb-item.active .breadcrumb-link {
      color: #00E38C;
      font-weight: 600;
    }

    /* Responsividade para breadcrumbs */
    @media (max-width: 768px) {
      .breadcrumbs-container {
        padding: 6px 0;
        margin-bottom: 15px;
      }

      .breadcrumbs {
        padding: 0 15px;
      }

      .breadcrumb-list {
        font-size: 0.85rem;
      }

      .breadcrumb-item:not(:last-child)::after {
        margin: 0 6px;
      }
    }

    /* Overlay para escurecer o fundo */
    .nav-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      z-index: 998;
    }

    .nav-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    /* Mostrar menu hambúrguer em mobile */
    @media (max-width: 768px) {
      .hamburger-menu {
        display: block;
      }
    }

    /* Ajuste do padding do body para o menu desktop */
    body {
      padding-top: 80px !important;
    }

    @media (max-width: 768px) {
      body {
        padding-top: 1rem !important;
      }
    }
  </style>

  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
</head>
<body class="p-4 sm:p-6">
  <!-- Menu Desktop -->
  <nav class="desktop-nav">
    <img src="/static/img/Logo_LoteriasIntelitente.png" alt="Logo" class="logo">
    <div class="desktop-nav-links">
      <a href="/"><i class="fa fa-home"></i> Início</a>
      <div class="dropdown">
        <a href="#" class="dropdown-toggle"><i class="fa fa-diamond"></i> +Milionária ▼</a>
        <div class="dropdown-content">
          <a href="/dashboard"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
          <a href="/aposta_inteligente_premium"><i class="fa fa-chart-line"></i> Inteligência Estatística</a>
        </div>
      </div>
      <div class="dropdown">
        <a href="#" class="dropdown-toggle"><i class="fa fa-bullseye"></i> Mega Sena ▼</a>
        <div class="dropdown-content">
          <a href="/dashboard_MS"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
          <a href="/aposta_inteligente_premium_MS"><i class="fa fa-chart-line"></i> Inteligência Estatística</a>
        </div>
      </div>
      <div class="dropdown">
        <a href="#" class="dropdown-toggle"><i class="fa fa-hashtag"></i> Quina ▼</a>
        <div class="dropdown-content">
          <a href="/dashboard_quina"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
          <a href="/aposta_inteligente_premium_quina"><i class="fa fa-chart-line"></i> Inteligência Estatística</a>
        </div>
      </div>
      <div class="dropdown">
        <a href="#" class="dropdown-toggle"><i class="fa fa-circle"></i> Lotomania ▼</a>
        <div class="dropdown-content">
          <a href="/dashboard_lotomania"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
        </div>
      </div>
      <div class="dropdown">
        <a href="#" class="dropdown-toggle"><i class="fa fa-dice"></i> Lotofácil ▼</a>
        <div class="dropdown-content">
          <a href="/dashboard_lotofacil"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
          <a href="/aposta_inteligente_premium_lotofacil"><i class="fa fa-chart-line"></i> Inteligência Estatística</a>
          <a href="/lotofacil_laboratorio"><i class="fa fa-flask"></i> Laboratório de Simulação</a>
        </div>
      </div>
      <a href="/boloes"><i class="fa fa-users"></i> Bolões</a>
      <a href="#"><i class="fa fa-phone"></i> Contato</a>
    </div>
  </nav>

  <!-- Menu Mobile (Hambúrguer) -->
  <div class="hamburger-menu">
    <div class="hamburger-icon" id="hamburgerIcon">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>

  <!-- Overlay para escurecer o fundo -->
  <div class="nav-overlay" id="navOverlay"></div>

  <!-- Sidebar deslizante -->
  <nav class="nav-panel" id="navPanel">
    <div class="nav-header">
      <img src="/static/img/Logo_LoteriasIntelitente.png" alt="Logo" class="nav-logo">
      <h3>Menu</h3>
    </div>
    <ul>
      <li><a href="/"><i class="fa fa-home"></i> Início</a></li>
      <li>
        <a href="#" class="mobile-dropdown-toggle"><i class="fa fa-diamond"></i> +Milionária ▼</a>
        <div class="mobile-dropdown">
          <a href="/dashboard"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
          <a href="/aposta_inteligente_premium"><i class="fa fa-chart-line"></i> Inteligência Estatística</a>
        </div>
      </li>
      <li>
        <a href="#" class="mobile-dropdown-toggle"><i class="fa fa-bullseye"></i> Mega Sena ▼</a>
        <div class="mobile-dropdown">
          <a href="/dashboard_MS"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
          <a href="/aposta_inteligente_premium_MS"><i class="fa fa-chart-line"></i> Inteligência Estatística</a>
        </div>
      </li>
      <li>
        <a href="#" class="mobile-dropdown-toggle active"><i class="fa fa-hashtag"></i> Quina ▼</a>
        <div class="mobile-dropdown">
          <a href="/dashboard_quina"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
          <a href="/aposta_inteligente_premium_quina" class="active"><i class="fa fa-chart-line"></i> Inteligência Estatística</a>
        </div>
      </li>
      <li>
        <a href="#" class="mobile-dropdown-toggle"><i class="fa fa-circle"></i> Lotomania ▼</a>
        <div class="mobile-dropdown">
          <a href="/dashboard_lotomania"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
        </div>
      </li>
      <li>
        <a href="#" class="mobile-dropdown-toggle"><i class="fa fa-dice"></i> Lotofácil ▼</a>
        <div class="mobile-dropdown">
          <a href="/dashboard_lotofacil"><i class="fa fa-bullseye"></i> Palpite da Sorte</a>
          <a href="/aposta_inteligente_premium_lotofacil"><i class="fa fa-chart-line"></i> Inteligência Estatística</a>
          <a href="/lotofacil_laboratorio"><i class="fa fa-flask"></i> Laboratório de Simulação</a>
        </div>
      </li>
      <li><a href="/boloes"><i class="fa fa-users"></i> Bolões</a></li>
      <li><a href="#"><i class="fa fa-phone"></i> Contato</a></li>
    </ul>
  </nav>

                  <!-- Breadcrumbs -->
                <div class="breadcrumbs-container">
                    <nav class="breadcrumbs" aria-label="Breadcrumb">
                        <ol class="breadcrumb-list">
                            <li class="breadcrumb-item">
                                <a href="#" class="breadcrumb-link">🎲 Lotofácil</a>
                            </li>
                            <li class="breadcrumb-item active">
                                <span class="breadcrumb-link">📊 Inteligência Estatística</span>
                            </li>
                        </ol>
                    </nav>
                </div>

  <!-- Header -->
  <header class="flex justify-between items-center mb-8">
    <!-- Título deslocado para a direita -->
    <div class="flex-1 text-center lotofacil-logo-container">
      <h1 class="text-2xl sm:text-3xl font-bold text-white mb-2 flex justify-center items-end">
                    <img src="/static/img/Lotofacil.png" alt="Lotofácil" class="lotofacil-logo">
      </h1>
    </div>

    <!-- Logo no lado direito -->
    <div class="flex justify-end items-center">
      <img src="/static/img/Logo_LoteriasIntelitente.png" alt="Logo Loterias Inteligente" class="max-w-[120px] sm:max-w-[150px] md:max-w-[180px]">
    </div>
  </header>

  <!-- Conteúdo Premium será adicionado aqui -->
  <div class="container mx-auto">
    <h2 class="text-2xl font-bold text-white mb-6 text-center">🎯 Aposta Inteligente Premium</h2>

    <!-- Conteúdo será adicionado posteriormente -->
    <div class="bg-[#1A1D25] p-8 rounded-2xl shadow-md">
      <div class="bloco-texto-aposta">
        <p class="texto-desktop">
          Com a Aposta Inteligente Premium, você vai além da sorte: você define os parâmetros, analisa os dados reais e usa inteligência estatística e sistema de pesos computacionais para gerar apostas fundamentadas. 🎯 Configure filtros, selecione padrões e use suas próprias decisões estratégicas para orientar o sistema de análise estatística. O controle está nas suas mãos — com o apoio da tecnologia de dados reais.
        </p>
        <p class="texto-mobile">
          Configure filtros, selecione padrões e use suas próprias decisões estratégicas para orientar o sistema. O controle está nas suas mãos — com apoio dos dados reais.
        </p>
      </div>
    </div>

    <!-- Bloco Explicativo com Passo a Passo -->
    <div class="mt-8 bg-[#1A1D25] p-6 rounded-2xl shadow-md">
      <h3 class="text-xl font-bold text-white mb-6 text-center">📘 Como usar a aposta inteligente:</h3>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Passo 1: Frequência -->
        <div id="passo1" class="bg-[#2E303A] p-4 rounded-xl">
          <div class="flex items-center mb-3">
            <span class="bg-[#00E38C] text-black font-bold px-3 py-1 rounded-full text-sm mr-3">Passo 1</span>
            <h4 class="text-lg font-semibold" style="color: #A855F7;">Descubra os Números Mais Sorteados</h4>
          </div>
          <p class="text-gray-300 text-sm mb-3">Veja os números que mais saem e use essa informação no seu jogo.</p>
          <button class="bg-[#00E38C] text-black font-semibold px-4 py-2 rounded-lg hover:opacity-80 transition-all text-sm w-full" onclick="abrirModal('frequencia')">
            🔍 Ver Análise Frequência
          </button>
        </div>

        <!-- Passo 2: Distribuição -->
        <div id="passo2" class="bg-[#2E303A] p-4 rounded-xl">
          <div class="flex items-center mb-3">
            <span class="bg-[#00E38C] text-black font-bold px-3 py-1 rounded-full text-sm mr-3">Passo 2</span>
            <h4 class="text-lg font-semibold" style="color: #A855F7;">Entenda Como os Números se Distribuem</h4>
          </div>
          <p class="text-gray-300 text-sm mb-3">Entenda como os números se espalham entre grupos e padrões.</p>
          <button class="bg-[#00E38C] text-black font-semibold px-4 py-2 rounded-lg hover:opacity-80 transition-all text-sm w-full" onclick="abrirModal('distribuicao')">
            📊 Ver Análise Distribuição
          </button>
        </div>

        <!-- Passo 3: Afinidades -->
        <div id="passo3" class="bg-[#2E303A] p-4 rounded-xl">
          <div class="flex items-center mb-3">
            <span class="bg-[#00E38C] text-black font-bold px-3 py-1 rounded-full text-sm mr-3">Passo 3</span>
            <h4 class="text-lg font-semibold" style="color: #A855F7;">Encontre Combinações que Saem Juntas</h4>
          </div>
          <p class="text-gray-300 text-sm mb-3">Descubra combinações que costumam sair juntas.</p>
          <button class="bg-[#00E38C] text-black font-semibold px-4 py-2 rounded-lg hover:opacity-80 transition-all text-sm w-full" onclick="abrirModal('afinidades')">
            🔗 Ver Análise Afinidades
          </button>
        </div>

        <!-- Passo 4: Sequências -->
        <div id="passo4" class="bg-[#2E303A] p-4 rounded-xl">
          <div class="flex items-center mb-3">
            <span class="bg-[#00E38C] text-black font-bold px-3 py-1 rounded-full text-sm mr-3">Passo 4</span>
            <h4 class="text-lg font-semibold" style="color: #A855F7;">Análise de Sequências</h4>
          </div>
          <p class="text-gray-300 text-sm mb-3">Identifique padrões de números consecutivos e sequências.</p>
          <button class="bg-[#00E38C] text-black font-semibold px-4 py-2 rounded-lg hover:opacity-80 transition-all text-sm w-full" onclick="abrirModal('sequencias')">
            🔢 Ver Análise Sequências
          </button>
        </div>

        <!-- Passo 5: Seca -->
        <div id="passo5" class="bg-[#2E303A] p-4 rounded-xl">
          <div class="flex items-center mb-3">
            <span class="bg-[#00E38C] text-black font-bold px-3 py-1 rounded-full text-sm mr-3">Passo 5</span>
            <h4 class="text-lg font-semibold" style="color: #A855F7;">Identifique Números que Não Saem</h4>
          </div>
          <p class="text-gray-300 text-sm mb-3">Evite números que estão há muito tempo sem sair.</p>
          <button class="bg-[#00E38C] text-black font-semibold px-4 py-2 rounded-lg hover:opacity-80 transition-all text-sm w-full" onclick="abrirModal('seca')">
            🚫 Ver Análise Seca
          </button>
        </div>

        <!-- Passo 6: Estatísticas Avançadas -->
        <div class="bg-[#2E303A] p-4 rounded-xl">
          <div class="flex items-center mb-3">
            <span class="bg-[#00E38C] text-black font-bold px-3 py-1 rounded-full text-sm mr-3">Passo 6</span>
            <h4 class="text-lg font-semibold" style="color: #A855F7;">Estatística Avançada para Padrões Ocultos</h4>
          </div>
          <p class="text-gray-300 text-sm mb-3">Explore correlações, padrões ocultos e tendências com análise estatística avançada.</p>
          <button class="bg-[#00E38C] text-black font-semibold px-4 py-2 rounded-lg hover:opacity-80 transition-all text-sm w-full" onclick="abrirModal('estatisticas')">
            🤖 Ver Análise Avançada
          </button>
        </div>
      </div>
    </div>

    <!-- Botão principal do Machine Learning - NO FINAL -->
    <div id="passo6" class="mt-8 text-center">
      <div class="bg-gradient-to-r from-[#00E38C] to-[#8B5CF6] p-1 rounded-xl inline-block">
        <button class="bg-[#1A1D25] text-white font-bold px-8 py-4 rounded-lg hover:bg-[#2E303A] transition-all text-lg" id="abrir-modal-premium">
          🎯 Gerar Aposta Inteligente (Premium)
        </button>
      </div>
      <p class="text-gray-400 text-sm mt-3">Após configurar suas preferências, clique aqui para gerar apostas com Inteligencia Estatística</p>
    </div>
  </div>





  <!-- Modal base -->
  <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="bg-[#1A1D25] p-8 rounded-2xl w-full max-w-6xl relative modal-content">
      <button class="absolute top-4 right-4 w-8 h-8 bg-[#2E303A] hover:bg-[#3E404A] text-white text-lg font-semibold rounded-full flex items-center justify-center transition-all duration-200 hover:scale-110 shadow-lg" onclick="fecharModal()" title="Fechar">✕</button>
      <h2 id="titulo-modal" class="text-2xl font-semibold mb-4">Título do Modal</h2>
      <div id="conteudo-modal" class="text-gray-300">
        Carregando análise...
      </div>
    </div>
  </div>

  <!-- Modal de Configuração de Aposta -->
  <div id="modalConfiguracao" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
    <div class="bg-[#1A1D25] p-8 rounded-2xl shadow-xl w-96 text-white">
      <h3 class="text-xl font-bold mb-6 text-center text-[#00E38C]">🎲 Configurar Aposta Aleatória</h3>

      <div class="mb-5">
        <label for="sliderNumeros" class="block text-gray-300 text-sm font-semibold mb-2">Quantos números principais? (15-20)</label>
        <input type="range" id="sliderNumeros" min="15" max="20" value="15" class="w-full h-2 bg-[#2E303A] rounded-lg appearance-none cursor-pointer range-lg">
        <span id="valorNumeros" class="block text-center text-lg font-bold mt-2 text-[#00E38C]">15</span>
      </div>



      <div class="flex justify-end space-x-4">
        <button id="btnCancelarModal" class="bg-gray-600 text-white px-4 py-2 rounded-xl font-semibold hover:opacity-80 transition-all">Cancelar</button>
        <button id="btnGerarNoModal" class="bg-[#00E38C] text-black px-4 py-2 rounded-xl font-semibold hover:opacity-80 transition-all">Gerar Aposta</button>
      </div>
    </div>
  </div>

  <!-- Modal Premium - Análise Estatística Premium -->
  <div id="modal-premium" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-[#1A1D25] rounded-lg shadow-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto text-white relative" style="border: 2px solid #8B5CF6; box-shadow: 0 0 8px rgba(139,92,246,0.85), 0 0 16px rgba(139,92,246,0.55), 0 0 24px rgba(139,92,246,0.35), 0 12px 28px rgba(0,0,0,0.6);">
        <h3 class="text-[#00E38C] text-2xl font-semibold mb-4 text-center">🎯 Gerar Aposta Inteligente (Premium)</h3>

        <p class="text-gray-300 text-sm mb-4">Revise e ajuste os parâmetros selecionados nas análises. Estes serão usados para gerar sua aposta inteligente:</p>

        <div id="resumo-parametros-premium" class="bg-[#2E303A] p-4 rounded-md mb-6">
            <h4 class="text-white text-lg font-semibold mb-3">📊 Parâmetros Ativos:</h4>
            <div id="lista-parametros" class="space-y-2 text-sm text-gray-300">
                <p class="text-gray-400">Nenhum parâmetro selecionado ainda.</p>
            </div>
        </div>

        <div class="bg-[#2E303A] p-4 rounded-md mb-6">
            <h4 class="text-white text-lg font-semibold mb-3">⚙️ Configuração da Aposta Gerada:</h4>
            <div class="flex flex-col sm:flex-row sm:items-center space-y-3 sm:space-y-0 sm:space-x-4 mb-4">
                <label for="qtde-numeros-aposta" class="text-gray-300">Quantos números na aposta?</label>
                <input type="number" id="qtde-numeros-aposta" class="w-20 bg-[#1A1D25] border border-gray-600 text-white rounded px-2 py-1 text-sm" value="15" min="15" max="20">
            </div>
            <div class="flex items-center">
                <label for="num-apostas-gerar" class="text-gray-300">Quantas apostas gerar?</label>
                <input type="number" id="num-apostas-gerar" class="w-20 bg-[#1A1D25] border border-gray-600 text-white rounded px-2 py-1 text-sm ml-2" value="1" min="1" max="10">
            </div>
        </div>

        <button id="gerar-sugestao-btn" class="bg-[#00E38C] text-black font-bold py-3 px-6 rounded-lg w-full hover:bg-green-600 transition-colors text-lg">
            🎲 Gerar Sugestão de Números
        </button>

        <div id="resultado-sugestao" class="bg-[#2E303A] p-4 rounded-md mt-6 hidden">
            <h4 class="text-[#00E38C] text-xl font-semibold mb-3 text-center">🎯 Sua Aposta Sugerida da Lotofácil:</h4>
            <div id="lista-apostas-geradas" class="space-y-4">
            </div>
        </div>

        <button id="fechar-modal-premium" class="absolute top-4 right-4 text-gray-400 hover:text-white text-3xl">&times;</button>
    </div>
  </div>

  <!-- Tour Guiado -->
  <div id="tour-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[9999]">
    <div id="tour-tip" class="absolute bg-[#2a2a3e] border-2 border-[rgba(168,85,247,0.6)] rounded-lg p-4 shadow-2xl max-w-sm text-white" style="box-shadow: 0 12px 24px rgba(0,0,0,0.5), 0 4px 8px rgba(168, 85, 247, 0.2);">
      <div id="tour-content" class="mb-4">
        <!-- Conteúdo do tip será inserido dinamicamente -->
      </div>
      <div class="flex justify-between items-center">
        <button id="tour-prev" class="bg-[#2E303A] hover:bg-[#3E404A] text-white px-3 py-2 rounded-lg transition-colors">
          ← Anterior
        </button>
        <div class="flex items-center space-x-2">
          <span id="tour-progress" class="text-sm text-gray-400">1/9</span>
          <button id="tour-skip" class="text-gray-400 hover:text-white text-sm">Pular Tour</button>
        </div>
        <button id="tour-next" class="bg-[#00E38C] hover:bg-[#00C973] text-black px-3 py-2 rounded-lg transition-colors">
          Próximo →
        </button>
      </div>
    </div>
  </div>

  <!-- Botão de ativação do Tour -->
  <button id="tour-activate" class="fixed top-20 right-4 bg-[#00E38C] hover:bg-[#00C973] text-black px-4 py-2 rounded-lg shadow-lg z-50 transition-all duration-200 hover:scale-105">
    🎯 Tour Guiado
  </button>

  <!-- Scripts -->
  <script>
    // Guardar função antes de qualquer uso neste bloco
    if (typeof window.armazenarAnalise !== 'function') {
      window.armazenarAnalise = function(tipo, dados) {
        try {
          const key = 'analisesSelecionadas_LF';
          const existentes = JSON.parse(localStorage.getItem(key)) || {};
          existentes[tipo] = dados;
          localStorage.setItem(key, JSON.stringify(existentes));
          console.log(`✅ armazenarAnalise (LF) definido no topo do script para: ${tipo}`);
        } catch (e) {
          console.warn('⚠️ armazenarAnalise (LF) falhou ao salvar:', e);
        }
      };
    }

    // Dados simulados (serão substituídos pelos dados reais)
    const dadosMilionaria = {
      frequencia: {
        numeros: {
          quentes: [21, 41, 50, 23, 44, 16, 35, 42, 47, 48],
          frios: [49, 43, 45, 46, 40, 39, 38, 37, 36, 34]
        },
        trevos: {
          frequentes: [2, 4, 1, 6, 3, 5]
        }
      },
      distribuicao: {
        pares: 3.04,
        impares: 2.96,
        faixas: {
          "1-10": 0.8,
          "11-20": 1.2,
          "21-30": 1.1,
          "31-40": 1.3,
          "41-50": 1.6
        }
      },
      afinidades: {
        positivas: [
          { num1: 21, num2: 22, correlacao: 0.182 },
          { num1: 17, num2: 46, correlacao: 0.173 },
          { num1: 4, num2: 38, correlacao: 0.155 }
        ],
        negativas: [
          { num1: 24, num2: 25, correlacao: -0.159 },
          { num1: 20, num2: 41, correlacao: -0.155 }
        ]
      },
      seca: {
        maior: [49, 43, 45, 46, 40],
        recentes: [21, 41, 50, 23, 44]
      }
    };

    // Variáveis globais
    let numerosSelecionados = [];
    let trevosSelecionados = []; // Array único para os 2 trevos selecionados

    // Tour Guiado - Inteligência Estatística
    let currentTourStep = 0;
    const tourSteps = [
      {
        target: 'h1',
        content: '<strong>Bem-vindo à Aposta Inteligente Premium!</strong><br><br>Descubra o coração da nossa inteligência aqui! Esta página combina múltiplas análises estatísticas e algoritmos avançados para transformar seus "achismos" em decisões de aposta fundamentadas em dados. Vamos começar?',
        position: 'bottom'
      },
      {
        target: '#passo1',
        content: '<strong>Passo 1: Análises Estatísticas de Frequência e Tendências</strong><br><br>Explore os Números Quentes e Frios, visualize a Matriz de Frequência dos concursos e veja o "tempo de seca" de cada número e trevo. Você controla o período temporal de análise para identificar tendências recentes ou históricas.',
        position: 'left'
      },
      {
        target: '#passo2',
        content: '<strong>Passo 2: Mergulhe na Distribuição Estatística dos Sorteios</strong><br><br>Vá além da frequência! Analise padrões de pares/ímpares, faixas numéricas e a soma dos números sorteados. Entenda como as distribuições se comportam ao longo do tempo.',
        position: 'left'
      },
      {
        target: '#passo3',
        content: '<strong>Passo 3: Encontre Combinações que Saem Juntas</strong><br><br>Descubra combinações que costumam sair juntas através de análise estatística avançada. Identifique padrões de afinidade entre números e trevos.',
        position: 'left'
      },
      {
        target: '#passo4',
        content: '<strong>Passo 4: Análise de Sequências</strong><br><br>Identifique padrões de números consecutivos e sequências. Analise estatísticas de repetições e ciclos de retorno para otimizar suas escolhas.',
        position: 'left'
      },
      {
        target: '#passo5',
        content: '<strong>Passo 5: Identifique Números que Não Saem</strong><br><br>Evite números que estão há muito tempo sem sair. Analise estatisticamente os períodos de "seca" para tomar decisões mais informadas.',
        position: 'left'
      },
      {
        target: '#passo6',
        content: '<strong>Passo 6: Estatística Avançada para Padrões Ocultos</strong><br><br>Explore correlações, padrões ocultos e tendências com análise estatística avançada. Descubra relações complexas entre números e trevos.',
        position: 'bottom'
      },
      {
        target: '#abrir-modal-premium',
        content: '<strong>Gerador de Aposta Inteligente: Sua Estratégia em Ação</strong><br><br>Após suas análises, use nosso Gerador de Aposta Inteligente. Com base em suas preferências, ele combina múltiplas análises estatísticas e gera até 10 apostas otimizadas.',
        position: 'left'
      },
      {
        target: 'h1',
        content: '<strong>Sua Vantagem Premium: Análise Estatística Avançada</strong><br><br>Esta ferramenta Premium oferece análise estatística avançada e algoritmos proprietários que você não encontra em outro lugar. Personalize sua estratégia e use dados reais para ir além do palpite aleatório. O futuro das suas apostas começa aqui!',
        position: 'center'
      }
    ];

    // Função para mostrar o tour
    function showTour() {
      document.getElementById('tour-overlay').classList.remove('hidden');
      currentTourStep = 0;
      showStep();
    }

    // Função para mostrar cada passo do tour
    function showStep() {
      const step = tourSteps[currentTourStep];
      const target = document.querySelector(step.target);
      const tip = document.getElementById('tour-tip');
      const content = document.getElementById('tour-content');
      const progress = document.getElementById('tour-progress');

      if (!target) {
        console.error('Target não encontrado:', step.target);
        return;
      }

      content.innerHTML = step.content;
      progress.textContent = `${currentTourStep + 1}/${tourSteps.length}`;

      const targetRect = target.getBoundingClientRect();
      const tipRect = tip.getBoundingClientRect();

      let left, top;

      switch (step.position) {
        case 'left':
          left = targetRect.left - tipRect.width - 20;
          top = targetRect.top + (targetRect.height / 2) - (tipRect.height / 2);
          break;
        case 'bottom':
          left = targetRect.left + (targetRect.width / 2) - (tipRect.width / 2);
          top = targetRect.bottom + 20;
          break;
        case 'center':
          left = (window.innerWidth / 2) - (tipRect.width / 2);
          top = (window.innerHeight / 2) - (tipRect.height / 2);
          break;
        default:
          left = targetRect.left + (targetRect.width / 2) - (tipRect.width / 2);
          top = targetRect.top - tipRect.height - 20;
      }

      // Garantir que a dica não saia da tela
      if (left < 20) left = 20;
      if (left + tipRect.width > window.innerWidth - 20) {
        left = window.innerWidth - tipRect.width - 20;
      }
      if (top < 20) top = 20;
      if (top + tipRect.height > window.innerHeight - 20) {
        top = window.innerHeight - tipRect.height - 20;
      }

      tip.style.left = left + 'px';
      tip.style.top = top + 'px';

      // Atualizar botões
      document.getElementById('tour-prev').disabled = currentTourStep === 0;
      document.getElementById('tour-next').textContent = currentTourStep === tourSteps.length - 1 ? 'Finalizar' : 'Próximo →';
    }

    // Função para mostrar mensagem de conclusão
    function showCompletionMessage() {
      const tip = document.getElementById('tour-tip');
      const content = document.getElementById('tour-content');

      content.innerHTML = '<strong>🎉 Tour Concluído!</strong><br><br>Agora você conhece todas as funcionalidades da nossa Inteligência Estatística Premium. Comece a explorar e transforme suas apostas com dados e algoritmos avançados!';

      document.getElementById('tour-prev').style.display = 'none';
      document.getElementById('tour-next').style.display = 'none';
      document.getElementById('tour-skip').textContent = 'Fechar';

      // Centralizar a mensagem
      const tipRect = tip.getBoundingClientRect();
      tip.style.left = (window.innerWidth / 2) - (tipRect.width / 2) + 'px';
      tip.style.top = (window.innerHeight / 2) - (tipRect.height / 2) + 'px';
    }

    // Event listeners para o tour
    document.addEventListener('DOMContentLoaded', function() {
      // Botão de ativação
      const tourActivate = document.getElementById('tour-activate');
      if (tourActivate) {
        tourActivate.addEventListener('click', showTour);
      }

      // Navegação do tour
      const tourNext = document.getElementById('tour-next');
      if (tourNext) {
        tourNext.addEventListener('click', function() {
          if (currentTourStep < tourSteps.length - 1) {
            currentTourStep++;
            showStep();
          } else {
            showCompletionMessage();
          }
        });
      }

      const tourPrev = document.getElementById('tour-prev');
      if (tourPrev) {
        tourPrev.addEventListener('click', function() {
          if (currentTourStep > 0) {
            currentTourStep--;
            showStep();
          }
        });
      }

      const tourSkip = document.getElementById('tour-skip');
      if (tourSkip) {
        tourSkip.addEventListener('click', function() {
          document.getElementById('tour-overlay').classList.add('hidden');
          // Resetar botões
          document.getElementById('tour-prev').style.display = 'block';
          document.getElementById('tour-next').style.display = 'block';
          document.getElementById('tour-skip').textContent = 'Pular Tour';
        });
      }

      // Fechar tour clicando fora
      const tourOverlay = document.getElementById('tour-overlay');
      if (tourOverlay) {
        tourOverlay.addEventListener('click', function(e) {
          if (e.target.id === 'tour-overlay') {
            document.getElementById('tour-overlay').classList.add('hidden');
          }
        });
      }

      // Verificar se é a primeira visita
      if (!localStorage.getItem('tourCompleted')) {
        setTimeout(() => {
          showTour();
        }, 2000);
      }
    });

    // Marcar tour como concluído
    function completeTour() {
      localStorage.setItem('tourCompleted', 'true');
    }

    // Inicialização - Aguarda carregamento completo dos estilos
    function inicializarAplicacao() {
      gerarNumeros();
      gerarTrevos();
      carregarEstatisticasRapidas();

      // Removido: chamada automática de atualizarAnaliseFrequencia()
      // A função será chamada apenas quando o modal for aberto
    }

    // Aguarda tanto DOM quanto estilos carregados
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', inicializarAplicacao);
    } else {
      // DOM já carregado, aguarda estilos
      window.addEventListener('load', inicializarAplicacao);
    }



    // Gerar números de 1 a 50 - DESABILITADO NA PÁGINA PREMIUM
    function gerarNumeros() {
      // Função desabilitada na página premium - não há grid de números
      console.log('Função gerarNumeros() desabilitada na página premium');
    }

    // Gerar trevos (container único) - DESABILITADO NA PÁGINA PREMIUM
    function gerarTrevos() {
      // Função desabilitada na página premium - não há container de trevos
      console.log('Função gerarTrevos() desabilitada na página premium');
    }

    // Selecionar número (manual - limite de 12)
    function selecionarNumero(numero, elemento) {
      // Verificar se já atingiu o limite antes de qualquer ação
      if (numerosSelecionados.length >= 12 && !numerosSelecionados.includes(numero)) {
        alert('Você já selecionou 12 números! Limite máximo para seleção manual.');
        // Garantir que o elemento NÃO seja marcado visualmente
        elemento.classList.remove('selecionado');
        // Forçar remoção de qualquer estado temporário
        elemento.blur();
        elemento.style.pointerEvents = 'none';
        setTimeout(() => {
          elemento.style.pointerEvents = 'auto';
        }, 100);
        return;
      }

      if (numerosSelecionados.includes(numero)) {
        numerosSelecionados = numerosSelecionados.filter(n => n !== numero);
        elemento.classList.remove('selecionado');
      } else {
        numerosSelecionados.push(numero);
        elemento.classList.add('selecionado');
      }
      atualizarNumerosSelecionados();
      calcularEAtualizarValorAposta(); // NOVA: Calcular valor após cada seleção
    }

    // Selecionar número automaticamente (sem limite)
    function selecionarNumeroAutomatico(numero, elemento) {
      if (!numerosSelecionados.includes(numero)) {
        numerosSelecionados.push(numero);
        elemento.classList.add('selecionado');
      }
      atualizarNumerosSelecionados();
    }

    // Selecionar trevo (manual - limite de 6 trevos)
    function selecionarTrevo(trevo, elemento) {
      // Verificar se já atingiu o limite antes de qualquer ação
      if (trevosSelecionados.length >= 6 && !trevosSelecionados.includes(trevo)) {
        alert('Você já selecionou 6 trevos! Limite máximo para seleção manual.');
        // Garantir que o elemento NÃO seja marcado visualmente
        elemento.classList.remove('selecionado');
        // Forçar remoção de qualquer estado temporário
        elemento.blur();
        elemento.style.pointerEvents = 'none';
        setTimeout(() => {
          elemento.style.pointerEvents = 'auto';
        }, 100);
        return;
      }

      if (trevosSelecionados.includes(trevo)) {
        trevosSelecionados = trevosSelecionados.filter(t => t !== trevo);
        elemento.classList.remove('selecionado');
      } else {
        trevosSelecionados.push(trevo);
        elemento.classList.add('selecionado');
      }
      atualizarTrevosSelecionados();
      calcularEAtualizarValorAposta(); // NOVA: Calcular valor após cada seleção
    }

    // Atualizar display dos números selecionados
    function atualizarNumerosSelecionados() {
      const container = document.getElementById('numeros-selecionados');
      if (numerosSelecionados.length === 0) {
        container.innerHTML = '<span class="text-gray-400">Nenhum número selecionado</span>';
      } else {
        container.innerHTML = numerosSelecionados
          .sort((a, b) => a - b)
          .map(n => `<span class="bg-[#00E38C] text-black px-2 py-1 rounded font-semibold">${n.toString().padStart(2, '0')}</span>`)
          .join('');
      }
    }

    // Atualizar display dos trevos selecionados
    function atualizarTrevosSelecionados() {
      const container = document.getElementById('trevos-selecionados');
      if (trevosSelecionados.length === 0) {
        container.innerHTML = '<span class="text-gray-400">Nenhum trevo selecionado</span>';
      } else {
        container.innerHTML = trevosSelecionados
          .sort((a, b) => a - b)
          .map(t => `<span class="bg-[#8B5CF6] text-white px-2 py-1 rounded font-semibold">${t}</span>`)
          .join('');
      }
    }

    // Atualizar display do valor da aposta (DESABILITADO NO MODAL PREMIUM)
    function atualizarValorAposta(valor, qtdeApostas, qtdeNum, qtdeTrevos) {
      // Função desabilitada no modal premium - não há container de valor
      console.log('Função atualizarValorAposta() desabilitada no modal premium');
    }

    // NOVA: Calcular e atualizar valor da aposta baseado nas seleções manuais (DESABILITADO NO MODAL PREMIUM)
    function calcularEAtualizarValorAposta() {
      // Função desabilitada no modal premium - não há seleção manual de números
      console.log('Função calcularEAtualizarValorAposta() desabilitada no modal premium');
    }

    // Carregar estatísticas rápidas - DESABILITADO NA PÁGINA PREMIUM
    function carregarEstatisticasRapidas() {
      // Função desabilitada na página premium - não há seção de estatísticas rápidas
      console.log('Função carregarEstatisticasRapidas() desabilitada na página premium');
    }



    // Abrir modal
    function abrirModal(tipo) {
      // Esconder todos os popups de ajuda primeiro
      const popups = document.querySelectorAll('.modal-ajuda');
      popups.forEach(popup => {
        popup.style.display = 'none';
      });

      // Usar modal genérico para todos
      const modal = document.getElementById('modal');
      const titulo = document.getElementById('titulo-modal');
      const conteudo = document.getElementById('conteudo-modal');

      modal.classList.remove('hidden');

      switch(tipo) {
        case 'frequencia':
          titulo.textContent = '📊 Análise de Frequência';
          carregarAnaliseFrequencia(conteudo);
          // Carregar preferências salvas após o modal ser carregado
          setTimeout(() => {
            if (typeof carregarPreferenciasFrequencia === 'function') {
              carregarPreferenciasFrequencia();
            }
          }, 500);
          break;
        case 'distribuicao':
          titulo.textContent = '🔢 Análise de Distribuição';
          carregarAnaliseDistribuicao(conteudo, null);
          // Carregar preferências salvas após o modal ser carregado
          setTimeout(() => {
            if (typeof carregarPreferenciasDistribuicao === 'function') {
              carregarPreferenciasDistribuicao();
            }
          }, 1000); // Aumentado de 500ms para 1000ms
          break;
        case 'afinidades':
          titulo.textContent = '🤝 Análise de Afinidades';
          carregarAnaliseAfinidades(conteudo);
          // Carregar preferências salvas após o modal ser carregado
          setTimeout(() => {
            if (typeof carregarPreferenciasAfinidades === 'function') {
              carregarPreferenciasAfinidades();
            }
          }, 1000); // Aumentado de 500ms para 1000ms
          break;
        case 'sequencias':
          titulo.textContent = '🔢 Análise de Sequências';
          carregarAnaliseSequencias(conteudo);
          // Carregar preferências salvas após o modal ser carregado
          setTimeout(() => {
            if (typeof carregarPreferenciasSequencias === 'function') {
              carregarPreferenciasSequencias();
            }
          }, 1000); // Aumentado de 500ms para 1000ms
          break;
        case 'seca':
          titulo.textContent = '🌵 Análise de Seca';
          carregarAnaliseSeca(conteudo);
          // Carregar preferências salvas após o modal ser carregado
          setTimeout(() => {
            if (typeof carregarPreferenciasSeca === 'function') {
              carregarPreferenciasSeca();
            }
          }, 1000); // Aumentado de 500ms para 1000ms
          break;
        case 'estatisticas':
          titulo.textContent = '📈 Estatísticas Avançadas';
          carregarAnaliseEstatisticasAvancadas(conteudo);
          // Carregar preferências salvas após o modal ser carregado
          setTimeout(() => {
            if (typeof carregarPreferenciasAvancadas === 'function') {
              carregarPreferenciasAvancadas();
            }
          }, 500);
          break;
      }
    }

    // Fechar modal
    function fecharModal(modalId = null) {
      if (modalId) {
        // Fechar modal específico
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.classList.add('hidden');
        }
      } else {
        // Fechar modal genérico
        document.getElementById('modal').classList.add('hidden');
      }
    }

    // Função auxiliar para renderizar números quentes e frios com segurança
    function renderizarNumerosQuentesFrios(data) {
      const numerosQuentes = data.numeros_quentes_frios?.numeros_quentes || [];
      const numerosFrios = data.numeros_quentes_frios?.numeros_frios || [];

      return {
        quentes: numerosQuentes.slice(0, 10).map(n =>
          `<div class="bg-[#00E38C] text-black p-3 rounded text-center font-semibold">${n[0]}</div>`
        ).join(''),
        frios: numerosFrios.slice(0, 10).map(n =>
          `<div class="bg-gray-600 text-white p-3 rounded text-center font-semibold">${n[0]}</div>`
        ).join('')
      };
    }

    // Carregar análise de frequência
    async function carregarAnaliseFrequencia(container) {
      container.innerHTML = "🔄 Carregando análise de frequência...";

      try {
        const response = await fetch('/api/analise-frequencia-lotofacil-v2?qtd_concursos=400');
        const data = await response.json();

        console.log('Dados recebidos em carregarAnaliseFrequencia:', data);

        if (data.error) {
          container.innerHTML = `<p style="color: red;">Erro: ${data.error}</p>`;
          return;
        }

        const numerosRenderizados = renderizarNumerosQuentesFrios(data);

        container.innerHTML = `
          <div class="space-y-6">
            <!-- Cabeçalho com título e ajuda -->
            <div class="flex justify-between items-start">
              <div class="bg-[#2E303A] p-4 rounded-xl flex-1">
                <h3 class="text-lg font-semibold mb-3 text-[#00E38C]">🎯 Janela de Análise Temporal</h3>
                <div class="flex flex-wrap gap-3 items-center">
                  <label class="text-sm text-gray-300">Período:</label>
                  <select id="janela-analise" class="bg-[#1A1D25] text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-[#00E38C] focus:outline-none" onchange="atualizarAnaliseFrequencia()">
                    <option value="300">Últimos 300 concursos</option>
                    <option value="25">Últimos 25 concursos</option>
                    <option value="50">Últimos 50 concursos</option>
                    <option value="100">Últimos 100 concursos</option>
                    <option value="200">Últimos 200 concursos</option>
                  </select>
                  <span class="text-xs text-gray-400">(Selecione para atualizar a análise)</span>
                </div>
              </div>
              <button onclick="abrirPopupAjuda()" class="ml-4 bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition-colors duration-200" title="Como usar estes gráficos?">
                ❓
              </button>
            </div>

            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">🔥 Números Mais Quentes (Top 10)</h3>
              <div class="grid grid-cols-5 gap-2">
                ${numerosRenderizados.quentes}
              </div>
            </div>

            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">❄️ Números Mais Frios (Top 10)</h3>
              <div class="grid grid-cols-5 gap-2">
                ${numerosRenderizados.frios}
              </div>
            </div>

            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">📊 Frequência Absoluta  vs  Relativa <span style="color: red;">(%)</span>  </h3>
              <div id="grafico-frequencia" class="grafico-frequencia-container"></div>
            </div>

            <div class="chart-container">
              <h3 class="titulo-matriz">🔢 Matriz Visual dos Últimos Concursos</h3>
              <div class="matriz-info">
                <span id="matriz-concursos-count" class="text-sm text-gray-400">Carregando...</span>
                <div class="matriz-navigation-hint">
                  <span class="text-xs text-gray-500">🖱️ Desktop: Use as barras de rolagem</span>
                  <span class="text-xs text-gray-500 ml-2">📱 Mobile: Deslize o dedo em qualquer direção</span>
                </div>
              </div>
              <div id="matriz-frequencia" class="matriz-container"></div>
            </div>

            <!-- SUGESTÕES PARA APOSTA PREMIUM (removido bloco duplicado; usar bloco consolidado adiante) -->
          </div>
        `;

        // Criar gráfico combinado: Absoluta vs Relativa
        const freqAbsObj = (data?.frequencia_absoluta?.numeros) || {};
        const freqRelObj = (data?.frequencia_relativa?.numeros) || {};
        const xNumeros = Object.keys(freqAbsObj).map(n=>Number(n)).sort((a,b)=>a-b);
        const yFreqAbs = xNumeros.map(n => freqAbsObj[n] ?? 0);
        const yFreqRelComb = xNumeros.map(n => freqRelObj[n] ?? 0);
        const linhaEsperadaComb = Array(25).fill((15/25)*100/15); // referência proporcional (aprox 4%)

        // Detectar se é smartphone para ajustar tamanho da fonte
        const isMobile = window.innerWidth <= 640;
        const fontSize = isMobile ? 6 : 12; // 6px para mobile, 12px para desktop

        Plotly.newPlot('grafico-frequencia', [
          {
            x: xNumeros,
            y: yFreqAbs,
            type: 'bar',
            name: '',
            marker: { color: 'deepskyblue' },
            yaxis: 'y',
            showlegend: false
          },
          {
            x: xNumeros,
            y: yFreqRelComb,
            type: 'scatter',
            mode: 'lines+markers',
            name: '',
            line: { color: 'red', width: 2 },
            marker: { color: 'red', size: 4 },
            yaxis: 'y2',
            showlegend: false
          },
          {
            x: xNumeros,
            y: linhaEsperadaComb,
            type: 'scatter',
            mode: 'lines',
            name: 'Freq. esperada',
            line: { color: 'white', dash: 'dash', width: 2 },
            yaxis: 'y2'
          }
        ], {
          title: {
            text: 'Freq. Números', // Título principal mais conciso para mobile
            font: { size: 14 } // Tamanho da fonte menor para o título do gráfico
          },
          paper_bgcolor: '#1a1a1a',
          plot_bgcolor: '#1a1a1a',
          font: { color: 'white' },
          autosize: true,
          responsive: true,
          // Reduzir as margens ao mínimo necessário para os rótulos dos eixos
          margin: {
            l: 25, // Margem esquerda mínima
            r: 25, // Margem direita mínima
            b: 70, // Ajuste para acomodar rótulos inclinados do eixo X
            t: 40, // Margem superior
            pad: 0 // Sem padding extra interno ao gráfico
          },
          xaxis: {
            automargin: true,
            // CHAVE PARA OS RÓTULOS SOBREPOSTOS:
            tickangle: 45, // Incline os rótulos em 45 graus
            tickfont: { size: 8 }, // Diminua o tamanho da fonte dos rótulos para que caibam melhor
            // showgrid: false // Remover grade vertical para menos poluição visual se não for essencial
          },
          yaxis: {
            automargin: true,
            title: {
              text: 'Abs.', // Título do eixo Y mais curto para economizar espaço
              font: { size: 9 } // Fonte menor para o título do eixo Y
            },
            tickfont: { size: 9 } // Fonte menor para os rótulos do eixo Y
          },
          yaxis2: {
            side: 'right',
            overlaying: 'y',
            automargin: true,
            title: {
              text: 'Rel. (%)', // Título do eixo Y2 mais curto
              font: { size: 9, color: 'red' }
            },
            tickfont: { color: 'red', size: 9 }
          },
          showlegend: false
        }, { displayModeBar: false });

        // Garantir que o gráfico se redimensione quando a janela mudar
        window.addEventListener('resize', () => {
          const graficoElement = document.getElementById('grafico-frequencia');
          if (graficoElement) {
            Plotly.relayout('grafico-frequencia', { 'autosize': true });
          }
        });

        // Aguardar um pouco para garantir que o DOM foi renderizado
        setTimeout(() => {
          if (data.concursos_para_matriz && Array.isArray(data.concursos_para_matriz) && data.concursos_para_matriz.length > 0) {
            console.log('Usando dados reais da API para matriz');
            montarMatriz(data.concursos_para_matriz);
          } else {
            console.log('Usando dados mock para matriz');
            montarMatriz(concursosMock); // fallback para teste
          }
        }, 100);

      } catch (error) {
        container.innerHTML = `<p style="color: red;">Erro ao carregar dados: ${error.message}</p>`;
      }
    }

            // Mock JS com dados fictícios da Quina (até conectar com a API real)
    const concursosMock = [
      { concurso: 1, numeros: [12, 23, 35, 44, 46, 50] },
      { concurso: 2, numeros: [3, 15, 21, 33, 42, 49] },
      { concurso: 3, numeros: [7, 9, 11, 20, 37, 40] },
      { concurso: 4, numeros: [5, 8, 18, 26, 39, 43] },
      { concurso: 5, numeros: [1, 10, 22, 28, 45, 55] },
      { concurso: 6, numeros: [2, 13, 19, 31, 38, 52] },
      { concurso: 7, numeros: [4, 14, 25, 36, 47, 58] },
      { concurso: 8, numeros: [6, 16, 27, 41, 48, 59] }
    ];

    function aplicarEstiloCelula(div) {
      // Removido: div.style.fontSize = '9px';
      // Removido: div.style.fontFamily = 'Arial, sans-serif';
      // Removido: div.style.lineHeight = '22px';
      // Removido: div.style.textAlign = 'center';
      // Removido: div.style.width = '22px';
      // Removido: div.style.height = '22px';
    }
    function montarMatriz(concursos) {
      console.log('montarMatriz chamada com:', concursos);
      console.log('Tipo de concursos:', typeof concursos);
      console.log('É array?', Array.isArray(concursos));
      console.log('Quantidade de concursos:', concursos ? concursos.length : 'N/A');

      const container = document.getElementById('matriz-frequencia');
      if (!container) {
        console.error('Elemento matriz-frequencia não encontrado');
        return;
      }
      console.log('Container encontrado, limpando...');
      container.innerHTML = '';

      if (!Array.isArray(concursos) || concursos.length === 0) {
        console.error('Dados de concursos inválidos ou vazios');
        container.innerHTML = '<p style="color: red;">Erro: Dados de concursos não disponíveis</p>';
        return;
      }

      let concursosProcessados = 0;
      // Inverter a ordem dos concursos para mostrar mais recente no topo
      const concursosInvertidos = [...concursos].reverse();

      concursosInvertidos.forEach((concurso, index) => { // Itera por cada concurso
        console.log(`Processando concurso ${index + 1}:`, concurso);

        if (!concurso.numeros || !Array.isArray(concurso.numeros)) {
          console.error(`Concurso ${index + 1} sem dados válidos:`, concurso);
          return;
        }

        // --- UMA ÚNICA LINHA POR CONCURSO ---
        const linhaConcurso = document.createElement('div');
        linhaConcurso.className = 'linha-concurso';

        // Adicionar todos os 25 números na mesma linha (Lotofácil)
        for (let i = 1; i <= 25; i++) {
          const celula = document.createElement('div');
          celula.className = 'celula-numero';
          celula.textContent = i;
          if (concurso.numeros.includes(i)) {
            celula.classList.add('sorteado');
          }
          linhaConcurso.appendChild(celula);
        }

        container.appendChild(linhaConcurso);
        concursosProcessados++;
        console.log(`Concurso ${index + 1} processado com sucesso. Total processados: ${concursosProcessados}`);
      });
      console.log('Matriz montada com sucesso!');

      // Atualizar contador de concursos
      const contadorElement = document.getElementById('matriz-concursos-count');
      if (contadorElement) {
        contadorElement.textContent = `${concursosProcessados} concursos exibidos`;
      }

      // Configuração adicional para melhor experiência de scroll
      const matrizContainer = document.getElementById('matriz-frequencia');
      if (matrizContainer) {
        // Garantir que o scroll funcione bem em todos os dispositivos
        matrizContainer.style.webkitOverflowScrolling = 'touch';
        matrizContainer.style.scrollBehavior = 'smooth';
      }
    }



    // Função para atualizar análise quando mudar a janela
    async function atualizarAnaliseFrequencia() {
      const janelaElement = document.getElementById('janela-analise');
      const janela = janelaElement ? janelaElement.value : '500'; // Valor padrão se elemento não existir
      const container = document.getElementById('conteudo-modal');

      container.innerHTML = "🔄 Atualizando análise...";

      try {
        // Garantir que sempre envie o parâmetro qtd_concursos, mesmo que seja 500
        const url = `/api/analise-frequencia-lotofacil-v2?qtd_concursos=${janela}`;
        console.log('Fazendo requisição para:', url);
        const response = await fetch(url);
        const data = await response.json();

        console.log('Dados recebidos da API:', data);
        console.log('data.concursos_para_matriz:', data.concursos_para_matriz);
        console.log('Tamanho de data.concursos_para_matriz:', data.concursos_para_matriz ? data.concursos_para_matriz.length : 'N/A');

        if (data.error) {
          container.innerHTML = `<p style="color: red;">Erro: ${data.error}</p>`;
          return;
        }

        // Recriar o conteúdo com os novos dados
        container.innerHTML = `
          <div class="space-y-6">
            <!-- Cabeçalho com título e ajuda -->
            <div class="flex justify-between items-start">
              <div class="bg-[#2E303A] p-4 rounded-xl flex-1">
                <h3 class="text-lg font-semibold mb-3 text-[#00E38C]">🎯 Janela de Análise</h3>
                <div class="flex flex-wrap gap-3 items-center">
                  <label class="text-sm text-gray-300">Período:</label>
                  <select id="janela-analise" class="bg-[#1A1D25] text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-[#00E38C] focus:outline-none" onchange="atualizarAnaliseFrequencia()">
                    <option value="300" ${janela === '' || janela === '300' ? 'selected' : ''}>Últimos 300 concursos</option>
                    <option value="25" ${janela === '25' ? 'selected' : ''}>Últimos 25 concursos</option>
                    <option value="50" ${janela === '50' ? 'selected' : ''}>Últimos 50 concursos</option>
                    <option value="100" ${janela === '100' ? 'selected' : ''}>Últimos 100 concursos</option>
                    <option value="200" ${janela === '200' ? 'selected' : ''}>Últimos 200 concursos</option>
                  </select>
                  <span class="text-xs text-gray-400">(Selecione para atualizar a análise)</span>
                </div>
              </div>
              <button onclick="abrirPopupAjuda()" class="ml-4 bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition-colors duration-200" title="Como usar estes gráficos?">
                ❓
              </button>
            </div>

            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">🔥 Números Mais Quentes (Top 10)</h3>
              <div class="grid grid-cols-5 gap-2">
                ${data.numeros_quentes_frios.numeros_quentes.slice(0, 10).map(n =>
                  `<div class="bg-[#00E38C] text-black p-3 rounded text-center font-semibold">${n[0]}</div>`
                ).join('')}
              </div>
            </div>

            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">❄️ Números Mais Frios (Top 10)</h3>
              <div class="grid grid-cols-5 gap-2">
                ${data.numeros_quentes_frios.numeros_frios.slice(0, 10).map(n =>
                  `<div class="bg-gray-600 text-white p-3 rounded text-center font-semibold">${n[0]}</div>`
                ).join('')}
              </div>
            </div>

            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">📊 Frequência Absoluta  vs  Relativa <span style="color: red;">(%)</span>  </h3>
              <div id="grafico-frequencia" class="grafico-frequencia-container"></div>
            </div>

            <h3 class="titulo-matriz">🔢 Matriz Visual dos Últimos Concursos</h3>
            <div class="matriz-info">
              <span id="matriz-concursos-count" class="text-sm text-gray-400">Carregando...</span>
              <div class="matriz-navigation-hint">
                <span class="text-xs text-gray-500">🖱️ Desktop: Use as barras de rolagem</span>
                <span class="text-xs text-gray-500 ml-2">📱 Mobile: Deslize o dedo em qualquer direção</span>
              </div>
            </div>
            <div id="matriz-frequencia" class="matriz-container"></div>

            <!-- SUGESTÕES PARA APOSTA PREMIUM -->
            <div class="mt-8 bg-[#2E303A] p-4 rounded-lg shadow-md">
              <h4 class="text-[#00E38C] text-xl font-semibold mb-4">🎯 Sugestões para Aposta Inteligente</h4>
              <div class="space-y-3">
                <div class="flex items-center">
                  <input type="checkbox" id="freq-priorizar-quentes" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="frequencia" data-pref-name="priorizarQuentes" data-pref-period="completa">
                  <label for="freq-priorizar-quentes" class="text-white">Priorizar Números MAIS Frequentes</label>
                  <input type="number" id="freq-qtde-quentes" class="ml-auto w-16 bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" value="10" min="1" max="25">
                </div>
                <div class="flex items-center">
                  <input type="checkbox" id="freq-priorizar-frios" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="frequencia" data-pref-name="priorizarFrios" data-pref-period="completa">
                  <label for="freq-priorizar-frios" class="text-white">Priorizar Números MENOS Frequentes</label>
                  <input type="number" id="freq-qtde-frios" class="ml-auto w-16 bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" value="10" min="1" max="25">
                </div>
                <div class="flex items-center">
                  <label for="freq-periodo" class="text-white">Considerar período:</label>
                  <select id="freq-periodo" class="select-premium-pref ml-2 bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" data-pref-type="frequencia" data-pref-name="considerarPeriodo">
                    <option value="300">Últimos 300 Concursos</option>
                    <option value="25">Últimos 25 Concursos</option>
                    <option value="50">Últimos 50 Concursos</option>
                  </select>
                </div>
              </div>
              <div class="mt-4 p-3 bg-[#1A1D25] rounded border-l-4 border-[#00E38C]">
                <p class="text-sm text-[#00E38C] font-medium">💡 Dica:</p>
                <p class="text-xs text-gray-300">Marque as opções que fazem sentido para sua estratégia. Elas serão usadas na Análise Premium.</p>
              </div>
            </div>
          </div>
        `;

        // Criar gráfico combinado: Absoluta vs Relativa
        const freqAbsObj2 = (data?.frequencia_absoluta?.numeros) || {};
        const freqRelObj2 = (data?.frequencia_relativa?.numeros) || {};
        const xNumeros = Object.keys(freqAbsObj2).map(n=>Number(n)).sort((a,b)=>a-b);
        const yFreqAbs = xNumeros.map(n => freqAbsObj2[n] ?? 0);
        const yFreqRelComb = xNumeros.map(n => freqRelObj2[n] ?? 0);
        const linhaEsperadaComb = Array(25).fill((15/25)*100/15); // referência proporcional (aprox 4%)

        // Detectar se é smartphone para ajustar tamanho da fonte
        const isMobile = window.innerWidth <= 640;
        const fontSize = isMobile ? 6 : 12; // 6px para mobile, 12px para desktop

        Plotly.newPlot('grafico-frequencia', [
          {
            x: xNumeros,
            y: yFreqAbs,
            type: 'bar',
            name: '',
            marker: { color: 'deepskyblue' },
            yaxis: 'y',
            showlegend: false
          },
          {
            x: xNumeros,
            y: yFreqRelComb,
            type: 'scatter',
            mode: 'lines+markers',
            name: '',
            line: { color: 'red', width: 2 },
            marker: { color: 'red', size: 4 },
            yaxis: 'y2',
            showlegend: false
          },
          {
            x: xNumeros,
            y: linhaEsperadaComb,
            type: 'scatter',
            mode: 'lines',
            name: 'Freq. esperada',
            line: { color: 'white', dash: 'dash', width: 2 },
            yaxis: 'y2'
          }
        ], {
          title: {
            text: 'Freq. Números', // Título principal mais conciso para mobile
            font: { size: 14 } // Tamanho da fonte menor para o título do gráfico
          },
          paper_bgcolor: '#1a1a1a',
          plot_bgcolor: '#1a1a1a',
          font: { color: 'white' },
          autosize: true,
          responsive: true,
          // Reduzir as margens ao mínimo necessário para os rótulos dos eixos
          margin: {
            l: 25, // Margem esquerda mínima
            r: 25, // Margem direita mínima
            b: 70, // Ajuste para acomodar rótulos inclinados do eixo X
            t: 40, // Margem superior
            pad: 0 // Sem padding extra interno ao gráfico
          },
          xaxis: {
            automargin: true,
            // CHAVE PARA OS RÓTULOS SOBREPOSTOS:
            tickangle: 45, // Incline os rótulos em 45 graus
            tickfont: { size: 8 }, // Diminua o tamanho da fonte dos rótulos para que caibam melhor
            // showgrid: false // Remover grade vertical para menos poluição visual se não for essencial
            range: [0, 26], // Força o range de 1-25
            tickmode: 'linear',
            tick0: 1,
            dtick: 5
          },
          yaxis: {
            automargin: true,
            title: {
              text: 'Abs.', // Título do eixo Y mais curto para economizar espaço
              font: { size: 9 } // Fonte menor para o título do eixo Y
            },
            tickfont: { size: 9 } // Fonte menor para os rótulos do eixo Y
          },
          yaxis2: {
            side: 'right',
            overlaying: 'y',
            automargin: true,
            title: {
              text: 'Rel. (%)', // Título do eixo Y2 mais curto
              font: { size: 9, color: 'red' }
            },
            tickfont: { color: 'red', size: 9 }
          },
          showlegend: false
        }, { displayModeBar: false });

        // Garantir que o gráfico se redimensione quando a janela mudar
        window.addEventListener('resize', () => {
          const graficoElement = document.getElementById('grafico-frequencia');
          if (graficoElement) {
            Plotly.relayout('grafico-frequencia', { 'autosize': true });
          }
        });

        // Carregar matriz visual com dados reais
        setTimeout(() => {
          console.log('Tentando carregar matriz...');
          console.log('data.concursos_para_matriz:', data.concursos_para_matriz);
          console.log('concursosMock:', concursosMock);

          if (data.concursos_para_matriz && Array.isArray(data.concursos_para_matriz) && data.concursos_para_matriz.length > 0) {
            console.log('Usando dados reais da API para matriz');
            montarMatriz(data.concursos_para_matriz);
          } else {
            console.log('Dados reais não disponíveis, tentando novamente...');
            // Se não temos dados reais, tentar fazer uma nova requisição específica para a matriz
            fetch(`/api/analise-frequencia-lotofacil-v2?qtd_concursos=${janela || '400'}`)
              .then(response => response.json())
              .then(dataRetry => {
                if (dataRetry.concursos_para_matriz && Array.isArray(dataRetry.concursos_para_matriz) && dataRetry.concursos_para_matriz.length > 0) {
                  console.log('Dados reais obtidos na segunda tentativa');
                  montarMatriz(dataRetry.concursos_para_matriz);
                } else {
                  console.log('Usando dados mock para matriz');
                  montarMatriz(concursosMock);
                }
              })
              .catch(error => {
                console.log('Erro na segunda tentativa, usando dados mock');
                montarMatriz(concursosMock);
              });
          }
        }, 100);

        // Salvar dados da análise de frequência no localStorage
        const dadosFrequencia = {
          janela: janela,
          numeros_quentes: data.numeros_quentes_frios.numeros_quentes.slice(0, 10).map(n => n[0]),
          numeros_frios: data.numeros_quentes_frios.numeros_frios.slice(0, 10).map(n => n[0]),
          frequencia_completa: data.frequencia_completa,
          timestamp: new Date().toISOString()
        };

        armazenarAnalise('frequencia', dadosFrequencia);
        console.log('✅ Dados de frequência salvos no localStorage');

      } catch (error) {
        container.innerHTML = `<p style="color: red;">Erro ao atualizar dados: ${error.message}</p>`;
      }
    }

      // Funções para o popup de ajuda
      function abrirPopupAjuda() {
        document.getElementById("popupAjuda").style.display = "block";
      }

      function fecharPopupAjuda() {
        document.getElementById("popupAjuda").style.display = "none";
      }

      // Funções para o popup de ajuda de distribuição
      function abrirPopupAjudaDistribuicao() {
        document.getElementById("popupAjudaDistribuicao").style.display = "block";
      }

      function fecharPopupAjudaDistribuicao() {
        document.getElementById("popupAjudaDistribuicao").style.display = "none";
      }

      // Funções para o popup de ajuda de afinidades
      function abrirPopupAjudaAfinidades() {
        document.getElementById("popupAjudaAfinidades").style.display = "block";
      }

      function fecharPopupAjudaAfinidades() {
        document.getElementById("popupAjudaAfinidades").style.display = "none";
      }

      // Funções para o popup de ajuda de sequências
      function abrirPopupAjudaSequencias() {
        document.getElementById("popupAjudaSequencias").style.display = "block";
      }

      function fecharPopupAjudaSequencias() {
        document.getElementById("popupAjudaSequencias").style.display = "none";
      }

    // Carregar análise de distribuição
    async function carregarAnaliseDistribuicao(container, qtdConcursos = null) {
      container.innerHTML = "🔄 Carregando análise de distribuição...";

      try {
        console.log("Iniciando fetch para /api/analise_de_distribuicao...");
        const url = qtdConcursos ? `/api/analise_de_distribuicao-lotofacil?qtd_concursos=${qtdConcursos}` : '/api/analise_de_distribuicao-lotofacil';
        const response = await fetch(url);
        console.log("Response status:", response.status);

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        console.log("Dados recebidos:", data);
        console.log("Tipo de data:", typeof data);
        console.log("data.paridade:", data.paridade);
        console.log("data.soma_dos_numeros:", data.soma_dos_numeros);
        console.log("data.amplitude_dos_numeros:", data.amplitude_dos_numeros);

        if (data.error) {
          container.innerHTML = `<p style="color: red;">Erro: ${data.error}</p>`;
          return;
        }

        // Verificar se os dados necessários existem
        if (!data.paridade || !data.soma_dos_numeros || !data.amplitude_dos_numeros) {
          console.error("Dados incompletos recebidos:", data);
          container.innerHTML = `<p style="color: red;">Erro: Dados incompletos recebidos da API. Verifique o console para detalhes.</p>`;
          return;
        }

        // Renderizar gráficos de distribuição
        container.innerHTML = `
          <div class="space-y-6">
            <!-- Cabeçalho com título e ajuda -->
            <div class="flex justify-between items-start">
              <div class="bg-[#2E303A] p-4 rounded-xl flex-1">
                <h3 class="text-lg font-semibold mb-3 text-[#00E38C]">🎯 Janela de Análise Temporal</h3>
                <div class="flex flex-wrap gap-3 items-center">
                  <label class="text-sm text-gray-300">Período:</label>
                  <select id="selectDistribuicaoPeriodo" class="bg-[#1A1D25] text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-[#00E38C] focus:outline-none" onchange="updateDistribuicaoModal()">
                    <option value="300" ${qtdConcursos === '' || !qtdConcursos || qtdConcursos === '300' ? 'selected' : ''}>Últimos 300 concursos</option>
                    <option value="10" ${qtdConcursos === '10' ? 'selected' : ''}>Últimos 10 concursos</option>
                    <option value="25" ${qtdConcursos === '25' ? 'selected' : ''}>Últimos 25 concursos</option>
                    <option value="50" ${qtdConcursos === '50' ? 'selected' : ''}>Últimos 50 concursos</option>
                    <option value="100" ${qtdConcursos === '100' ? 'selected' : ''}>Últimos 100 concursos</option>
                    <option value="200" ${qtdConcursos === '200' ? 'selected' : ''}>Últimos 200 concursos</option>
                  </select>
                  <span class="text-xs text-gray-400">(Selecione para atualizar a análise)</span>
                </div>
                <div class="mt-2 text-xs text-gray-400" id="distribuicaoPeriodoDisplay">
                  ${qtdConcursos ? `Análise dos últimos ${qtdConcursos} concursos.` : 'Análise dos últimos 300 concursos.'}
                </div>
              </div>
              <button onclick="abrirPopupAjudaDistribuicao()" class="ml-4 bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition-colors duration-200" title="Como usar estes gráficos?">
                ❓
              </button>
            </div>

            <!-- Gráfico de Paridade - Números Principais -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">🔢 Paridade - Números Principais${qtdConcursos ? ` (Últimos ${qtdConcursos} concursos)` : ''}</h3>
              <div id="grafico-paridade-numeros" style="height: 400px;"></div>
            </div>



            <!-- Estatísticas de Paridade -->
            <div class="grid grid-cols-1 gap-4">
              <div class="stat-card p-4">
                <h4 class="font-semibold mb-2">📊 Números Principais${qtdConcursos ? ` (Últimos ${qtdConcursos} concursos)` : ''}</h4>
                <p class="text-sm text-gray-400">Média de Pares: <span class="text-[#00E38C]">${data.paridade.numeros_principais.media_pares.toFixed(2)}</span></p>
                <p class="text-sm text-gray-400">Média de Ímpares: <span class="text-[#00E38C]">${data.paridade.numeros_principais.media_impares.toFixed(2)}</span></p>
              </div>
            </div>

            <!-- Gráfico de Soma - Números Principais -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">📊 Soma dos Números Principais${qtdConcursos ? ` (Últimos ${qtdConcursos} concursos)` : ''}</h3>
              <div id="grafico-soma-numeros" style="height: 400px;"></div>
            </div>



            <!-- Estatísticas de Soma -->
            <div class="grid grid-cols-1 gap-4">
              <div class="stat-card p-4">
                <h4 class="font-semibold mb-2">📊 Soma Números Principais${qtdConcursos ? ` (Últimos ${qtdConcursos} concursos)` : ''}</h4>
                <p class="text-sm text-gray-400">Mín: <span class="text-[#00E38C]">${data.soma_dos_numeros.numeros_principais.min}</span></p>
                <p class="text-sm text-gray-400">Máx: <span class="text-[#00E38C]">${data.soma_dos_numeros.numeros_principais.max}</span></p>
                <p class="text-sm text-gray-400">Média: <span class="text-[#00E38C]">${data.soma_dos_numeros.numeros_principais.media}</span></p>
                <p class="text-sm text-gray-400">Moda: <span class="text-[#00E38C]">${data.soma_dos_numeros.numeros_principais.moda}</span></p>
              </div>
            </div>

            <!-- Gráfico de Amplitude - Números Principais -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">📏 Amplitude dos Números Principais${qtdConcursos ? ` (Últimos ${qtdConcursos} concursos)` : ''}</h3>
              <div id="grafico-amplitude-numeros" style="height: 400px;"></div>
            </div>

            <!-- Estatísticas de Amplitude -->
            <div class="grid grid-cols-1 gap-4">
              <div class="stat-card p-4">
                <h4 class="font-semibold mb-2">📏 Amplitude (Maior - Menor Número)</h4>
                <p class="text-sm text-gray-400">Mín: <span class="text-[#00E38C]">${data.amplitude_dos_numeros.min}</span></p>
                <p class="text-sm text-gray-400">Máx: <span class="text-[#00E38C]">${data.amplitude_dos_numeros.max}</span></p>
                <p class="text-sm text-gray-400">Média: <span class="text-[#00E38C]">${data.amplitude_dos_numeros.media}</span></p>
                <p class="text-sm text-gray-400">Moda: <span class="text-[#00E38C]">${data.amplitude_dos_numeros.moda}</span></p>
              </div>
            </div>

            <!-- SUGESTÕES PARA APOSTA PREMIUM -->
            <div class="mt-8 bg-[#2E303A] p-4 rounded-lg shadow-md">
              <h4 class="text-[#00E38C] text-xl font-semibold mb-4">🎯 Sugestões para Aposta Inteligente</h4>
              <div class="space-y-3">
                <div class="flex items-center">
                  <input type="checkbox" id="dist-priorizar-pares-impares" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="distribuicao" data-pref-name="priorizarParesImpares">
                  <label for="dist-priorizar-pares-impares" class="text-white">Priorizar Paridade (Pares/Ímpares)</label>
                  <select id="dist-paridade-desejada" class="select-premium-pref ml-auto bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" data-pref-type="distribuicao" data-pref-name="paridadeDesejada">
                    <option value="equilibrado">Equilibrada (2 pares/3 ímpares ou 3 pares/2 ímpares)</option>
                    <option value="mais_pares">Mais Pares</option>
                    <option value="mais_impares">Mais Ímpares</option>
                  </select>
                </div>
                <div class="flex items-center">
                  <input type="checkbox" id="dist-priorizar-soma" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="distribuicao" data-pref-name="priorizarSoma">
                  <label for="dist-priorizar-soma" class="text-white">Priorizar Soma dos Números</label>
                </div>
                <div class="flex items-center ml-auto">
                  <label for="dist-soma-min" class="text-gray-300 text-sm mr-2">Soma Min:</label>
                  <input type="number" id="dist-soma-min" class="w-20 bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" value="100" min="15" max="390">
                  <label for="dist-soma-max" class="text-gray-300 text-sm ml-4 mr-2">Soma Max:</label>
                  <input type="number" id="dist-soma-max" class="w-20 bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" value="200" min="15" max="390">
                </div>
              </div>
              <div class="mt-4 p-3 bg-[#1A1D25] rounded border-l-4 border-[#00E38C]">
                <p class="text-sm text-[#00E38C] font-medium">💡 Dica:</p>
                <p class="text-xs text-gray-300">Marque as opções que fazem sentido para sua estratégia. Elas serão usadas na Análise Premium.</p>
              </div>
            </div>
          </div>
        `;

        // Verificar estrutura dos dados
        console.log("Estrutura dos dados:", {
          temParidade: !!data.paridade,
          paridadeKeys: data.paridade ? Object.keys(data.paridade) : 'N/A',
          numerosPrincipais: data.paridade?.numeros_principais,
          trevos: data.paridade?.trevos
        });

        // Criar gráficos (apenas para Quina - sem trevos)
        criarGraficoParidadeNumeros(data.paridade.numeros_principais.distribuicao);
        criarGraficoSomaNumeros(data.soma_dos_numeros.numeros_principais);
        criarGraficoAmplitude(data.amplitude_dos_numeros);

        console.log("Dados de distribuição recebidos:", data);

      } catch (error) {
        console.error('Erro ao carregar análise de distribuição:', error);
        container.innerHTML = '<p class="text-center text-red-500 mt-4">Erro ao carregar a análise de distribuição. Verifique o console para detalhes.</p>';
      }
    }

    // Função para criar o Gráfico de Barras de Paridade dos Números Principais
    function criarGraficoParidadeNumeros(dataDistribuicao) {
      // Converte o objeto de distribuição em arrays para Plotly
      const labels = Object.keys(dataDistribuicao);
      const values = Object.values(dataDistribuicao);

      const data = [{
        x: labels,
        y: values,
        type: 'bar',
        marker: {
          color: labels.map(label => {
            // Cores baseadas nas combinações P/I para Quina (5 números)
            if (label.includes('5P')) return '#4CAF50'; // Mais pares
            if (label.includes('0P')) return '#F44336'; // Mais ímpares
            if (label.includes('2P-3I') || label.includes('3P-2I')) return '#2196F3'; // Equilíbrio
            return '#9C27B0'; // Outros
          })
        }
      }];

      const layout = {
        title: 'Distribuição de Paridade (Números Principais)',
        xaxis: { title: 'Combinação Par/Ímpar', automargin: true },
        yaxis: { title: 'Contagem', automargin: true },
        plot_bgcolor: '#1a1d25',
        paper_bgcolor: '#1a1d25',
        font: {
          color: '#FFFFFF'
        },
        responsive: true,
        margin: { t: 50, b: 50, l: 50, r: 20 }
      };

      Plotly.newPlot('grafico-paridade-numeros', data, layout);
    }



    // Função para criar o Gráfico de Soma dos Números Principais
    function criarGraficoSomaNumeros(dadosSoma) {
      const minSoma = dadosSoma.min;
      const maxSoma = dadosSoma.max;
      const mediaSoma = dadosSoma.media;
      const modaSoma = dadosSoma.moda;
      const somas = dadosSoma.somas; // Lista real de somas históricas

      const data = [{
        x: somas,
        type: 'histogram',
        marker: {
          color: '#8B5CF6'
        },
        xbins: {
          size: 5
        },
        opacity: 0.75,
        name: 'Contagem de Somas'
      }];

      const layout = {
        title: 'Distribuição da Soma dos 5 Números Principais',
        xaxis: { title: 'Soma dos Números', automargin: true },
        yaxis: { title: 'Frequência', automargin: true },
        plot_bgcolor: '#1a1d25',
        paper_bgcolor: '#1a1d25',
        font: {
          color: '#FFFFFF'
        },
        responsive: true,
        margin: { t: 50, b: 50, l: 50, r: 20 },
        annotations: [
          {
            xref: 'paper', yref: 'paper',
            x: 0.05, y: 0.95,
            text: `Min: ${minSoma}<br>Max: ${maxSoma}<br>Média: ${mediaSoma}<br>Moda: ${modaSoma}`,
            showarrow: false,
            align: 'left',
            font: { color: '#FFFFFF', size: 10 },
            bgcolor: 'rgba(0,0,0,0.5)',
            bordercolor: '#8B5CF6',
            borderwidth: 1,
            borderpad: 4
          }
        ]
      };

      Plotly.newPlot('grafico-soma-numeros', data, layout);
    }



    // Função para criar o Gráfico de Amplitude dos Números Principais
    function criarGraficoAmplitude(dadosAmplitude) {
      const amplitudes = dadosAmplitude.amplitudes; // Lista de todas as amplitudes
      const minAmplitude = dadosAmplitude.min;
      const maxAmplitude = dadosAmplitude.max;
      const mediaAmplitude = dadosAmplitude.media;
      const modaAmplitude = dadosAmplitude.moda;

      const data = [{
        x: amplitudes,
        type: 'histogram',
        marker: {
          color: '#00BFFF' // Um tom de azul claro
        },
        xbins: {
          size: 2 // Agrupa amplitudes em intervalos de 2, ajuste conforme necessário
        },
        opacity: 0.75,
        name: 'Contagem de Amplitudes'
      }];

      const layout = {
        title: 'Distribuição da Amplitude dos 5 Números Principais',
        xaxis: { title: 'Amplitude (Maior - Menor Número)', automargin: true },
        yaxis: { title: 'Frequência', automargin: true },
        plot_bgcolor: '#1a1d25',
        paper_bgcolor: '#1a1d25',
        font: {
          color: '#FFFFFF'
        },
        responsive: true,
        margin: { t: 50, b: 50, l: 50, r: 20 },
        annotations: [
          {
            xref: 'paper', yref: 'paper',
            x: 0.05, y: 0.95, // Posição superior esquerda
            text: `Min: ${minAmplitude}<br>Max: ${maxAmplitude}<br>Média: ${mediaAmplitude.toFixed(2)}<br>Moda: ${modaAmplitude}`,
            showarrow: false,
            align: 'left',
            font: { color: '#FFFFFF', size: 10 },
            bgcolor: 'rgba(0,0,0,0.5)',
            bordercolor: '#00BFFF',
            borderwidth: 1,
            borderpad: 4
          }
        ]
      };

      Plotly.newPlot('grafico-amplitude-numeros', data, layout);
    }
    // Carregar análise de afinidades
    async function carregarAnaliseAfinidades(container, qtdConcursos = null) {
      container.innerHTML = "🔄 Carregando análise de afinidades...";

      try {
        let url = '/api/analise_de_combinacoes-lotofacil';
        // Sempre enviar qtd_concursos, limite máximo 200 para performance
        const qtdToSend = (qtdConcursos && Number(qtdConcursos) <= 200) ? qtdConcursos : '200';
        url += `?qtd_concursos=${qtdToSend}`;

        console.log("=== REQUISIÇÃO AFINIDADES ===");
        console.log("URL:", url);
        console.log("qtdConcursos:", qtdConcursos);

        const response = await fetch(url);
        const data = await response.json();

        console.log("=== DADOS RECEBIDOS DO BACKEND ===");
        console.log("Data completo:", data);
        console.log("Afinidade entre números:", data.afinidade_entre_numeros);

        if (data.error) {
          container.innerHTML = `<p style="color: red;">Erro: ${data.error}</p>`;
          return;
        }

        const afinidades = data.afinidade_entre_numeros;
        const periodoInfo = data.periodo_analisado;

        // Debug específico da tabela
        console.log("=== DEBUG TABELA DETALHADA ===");
        console.log("Período solicitado:", qtdConcursos);
        console.log("Período analisado:", periodoInfo);
        console.log("Pares com maior afinidade:", afinidades.pares_com_maior_afinidade);
        console.log("Primeiros 5 pares:", afinidades.pares_com_maior_afinidade.slice(0, 5));
        console.log("Frequências dos primeiros 5 pares:", afinidades.pares_com_maior_afinidade.slice(0, 5).map(p => p[1]));

        // Verificar se os dados estão no formato correto
        if (!afinidades || !afinidades.pares_com_maior_afinidade || !afinidades.numeros_com_maior_afinidade_geral) {
          container.innerHTML = `<p style="color: red;">Erro: Dados de afinidade incompletos ou em formato incorreto.</p>`;
          return;
        }

        container.innerHTML = `
          <div class="space-y-6">
            <!-- Cabeçalho com título e ajuda -->
            <div class="flex justify-between items-start">
              <div class="bg-[#2E303A] p-4 rounded-xl flex-1">
                <h3 class="text-lg font-semibold mb-3 text-[#00E38C]">🎯 Janela de Análise Temporal</h3>
                <div class="flex flex-wrap gap-3 items-center">
                  <label class="text-sm text-gray-300">Período:</label>
                  <select id="janela-analise-afinidades" class="bg-[#1A1D25] text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-[#00E38C] focus:outline-none" onchange="updateAfinidadeModal()">
                    <option value="200" ${qtdConcursos === '' || !qtdConcursos || qtdConcursos === '200' ? 'selected' : ''}>Últimos 200 concursos</option>
                    <option value="25" ${qtdConcursos === '25' ? 'selected' : ''}>Últimos 25 concursos</option>
                    <option value="50" ${qtdConcursos === '50' ? 'selected' : ''}>Últimos 50 concursos</option>
                    <option value="100" ${qtdConcursos === '100' ? 'selected' : ''}>Últimos 100 concursos</option>
                    <option value="200" ${qtdConcursos === '200' ? 'selected' : ''}>Últimos 200 concursos</option>
                  </select>
                  <span class="text-xs text-gray-400">(Selecione para atualizar a análise)</span>
                </div>
              </div>
              <button onclick="abrirPopupAjudaAfinidades()" class="ml-4 bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition-colors duration-200" title="Como usar esta análise?">
                ❓
              </button>
            </div>

            <!-- Top 15 Pares com Maior Afinidade -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">🔗 Pares com Maior Afinidade (Top 15)</h3>
              <div class="grid grid-cols-5 gap-2">
                ${afinidades.pares_com_maior_afinidade.slice(0, 15).map(par =>
                  `<div class="bg-[#00E38C] text-black p-3 rounded text-center font-semibold">
                    <div class="text-lg">${par[0][0]} ↔ ${par[0][1]}</div>
                    <div class="text-xs">${par[1]} vezes</div>
                  </div>`
                ).join('')}
              </div>
            </div>

            <!-- Top 15 Números com Maior Afinidade Geral -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">⭐ Números com Maior Afinidade Geral (Top 15)</h3>
              <div class="grid grid-cols-5 gap-2">
                ${afinidades.numeros_com_maior_afinidade_geral.slice(0, 15).map(num =>
                  `<div class="bg-[#8B5CF6] text-white p-3 rounded text-center font-semibold">
                    <div class="text-lg">${num[0]}</div>
                    <div class="text-xs">${num[1]} pts</div>
                  </div>`
                ).join('')}
              </div>
            </div>

            <!-- Tabela Detalhada de Pares -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">📋 Tabela Detalhada - Pares com Maior Afinidade</h3>
              <div class="overflow-x-auto">
                <table class="w-full text-left table-auto border-collapse rounded-lg overflow-hidden">
                  <thead>
                    <tr class="bg-gray-800 text-gray-300 uppercase text-xs">
                      <th class="px-4 py-3 text-center">#</th>
                      <th class="px-4 py-3 text-center">Par</th>
                      <th class="px-4 py-3 text-center">Frequência</th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-gray-700">
                    ${afinidades.pares_com_maior_afinidade.slice(0, 25).map((par, i) => {
                      // Debug individual de cada par
                      console.log(`Par ${i + 1}:`, par, `Estrutura: [${par[0][0]}, ${par[0][1]}], Frequência: ${par[1]}`);
                      return `<tr class="${i % 2 === 0 ? 'bg-gray-800' : 'bg-gray-700'} hover:bg-gray-600">
                        <td class="px-4 py-2 text-center text-gray-300">${i + 1}</td>
                        <td class="px-4 py-2 text-center text-white font-bold">${par[0][0]} ↔ ${par[0][1]}</td>
                        <td class="px-4 py-2 text-center text-[#00E38C] font-semibold">${par[1]} vezes</td>
                      </tr>`;
                    }).join('')}
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Debug da Tabela -->
            <div class="mt-4 p-3 bg-gray-800 rounded text-xs text-gray-300">
              <strong>Debug Tabela:</strong>
              Período: ${qtdConcursos || 'Todos'},
              Total de pares: ${afinidades.pares_com_maior_afinidade.length},
              Primeiros 3 pares: ${afinidades.pares_com_maior_afinidade.slice(0, 3).map(p => `${p[0][0]}-${p[0][1]}(${p[1]})`).join(', ')}
            </div>

            <!-- Gráfico de Pares com Maior Afinidade -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">📊 Gráfico de Pares com Maior Afinidade</h3>
              <div id="grafico-pares-afinidade" style="height: 400px;"></div>
            </div>

            <!-- Gráfico de Números com Maior Afinidade Geral -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">📈 Gráfico de Afinidade Geral por Número</h3>
              <div id="grafico-afinidade-geral" style="height: 400px;"></div>
            </div>

            <!-- Gráfico de Rede de Afinidade -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">🕸️ Rede de Afinidade entre Números</h3>
              <p class="text-sm text-gray-400 mb-4">Visualize as conexões entre números. Linhas mais grossas = maior afinidade</p>

              <!-- Legenda das cores -->
              <div class="flex justify-center gap-6 mb-4 text-xs">
                <div class="flex items-center gap-2">
                  <div class="w-4 h-1 bg-[#8B5CF6]"></div>
                  <span class="text-gray-300">Baixa afinidade</span>
                </div>
                <div class="flex items-center gap-2">
                  <div class="w-4 h-1 bg-[#FFA500]"></div>
                  <span class="text-gray-300">Média afinidade</span>
                </div>
                <div class="flex items-center gap-2">
                  <div class="w-4 h-1 bg-[#00E38C]"></div>
                  <span class="text-gray-300">Alta afinidade</span>
                </div>
              </div>

              <div id="grafico-rede-afinidade" style="height: 500px;"></div>
            </div>

            <!-- Dica Estratégica -->
            <div class="mt-8 p-4 bg-blue-900 bg-opacity-30 rounded-lg text-center text-blue-300 border border-blue-800 shadow">
              <span class="font-semibold">💡 Dica Estratégica:</span> Combine números com forte afinidade e alta conexão geral para aumentar suas chances de formar grupos vencedores!
            </div>

            <!-- SUGESTÕES PARA APOSTA PREMIUM -->
            <div class="mt-8 bg-[#2E303A] p-4 rounded-lg shadow-md">
              <h4 class="text-[#00E38C] text-xl font-semibold mb-4">🎯 Sugestão para Aposta Inteligente (Afinidades)</h4>
              <div class="space-y-3">
                  <div class="flex items-center">
                      <input type="checkbox" id="afinidade-priorizar-pares-fortes" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="afinidades" data-pref-name="priorizarParesFortes">
                      <label for="afinidade-priorizar-pares-fortes" class="text-white">Priorizar Pares com Forte Afinidade</label>
                      <input type="number" id="afinidade-qtde-pares" class="ml-auto w-16 bg-[#1A1D25] border border-gray-600 text-white rounded px-2 py-1 text-sm" value="3" min="1" max="10">
                  </div>
                  <div class="flex items-center">
                      <input type="checkbox" id="afinidade-priorizar-numeros-conectados" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="afinidades" data-pref-name="priorizarNumerosConectados">
                      <label for="afinidade-priorizar-numeros-conectados" class="text-white">Priorizar Números com Alta Conexão Geral</label>
                      <input type="number" id="afinidade-qtde-numeros" class="ml-auto w-16 bg-[#1A1D25] border border-gray-600 text-white rounded px-2 py-1 text-sm" value="4" min="1" max="10">
                  </div>
                  <div class="flex items-center">
                      <input type="checkbox" id="afinidade-evitar-pares-fracos" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="afinidades" data-pref-name="evitarParesFracos">
                      <label for="afinidade-evitar-pares-fracos" class="text-white">Evitar Pares com Afinidade Fraca</label>
                  </div>
              </div>
            </div>
          </div>
        `;

        // Criar gráfico de pares com maior afinidade
        console.log("Dados de afinidade:", afinidades);
        console.log("Pares com maior afinidade:", afinidades.pares_com_maior_afinidade);
        console.log("Primeiro par:", afinidades.pares_com_maior_afinidade[0]);
        console.log("Tipo do primeiro par:", typeof afinidades.pares_com_maior_afinidade[0]);
        console.log("É array?", Array.isArray(afinidades.pares_com_maior_afinidade[0]));

        // Verificar se há dados válidos para o gráfico
        if (afinidades.pares_com_maior_afinidade && afinidades.pares_com_maior_afinidade.length > 0) {
          const paresLabels = afinidades.pares_com_maior_afinidade.slice(0, 15).map((par, index) => {
            console.log(`Par ${index}:`, par);
            // Verificar se o par tem a estrutura correta
            if (Array.isArray(par) && par.length >= 2 && Array.isArray(par[0])) {
              return `${par[0][0]}-${par[0][1]}`;
            } else if (Array.isArray(par) && par.length >= 2) {
              // Estrutura alternativa: [num1, num2, count]
              return `${par[0]}-${par[1]}`;
            } else {
              console.error("Estrutura de par inválida:", par);
              return `Erro-${index}`;
            }
          });

          const paresValues = afinidades.pares_com_maior_afinidade.slice(0, 15).map((par, index) => {
            if (Array.isArray(par) && par.length >= 2 && Array.isArray(par[0])) {
              return par[1];
            } else if (Array.isArray(par) && par.length >= 3) {
              // Estrutura alternativa: [num1, num2, count]
              return par[2];
            } else {
              console.error("Valor de par inválido:", par);
              return 0;
            }
          });

          console.log("Labels dos pares:", paresLabels);
          console.log("Valores dos pares:", paresValues);

          Plotly.newPlot('grafico-pares-afinidade', [{
            x: paresLabels,
            y: paresValues,
            type: 'bar',
            marker: { color: '#00E38C' }
          }], {
            title: 'Pares com Maior Afinidade',
            paper_bgcolor: '#1a1a1a',
            plot_bgcolor: '#1a1a1a',
            font: { color: 'white' },
            xaxis: { automargin: true },
            yaxis: { automargin: true },
            showlegend: false,
            autosize: true,
            responsive: true,
            margin: { l: 40, r: 20, t: 40, b: 40, pad: 5 }
          }, { displayModeBar: false });
        } else {
          console.error("Nenhum dado de pares encontrado");
          document.getElementById('grafico-pares-afinidade').innerHTML = '<p style="color: red; text-align: center;">Erro: Dados de pares não encontrados</p>';
        }

        // Criar gráfico de afinidade geral por número
        console.log("=== DEBUG GRÁFICO AFINIDADE GERAL ===");
        console.log("Dados de afinidade geral:", afinidades.numeros_com_maior_afinidade_geral);
        console.log("Tipo:", typeof afinidades.numeros_com_maior_afinidade_geral);
        console.log("É array?", Array.isArray(afinidades.numeros_com_maior_afinidade_geral));
        console.log("Tamanho:", afinidades.numeros_com_maior_afinidade_geral ? afinidades.numeros_com_maior_afinidade_geral.length : 'undefined');

        if (afinidades.numeros_com_maior_afinidade_geral && afinidades.numeros_com_maior_afinidade_geral.length > 0) {
          const numerosLabels = afinidades.numeros_com_maior_afinidade_geral.slice(0, 20).map(num => num[0]);
          const numerosValues = afinidades.numeros_com_maior_afinidade_geral.slice(0, 20).map(num => num[1]);

          console.log("Labels processados:", numerosLabels);
          console.log("Values processados:", numerosValues);

          Plotly.newPlot('grafico-afinidade-geral', [{
            x: numerosLabels,
            y: numerosValues,
            type: 'bar',
            marker: { color: '#8B5CF6' }
          }], {
            title: 'Afinidade Geral por Número',
            paper_bgcolor: '#1a1a1a',
            plot_bgcolor: '#1a1a1a',
            font: { color: 'white' },
            xaxis: { automargin: true },
            yaxis: { automargin: true },
            showlegend: false,
            autosize: true,
            responsive: true,
            margin: { l: 40, r: 20, t: 40, b: 40, pad: 5 }
          }, { displayModeBar: false });
        } else {
          console.error("Dados de afinidade geral não encontrados ou vazios");
          document.getElementById('grafico-afinidade-geral').innerHTML = '<p style="color: red; text-align: center;">Erro: Dados de afinidade geral não encontrados</p>';
        }

        // Criar gráfico de rede de afinidade
        console.log("=== CRIANDO GRÁFICO DE REDE ===");

        // Pegar TODOS os pares para a rede (ou usar top 30 se não houver todos_pares_afinidade)
        const todosParesRede = afinidades.todos_pares_afinidade || afinidades.pares_com_maior_afinidade;
        const topParesRede = todosParesRede.slice(0, 30); // Usar top 30 para não sobrecarregar
        console.log("Total de pares disponíveis:", todosParesRede.length);
        console.log("Pares para rede (top 30):", topParesRede.length);

        // Criar nós (números únicos)
        const numerosUnicos = new Set();
        topParesRede.forEach(par => {
          numerosUnicos.add(par[0][0]);
          numerosUnicos.add(par[0][1]);
        });

        const nodes = Array.from(numerosUnicos).map(num => ({
          id: num,
          label: num.toString(),
          // Mesmo critério da Quina: tamanho base + score/10
          size: 20 + (afinidades.numeros_com_maior_afinidade_geral.find(n => n[0] === num)?.[1] || 0) / 10
        }));

        // Criar arestas (conexões)
        const edges = topParesRede.map((par, index) => ({
          from: par[0][0],
          to: par[0][1],
          value: par[1],
          title: `${par[0][0]} ↔ ${par[0][1]}: ${par[1]} vezes`
        }));

        console.log("Nós da rede:", nodes);
        console.log("Arestas da rede:", edges);

        // Criar dados para Plotly
        const nodeX = [];
        const nodeY = [];
        const nodeText = [];
        const nodeSize = [];
        const nodeColor = [];

        // Posicionar nós em círculo
        const radius = 200;
        const centerX = 0;
        const centerY = 0;

        nodes.forEach((node, i) => {
          const angle = (i / nodes.length) * 2 * Math.PI;
          nodeX.push(centerX + radius * Math.cos(angle));
          nodeY.push(centerY + radius * Math.sin(angle));
          nodeText.push(node.label);
          nodeSize.push(node.size);
          nodeColor.push('#00E38C');
        });

        // Criar arestas
        const edgeX = [];
        const edgeY = [];
        const edgeWidth = [];
        const edgeColors = [];

        // Calcular valores mínimos e máximos para normalização
        const maxFreq = Math.max(...edges.map(e => e.value));
        const minFreq = Math.min(...edges.map(e => e.value));
        const freqRange = maxFreq - minFreq;

        console.log("=== DEBUG ESPESSURA DAS LINHAS ===");
        console.log("Frequência máxima:", maxFreq);
        console.log("Frequência mínima:", minFreq);
        console.log("Range de frequências:", freqRange);
        console.log("Primeiros 5 pares com frequências:", edges.slice(0, 5).map(e => `${e.from}-${e.to}: ${e.value}`));

        // Calcular limiares por tercis para garantir as três classes de cor
        const freqValuesSorted = edges.map(e => e.value).sort((a, b) => a - b);
        const q33Idx = Math.floor(freqValuesSorted.length * 0.33);
        const q66Idx = Math.floor(freqValuesSorted.length * 0.66);
        const thrLow = freqValuesSorted[q33Idx] ?? minFreq;
        const thrHigh = freqValuesSorted[q66Idx] ?? maxFreq;

        edges.forEach(edge => {
          const fromNode = nodes.find(n => n.id === edge.from);
          const toNode = nodes.find(n => n.id === edge.to);

          if (fromNode && toNode) {
            const fromIndex = nodes.indexOf(fromNode);
            const toIndex = nodes.indexOf(toNode);

            edgeX.push([nodeX[fromIndex], nodeX[toIndex], null]);
            edgeY.push([nodeY[fromIndex], nodeY[toIndex], null]);

            // Classificação por faixas (baixa, média, alta) com largura fixa por classe
            let color = '#8B5CF6'; // baixa (roxo)
            let width = 2;
            if (edge.value > thrHigh) { // alta (verde)
              color = '#00E38C';
              width = 8;
            } else if (edge.value > thrLow) { // média (laranja)
              color = '#FFA500';
              width = 5;
            }

            edgeWidth.push(width);
            edgeColors.push(color);

            console.log(`Par ${edge.from}-${edge.to}: Frequência=${edge.value}, Espessura=${width.toFixed(2)}, Cor=${color}`);
          }
        });

        // Criar trace das arestas
        const edgeTraces = edgeX.map((x, i) => ({
          x: x,
          y: edgeY[i],
          mode: 'lines',
          line: {
            color: edgeColors[i],
            width: edgeWidth[i],
            opacity: 0.8
          },
          hoverinfo: 'text',
          hovertext: edges[i].title,
          showlegend: false
        }));

        // Criar trace dos nós
        const nodeTrace = {
          x: nodeX,
          y: nodeY,
          mode: 'markers+text',
          type: 'scatter',
          text: nodeText,
          textposition: 'middle center',
          marker: {
            size: nodeSize,
            color: nodeColor,
            line: {
              color: '#ffffff',
              width: 2
            }
          },
          textfont: { color: '#000000', size: 11, weight: 'bold' },
          hoverinfo: 'text',
          hovertext: nodeText.map((text, i) => `Número ${text}<br>Tamanho: ${nodeSize[i].toFixed(1)}`),
          showlegend: false
        };

        // Layout do gráfico
        const layout = {
          title: `Rede de Afinidade ${qtdConcursos ? `(Últimos ${qtdConcursos} concursos)` : '(Análise completa)'}`,
          paper_bgcolor: '#1a1a1a',
          plot_bgcolor: '#1a1a1a',
          font: { color: 'white' },
          xaxis: {
            showgrid: false,
            zeroline: false,
            showticklabels: false,
            range: [-250, 250]
          },
          yaxis: {
            showgrid: false,
            zeroline: false,
            showticklabels: false,
            range: [-250, 250]
          },
          showlegend: false,
          autosize: true,
          responsive: true,
          margin: { l: 20, r: 20, t: 40, b: 20, pad: 5 }
        };

        // Plotar o gráfico
        Plotly.newPlot('grafico-rede-afinidade', [nodeTrace, ...edgeTraces], layout, { displayModeBar: false });

      } catch (error) {
        container.innerHTML = `<p style="color: red;">Erro ao carregar dados: ${error.message}</p>`;
      }
    }



    // Função para atualizar o modal quando o filtro de período é alterado
    function updateAfinidadeModal() {
      const selectElement = document.getElementById('janela-analise-afinidades');
      const selectedQtd = selectElement.value || '500'; // Default para 500 se não houver valor
      const container = document.getElementById('conteudo-modal');
      if (container) {
        carregarAnaliseAfinidades(container, selectedQtd).then(() => {
          // Salvar dados da análise de afinidades no localStorage
          const dadosAfinidades = {
            janela: selectedQtd,
            timestamp: new Date().toISOString()
          };

          armazenarAnalise('afinidades', dadosAfinidades);
          console.log('✅ Dados de afinidades salvos no localStorage');
        });
      }
    }

    // Exibe concursos que possuem blocos de consecutivos do tamanho solicitado
    async function verExemplosConsecutivos(tamanho) {
      try {
        const select = document.getElementById('janela-analise-sequencias');
        const qtd = select ? (select.value || '100') : '100';
        const resp = await fetch(`/api/lotofacil/sequencias/detalhe?tamanho=${tamanho}&qtd_concursos=${qtd}`);
        const dados = await resp.json();
        const box = document.getElementById('detalhes-consecutivos');
        if (!box) return;
        if (dados.error) {
          box.classList.remove('hidden');
          box.innerHTML = `<p class=\"text-red-400\">Erro: ${dados.error}</p>`;
          return;
        }
        const lista = (dados.detalhes || []).map(d => `Concurso ${d.concurso}: ${d.blocos.map(b => '['+b.join(', ')+']').join(' ')}`).join('<br>');
        box.classList.remove('hidden');
        box.innerHTML = `
          <h4 class=\"text-md font-semibold mb-3 text-[#00E38C]\">📜 Exemplos de sequências (${tamanho})</h4>
          <p class=\"text-sm text-gray-300\">Período analisado: últimos ${qtd} concursos</p>
          <div class=\"mt-2 text-sm text-gray-200\">${lista || 'Nenhum exemplo encontrado.'}</div>
        `;
        box.scrollIntoView({ behavior: 'smooth', block: 'start' });
      } catch (e) {
        const box = document.getElementById('detalhes-consecutivos');
        if (box) {
          box.classList.remove('hidden');
          box.innerHTML = `<p class=\"text-red-400\">Erro ao buscar exemplos: ${e.message}</p>`;
        }
      }
    }

    // Carregar análise de sequências
    async function carregarAnaliseSequencias(container, qtdConcursos = null) {
      container.innerHTML = "🔄 Carregando análise de Sequências...";

      try {
        let url = '/api/analise_padroes_sequencias-lotofacil';
        if (qtdConcursos !== null && qtdConcursos !== '') {
          url += `?qtd_concursos=${qtdConcursos}`;
        }

        console.log("=== REQUISIÇÃO SEQUÊNCIAS ===");
        console.log("URL:", url);
        console.log("qtdConcursos:", qtdConcursos);

        const response = await fetch(url);
        const data = await response.json();

        console.log("=== DADOS RECEBIDOS DO BACKEND ===");
        console.log("Data completo:", data);

        if (data.error) {
          container.innerHTML = `<p style="color: red;">Erro: ${data.error}</p>`;
          return;
        }

                    // Extrair dados da resposta da API
                    const numerosConsecutivos = data.numeros_consecutivos || {};
                    const repeticoes = data.repeticoes_entre_concursos || {};
                    const intervalos = data.intervalos_de_ausencia || {};
                    const ciclos = data.ciclos_de_retorno || {};
                    const periodoInfo = data.periodo_analisado || {};

                            console.log("=== DEBUG SEQUÊNCIAS ===");
                    console.log("Números consecutivos:", numerosConsecutivos);
                    console.log("Repetições:", repeticoes);
                    console.log("Repetições - numeros_que_mais_repetem:", repeticoes.numeros_que_mais_repetem);
                    console.log("Intervalos:", intervalos);
                    console.log("Ciclos:", ciclos);

        container.innerHTML = `
          <div class="space-y-6">
            <!-- Cabeçalho com título e ajuda -->
            <div class="flex justify-between items-start">
              <div class="bg-[#2E303A] p-4 rounded-xl flex-1">
                <h3 class="text-lg font-semibold mb-3 text-[#00E38C]">🎯 Janela de Análise Temporal</h3>
                <div class="flex flex-wrap gap-3 items-center">
                  <label class="text-sm text-gray-300">Período:</label>
                  <select id="janela-analise-sequencias" class="bg-[#1A1D25] text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-[#00E38C] focus:outline-none" onchange="updateSequenciasModal()">
                    <option value="300" ${qtdConcursos === '' || !qtdConcursos || qtdConcursos === '300' ? 'selected' : ''}>Últimos 300 concursos</option>
                    <option value="25" ${qtdConcursos === '25' ? 'selected' : ''}>Últimos 25 concursos</option>
                    <option value="50" ${qtdConcursos === '50' ? 'selected' : ''}>Últimos 50 concursos</option>
                    <option value="100" ${qtdConcursos === '100' ? 'selected' : ''}>Últimos 100 concursos</option>
                    <option value="200" ${qtdConcursos === '200' ? 'selected' : ''}>Últimos 200 concursos</option>
                  </select>
                  <span class="text-xs text-gray-400">(Selecione para atualizar a análise)</span>
                </div>
              </div>
              <button onclick="abrirPopupAjudaSequencias()" class="ml-4 bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition-colors duration-200" title="Como usar esta análise?">
                ❓
              </button>
            </div>

            <!-- Números Consecutivos -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">🔢 Números Consecutivos</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Estatísticas Gerais -->
                <div class="bg-[#2E303A] p-4 rounded-xl">
                  <h4 class="text-md font-semibold mb-3 text-[#00E38C]">📊 Estatísticas Gerais</h4>
                  <div class="space-y-2">
                    <p class="text-sm text-gray-300">Concursos com consecutivos: <span class="text-[#00E38C] font-bold">${numerosConsecutivos.total_concursos_com_consecutivos || 0}</span></p>
                    <p class="text-sm text-gray-300">Percentual: <span class="text-[#00E38C] font-bold">${numerosConsecutivos.percentual_concursos_com_consecutivos || 0}%</span></p>
                    <p class="text-sm text-gray-300">Maior sequência: <span class="text-[#00E38C] font-bold">${numerosConsecutivos.maior_sequencia_consecutiva || 0} números</span></p>
                  </div>
                </div>

                <!-- Tipos de Consecutivos -->
                <div class="bg-[#2E303A] p-4 rounded-xl">
                  <h4 class="text-md font-semibold mb-3 text-[#00E38C]">🎯 Tipos de Consecutivos</h4>
                  <div class="space-y-2">
                    ${Object.entries(numerosConsecutivos.tipos_consecutivos || {}).map(([tipo, qtd]) => {
                      const t = Number(tipo);
                      return `<p class=\"text-sm text-gray-300\">${t}: <span class=\"text-[#00E38C] font-bold\">${qtd}</span>
                        <a href=\"#\" class=\"ml-2 text-xs text-blue-400 hover:underline\" onclick=\"verExemplosConsecutivos(${t});return false;\">ver</a>
                      </p>`;
                    }).join('')}
                  </div>
                </div>
              </div>

              <!-- Detalhes de concursos por tamanho de consecutivo -->
              <div id="detalhes-consecutivos" class="mt-4 hidden bg-[#2E303A] p-4 rounded-xl"></div>

              <!-- Gráfico de Consecutivos -->
              <div class="mt-6">
                <h4 class="text-md font-semibold mb-3 text-[#00E38C]">📈 Distribuição de Consecutivos</h4>
                <div id="grafico-consecutivos" style="height: 400px;"></div>
              </div>
            </div>

            <!-- Repetições entre Concursos -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">🔄 Repetições entre Concursos</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Estatísticas de Repetições -->
                <div class="bg-[#2E303A] p-4 rounded-xl">
                  <h4 class="text-md font-semibold mb-3 text-[#00E38C]">📊 Estatísticas</h4>
                  <div class="space-y-2">
                    <p class="text-sm text-gray-300">Média de repetições: <span class="text-[#00E38C] font-bold">${repeticoes.media_repeticoes || 0}</span></p>
                    <p class="text-sm text-gray-300">Maior sequência sem repetição: <span class="text-[#00E38C] font-bold">${repeticoes.maior_sequencia_sem_repeticao || 0} concursos</span></p>
                  </div>
                </div>

                <!-- Números que Mais Repetem -->
                <div class="bg-[#2E303A] p-4 rounded-xl">
                  <h4 class="text-md font-semibold mb-3 text-[#00E38C]">🏆 Números que Mais Repetem</h4>
                  <div class="space-y-2">
                    ${Object.entries(repeticoes.numeros_que_mais_repetem || {}).slice(0, 5).map(([numero, qtd]) =>
                      `<p class="text-sm text-gray-300">Número ${numero}: <span class="text-[#00E38C] font-bold">${qtd} vezes</span></p>`
                    ).join('')}
                  </div>
                </div>
              </div>

              <!-- Gráfico de Repetições -->
              <div class="mt-6">
                <h4 class="text-md font-semibold mb-3 text-[#00E38C]">📈 Histograma de Repetições</h4>
                <div id="grafico-repeticoes" style="height: 400px;"></div>
              </div>
            </div>

            <!-- Intervalos de Ausência -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">⏰ Intervalos de Ausência</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Estatísticas de Intervalos -->
                <div class="bg-[#2E303A] p-4 rounded-xl">
                  <h4 class="text-md font-semibold mb-3 text-[#00E38C]">📊 Estatísticas</h4>
                  <div class="space-y-2">
                    <p class="text-sm text-gray-300">Intervalo médio: <span class="text-[#00E38C] font-bold">${(intervalos.intervalo_medio_geral ?? 0).toFixed(1)} concursos</span></p>
                    <p class="text-sm text-gray-300">Maior intervalo histórico: <span class="text-[#00E38C] font-bold">${intervalos.maior_intervalo_historico ?? 0} concursos</span></p>
                  </div>
                </div>

                <!-- Números Mais Ausentes -->
                <div class="bg-[#2E303A] p-4 rounded-xl">
                  <h4 class="text-md font-semibold mb-3 text-[#00E38C]">🚫 Números Mais Ausentes</h4>
                  <div class="space-y-2">
                    ${((intervalos.numeros_mais_ausentes || [])).slice(0, 10).map(([numero, atraso]) =>
                      `<p class=\"text-sm text-gray-300\">Número ${numero}: <span class=\"text-[#00E38C] font-bold\">${atraso} concursos</span></p>`
                    ).join('')}
                  </div>
                </div>
              </div>

              <!-- Gráfico de Intervalos -->
              <div class="mt-6">
                <h4 class="text-md font-semibold mb-3 text-[#00E38C]">📈 Distribuição de Intervalos</h4>
                <div id="grafico-intervalos" style="height: 400px;"></div>
              </div>
            </div>

            <!-- Ciclos de Retorno -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">🔄 Ciclos de Retorno</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Estatísticas de Ciclos -->
                <div class="bg-[#2E303A] p-4 rounded-xl">
                  <h4 class="text-md font-semibold mb-3 text-[#00E38C]">📊 Estatísticas</h4>
                  <div class="space-y-2">
                    <p class="text-sm text-gray-300">Ciclo médio: <span class="text-[#00E38C] font-bold">${(ciclos.ciclo_medio_geral ?? 0).toFixed(2)} concursos</span></p>
                    <p class="text-sm text-gray-300">Ciclo mais comum: <span id="ciclo-moda" class="text-[#00E38C] font-bold">calculando...</span> concursos</p>
                  </div>
                </div>

                <!-- Números com Ciclos Curtos -->
                <div class="bg-[#2E303A] p-4 rounded-xl">
                  <h4 class="text-md font-semibold mb-3 text-[#00E38C]">⚡ Números com Ciclos Curtos</h4>
                  <div class="space-y-2">
                    ${(ciclos.ciclos_curtos || []).slice(0, 5).map(([numero, ciclo]) =>
                      `<p class="text-sm text-gray-300">Número ${numero}: <span class="text-[#00E38C] font-bold">${ciclo.toFixed(1)} concursos</span></p>`
                    ).join('')}
                  </div>
                </div>
              </div>

              <!-- Gráfico de Ciclos -->
              <div class="mt-6">
                <h4 class="text-md font-semibold mb-3 text-[#00E38C]">📈 Distribuição de Ciclos</h4>
                <div id="grafico-ciclos" style="height: 400px;"></div>

                <!-- Legenda das Cores -->
                <div class="mt-4 flex flex-wrap gap-4 justify-center">
                  <div class="flex items-center">
                    <div class="w-4 h-4 bg-[#00E38C] rounded mr-2"></div>
                    <span class="text-sm text-gray-300">Ciclos Curtos (≤3 concursos)</span>
                  </div>
                  <div class="flex items-center">
                    <div class="w-4 h-4 bg-[#FFA500] rounded mr-2"></div>
                    <span class="text-sm text-gray-300">Ciclos Médios (4-6 concursos)</span>
                  </div>
                  <div class="flex items-center">
                    <div class="w-4 h-4 bg-[#EF4444] rounded mr-2"></div>
                    <span class="text-sm text-gray-300">Ciclos Longos (>6 concursos)</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;

        // Calcular moda de ciclos (mais frequente) e preencher no card
        try {
          const porNumero = ciclos.por_numero || {};
          const todosCiclos = Object.values(porNumero).flatMap(d => d?.ciclos || []);
          let moda = 0;
          if (todosCiclos.length) {
            const freq = {};
            for (const c of todosCiclos) freq[c] = (freq[c] || 0) + 1;
            moda = Number(Object.entries(freq).sort((a,b)=>b[1]-a[1])[0][0]);
          }
          const modaEl = document.getElementById('ciclo-moda');
          if (modaEl) modaEl.textContent = isFinite(moda) ? moda : '0';
        } catch {}

        // Criar gráficos
        criarGraficoConsecutivos(numerosConsecutivos);
        criarGraficoRepeticoes(repeticoes);
        criarGraficoIntervalos(intervalos);
        criarGraficoCiclos(ciclos);

        // Adicionar seção de sugestões após os gráficos serem criados
        setTimeout(() => {
          const containerDiv = container.querySelector('.space-y-6');
          if (containerDiv) {
            const sugestoesHtml = `
              <!-- SUGESTÕES PARA APOSTA PREMIUM -->
              <div class="mt-8 bg-[#2E303A] p-4 rounded-lg shadow-md">
                <h4 class="text-[#00E38C] text-xl font-semibold mb-4">🎯 Sugestões para Aposta Inteligente</h4>
                <div class="space-y-3">
                  <div class="flex items-center">
                    <input type="checkbox" id="sequencia-evitar-consecutivos" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="sequencias" data-pref-name="evitarConsecutivos">
                    <label for="sequencia-evitar-consecutivos" class="text-white">Evitar Números Consecutivos (ex: 23-24)</label>
                  </div>
                  <div class="flex items-center">
                    <input type="checkbox" id="sequencia-priorizar-atrasados" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="sequencias" data-pref-name="priorizarAtrasados">
                    <label for="sequencia-priorizar-atrasados" class="text-white">Priorizar Números MUITO Atrasados</label>
                    <label for="sequencia-min-atraso" class="text-gray-300 text-sm ml-auto mr-2">Mínimo de concursos sem sair:</label>
                    <input type="number" id="sequencia-min-atraso" class="w-16 bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" value="20" min="1" max="100">
                  </div>
                  <div class="flex items-center">
                    <input type="checkbox" id="sequencia-evitar-sequencias" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="sequencias" data-pref-name="evitarSequencias">
                    <label for="sequencia-evitar-sequencias" class="text-white">Evitar Sequências Específicas</label>
                  </div>
                  <div class="flex items-center">
                    <input type="checkbox" id="sequencia-evitar-repeticoes" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="sequencias" data-pref-name="evitarRepeticoesSeguidas">
                    <label for="sequencia-evitar-repeticoes" class="text-white">Evitar Números Repetidos do Último Concurso</label>
                  </div>
                </div>
                <div class="mt-4 p-3 bg-[#1A1D25] rounded border-l-4 border-[#00E38C]">
                  <p class="text-sm text-[#00E38C] font-medium">💡 Dica:</p>
                  <p class="text-xs text-gray-300">Marque as opções que fazem sentido para sua estratégia. Elas serão usadas na Análise Premium.</p>
                </div>
              </div>
            `;
            containerDiv.insertAdjacentHTML('beforeend', sugestoesHtml);
          }
        }, 500);

      } catch (error) {
        console.error("Erro ao carregar análise de sequências:", error);
        container.innerHTML = `<p style="color: red;">Erro ao carregar dados: ${error.message}</p>`;
      }
    }

    // Função para atualizar o modal de sequências quando o período é alterado
    function updateSequenciasModal() {
      const selectElement = document.getElementById('janela-analise-sequencias');
      const selectedQtd = selectElement.value;
      const container = document.getElementById('conteudo-modal');
      carregarAnaliseSequencias(container, selectedQtd).then(() => {
        // Salvar dados da análise de sequências no localStorage
        const dadosSequencias = {
          janela: selectedQtd,
          timestamp: new Date().toISOString()
        };

        armazenarAnalise('sequencias', dadosSequencias);
        console.log('✅ Dados de sequências salvos no localStorage');
      });
    }

    // Funções para criar gráficos Plotly das sequências
    function criarGraficoConsecutivos(numerosConsecutivos) {
      const tipos = Object.keys(numerosConsecutivos.tipos_consecutivos || {});
      const valores = Object.values(numerosConsecutivos.tipos_consecutivos || {});

      const data = [{
        x: tipos,
        y: valores,
        type: 'bar',
        marker: {
          color: '#00E38C',
          opacity: 0.9,
          line: {
            color: 'white',
            width: 2
          }
        },
        text: valores,
        textposition: 'auto',
        textfont: {
          color: 'white',
          size: 12,
          weight: 'bold'
        }
      }];

      const layout = {
        title: {
          text: '🔢 Distribuição de Tipos de Consecutivos',
          font: { size: 18, color: 'white' }
        },
        xaxis: {
          title: 'Tipo de Consecutivo',
          titlefont: { color: 'white' },
          tickfont: { color: 'white', size: 14 }
        },
        yaxis: {
          title: 'Quantidade',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        margin: { t: 60, b: 60, l: 60, r: 40 }
      };

      Plotly.newPlot('grafico-consecutivos', data, layout);
    }

    function criarGraficoRepeticoes(repeticoes) {
      // Os dados vêm como objeto {numero: valor}, então precisamos converter para arrays
      const dados = repeticoes.numeros_que_mais_repetem || {};
      const numeros = Object.keys(dados).slice(0, 10);
      const valores = Object.values(dados).slice(0, 10);

      console.log("=== DEBUG GRÁFICO REPETIÇÕES ===");
      console.log("Dados brutos:", dados);
      console.log("Números:", numeros);
      console.log("Valores:", valores);
      console.log("Tipo dos números:", typeof numeros[0]);
      console.log("Primeiros 5 números:", numeros.slice(0, 5));
      console.log("Range dos números:", Math.min(...numeros.map(Number)), "a", Math.max(...numeros.map(Number)));
      console.log("Números como strings:", numeros.map(n => String(n)));

      const data = [{
        x: numeros.map(n => String(n)),  // Força conversão para string
        y: valores,
        type: 'bar',
        marker: {
          color: '#8B5CF6',
          opacity: 0.9,
          line: {
            color: 'white',
            width: 2
          }
        },
        text: valores,
        textposition: 'auto',
        textfont: {
          color: 'white',
          size: 12,
          weight: 'bold'
        }
      }];

      const layout = {
        title: {
          text: '🔄 Números que Mais Repetem',
          font: { size: 18, color: 'white' }
        },
        xaxis: {
          title: 'Número',
          titlefont: { color: 'white' },
          tickfont: { color: 'white', size: 14 },
          type: 'category',  // Força o eixo X a ser categórico
          tickmode: 'array',
          tickvals: numeros,  // Define explicitamente os valores do eixo X
          ticktext: numeros.map(n => `Nº ${n}`)  // Formata os labels
        },
        yaxis: {
          title: 'Quantidade de Repetições',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        margin: { t: 60, b: 60, l: 60, r: 40 }
      };

      Plotly.newPlot('grafico-repeticoes', data, layout);
    }

    function criarGraficoIntervalos(intervalos) {
      // Os dados vêm como array de tuplas [[numero, valor], ...]
      const dados = intervalos.numeros_mais_ausentes || [];
      const numeros = dados.slice(0, 10).map(item => item[0]);
      const valores = dados.slice(0, 10).map(item => item[1]);

      const data = [{
        x: numeros,
        y: valores,
        type: 'bar',
        marker: {
          color: '#F59E0B',
          opacity: 0.9,
          line: {
            color: 'white',
            width: 2
          }
        },
        text: valores,
        textposition: 'auto',
        textfont: {
          color: 'white',
          size: 12,
          weight: 'bold'
        }
      }];

      const layout = {
        title: {
          text: '⏰ Números Mais Ausentes',
          font: { size: 18, color: 'white' }
        },
        xaxis: {
          title: 'Número',
          titlefont: { color: 'white' },
          tickfont: { color: 'white', size: 14 }
        },
        yaxis: {
          title: 'Concursos sem Sair',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        margin: { t: 60, b: 60, l: 60, r: 40 }
      };

      Plotly.newPlot('grafico-intervalos', data, layout);
    }

    function criarGraficoCiclos(ciclos) {
      // Obter dados de ciclos médios para todos os números
      const por_numero = ciclos.por_numero || {};

      // Criar array completo de 1 a 25
      const numeros = [];
      const valores = [];
      const cores = [];

      for (let i = 1; i <= 25; i++) {
        numeros.push(i);
        const dados_numero = por_numero[i] || {};
        const ciclo_medio = dados_numero.ciclo_medio || 0;
        valores.push(ciclo_medio);

        // Classificar por cor baseado no ciclo
        if (ciclo_medio <= 3) {
          cores.push('#00E38C'); // Verde - Ciclos curtos
        } else if (ciclo_medio <= 6) {
          cores.push('#FFA500'); // Laranja - Ciclos médios
        } else {
          cores.push('#EF4444'); // Vermelho - Ciclos longos
        }
      }

      console.log("=== DEBUG GRÁFICO CICLOS ===");
      console.log("Números:", numeros);
      console.log("Valores:", valores);
      console.log("Cores:", cores);

      const data = [{
        x: numeros,
        y: valores,
        type: 'bar',
        marker: {
          color: cores,
          opacity: 0.9,
          line: {
            color: 'white',
            width: 1
          }
        },
        text: valores.map(v => v.toFixed(1)),
        textposition: 'auto',
        textfont: {
          color: 'white',
          size: 10,
          weight: 'bold'
        }
      }];

      const layout = {
        title: {
          text: '🔄 Números de Ciclos',
          font: { size: 18, color: 'white' }
        },
        xaxis: {
          title: 'Número',
          titlefont: { color: 'white' },
          tickfont: { color: 'white', size: 14 },
          type: 'category',
          tickmode: 'array',
          tickvals: numeros,  // Define explicitamente os valores do eixo X
          ticktext: numeros,  // Mostra apenas os números
          range: [0, 26]
        },
        yaxis: {
          title: 'Ciclo Médio (concursos)',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        margin: { t: 60, b: 60, l: 60, r: 40 }
      };

      Plotly.newPlot('grafico-ciclos', data, layout);
    }



        // Carregar análise de seca
    async function carregarAnaliseSeca(container, qtdConcursos = null) {
      container.innerHTML = `<p class="text-center text-gray-400">🔄 Carregando análise de seca...</p>`;

        try {
          let url = '/api/analise_seca_lotofacil';
          if (qtdConcursos !== null && qtdConcursos !== '') {
            url += `?qtd_concursos=${qtdConcursos}`;
          }

          const response = await fetch(url);
          const data = await response.json();

        if (data.error) {
          container.innerHTML = `<p class="text-red-500 text-center">Erro: ${data.error}</p>`;
          return;
        }

        const numerosSeca = data.numeros_seca;

        if (!numerosSeca) {
          container.innerHTML = `<p class="text-red-500 text-center">Dados de seca incompletos ou não encontrados.</p>`;
          return;
        }

        // Preparar dados para exibição
        const maiorSecaNumeros = numerosSeca.numeros_maior_seca && numerosSeca.numeros_maior_seca.length > 0
          ? `${numerosSeca.numeros_maior_seca[0][0]} (${numerosSeca.numeros_maior_seca[0][1].seca_atual} concursos)`
          : 'N/A';

        const recentesNumeros = numerosSeca.numeros_recentes && numerosSeca.numeros_recentes.length > 0
          ? numerosSeca.numeros_recentes.slice(0, 3).join(', ')
          : 'N/A';



        // Criar HTML completo para o modal genérico
        container.innerHTML = `
          <div class="space-y-6">
            <!-- Explicação -->
            <div class="bg-gray-800 p-4 rounded-lg border-l-4 border-[#00E38C]">
              <h3 class="text-xl font-semibold text-[#00E38C] mb-2">Entendendo a Análise de Seca 🌵</h3>
              <p class="text-gray-300 mb-2">
                A análise de seca identifica há quantos concursos um determinado número não é sorteado.
              </p>
              <p class="text-gray-300">
                <span class="font-bold text-red-400">"Maior Seca"</span> indica os que estão há mais tempo sem aparecer.
                <span class="font-bold text-green-400">"Recentemente Sorteados"</span> são os que saíram nos últimos concursos.
              </p>
            </div>

            <!-- Cabeçalho com título e ajuda -->
            <div class="flex justify-between items-start">
              <div class="bg-[#2E303A] p-4 rounded-xl flex-1">
                <h3 class="text-lg font-semibold mb-3 text-[#00E38C]">🎯 Janela de Análise Temporal</h3>
                <div class="flex flex-wrap gap-3 items-center">
                  <label class="text-sm text-gray-300">Período:</label>
                  <select id="selectSecaPeriodo" class="bg-[#1A1D25] text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-[#00E38C] focus:outline-none" onchange="updateSecaModal()">
                    <option value="300" ${qtdConcursos === '' || !qtdConcursos || qtdConcursos === '300' ? 'selected' : ''}>Últimos 300 concursos</option>
                    <option value="25" ${qtdConcursos === '25' ? 'selected' : ''}>Últimos 25 concursos</option>
                    <option value="50" ${qtdConcursos === '50' ? 'selected' : ''}>Últimos 50 concursos</option>
                    <option value="100" ${qtdConcursos === '100' ? 'selected' : ''}>Últimos 100 concursos</option>
                    <option value="200" ${qtdConcursos === '200' ? 'selected' : ''}>Últimos 200 concursos</option>
                  </select>
                  <span class="text-xs text-gray-400">(Selecione para atualizar a análise)</span>
                </div>
                <div class="mt-2 text-xs text-gray-400" id="secaPeriodoDisplay">
                  ${qtdConcursos ? `Análise dos últimos ${qtdConcursos} concursos.` : 'Análise dos últimos 300 concursos.'}
                </div>
              </div>
              <button onclick="abrirPopupAjudaSeca()" class="ml-4 bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition-colors duration-200" title="Como usar esta análise?">
                ❓
              </button>
            </div>

            <!-- Números da Lotofácil -->
            <div class="grid grid-cols-1 gap-6">
              <!-- Números -->
              <div class="bg-gray-800 p-4 rounded-lg shadow">
                <h3 class="text-xl font-semibold text-[#00E38C] mb-4 text-center">Números da Lotofácil (1-25)</h3>
                <div class="text-gray-300 mb-4">
                  <p class="mb-2"><strong>Em Maior Seca:</strong> <span class="font-bold text-lg text-red-400">${maiorSecaNumeros}</span></p>
                  <p class="mb-2"><strong>Recentemente Sorteados:</strong> <span class="font-bold text-lg text-green-400">${recentesNumeros}</span></p>
                  <div class="mb-2">
                    <strong>Estatísticas:</strong>
                    <ul class="list-disc list-inside ml-4 text-sm">
                      <li>Média de seca: ${numerosSeca.estatisticas?.seca_media || 'N/A'} concursos</li>
                      <li>Maior seca: ${numerosSeca.estatisticas?.seca_maxima || 'N/A'} concursos</li>
                      <li>Menor seca: ${numerosSeca.estatisticas?.seca_mediana || 'N/A'} concursos</li>
                    </ul>
                  </div>
                </div>
                <div id="graficoSecaNumeros" class="w-full h-80 bg-gray-700 rounded"></div>
              </div>


            </div>

            <!-- Interpretação -->
            <div class="bg-gray-800 p-4 rounded-lg border-l-4 border-[#8B5CF6]">
              <h3 class="text-xl font-semibold text-[#8B5CF6] mb-2">Interpretação dos Gráficos de Seca 📊</h3>
              <ul class="list-disc list-inside text-gray-300 ml-4">
                <li><strong>Eixo X:</strong> Números da Lotofácil (1-25).</li>
                <li><strong>Eixo Y:</strong> Concursos em que estão sem sair.</li>
                <li><strong>Barras altas:</strong> Maior tempo de seca.</li>
                <li><strong>Barras baixas:</strong> Sorteados recentemente.</li>
              </ul>
            </div>

            <!-- Estratégias -->
            <div class="bg-gray-800 p-4 rounded-lg border-l-4 border-green-400">
              <h3 class="text-xl font-semibold text-green-400 mb-2">Estratégias com a Seca ✅</h3>
              <ul class="list-disc list-inside text-gray-300 ml-4">
                <li><strong>Atrasados:</strong> Apostar nos que estão em seca.</li>
                <li><strong>Recentes:</strong> Apostar nos que saíram há pouco.</li>
                <li><strong>Misto:</strong> Combinar os dois.</li>
                <li><strong>Aleatoriedade:</strong> Não é garantia. Combine com frequência.</li>
              </ul>
            </div>

            <!-- Alerta Final -->
            <div class="mt-8 text-center text-gray-400">
              <p>⚠️ <strong>Importante:</strong> Esta é uma análise estatística histórica. Não garante resultados futuros. Aposte com responsabilidade.</p>
            </div>

            <!-- SUGESTÕES PARA APOSTA PREMIUM -->
            <div class="mt-8 bg-[#2E303A] p-4 rounded-lg shadow-md">
              <h4 class="text-[#00E38C] text-xl font-semibold mb-4">🎯 Sugestões para Aposta Inteligente</h4>
              <div class="space-y-3">
                <div class="flex items-center">
                  <input type="checkbox" id="padrao-evitar-consecutivos" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="padroes" data-pref-name="evitarConsecutivos">
                  <label for="padrao-evitar-consecutivos" class="text-white">Evitar Números Consecutivos (ex: 23-24)</label>
                </div>
                <div class="flex items-center">
                  <input type="checkbox" id="padrao-priorizar-atrasados" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="padroes" data-pref-name="priorizarAtrasados">
                  <label for="padrao-priorizar-atrasados" class="text-white">Priorizar Números MUITO Atrasados</label>
                  <label for="padrao-min-atraso" class="text-gray-300 text-sm ml-auto mr-2">Mínimo de concursos sem sair:</label>
                  <input type="number" id="padrao-min-atraso" class="w-16 bg-[#1A1D25] border border-[#3E404A] text-white rounded px-2 py-1 text-sm" value="20" min="1" max="100">
                </div>
                <div class="flex items-center">
                  <input type="checkbox" id="padrao-evitar-repeticoes-seguidas" class="checkbox-premium-pref form-checkbox h-5 w-5 text-[#00E38C] rounded mr-2" data-pref-type="padroes" data-pref-name="evitarRepeticoesSeguidas">
                  <label for="padrao-evitar-repeticoes-seguidas" class="text-white">Evitar Números Repetidos do Último Concurso</label>
                </div>
              </div>
              <div class="mt-4 p-3 bg-[#1A1D25] rounded border-l-4 border-[#00E38C]">
                <p class="text-sm text-[#00E38C] font-medium">💡 Dica:</p>
                <p class="text-xs text-gray-300">Marque as opções que fazem sentido para sua estratégia. Elas serão usadas na Análise Premium.</p>
              </div>
            </div>
          </div>
        `;

        // Criar gráficos após o HTML ser inserido
        setTimeout(() => {
          plotGraficoSecaNumeros(numerosSeca);
        }, 100);

      } catch (error) {
        console.error('❌ Erro ao carregar dados de seca:', error);
        console.error('❌ Stack trace:', error.stack);
        if (container) {
          container.innerHTML = `<p class="text-red-500 text-center">Erro ao carregar dados: ${error.message}. Verifique a conexão com o servidor.</p>`;
        } else {
          // Atualizar elementos do modal diretamente
          const secaNumerosMaior = document.getElementById('secaNumerosMaior');
          const secaNumerosRecentes = document.getElementById('secaNumerosRecentes');
          const secaTrevosMaior = document.getElementById('secaTrevosMaior');
          const secaTrevosRecentes = document.getElementById('secaTrevosRecentes');

          if (secaNumerosMaior) secaNumerosMaior.textContent = `Erro: ${error.message}`;
          if (secaNumerosRecentes) secaNumerosRecentes.textContent = `Erro: ${error.message}`;
          if (secaTrevosMaior) secaTrevosMaior.textContent = `Erro: ${error.message}`;
          if (secaTrevosRecentes) secaTrevosRecentes.textContent = `Erro: ${error.message}`;
        }
      }
    }



    // Função para atualizar o modal quando o filtro de período é alterado
    function updateSecaModal() {
      const selectElement = document.getElementById('selectSecaPeriodo');
      const selectedQtd = selectElement.value;

      // Carregar dados no modal genérico
      const conteudo = document.getElementById('conteudo-modal');
      if (conteudo) {
        carregarAnaliseSeca(conteudo, selectedQtd).then(() => {
          // Salvar dados da análise de seca no localStorage
          const dadosSeca = {
            janela: selectedQtd,
            timestamp: new Date().toISOString()
          };

          armazenarAnalise('seca', dadosSeca);
          console.log('✅ Dados de seca salvos no localStorage');
        });
      }
    }

    // Função para abrir popup de ajuda da análise de seca
    function abrirPopupAjudaSeca() {
      document.getElementById("popupAjudaSeca").style.display = "block";
    }

    function fecharPopupAjudaSeca() {
      document.getElementById("popupAjudaSeca").style.display = "none";
    }

    // Função para criar gráfico de seca dos números principais
    function plotGraficoSecaNumeros(numerosSeca) {
      if (!numerosSeca || !numerosSeca.seca_por_numero) {
        console.error('Dados de seca dos números não disponíveis');
        return;
      }

      // Converter seca_por_numero em arrays para o gráfico
      const secaPorNumero = numerosSeca.seca_por_numero;

      // Garantir que todos os números de 1-25 estejam presentes
      const labels = [];
      const valores = [];

      for (let i = 1; i <= 25; i++) {
        labels.push(i);
        if (secaPorNumero[i]) {
          valores.push(secaPorNumero[i].seca_atual);
        } else {
          valores.push(0); // Se não encontrado, assume seca 0
        }
      }

      // Cores baseadas na seca (vermelho para maior seca, verde para menor)
      const cores = valores.map(valor => {
        const maxSeca = Math.max(...valores);
        const minSeca = Math.min(...valores);
        const normalized = (valor - minSeca) / (maxSeca - minSeca);

        if (normalized > 0.8) return '#EF4444'; // Vermelho (maior seca)
        if (normalized > 0.6) return '#F97316'; // Laranja
        if (normalized > 0.4) return '#EAB308'; // Amarelo
        if (normalized > 0.2) return '#22C55E'; // Verde claro
        return '#00E38C'; // Verde (menor seca)
      });

      const data = [{
        x: labels,
        y: valores,
        type: 'bar',
        marker: {
          color: cores,
          opacity: 0.9,
          line: {
            color: 'white',
            width: 1
          }
        },
        text: valores.map(val => `${val} concursos`),
        textposition: 'auto',
        textfont: {
          color: 'white',
          size: 10,
          weight: 'bold'
        },
        hovertemplate: '<b>Número %{x}</b><br>Em seca há: %{y} concursos<extra></extra>'
      }];

      const layout = {
        title: {
          text: '🌵 Seca dos Números da Lotofácil (1-25)',
          font: { size: 18, color: 'white' }
        },
        xaxis: {
          title: 'Número',
          titlefont: { color: 'white' },
          tickfont: { color: 'white', size: 12 },
          tickmode: 'linear',
          tick0: 1,
          dtick: 5,
          range: [0, 26]
        },
        yaxis: {
          title: 'Concursos em Seca',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        margin: { l: 80, r: 30, t: 80, b: 80, pad: 5 },
        annotations: [{
          text: 'Barras vermelhas = maior seca | Barras verdes = menor seca',
          showarrow: false,
          xref: 'paper',
          yref: 'paper',
          x: 0.5,
          y: -0.15,
          font: { color: 'gray', size: 12 }
        }]
      };

      Plotly.newPlot('graficoSecaNumeros', data, layout, {
        displayModeBar: false,
        responsive: true
      });
    }



    // Carregar análise de estatísticas avançadas
    async function carregarAnaliseEstatisticasAvancadas(container, qtdConcursos = null) {
      console.log('🚀 Iniciando carregamento de estatísticas avançadas...');
      container.innerHTML = "🔄 Carregando análise de estatísticas avançadas...";

      try {
        // Construir URL com parâmetro de concursos se fornecido
        let url = '/api/estatisticas_avancadas_lotofacil';
        if (qtdConcursos) {
          url += `?qtd_concursos=${qtdConcursos}`;
        }

        console.log('📡 Fazendo requisição para:', url);

        const response = await fetch(url);
        console.log('📥 Resposta recebida:', response.status, response.statusText);

        const data = await response.json();
        console.log('📊 Dados recebidos:', data);
        console.log('🔍 Distribuição de números:', data.distribuicao_numeros);
        console.log('🔍 Tipo da distribuição:', typeof data.distribuicao_numeros);
        console.log('🔍 É lista?', Array.isArray(data.distribuicao_numeros));

        if (data.error) {
          container.innerHTML = `<p style="color: red;">Erro: ${data.error}</p>`;
          return;
        }

        // Extrair dados das estatísticas
        const testeAleatoriedade = data.teste_aleatoriedade || {};
        const desvioPadrao = data.desvio_padrao_distribuicao || {};
        const clusters = data.analise_clusters || {};
        const correlacao = data.analise_correlacao_numeros || {};
        const probabilidades = data.probabilidades_condicionais || {};

        container.innerHTML = `
          <div class="space-y-6">
            <!-- Cabeçalho com título e ajuda -->
            <div class="flex justify-between items-start">
              <div class="bg-[#2E303A] p-4 rounded-xl flex-1">
                <h3 class="text-lg font-semibold mb-3 text-[#00E38C]">🎯 Janela de Análise Temporal</h3>
                <div class="flex flex-wrap gap-3 items-center">
                  <label class="text-sm text-gray-300">Período:</label>
                  <select id="selectEstatisticasAvancadasPeriodo" class="bg-[#1A1D25] text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-[#00E38C] focus:outline-none" onchange="updateEstatisticasAvancadasModal()">
                    <option value="300" ${qtdConcursos === '' || !qtdConcursos || qtdConcursos === '300' ? 'selected' : ''}>Últimos 300 concursos</option>
                    <option value="10" ${qtdConcursos === '10' ? 'selected' : ''}>Últimos 10 concursos</option>
                    <option value="25" ${qtdConcursos === '25' ? 'selected' : ''}>Últimos 25 concursos</option>
                    <option value="50" ${qtdConcursos === '50' ? 'selected' : ''}>Últimos 50 concursos</option>
                    <option value="100" ${qtdConcursos === '100' ? 'selected' : ''}>Últimos 100 concursos</option>
                    <option value="200" ${qtdConcursos === '200' ? 'selected' : ''}>Últimos 200 concursos</option>
                  </select>
                  <span class="text-xs text-gray-400">(Selecione para atualizar a análise)</span>
                </div>
                <div class="mt-2 text-xs text-gray-400" id="estatisticasAvancadasPeriodoDisplay">
                  ${qtdConcursos ? `Análise dos últimos ${qtdConcursos} concursos.` : 'Análise dos últimos 300 concursos.'}
                </div>
              </div>
              <button onclick="abrirPopupAjudaEstatisticasAvancadas()" class="ml-4 bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition-colors duration-200" title="Como usar esta análise?">
                ❓
              </button>
            </div>

            <!-- Estatísticas Principais -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="stat-card p-4">
                <h4 class="font-semibold mb-2">🎲 Teste de Aleatoriedade${qtdConcursos ? ` (Últimos ${qtdConcursos} concursos)` : ''}</h4>
                <p class="text-lg font-bold text-[#00E38C]">${testeAleatoriedade.teste_chi_quadrado?.interpretacao || 'N/A'}</p>
                <p class="text-sm text-gray-400">P-valor: ${testeAleatoriedade.teste_chi_quadrado?.p_value?.toFixed(4) || 'N/A'}</p>
                <p class="text-sm text-gray-400">Chi²: ${testeAleatoriedade.teste_chi_quadrado?.chi2?.toFixed(4) || 'N/A'}</p>
              </div>
              <div class="stat-card p-4">
                <h4 class="font-semibold mb-2">📊 Desvio Padrão da Distribuição${qtdConcursos ? ` (Últimos ${qtdConcursos} concursos)` : ''}</h4>
                <p class="text-lg font-bold text-[#00E38C]">${desvioPadrao.estatisticas_gerais?.desvio_padrao?.toFixed(2) || 'N/A'}</p>
                <p class="text-sm text-gray-400">Coeficiente: ${desvioPadrao.estatisticas_gerais?.coeficiente_variacao?.toFixed(2) || 'N/A'}%</p>
                <p class="text-sm text-gray-400">Média: ${desvioPadrao.estatisticas_gerais?.media_frequencia?.toFixed(2) || 'N/A'}</p>
              </div>
            </div>

            <!-- Gráfico de Distribuição -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">📊 Distribuição de Frequência dos Números${qtdConcursos ? ` (Últimos ${qtdConcursos} concursos)` : ''}</h3>

              <!-- Controles de Ordenação -->
              <div class="flex justify-center items-center mb-4 gap-4">
                <span class="text-gray-300 text-sm">Ordenar por:</span>
                <button id="btn-ordenar-numerica" class="px-4 py-2 rounded-lg bg-[#00E38C] text-black font-semibold hover:opacity-80 transition-all">
                  🔢 Ordem Numérica
                </button>
                <button id="btn-ordenar-frequencia" class="px-4 py-2 rounded-lg bg-[#2E303A] text-white hover:bg-[#3E404A] transition-all">
                  📊 Por Frequência
                </button>
              </div>

              <!-- Estatísticas Rápidas -->
              <div class="text-center text-xs text-gray-400 mb-2">
                <span id="stats-distribuicao">
                  Total: <span id="total-numeros">0</span> |
                  Média: <span id="media-frequencia">0</span> |
                  Máximo: <span id="max-frequencia">0</span>
                </span>
              </div>

              <div id="grafico-estatisticas-distribuicao" style="height: 400px;"></div>
            </div>

            <!-- Gráficos -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="chart-container">
                <h3 class="text-lg font-semibold mb-4">🔗 Análise de Clusters${qtdConcursos ? ` (Últimos ${qtdConcursos} concursos)` : ''}</h3>
                <div id="grafico-estatisticas-clusters" style="height: 400px;"></div>
              </div>
              <div class="chart-container">
                <h3 class="text-lg font-semibold mb-4">📈 Correlação entre Números${qtdConcursos ? ` (Últimos ${qtdConcursos} concursos)` : ''}</h3>
                <div id="grafico-estatisticas-correlacao" style="height: 400px;"></div>
              </div>
            </div>

            <!-- Interpretação dos Clusters -->
            <div class="mt-8">
              <h4 class="text-primary text-xl font-semibold mb-4 text-center">📊 Interpretação dos Grupos de Números</h4>
              <div id="interpretacao-clusters" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                <p class="text-textSecondary text-center col-span-full">Carregando detalhes dos clusters...</p>
              </div>
            </div>

            <!-- Probabilidades Condicionais -->
            <div class="chart-container">
              <h3 class="text-lg font-semibold mb-4">🎯 Probabilidades Condicionais${qtdConcursos ? ` (Últimos ${qtdConcursos} concursos)` : ''}</h3>
              <div id="grafico-estatisticas-probabilidades" style="height: 400px;"></div>
            </div>

            <!-- Interpretação -->
            <div class="bg-gray-800 p-4 rounded-lg border-l-4 border-[#8B5CF6]">
              <h3 class="text-xl font-semibold text-[#8B5CF6] mb-2">Interpretação das Estatísticas Avançadas 📊</h3>

              <div class="mb-4">
                <h4 class="text-lg font-semibold text-[#8B5CF6] mb-2">🧪 Teste de Aleatoriedade</h4>
                <p class="text-gray-300 mb-3">
                  Esse teste verifica se os sorteios seguem um padrão realmente aleatório ou se apresentam algum tipo de regularidade estatística.
                </p>
                <p class="text-gray-300 mb-3">
                  Ele usa um p-valor (probabilidade) para indicar o grau de aleatoriedade dos resultados:
                </p>
                <ul class="list-disc list-inside text-gray-300 ml-4 mb-3">
                  <li><strong>p < 0.05:</strong> Sugere que há padrões não aleatórios, ou seja, comportamentos que se repetem mais do que o acaso explicaria.</li>
                  <li><strong>p > 0.05:</strong> Indica que os resultados são compatíveis com sorteios aleatórios.</li>
                  <li><strong>Quanto mais próximo de 1.0,</strong> maior a evidência de que os resultados seguem o acaso puro.</li>
                </ul>
                <p class="text-gray-300 italic">
                  🔍 Em outras palavras, esse teste ajuda a descobrir se há algum "sinal escondido" nos sorteios, ou se tudo está mesmo no reino da sorte e do acaso.
                </p>
              </div>

              <div class="border-t border-gray-600 pt-4">
                <h4 class="text-lg font-semibold text-[#8B5CF6] mb-2">Outras Análises:</h4>
                <ul class="list-disc list-inside text-gray-300 ml-4">
                  <li><strong>Desvio Padrão:</strong> Mede a dispersão dos números sorteados.</li>
                  <li><strong>Clusters:</strong> Identifica grupos de números que aparecem juntos.</li>
                  <li><strong>Correlação:</strong> Mostra relações entre diferentes números.</li>
                  <li><strong>Probabilidades Condicionais:</strong> Probabilidade de um número sair dado que outro saiu.</li>
                </ul>
              </div>
            </div>

            <!-- Estratégias -->
            <div class="bg-gray-800 p-4 rounded-lg border-l-4 border-green-400">
              <h3 class="text-xl font-semibold text-green-400 mb-2">Estratégias com Estatísticas Avançadas ✅</h3>
              <ul class="list-disc list-inside text-gray-300 ml-4">
                <li><strong>Aleatoriedade:</strong> Se confirmada, use estratégias balanceadas.</li>
                <li><strong>Clusters:</strong> Evite ou explore grupos de números relacionados.</li>
                <li><strong>Correlações:</strong> Use pares de números que se relacionam.</li>
                <li><strong>Probabilidades:</strong> Aproveite as relações condicionais.</li>
                <li><strong>Combinação:</strong> Integre com análises de frequência e seca.</li>
              </ul>
            </div>

            <!-- Alerta Final -->
            <div class="mt-8 text-center text-gray-400">
              <p>⚠️ <strong>Importante:</strong> Esta é uma análise estatística avançada. Não garante resultados futuros. Aposte com responsabilidade.</p>
            </div>

            <!-- SUGESTÕES PARA APOSTA PREMIUM -->
            <div class="mt-8 bg-[#2E303A] p-4 rounded-lg shadow-md">
              <h4 class="text-[#00E38C] text-xl font-semibold mb-4">🎯 Sugestões para Aposta Inteligente (Clusters)</h4>
              <p class="text-gray-300 text-sm mb-3">Selecione os clusters cujos números você deseja priorizar:</p>
              <div id="avancada-opcoes-clusters" class="grid grid-cols-2 gap-2 text-white">
                <p class="col-span-2 text-gray-300">Carregando opções de clusters...</p>
              </div>
            </div>
          </div>
        `;

        // Armazenar dados da distribuição globalmente para os controles de ordenação
        window.ultimaDistribuicaoNumeros = data.distribuicao_numeros;
        window.ultimoPeriodoEstatisticas = qtdConcursos;
        console.log('🔍 Dados armazenados globalmente:', {
          distribuicao: window.ultimaDistribuicaoNumeros,
          periodo: window.ultimoPeriodoEstatisticas
        });

        // Armazenar dados dos clusters globalmente para as preferências premium
        window.analiseResultados = {
            avancada: {
                clusters: clusters
            }
        };

        // SALVAR PREFERÊNCIAS DO PASSO 6 (ESTATÍSTICAS AVANÇADAS) - LOTOFÁCIL
        window.userPremiumPreferencesLF = window.userPremiumPreferencesLF || {};

        // Salvar preferências de padrões baseadas na análise de seca
        window.userPremiumPreferencesLF.padroes = {
            priorizarAtrasados: true,
            minAtraso: 15, // Valor padrão para Lotofácil
            evitarConsecutivos: true,
            evitarRepeticoesSeguidas: true
        };

        // Salvar dados de clusters para uso no modal premium
        if (clusters && clusters.resumo_clusters) {
            // Os clusters serão selecionados pelo usuário via checkboxes
            window.userPremiumPreferencesLF.clusters = [];
        }

        // Salvar no localStorage (Lotofácil)
        if (typeof savePremiumPreferencesLF === 'function') {
            savePremiumPreferencesLF();
        }

        // Debug: verificar se os dados estão sendo armazenados corretamente
        console.log('Dados dos clusters armazenados (LF):', window.analiseResultados.avancada.clusters);
        console.log('Resumo dos clusters (LF):', window.analiseResultados.avancada.clusters?.resumo_clusters);
        console.log('Preferências salvas (LF):', window.userPremiumPreferencesLF);

        // Criar gráficos após o HTML ser inserido
        setTimeout(() => {
          plotGraficoEstatisticasDistribuicao(data.distribuicao_numeros, 'numerica', qtdConcursos);
          plotGraficoEstatisticasClusters(clusters, qtdConcursos);
          plotGraficoEstatisticasCorrelacao(correlacao, qtdConcursos);
          plotGraficoEstatisticasProbabilidades(probabilidades, qtdConcursos);

          // Adicionar logs para debug
          console.log("🔍 Dados de correlação para gráfico:", correlacao);
          console.log("🔍 Container do gráfico existe:", !!document.getElementById('grafico-estatisticas-correlacao'));

          // Configurar event listeners para os botões de ordenação
          configurarControlesOrdenacao();

          // Renderizar checkboxes de clusters para as preferências premium
          if (typeof renderClusterCheckboxes === 'function') {
            renderClusterCheckboxes();
          }
        }, 100);

        // Fallback: tentar renderizar os checkboxes de clusters quando a função for carregada
        (function tentarRenderClusters(maxTentativas = 20) {
          let tentativas = 0;
          const timer = setInterval(() => {
            const pronto = typeof renderClusterCheckboxes === 'function' &&
              window.analiseResultados &&
              window.analiseResultados.avancada &&
              window.analiseResultados.avancada.clusters &&
              window.analiseResultados.avancada.clusters.resumo_clusters;
            if (pronto) {
              try { renderClusterCheckboxes(); } catch (_) {}
              clearInterval(timer);
            }
            tentativas++;
            if (tentativas >= maxTentativas) {
              clearInterval(timer);
            }
          }, 200);
        })();

        // Fallback: define uma versão local do renderClusterCheckboxes caso o JS global não carregue
        if (typeof window.renderClusterCheckboxes !== 'function') {
          window.renderClusterCheckboxes = function() {
            const opcoesDiv = document.getElementById('avancada-opcoes-clusters');
            const dados = window.analiseResultados && window.analiseResultados.avancada && window.analiseResultados.avancada.clusters;
            if (!opcoesDiv) return;
            if (!dados || !dados.resumo_clusters) {
              opcoesDiv.innerHTML = '<p class="col-span-2 text-red-500 text-center">Dados de clusters não disponíveis.</p>';
              return;
            }
            const resumo = dados.resumo_clusters;
            const selKey = 'li_lf_clusters_sel';
            const selecionados = JSON.parse(localStorage.getItem(selKey) || '[]');
            let html = '';
            Object.keys(resumo).forEach(key => {
              const c = resumo[key];
              const checked = selecionados.includes(key) ? 'checked' : '';
              html += `
                <div>
                  <input type="checkbox" id="cluster-${key}" value="${key}" ${checked} class="form-checkbox h-5 w-5 text-[#00E38C] rounded">
                  <label for="cluster-${key}" class="text-white">${c.id || key} — ${c.descricao_curta || ''}</label>
                </div>`;
            });
            opcoesDiv.innerHTML = html || '<p class="col-span-2 text-gray-300 text-center">Nenhum cluster identificado.</p>';
            opcoesDiv.querySelectorAll('input[type="checkbox"]').forEach(cb => {
              cb.addEventListener('change', () => {
                const arr = Array.from(opcoesDiv.querySelectorAll('input[type="checkbox"]:checked')).map(x => x.value);
                localStorage.setItem(selKey, JSON.stringify(arr));
              });
            });
          }
        }

      } catch (error) {
        console.error('Erro ao carregar estatísticas avançadas:', error);
        container.innerHTML = `<p style="color: red;">Erro ao carregar dados: ${error.message}</p>`;
      }
    }

    // Funções para criar gráficos (simuladas)
    function criarGraficoFrequencia() {
      // Implementar gráfico real com Plotly
      console.log('Criando gráfico de frequência...');
    }

    function criarGraficoDistribuicao() {
      console.log('Criando gráfico de distribuição...');
    }

    function criarGraficoCorrelacao() {
      console.log('Criando gráfico de correlação...');
    }

    function criarGraficoTrevos() {
      console.log('Criando gráfico de trevos...');
    }

    function criarGraficoSeca() {
      console.log('Criando gráfico de seca...');
    }
    // Função para atualizar o modal quando o filtro de período é alterado
    function updateEstatisticasAvancadasModal() {
      const selectElement = document.getElementById('selectEstatisticasAvancadasPeriodo');
      const selectedQtd = selectElement.value;

      // Atualizar o texto do período
      const periodoDisplay = document.getElementById('estatisticasAvancadasPeriodoDisplay');
      if (periodoDisplay) {
        if (selectedQtd) {
          periodoDisplay.textContent = `Análise dos últimos ${selectedQtd} concursos.`;
        } else {
          periodoDisplay.textContent = 'Análise dos últimos 300 concursos.';
        }
      }

      // Carregar dados no modal genérico
      const conteudo = document.getElementById('conteudo-modal');
      if (conteudo) {
        carregarAnaliseEstatisticasAvancadas(conteudo, selectedQtd).then(() => {
          // Salvar dados da análise de estatísticas avançadas no localStorage
          const dadosEstatisticas = {
            janela: selectedQtd,
            timestamp: new Date().toISOString()
          };

          armazenarAnalise('estatisticas', dadosEstatisticas);
          console.log('✅ Dados de estatísticas avançadas salvos no localStorage');
        });
      }
    }

    // Função para abrir popup de ajuda das estatísticas avançadas
    function abrirPopupAjudaEstatisticasAvancadas() {
      document.getElementById("popupAjudaEstatisticasAvancadas").style.display = "block";
    }

    function fecharPopupAjudaEstatisticasAvancadas() {
      document.getElementById("popupAjudaEstatisticasAvancadas").style.display = "none";
    }

    // Função para criar gráfico de clusters com interface melhorada
    function plotGraficoEstatisticasClusters(clusters, periodo = null) {
      console.log('Dados de clusters recebidos:', clusters);
      if (!clusters || !clusters.estatisticas_clusters) {
        console.error('Dados de clusters não disponíveis');
        return;
      }

      const clusterData = clusters.estatisticas_clusters;
      const resumoClusters = clusters.resumo_clusters || {};
      console.log('Resumo clusters:', resumoClusters);
      const labels = Object.keys(clusterData);
      const valores = Object.values(clusterData).map(cluster => cluster.quantidade);

      // Criar título com período
      let titulo = '🔗 Clusters de Números Identificados';
      if (periodo) {
        titulo += `<br>(Últimos ${periodo} concursos)`;
      }

      // Usar cores dos clusters se disponíveis
      const cores = labels.map(label => {
        const resumo = resumoClusters[label];
        return resumo && resumo.cor ? resumo.cor : '#00E38C';
      });

      const data = [{
        x: labels,
        y: valores,
        type: 'bar',
        marker: {
          color: cores,
          opacity: 0.9,
          line: {
            color: 'white',
            width: 1
          }
        },
        text: valores.map(val => `${val} números`),
        textposition: 'auto',
        textfont: {
          color: 'white',
          size: 10,
          weight: 'bold'
        },
        hovertemplate: '<b>Cluster %{x}</b><br>Números: %{y}<extra></extra>'
      }];

      const layout = {
        title: {
          text: titulo,
          font: { size: 14, color: 'white' }
        },
        xaxis: {
          title: 'Cluster',
          titlefont: { color: 'white' },
          tickfont: { color: 'white', size: 12 }
        },
        yaxis: {
          title: 'Quantidade de Números',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        margin: { l: 80, r: 30, t: 70, b: 80, pad: 5 }
      };

      Plotly.newPlot('grafico-estatisticas-clusters', data, layout, { displayModeBar: false });

      // Criar cards de interpretação dos clusters
      criarCardsInterpretacaoClusters(resumoClusters);
    }

    // Função para criar cards de interpretação dos clusters
    function criarCardsInterpretacaoClusters(resumoClusters) {
      console.log('Criando cards de interpretação:', resumoClusters);
      const container = document.getElementById('interpretacao-clusters');
      if (!container || !resumoClusters) {
        console.log('Container ou resumoClusters não encontrado:', { container: !!container, resumoClusters: !!resumoClusters });
        return;
      }

      container.innerHTML = '';

      Object.values(resumoClusters).forEach(cluster => {
        const card = document.createElement('div');
        card.className = 'bg-card p-4 rounded-lg border-l-4 shadow-lg hover:shadow-xl transition-shadow duration-300';
        card.style.borderLeftColor = cluster.cor;

        card.innerHTML = `
          <div class="flex items-center justify-between mb-3">
            <h4 class="text-lg font-semibold text-text">${cluster.id}</h4>
            <span class="px-2 py-1 rounded text-xs font-bold cursor-pointer hover:opacity-80 transition-opacity click-cluster-badge" data-cluster-id="${cluster.id}" style="background-color: ${cluster.cor}; color: white;">
              ${cluster.tipo}
            </span>
          </div>

          <div class="text-sm text-textSecondary mb-3">
            <p class="mb-2 leading-relaxed">${cluster.descricao_curta}</p>
            <p class="text-yellow-400 font-semibold text-sm">${cluster.recomendacao}</p>
          </div>

          <div class="text-xs text-textSecondary mb-3 bg-surface p-2 rounded">
            <div class="grid grid-cols-2 gap-2">
              <div><strong>Freq:</strong> ${cluster.caracteristicas_principais.frequencia_media}</div>
              <div><strong>Intervalo:</strong> ${cluster.caracteristicas_principais.intervalo_medio}</div>
              <div><strong>Atraso:</strong> ${cluster.caracteristicas_principais.score_atraso}</div>
              <div><strong>Volatilidade:</strong> ${cluster.caracteristicas_principais.volatilidade}</div>
            </div>
          </div>
        `;

        container.appendChild(card);
      });

      // Adicionar event listeners para as caixinhas clicáveis
      const clusterBadges = document.querySelectorAll('.click-cluster-badge');
      clusterBadges.forEach(badge => {
        badge.addEventListener('click', () => {
          const clusterId = badge.dataset.clusterId;
          const clusterData = Object.values(resumoClusters).find(cluster => cluster.id === clusterId);
          if (clusterData && clusterData.todos_numeros_do_cluster) {
            exibirNumerosDoCluster(clusterData.id, clusterData.todos_numeros_do_cluster);
          } else {
            console.error('Dados completos do cluster não encontrados para:', clusterId);
          }
        });
      });
    }

    // Função para exibir números do cluster em popup
    function exibirNumerosDoCluster(titulo, numeros) {
      const modal = document.getElementById('modal-numeros-cluster');
      const modalTitulo = document.getElementById('modal-numeros-cluster-titulo');
      const modalConteudo = document.getElementById('modal-numeros-cluster-conteudo');
      const fecharBtn = document.getElementById('fechar-modal-numeros-cluster');

      modalTitulo.innerText = `${titulo}: Números`;

      // Limpar conteúdo anterior
      modalConteudo.innerHTML = '';

      // Adicionar os números formatados
      numeros.forEach(num => {
        const numDiv = document.createElement('div');
        numDiv.className = 'bg-surface text-text px-2 py-1 rounded-md';
        numDiv.innerText = num;
        modalConteudo.appendChild(numDiv);
      });

      modal.classList.remove('hidden'); // Mostra o modal

      // Adicionar listener para fechar o modal
      fecharBtn.onclick = () => {
        modal.classList.add('hidden');
      };

      // Fechar ao clicar fora do conteúdo do modal
      modal.onclick = (event) => {
        if (event.target === modal) {
          modal.classList.add('hidden');
        }
      };
    }

    // Função para criar gráfico de correlação
    function plotGraficoEstatisticasCorrelacao(correlacao, periodo = null) {
      console.log("🔍 plotGraficoEstatisticasCorrelacao chamada com:", { correlacao, periodo });

      if (!correlacao || !correlacao.correlacoes_positivas) {
        console.error('❌ Dados de correlação não disponíveis:', correlacao);
        const container = document.getElementById('grafico-estatisticas-correlacao');
        if (container) {
          container.innerHTML = '<p class="text-center text-gray-400 p-4">Dados de correlação não disponíveis para este período.</p>';
        }
        return;
      }

      console.log("📊 Correlações positivas:", correlacao.correlacoes_positivas);
      console.log("📊 Correlações negativas:", correlacao.correlacoes_negativas);

      // Combinar correlações positivas e negativas
      const todasCorrelacoes = [...(correlacao.correlacoes_positivas || []), ...(correlacao.correlacoes_negativas || [])];

      console.log("📊 Todas as correlações combinadas:", todasCorrelacoes);

      // Verificar se há dados suficientes para plotar
      if (todasCorrelacoes.length === 0) {
        console.warn('⚠️ Nenhuma correlação significativa encontrada para este período');
        const container = document.getElementById('grafico-estatisticas-correlacao');
        if (container) {
          container.innerHTML = '<p class="text-center text-gray-400 p-4">Nenhuma correlação significativa encontrada para este período.<br><small>Isso pode indicar que os números são bem distribuídos e independentes.</small></p>';
        }
        return;
      }

      const pares = todasCorrelacoes.map(pair => `${pair[0]}-${pair[1]}`);
      const valores = todasCorrelacoes.map(pair => pair[2]);

      console.log("📊 Pares criados:", pares);
      console.log("📊 Valores criados:", valores);

      // Criar título com período
      let titulo = '📈 Correlações Significativas<br>entre Números';
      if (periodo) {
        titulo += `<br>(Últimos ${periodo} concursos)`;
      }

      const data = [{
        x: pares,
        y: valores,
        type: 'bar',
        marker: {
          color: valores.map(val => val > 0 ? '#22C55E' : '#EF4444'),
          opacity: 0.9,
          line: {
            color: 'white',
            width: 1
          }
        },
        text: valores.map(val => val.toFixed(3)),
        textposition: 'auto',
        textfont: {
          color: 'white',
          size: 10,
          weight: 'bold'
        },
        hovertemplate: '<b>%{x}</b><br>Correlação: %{y}<extra></extra>'
      }];

      const layout = {
        title: {
          text: titulo,
          font: { size: 14, color: 'white' }
        },
        xaxis: {
          title: 'Pares de Números',
          titlefont: { color: 'white' },
          tickfont: { color: 'white', size: 10 },
          type: 'category', // Força o eixo X a ser categórico
          automargin: true // Ajuda com labels longos
        },
        yaxis: {
          title: 'Coeficiente de Correlação',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        margin: { l: 40, r: 40, t: 70, b: 80, pad: 5 }
      };

      console.log("🎯 Tentando criar gráfico Plotly...");
      console.log("📊 Data para Plotly:", data);
      console.log("📊 Layout para Plotly:", layout);

      try {
        Plotly.newPlot('grafico-estatisticas-correlacao', data, layout, { displayModeBar: false });
        console.log(`✅ Gráfico de correlação criado com ${todasCorrelacoes.length} pares significativos`);
      } catch (error) {
        console.error("❌ Erro ao criar gráfico Plotly:", error);
        console.error("❌ Detalhes do erro:", error.message);
      }
    }

    // Função para criar gráfico de probabilidades condicionais
    function plotGraficoEstatisticasProbabilidades(probabilidades, periodo = null) {
      console.log('🔍 DEBUG - Dados recebidos em plotGraficoEstatisticasProbabilidades:', probabilidades);

      if (!probabilidades || !probabilidades.dependencias_fortes) {
        console.error('Dados de probabilidades condicionais não disponíveis');
        const container = document.getElementById('grafico-estatisticas-probabilidades');
        if (container) {
          container.innerHTML = '<p class="text-center text-gray-400 p-4">Dados de probabilidades condicionais não disponíveis para este período.</p>';
        }
        return;
      }

      const dependencias = probabilidades.dependencias_fortes || [];
      console.log('🔍 DEBUG - Dependências encontradas:', dependencias);

      // Verificar se há dados suficientes para plotar
      if (dependencias.length === 0) {
        console.warn('Nenhuma dependência forte encontrada para este período');
        const container = document.getElementById('grafico-estatisticas-probabilidades');
        if (container) {
          container.innerHTML = '<p class="text-center text-gray-400 p-4">Nenhuma dependência forte encontrada para este período.<br><small>Isso pode indicar que os números são bem independentes.</small></p>';
        }
        return;
      }

      const pares = dependencias.map(dep => `${dep[0]}-${dep[1]}`);
      const valores = dependencias.map(dep => dep[2]);

      console.log('🔍 DEBUG - Pares processados:', pares);
      console.log('🔍 DEBUG - Valores processados:', valores);

      // Criar título com período
      let titulo = '🎯 Probabilidades Condicionais';
      if (periodo) {
        titulo += `<br>(Últimos ${periodo} concursos)`;
      }

      const data = [{
        x: pares,
        y: valores,
        type: 'bar',
        marker: {
          color: '#8B5CF6',
          opacity: 0.9,
          line: {
            color: 'white',
            width: 1
          }
        },
        text: valores.map(val => `${(val * 100).toFixed(1)}%`),
        textposition: 'auto',
        textfont: {
          color: 'white',
          size: 10,
          weight: 'bold'
        },
        hovertemplate: '<b>%{x}</b><br>Probabilidade: %{y}<extra></extra>'
      }];

      console.log('🔍 DEBUG - Dados finais para Plotly:', data);

      const layout = {
        title: {
          text: titulo,
          font: { size: 14, color: 'white' }
        },
        xaxis: {
          title: 'Pares de Números',
          titlefont: { color: 'white' },
          tickfont: { color: 'white', size: 10 },
          type: 'category', // Força o eixo X a ser categórico
          automargin: true // Ajuda com labels longos
        },
        yaxis: {
          title: 'Probabilidade',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        margin: { l: 40, r: 40, t: 70, b: 80, pad: 5 }
      };

      Plotly.newPlot('grafico-estatisticas-probabilidades', data, layout, { displayModeBar: false });
      console.log(`✅ Gráfico de probabilidades condicionais criado com ${dependencias.length} dependências`);
    }

    // Função para criar gráfico de distribuição com ordenação
    function plotGraficoEstatisticasDistribuicao(distribuicaoNumerosOriginal, ordenacao = 'numerica', periodo = null) {
      if (!distribuicaoNumerosOriginal || distribuicaoNumerosOriginal.length === 0) {
        console.warn('Dados de distribuição de números vazios ou inválidos.');
        Plotly.purge('grafico-estatisticas-distribuicao');
        document.getElementById('grafico-estatisticas-distribuicao').innerHTML = '<p class="text-center text-gray-400">Dados de distribuição não disponíveis para este período.</p>';
        return;
      }

      // 1. Criar uma cópia dos dados para não alterar o original
      let distribuicaoParaPlotar = [...distribuicaoNumerosOriginal];

      // 2. Aplicar a ordenação
      if (ordenacao === 'frequencia') {
        distribuicaoParaPlotar.sort((a, b) => b.frequencia - a.frequencia); // Do maior para o menor
        console.log('🔍 Ordenação por frequência aplicada. Primeiros 5 números:', distribuicaoParaPlotar.slice(0, 5).map(item => `${item.numero}:${item.frequencia}`));
      } else { // 'numerica' ou qualquer outro valor, mantém a ordem original (1 a 80)
        distribuicaoParaPlotar.sort((a, b) => a.numero - b.numero);
        console.log('🔍 Ordenação numérica aplicada. Primeiros 5 números:', distribuicaoParaPlotar.slice(0, 5).map(item => `${item.numero}:${item.frequencia}`));
      }

      const numeros = distribuicaoParaPlotar.map(item => item.numero);
      const frequencias = distribuicaoParaPlotar.map(item => item.frequencia);

      // Para ordenação por frequência, converter números para string para forçar eixo categórico
      const numerosParaEixo = ordenacao === 'frequencia'
        ? numeros.map(num => num.toString())
        : numeros;

      console.log('🔍 Tipo de ordenação:', ordenacao);
      console.log('🔍 Primeiros 5 números para eixo X:', numerosParaEixo.slice(0, 5));
      console.log('🔍 Tipo do eixo X:', ordenacao === 'frequencia' ? 'category' : 'linear');

      // Calcular estatísticas para exibir
      const total = frequencias.reduce((a, b) => a + b, 0);
      const media = total / frequencias.length;
      const maximo = Math.max(...frequencias);

      // Atualizar estatísticas rápidas
      const totalElement = document.getElementById('total-numeros');
      const mediaElement = document.getElementById('media-frequencia');
      const maximoElement = document.getElementById('max-frequencia');

      if (totalElement) totalElement.textContent = total;
      if (mediaElement) mediaElement.textContent = media.toFixed(1);
      if (maximoElement) maximoElement.textContent = maximo;

      // Criar título com período e ordenação
      let titulo = '📊 Distribuição de Frequência<br>dos Números';
      if (periodo) {
        titulo += `<br>(Últimos ${periodo} concursos)`;
      }
      titulo += ordenacao === 'frequencia' ? '<br>- Ordenado por Frequência' : '<br>- Ordem Numérica';

      const data = [{
        x: numerosParaEixo,
        y: frequencias,
        type: 'bar',
        marker: {
          color: '#00E38C',
          opacity: 0.9,
          line: {
            color: 'white',
            width: 1
          }
        },
        text: frequencias.map(val => val.toString()),
        textposition: 'auto',
        textfont: {
          color: 'white',
          size: 8,
          weight: 'bold'
        },
        hovertemplate: ordenacao === 'frequencia'
          ? '<b>Número %{x}</b><br>Frequência: %{y}<br><i>Ordenado por frequência</i><extra></extra>'
          : '<b>Número %{x}</b><br>Frequência: %{y}<extra></extra>'
      }];

      // Adicionar linha de média quando ordenado por frequência
      if (ordenacao === 'frequencia') {
        data.push({
          x: [numeros[0].toString(), numeros[numeros.length - 1].toString()], // Converter para string para eixo categórico
          y: [media, media],
          type: 'scatter',
          mode: 'lines',
          line: { color: 'red', dash: 'dash', width: 2 },
          name: 'Média',
          showlegend: true,
          hoverinfo: 'skip'
        });
      }

      const layout = {
        title: {
          text: titulo,
          font: { size: 14, color: 'white' }
        },
        xaxis: {
          title: { text: 'Número', font: { color: 'white' } },
          type: ordenacao === 'frequencia' ? 'category' : 'linear', // Força categoria apenas quando ordenado por frequência
          gridcolor: '#2E303A',
          tickfont: { color: 'white', size: 10 },
          linecolor: '#2E303A',
          automargin: true,
          range: [0, 26],
          tickmode: 'linear',
          dtick: 5
        },
        yaxis: {
          title: 'Frequência',
          titlefont: { color: 'white' },
          tickfont: { color: 'white' }
        },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        font: { color: 'white' },
        margin: { l: 40, r: 40, t: 70, b: 80, pad: 5 },
        showlegend: ordenacao === 'frequencia'
      };

      Plotly.newPlot('grafico-estatisticas-distribuicao', data, layout, { displayModeBar: false });
      console.log(`✅ Gráfico de distribuição criado com ordenação: ${ordenacao}!`);
    }

    // Função para atualizar estados dos botões de ordenação
    function atualizarBotoesOrdenacao(ordenacaoAtiva) {
      const btnNumerica = document.getElementById('btn-ordenar-numerica');
      const btnFrequencia = document.getElementById('btn-ordenar-frequencia');

      if (btnNumerica && btnFrequencia) {
        if (ordenacaoAtiva === 'numerica') {
          btnNumerica.className = 'px-4 py-2 rounded-lg bg-[#00E38C] text-black font-semibold hover:opacity-80 transition-all';
          btnFrequencia.className = 'px-4 py-2 rounded-lg bg-[#2E303A] text-white hover:bg-[#3E404A] transition-all';
        } else {
          btnFrequencia.className = 'px-4 py-2 rounded-lg bg-[#00E38C] text-black font-semibold hover:opacity-80 transition-all';
          btnNumerica.className = 'px-4 py-2 rounded-lg bg-[#2E303A] text-white hover:bg-[#3E404A] transition-all';
        }
      }
    }

    // Função para configurar event listeners dos controles de ordenação
    function configurarControlesOrdenacao() {
      const btnOrdenarNumerica = document.getElementById('btn-ordenar-numerica');
      const btnOrdenarFrequencia = document.getElementById('btn-ordenar-frequencia');

      if (btnOrdenarNumerica && btnOrdenarFrequencia && window.ultimaDistribuicaoNumeros) {
        // Remover event listeners anteriores para evitar duplicação
        btnOrdenarNumerica.replaceWith(btnOrdenarNumerica.cloneNode(true));
        btnOrdenarFrequencia.replaceWith(btnOrdenarFrequencia.cloneNode(true));

        // Recuperar referências após clonagem
        const btnNumerica = document.getElementById('btn-ordenar-numerica');
        const btnFrequencia = document.getElementById('btn-ordenar-frequencia');

        btnNumerica.addEventListener('click', () => {
          console.log('🔍 Botão "Ordem Numérica" clicado!');
          plotGraficoEstatisticasDistribuicao(window.ultimaDistribuicaoNumeros, 'numerica', window.ultimoPeriodoEstatisticas);
          atualizarBotoesOrdenacao('numerica');
        });

        btnFrequencia.addEventListener('click', () => {
          console.log('🔍 Botão "Por Frequência" clicado!');
          console.log('🔍 Dados disponíveis:', window.ultimaDistribuicaoNumeros);
          console.log('🔍 Período:', window.ultimoPeriodoEstatisticas);
          plotGraficoEstatisticasDistribuicao(window.ultimaDistribuicaoNumeros, 'frequencia', window.ultimoPeriodoEstatisticas);
          atualizarBotoesOrdenacao('frequencia');
        });

        // Definir estado inicial (ordem numérica ativa)
        atualizarBotoesOrdenacao('numerica');

        console.log('✅ Controles de ordenação configurados!');
      }
    }

    function criarGraficoClusters() {
      console.log('Criando gráfico de clusters...');
    }

    // Função para gerar números aleatórios (GRATUITO)
    async function gerarNumerosAleatorios() {
      // Capturar o botão no início da função
      const botao = event.target;
      const textoOriginal = botao.innerHTML;

      try {
        // Mostrar loading
        botao.innerHTML = '🍀 Gerando Palpite...';
        botao.disabled = true;

        // Chamar API para gerar números aleatórios
        const response = await fetch('/api/gerar-numeros-aleatorios');
        const dados = await response.json();

        if (dados.success) {
          // Limpar seleções anteriores (sem mostrar mensagem)
          limparSelecaoSilenciosa();

          // Selecionar números aleatórios
          dados.numeros.forEach(numero => {
            const elementos = document.querySelectorAll('#numeros-container .numero');
            const elemento = Array.from(elementos).find(el => el.textContent.trim() === numero.toString().padStart(2, '0'));
            if (elemento) {
              selecionarNumero(numero, elemento);
            }
          });

          // Selecionar trevos (corrigido para usar a nova estrutura)
          const trevoElementos = document.querySelectorAll('#trevos-container .trevo-icon-container');

          // Função para selecionar trevo sem validação de limite (para geração automática)
          function selecionarTrevoAutomatico(trevo, elemento) {
            if (!trevosSelecionados.includes(trevo)) {
              trevosSelecionados.push(trevo);
              elemento.classList.add('selecionado');
            }
            atualizarTrevosSelecionados();
          }

          // Selecionar primeiro trevo
          const trevo1Elemento = Array.from(trevoElementos).find(el =>
            el.querySelector('.trevo-number').textContent.trim() === dados.trevo1.toString()
          );
          if (trevo1Elemento) {
            selecionarTrevoAutomatico(dados.trevo1, trevo1Elemento);
          }

          // Selecionar segundo trevo
          const trevo2Elemento = Array.from(trevoElementos).find(el =>
            el.querySelector('.trevo-number').textContent.trim() === dados.trevo2.toString()
          );
          if (trevo2Elemento) {
            selecionarTrevoAutomatico(dados.trevo2, trevo2Elemento);
          }

          // Mostrar sucesso
          mostrarMensagem('🍀 Palpite da Sorte gerado com sucesso!', 'success');
        } else {
          throw new Error(dados.error || 'Erro ao gerar números');
        }
      } catch (error) {
        console.error('Erro:', error);
        mostrarMensagem('❌ Erro ao gerar números. Tente novamente.', 'error');
      } finally {
        // Restaurar botão usando a referência capturada
        botao.innerHTML = '🍀 Gerar Palpite da Sorte';
        botao.disabled = false;
      }
    }

    // Função para limpar todas as seleções (silenciosa - sem mensagem)
    function limparSelecaoSilenciosa() {
      // Limpar números selecionados
      numerosSelecionados = [];
      document.querySelectorAll('#numeros-container .numero').forEach(el => {
        el.classList.remove('selecionado');
      });

      // Limpar trevos (corrigido para usar a nova classe)
      trevosSelecionados = [];
      document.querySelectorAll('#trevos-container .trevo-icon-container').forEach(el => {
        el.classList.remove('selecionado');
      });

      // Atualizar displays
      atualizarNumerosSelecionados();
      atualizarTrevosSelecionados();
      calcularEAtualizarValorAposta(); // NOVA: Recalcular valor após limpeza
    }

    // Função para limpar todas as seleções (com mensagem)
    function limparSelecao() {
      limparSelecaoSilenciosa();
      mostrarMensagem('🗑️ Seleção limpa com sucesso!', 'info');
    }

    // Função para mostrar mensagens
    function mostrarMensagem(texto, tipo) {
      // Criar elemento de mensagem
      const mensagem = document.createElement('div');
      mensagem.className = `fixed top-4 right-4 p-4 rounded-xl text-white font-semibold z-50 transition-all duration-300 ${
        tipo === 'success' ? 'bg-green-600' :
        tipo === 'error' ? 'bg-red-600' :
        'bg-blue-600'
      }`;
      mensagem.textContent = texto;

      // Adicionar ao DOM
      document.body.appendChild(mensagem);

      // Remover após 3 segundos
      setTimeout(() => {
        mensagem.remove();
      }, 3000);
    }

    // ===== MODAL DE CONFIGURAÇÃO DE APOSTA =====

    // Elementos do modal
    const modalConfiguracao = document.getElementById('modalConfiguracao');
    const btnCancelarModal = document.getElementById('btnCancelarModal');
    const btnGerarNoModal = document.getElementById('btnGerarNoModal');
    const sliderNumeros = document.getElementById('sliderNumeros');
    const valorNumeros = document.getElementById('valorNumeros');

    // CORREÇÃO: A Quina não tem trevos, então não tenta acessar esses elementos
    // const sliderTrevos = document.getElementById('sliderTrevos');
    // const valorTrevos = document.getElementById('valorTrevos');

    // Atualiza os valores exibidos pelos sliders
    if (sliderNumeros && valorNumeros) {
        // Lotofácil: 15 a 20 números
        sliderNumeros.min = 15;
        sliderNumeros.max = 20;
        if (parseInt(sliderNumeros.value) < 15 || parseInt(sliderNumeros.value) > 20) {
          sliderNumeros.value = 15;
        }
        valorNumeros.textContent = sliderNumeros.value;
        sliderNumeros.oninput = () => {
            valorNumeros.textContent = sliderNumeros.value;
            atualizarCorSlider(sliderNumeros);
        };
    }

    // CORREÇÃO: Removido código dos trevos para a Quina
    // if (sliderTrevos && valorTrevos) {
    //     sliderTrevos.oninput = () => {
    //         valorTrevos.textContent = sliderTrevos.value;
    //         atualizarCorSlider(sliderTrevos);
    //     };
    // }

    // Função para atualizar a cor da barra do slider dinamicamente
    function atualizarCorSlider(slider) {
      const value = (slider.value - slider.min) / (slider.max - slider.min) * 100;

      // Atualiza o gradiente da barra baseado no valor
      slider.style.background = `linear-gradient(to right, #00E38C 0%, #00E38C ${value}%, #2E303A ${value}%, #2E303A 100%)`;

      // Adiciona efeito de brilho sutil
      slider.style.boxShadow = `inset 0 1px 3px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(0, 227, 140, ${value * 0.01})`;
    }

    // Inicializa a cor do slider ao carregar a página
    document.addEventListener('DOMContentLoaded', () => {
      if (sliderNumeros) {
        atualizarCorSlider(sliderNumeros);
      }
      // CORREÇÃO: A Quina não tem trevos, então não tenta acessar sliderTrevos
      // if (sliderTrevos) {
      //   atualizarCorSlider(sliderTrevos);
      // }
    });

    // Abrir o modal
    function abrirModalConfiguracao() {
      modalConfiguracao.classList.remove('hidden');
    }

    // Fechar o modal
    btnCancelarModal.addEventListener('click', () => {
      modalConfiguracao.classList.add('hidden');
    });

    // Gerar aposta ao clicar no botão dentro do modal
    btnGerarNoModal.addEventListener('click', () => {
      const qtdeNum = parseInt(sliderNumeros.value);
      // CORREÇÃO: A Quina não tem trevos, então usa 0 como padrão
      const qtdeTrevos = 0; // parseInt(sliderTrevos.value);
      gerarApostaAleatoria(qtdeNum, qtdeTrevos);
      modalConfiguracao.classList.add('hidden'); // Fecha o modal após gerar
    });
    // Função para chamar o backend Flask
    async function gerarApostaAleatoria(qtdeNum, qtdeTrevos) {
      try {
        mostrarMensagem('🎲 Gerando sua aposta...', 'info');

        // Lotofácil: usa a API dedicada
        const response = await fetch('/api/gerar-aposta-aleatoria-lotofacil', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            qtde_num: qtdeNum
          })
        });

        if (!response.ok) {
          throw new Error(`Erro HTTP: ${response.status}`);
        }

        const data = await response.json();
        console.log("Aposta Gerada:", data);

        // Limpar seleções anteriores
        limparSelecaoSilenciosa();

        // CORREÇÃO: A Quina não tem trevos, então só seleciona números
        // Selecionar números aleatórios automaticamente
        if (data.numeros && Array.isArray(data.numeros)) {
          data.numeros.forEach(numero => {
            const elementos = document.querySelectorAll('#numeros-container .numero');
            const elemento = Array.from(elementos).find(el => el.textContent.trim() === numero.toString().padStart(2, '0'));
            if (elemento) {
              selecionarNumeroAutomatico(numero, elemento);
            }
          });
        }

        // Atualizar valor da aposta (sem trevos)
        if (data.valor && data.qtde_apostas) {
          atualizarValorAposta(data.valor, data.qtde_apostas, qtdeNum, 0, 0);
        }

        mostrarMensagem(`✅ Aposta gerada com sucesso! ${data.qtde_apostas || 1} combinações`, 'success');

      } catch (error) {
        console.error("Erro ao gerar aposta:", error);
        mostrarMensagem(`❌ Erro ao gerar aposta: ${error.message}`, 'error');
      }
    }

    // Função para atualizar o modal quando o filtro de período é alterado
    function updateDistribuicaoModal() {
      const selectElement = document.getElementById('selectDistribuicaoPeriodo');
      const selectedQtd = selectElement.value;

      // Carregar dados no modal genérico
      const conteudo = document.getElementById('conteudo-modal');
      if (conteudo) {
        carregarAnaliseDistribuicao(conteudo, selectedQtd).then(() => {
          // Salvar dados da análise de distribuição no localStorage
          const dadosDistribuicao = {
            janela: selectedQtd,
            timestamp: new Date().toISOString()
          };

          armazenarAnalise('distribuicao', dadosDistribuicao);
          console.log('✅ Dados de distribuição salvos no localStorage');
        });
      }
    }
  </script>







  <!-- Popup de Ajuda -->
  <div id="popupAjuda" class="modal-ajuda">
    <div class="modal-content">
      <span class="close" onclick="fecharPopupAjuda()">×</span>
      <h2>🧠 Entendendo os Gráficos e a Matriz</h2>
      <p>Esses gráficos e a matriz visual mostram padrões que podem te ajudar a escolher seus números com mais estratégia.</p>

      <h3>📊 Frequência Absoluta</h3>
      <p>
                        Quantas vezes cada número foi sorteado.<br>
        <strong>✔ Útil para:</strong> ver os mais e menos sorteados até hoje.
      </p>

      <h3>📈 Frequência Relativa</h3>
      <p>
        Mostra a frequência em porcentagem, comparando com o esperado em sorteios aleatórios.<br>
        <strong>✔ Útil para:</strong> saber se um número saiu mais ou menos do que o "normal".
      </p>

      <h3>🔥 Números Quentes</h3>
      <p>
        São os que mais saíram recentemente. Alguns jogadores acreditam que estão em "alta".
      </p>

      <h3>❄️ Números Frios</h3>
      <p>
        São os que há tempos não aparecem. Alguns apostadores preferem dar chance a eles.
      </p>

      <h3>🕒 Análise Temporal</h3>
      <p>
        Compara os números mais frequentes em blocos (últimos 10%, 20%, 30% dos concursos).<br>
        <strong>✔ Útil para:</strong> detectar tendências mais recentes.
      </p>

      <h3>🔢 Matriz Visual dos Concursos</h3>
      <p>
        Esta grade mostra os resultados dos últimos concursos de forma visual e compacta. Cada linha representa um sorteio, com os números e trevos sorteados destacados.<br>
        <strong>✔ Útil para:</strong><br>
        • <strong>Identificar padrões visuais:</strong> ver se há aglomerados de números, sequências (ex: 1, 2, 3), ou se a distribuição está mais dispersa.<br>
        • <strong>Observar "buracos":</strong> identificar áreas da matriz que parecem "vazias" (números que não foram sorteados em uma sequência de concursos).<br>
        • <strong>Revisão rápida:</strong> ter uma visão geral dos números e trevos que saíram nos sorteios recentes.
      </p>

      <p style="margin-top: 20px; font-style: italic;">
        <strong⚠️ Lembre-se:</strong> Estes gráficos e a matriz não garantem acertos, mas ajudam a apostar com mais consciência estatística e a explorar os dados históricos do jogo.
      </p>
    </div>
  </div>

  <!-- Popup de Ajuda para Distribuição -->
  <div id="popupAjudaDistribuicao" class="modal-ajuda">
    <div class="modal-content">
      <span class="close" onclick="fecharPopupAjudaDistribuicao()">×</span>
      <h2>🧠 Entendendo a Análise de Distribuição</h2>
      <p>Esta análise revela a "forma" como os números da Quina se comportam, mostrando padrões estatísticos, desequilíbrios, aglomerados e dispersão. Compreender esses padrões pode guiar suas escolhas com mais estratégia.</p>

      <h3>📊 Paridade (Pares vs Ímpares)</h3>
      <p>
        O que mostra: A frequência de sorteios com diferentes combinações de números pares e ímpares nos 5 números principais da Quina. (Ex: 3 Pares-2 Ímpares, 2 Pares-3 Ímpares, etc.).<br>
        <strong>✔ Útil para:</strong> Equilibrar sua aposta e identificar padrões comuns ou combinações historicamente raras.<br>
        <strong💡 Dica:</strong> A maioria dos sorteios da Quina tem entre 2 e 3 números pares.
      </p>

      <h3>🔢 Distribuição por Faixas Numéricas</h3>
      <p>
        O que mostra: Quantas vezes os números sorteados caem em diferentes faixas numéricas (1-5, 6-10, 11-15, 16-20, 21-25). Também exibe a média e a moda de ocorrências por faixa.<br>
        <strong>✔ Útil para:</strong> Observar se algumas faixas da Lotofácil (1-25) são historicamente mais sorteadas do que outras.<br>
        <strong💡 Dica:</strong> Ajuda a balancear sua aposta para incluir números de faixas mais ativas ou, se preferir, de faixas menos exploradas.
      </p>

      <h3>➕ Soma dos Números Principais</h3>
      <p>
        O que mostra: Um histograma da frequência da soma total dos 5 números principais sorteados. Apresenta também o valor mínimo, máximo, a média e a(s) moda(s) das somas.<br>
        <strong>✔ Útil para:</strong> Escolher combinações com somas que estejam dentro da faixa de valores mais comuns historicamente.<br>
        <strong💡 Dica:</strong> Evite somas muito altas ou muito baixas, que são estatisticamente menos frequentes.
      </p>



      <h3>↔️ Amplitude dos Números Principais</h3>
      <p>
        O que mostra: Um histograma da frequência da diferença entre o maior e o menor número sorteado em cada concurso da Quina. (Ex: Números 5 e 75 = amplitude 70).<br>
        <strong>✔ Útil para:</strong> Avaliar a "dispersão" dos números sorteados e evitar apostar em números muito próximos ou muito distantes entre si.<br>
        <strong💡 Dica:</strong> Na Quina, amplitudes entre 40 e 70 são as mais frequentes historicamente.
      </p>

      <h3>🎯 Como Usar na Prática</h3>
      <p>
        <strong>Observe os picos nos histogramas:</strong> Eles indicam as faixas de valores mais comuns (para somas e amplitudes).<br>
        <strong>Busque o equilíbrio:</strong> Evite combinações muito extremas (ex: muitos pares/ímpares, somas muito altas/baixas, amplitudes incomuns) que são menos frequentes historicamente.<br>
        <strong>Use como referência, não como regra absoluta:</strong> As estatísticas são ferramentas para auxiliar, não garantias.<br>
        <strong>Combine com outras análises:</strong> Para uma estratégia mais robusta, utilize estas informações em conjunto com a Análise de Frequência e outras ferramentas disponíveis.
      </p>

      <p style="margin-top: 20px; font-style: italic;">
        <strongImportante:</strong> A Loteria é um jogo de probabilidades onde a sorte é protagonista. Estas análises estatísticas não garantem acertos, mas ajudam você a criar apostas mais equilibradas e estatisticamente mais prováveis, baseadas em dados históricos reais.
      </p>
    </div>
  </div>

  <!-- Popup de Ajuda para Afinidades -->
  <div id="popupAjudaAfinidades" class="modal-ajuda">
    <div class="modal-content">
      <span class="close" onclick="fecharPopupAjudaAfinidades()">×</span>
      <h2>🤝 Entendendo a Análise de Afinidade entre Números</h2>
      <p>Esta análise revela quais números têm maior tendência de aparecer juntos nos sorteios, baseada em dados históricos reais. Compreender essas afinidades auxilia na criação de combinações estratégicas.</p>

      <h3>🔗 Pares com Maior Afinidade</h3>
      <p>
        <strong>O que mostra:</strong> Os pares de números que mais frequentemente saem juntos nos sorteios. Por exemplo, se os números 21 e 22 aparecem juntos 15 vezes, eles têm alta afinidade.<br>
        <strong>✔ Útil para:</strong> Identificar números que "gostam" de sair juntos, podendo incluir ambos ou evitar ambos em sua aposta.
      </p>

      <h3>⭐ Afinidade Geral por Número</h3>
      <p>
        <strong>O que mostra:</strong> A pontuação total de afinidade de cada número com todos os outros. Por exemplo, o número 7 tem uma pontuação de afinidade geral de 250, indicando que ele apareceu com muitos outros números.<br>
        <strong>✔ Útil para:</strong> Identificar números que são mais "ativos" nos sorteios e podem ser bons candidatos para suas apostas.
      </p>

      <h3>🌐 Gráfico de Rede de Afinidade</h3>
      <p>
        <strong>O que mostra:</strong> Visualização interativa das conexões entre números. Nós maiores representam números com maior afinidade geral, e linhas mais grossas indicam pares com maior afinidade.<br>
        <strong>✔ Útil para:</strong> Identificar clusters de números que tendem a sair juntos e visualizar padrões de conexão.
      </p>

      <h3>📊 Interpretando os Gráficos</h3>
      <p>
        <strong>📈 Gráfico de Pares:</strong> Mostra os pares com maior afinidade em ordem decrescente. Barras mais altas indicam pares que saem juntos com mais frequência.<br>
        <strong⭐ Gráfico de Afinidade Geral:</strong> Mostra a pontuação total de cada número. Números com barras mais altas são mais "sociais" nos sorteios.<br>
        <strong🌐 Rede de Afinidade:</strong> Linhas mais grossas e coloridas (vermelho = alta afinidade, laranja = média, roxo = baixa) mostram a intensidade das conexões.
      </p>

      <h3>🎯 Estratégias de Uso</h3>
      <p>
        <strong✅ Estratégia de Inclusão:</strong> Incluir pares com alta afinidade em sua aposta, pois eles têm histórico de sair juntos.<br>
        <strong❌ Estratégia de Evitação:</strong> Evitar pares com alta afinidade para não "concentrar" demais sua aposta.<br>
        <strong🔄 Estratégia Mista:</strong> Usar números com alta afinidade geral como base e complementar com números menos frequentes.<br>
        <strong⚖️ Balanceamento:</strong> Combinar números com diferentes níveis de afinidade para criar apostas mais equilibradas.
      </p>

      <h3>⚠️ Considerações Importantes</h3>
      <p>
        <strong🔍 Correlação não é causalidade:</strong> Números com alta afinidade não "causam" o sorteio um do outro, apenas têm histórico de aparecer juntos.<br>
        <strong🔄 Padrões podem mudar:</strong> Afinidades baseadas em dados históricos podem não se repetir no futuro.<br>
        <strong🎯 Use com moderação:</strong> Não dependa exclusivamente da afinidade, combine com outras análises.
      </p>

      <p style="margin-top: 20px; font-style: italic;">
        <strong⚠️ Importante:</strong> A Loteria é um jogo de probabilidades onde a sorte é protagonista. Estas análises de afinidade não garantem acertos, mas ajudam você a entender padrões históricos e criar apostas mais informadas, baseadas em dados reais dos sorteios.
      </p>
    </div>
  </div>

  <!-- Popup de Ajuda para Sequências -->
  <div id="popupAjudaSequencias" class="modal-ajuda">
    <div class="modal-content">
      <span class="close" onclick="fecharPopupAjudaSequencias()">×</span>
      <h2>🔢 Entendendo a Análise de Sequências</h2>
      <p>Esta análise revela padrões de números consecutivos, repetições entre concursos, intervalos de ausência e ciclos de retorno baseada em dados históricos reais da Mega Sena.</p>

      <h3>🔢 Números Consecutivos</h3>
      <p>
        <strong>O que mostra:</strong> Padrões de números que saem em sequência (ex: 23,24,25 ou 45,46). Identifica quantos concursos têm consecutivos e qual a maior sequência já sorteada.<br>
        <strong>✔ Útil para:</strong> Evitar apostas com muitas sequências consecutivas, que são menos prováveis de sair.
      </p>

      <h3>🔄 Repetições entre Concursos</h3>
      <p>
        <strong>O que mostra:</strong> Números que se repetem em sorteios seguidos e estatísticas de repetição. Identifica quais números mais repetem e sequências sem repetição.<br>
        <strong>✔ Útil para:</strong> Identificar números "quentes" que tendem a repetir e padrões de alternância.
      </p>

      <h3>⏰ Intervalos de Ausência</h3>
      <p>
        <strong>O que mostra:</strong> Há quantos concursos cada número não sai. Identifica números em "seca" prolongada e intervalos médios de ausência.<br>
        <strong>✔ Útil para:</strong> Identificar números "atrasados" que podem estar próximos de sair.
      </p>

      <h3>🔄 Ciclos de Retorno</h3>
      <p>
        <strong>O que mostra:</strong> Tempo médio que cada número leva para voltar a ser sorteado. Classifica números por ciclo curto/longo.<br>
        <strong>✔ Útil para:</strong> Identificar números com padrões de retorno previsíveis.
      </p>

      <h3>📊 Interpretando os Gráficos</h3>
      <p>
        <strong>📈 Gráfico de Consecutivos:</strong> Mostra a distribuição de tipos de consecutivos encontrados.<br>
        <strong>🔄 Gráfico de Repetições:</strong> Mostra os números que mais repetem entre concursos.<br>
        <strong>⏰ Gráfico de Intervalos:</strong> Mostra os números mais ausentes e seus intervalos.<br>
        <strong>🔄 Gráfico de Ciclos:</strong> Mostra números com ciclos de retorno curtos.
      </p>

      <h3>🎯 Estratégias de Uso</h3>
      <p>
        <strong>🔢 Estratégia Anti-Consecutivos:</strong> Evitar apostas com muitas sequências consecutivas.<br>
        <strong>🔄 Estratégia de Repetições:</strong> Incluir números que tendem a repetir ou evitar os que repetem muito.<br>
        <strong>⏰ Estratégia de Seca:</strong> Apostar em números em seca prolongada.<br>
        <strong>🔄 Estratégia de Ciclos:</strong> Incluir números com ciclos de retorno curtos.
      </p>

      <h3>⚠️ Considerações Importantes</h3>
      <p>
        <strong>🔍 Padrões podem variar:</strong> Análises históricas não garantem repetição no futuro.<br>
        <strong>🔄 Análise temporal:</strong> Use a janela de análise para ver padrões recentes vs. históricos.<br>
        <strong>🎯 Use com moderação:</strong> Combine com outras análises para estratégias mais robustas.
      </p>

      <p style="margin-top: 20px; font-style: italic;">
        <strong>⚠️ Importante:</strong> A Loteria é um jogo de probabilidades onde a sorte é protagonista. Estas análises de sequências não garantem acertos, mas ajudam você a entender padrões históricos e criar apostas mais informadas, baseadas em dados reais dos sorteios.
      </p>
    </div>
  </div>

  <!-- Popup de Ajuda para Seca -->
  <div id="popupAjudaSeca" class="modal-ajuda">
    <div class="modal-content">
      <span class="close" onclick="fecharPopupAjudaSeca()">×</span>
      <h2>🌵 Entendendo a Análise de Seca</h2>
              <p>Esta análise identifica há quantos concursos um determinado número não foi sorteado, revelando padrões de "seca" que podem orientar suas estratégias de aposta.</p>

      <h3>📊 O que é a Análise de Seca?</h3>
      <p>
        A análise de seca calcula o período em que cada número não foi sorteado.<br>
                  <strong>Maior Seca:</strong> Números que estão há mais tempo sem aparecer.<br>
          <strong>Recentemente Sorteados:</strong> Números que saíram nos últimos concursos.<br>
        <strong💡 Dica:</strong> Números em seca prolongada podem estar "atrasados" para sair.
      </p>

      <h3>🎯 Janela de Análise Temporal</h3>
      <p>
        Use o seletor de período para analisar diferentes janelas de tempo:<br>
        <strong>Últimos 300 concursos:</strong> Análise completa do histórico disponível.<br>
        <strongÚltimos 25/50/100/200:</strong> Foco em períodos mais recentes.<br>
        <strong💡 Dica:</strong> Períodos menores mostram tendências mais recentes, períodos maiores mostram padrões históricos consolidados.
      </p>

      <h3>📈 Interpretando os Gráficos</h3>
      <p>
        <strong>Eixo X:</strong> Números (1-25).<br>
        <strong>Eixo Y:</strong> Concursos em que estão sem sair.<br>
        <strongBarras vermelhas:</strong> Maior tempo de seca (mais "atrasados").<br>
        <strongBarras verdes:</strong> Sorteados recentemente.<br>
        <strong💡 Dica:</strong> As cores indicam a intensidade da seca, facilitando a identificação visual.
      </p>

      <h3>💡 Estratégias de Aposta</h3>
      <p>
        <strongAtrasados:</strong> Apostar nos números em maior seca, baseado na teoria de que estão "devendo" sair.<br>
        <strongRecentes:</strong> Apostar nos que saíram há pouco, seguindo a tendência de "momentum".<br>
        <strongMisto:</strong> Combinar ambas as estratégias para diversificar sua aposta.<br>
        <strongAleatoriedade:</strong> Lembre-se: não há garantias! A loteria é um jogo de probabilidades onde a sorte é protagonista.
      </p>

      <h3>🎯 Como Usar na Prática</h3>
      <p>
        <strongObserve as barras altas:</strong> Elas indicam números em maior seca.<br>
        <strongAnalise as barras baixas:</strong> Mostram números sorteados recentemente.<br>
        <strongCompare períodos:</strong> Use diferentes janelas temporais para identificar tendências.<br>
        <strongCombine estratégias:</strong> Use a seca em conjunto com outras análises disponíveis.
      </p>

      <h3>⚠️ Considerações Importantes</h3>
      <p>
        <strongNão é garantia:</strong> A análise de seca é uma ferramenta estatística, não uma previsão.<br>
        <strongAleatoriedade:</strong> Cada sorteio é independente, não há "dívida" real dos números.<br>
        <strongResponsabilidade:</strong> Aposte apenas o que pode perder, dentro dos seus limites financeiros.<br>
        <strongDiversificação:</strong> Não aposte apenas em números em seca, diversifique suas escolhas.
      </p>

      <p style="margin-top: 20px; font-style: italic;">
        <strongImportante:</strong> Esta é uma análise estatística histórica que não garante resultados futuros. Use como ferramenta de orientação, mas sempre aposte com responsabilidade e consciência de que a loteria é um jogo de probabilidades onde a sorte é protagonista.
      </p>
    </div>
  </div>

  <!-- Popup de Ajuda para Estatísticas Avançadas -->
  <div id="popupAjudaEstatisticasAvancadas" class="modal-ajuda">
    <div class="modal-content">
      <span class="close" onclick="fecharPopupAjudaEstatisticasAvancadas()">×</span>
      <h2>📈 Entendendo as Estatísticas Avançadas</h2>
      <p>Esta análise utiliza métodos estatísticos avançados para identificar padrões complexos nos sorteios da +Milionária, oferecendo insights profundos sobre a aleatoriedade e distribuição dos números.</p>

      <h3>🧪 Teste de Aleatoriedade</h3>
      <p>
        Esse teste verifica se os sorteios seguem um padrão realmente aleatório ou se apresentam algum tipo de regularidade estatística.<br>
        <strong>O que faz:</strong> Usa um p-valor (probabilidade) para indicar o grau de aleatoriedade dos resultados:<br>
        <strong>p < 0.05:</strong> Sugere que há padrões não aleatórios, ou seja, comportamentos que se repetem mais do que o acaso explicaria.<br>
        <strong>p > 0.05:</strong> Indica que os resultados são compatíveis com sorteios aleatórios.<br>
        <strong>Quanto mais próximo de 1.0,</strong> maior a evidência de que os resultados seguem o acaso puro.<br>
        <strong💡 Dica:</strong> Em outras palavras, esse teste ajuda a descobrir se há algum "sinal escondido" nos sorteios, ou se tudo está mesmo no reino da sorte e do acaso.
      </p>

      <h3>📊 Desvio Padrão da Distribuição</h3>
      <p>
        Mede a dispersão dos números sorteados em relação à média esperada.<br>
        <strongDesvio Padrão:</strong> Indica o quão espalhados estão os números.<br>
        <strongCoeficiente de Variação:</strong> Desvio padrão relativo à média (em %).<br>
        <strong💡 Dica:</strong> Valores altos indicam maior variabilidade nos sorteios.
      </p>

      <h3>🔗 Análise de Clusters</h3>
      <p>
        Técnica de mineração de dados e aprendizado de máquina não supervisionado que tem como objetivo agrupar objetos (ou dados) em conjuntos, identificando grupos naturais de números que apresentam comportamentos semelhantes ou tendem a aparecer juntos nos sorteios.<br>
        <strongSignificado:</strong> Revela associações ocultas entre números, agrupando aqueles que compartilham características ou padrões de frequência.<br>
        <strongBenefício:</strong> Permite identificar combinações promissoras ou tendências inesperadas nos sorteios, oferecendo uma nova perspectiva para suas apostas.
      </p>

      <h3>📈 Correlação entre Números</h3>
      <p>
        Analisa as relações estatísticas entre diferentes números, mostrando apenas os <strong>extremos mais significativos</strong>.<br>
        <strong🔢 Por que apenas os extremos:</strong> Com 50 números, existem 1.225 combinações possíveis (50×49÷2). Mostrar todas seria impraticável e confuso visualmente.<br>
        <strong📊 O que o gráfico mostra:</strong><br>
        • <strong>Correlações positivas:</strong> Apenas os 10 pares mais correlacionados (correlação > 0.1)<br>
        • <strong>Correlações negativas:</strong> Apenas os 10 pares menos correlacionados (correlação < -0.1)<br>
        <strong🎯 Foco nos extremos:</strong> Os extremos são os mais significativos para análise, mostrando números que realmente tendem a sair juntos (positivas) ou raramente aparecem juntos (negativas).<br>
        <strong💡 Dica:</strong> Use essas correlações extremas para identificar combinações promissoras ou evitar números que raramente saem juntos.
      </p>

      <h3>🎯 Probabilidades Condicionais</h3>
      <p>
        Esse gráfico mostra a chance de um número ser sorteado quando outro já foi. É como observar se certos números têm uma tendência a aparecer juntos com frequência.<br><br>
        <strong>🔗 Essas são chamadas de probabilidades condicionais</strong> — ou seja, "Dado que o número X saiu, qual a chance de Y também sair?".<br><br>
        <strong>📊 Os valores são apresentados em porcentagem</strong>, mostrando a força dessa relação entre os pares.<br><br>
        <strong>💡 Use essa análise para identificar números que "se atraem" estatisticamente</strong>, e que podem surgir juntos com mais frequência do que o acaso sugeriria.<br><br>
        <strong>🧠 É uma ferramenta poderosa para quem busca padrões sutis e conexões escondidas entre os números.</strong>
      </p>

      <h3>🎯 Janela de Análise Temporal</h3>
      <p>
        Use o seletor de período para analisar diferentes janelas de tempo:<br>
        <strong>Últimos 300 concursos:</strong> Análise completa do histórico disponível.<br>
        <strongÚltimos 25/50/100/200:</strong> Foco em períodos mais recentes.<br>
        <strong💡 Dica:</strong> Períodos menores mostram tendências mais recentes, períodos maiores mostram padrões históricos consolidados.
      </p>

      <h3>💡 Estratégias de Aposta</h3>
      <p>
        <strongAleatoriedade Confirmada:</strong> Use estratégias balanceadas e diversificadas.<br>
        <strongClusters Identificados:</strong> Evite ou explore grupos de números relacionados.<br>
        <strongCorrelações:</strong> Use pares de números que se relacionam estatisticamente.<br>
        <strongProbabilidades:</strong> Aproveite as relações condicionais identificadas.<br>
        <strongCombinação:</strong> Integre com análises de frequência e seca.
      </p>

      <h3>🎯 Como Usar na Prática</h3>
      <p>
        <strongObserve o teste de aleatoriedade:</strong> Confirma se há padrões nos dados.<br>
        <strongAnalise os clusters:</strong> Identifique grupos de números relacionados.<br>
        <strongEstude as correlações:</strong> Use pares de números que se relacionam.<br>
        <strongConsidere as probabilidades:</strong> Aproveite as relações condicionais.<br>
        <strongCompare períodos:</strong> Use diferentes janelas temporais para identificar tendências.
      </p>

      <h3>⚠️ Considerações Importantes</h3>
      <p>
        <strongComplexidade:</strong> Esta análise usa métodos estatísticos avançados.<br>
        <strongInterpretação:</strong> Requer conhecimento básico de estatística.<br>
        <strongLimitações:</strong> Padrões passados não garantem resultados futuros.<br>
        <strongResponsabilidade:</strong> Aposte apenas o que pode perder, dentro dos seus limites financeiros.<br>
        <strongDiversificação:</strong> Não aposte apenas baseado em uma análise, diversifique suas escolhas.
      </p>

      <p style="margin-top: 20px; font-style: italic;">
        <strongImportante:</strong> Esta é uma análise estatística avançada que não garante resultados futuros. Use como ferramenta de orientação, mas sempre aposte com responsabilidade e consciência de que a loteria é um jogo de probabilidades onde a sorte é protagonista.
      </p>
    </div>
  </div>

  <!-- CSS para o popup de ajuda e gráficos responsivos -->
  <style>
  .modal-ajuda {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.85);
  }

  .modal-principal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.85);
  }

  /* Gráficos responsivos */
  .chart-container {
    padding: 10px;
    margin: 10px 0;
  }

  @media (max-width: 768px) {
    .chart-container {
      padding: 5px;
      margin: 5px 0;
    }

    .chart-container h3 {
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    .chart-container div[id^="grafico-"] {
      height: 350px !important; /* Aumenta ainda mais sem títulos de eixo */
      width: 100% !important;
    }
  }

  @media (max-width: 640px) {
    .chart-container div[id^="grafico-"] {
      height: 310px !important; /* Aumenta ainda mais sem títulos de eixo */
    }

    /* Otimizações específicas para gráficos Plotly em mobile */
    .js-plotly-plot .plotly .modebar {
      display: none !important;
    }

    /* Esconde legendas em mobile para economizar espaço */
    .js-plotly-plot .plotly .legend {
      display: none !important;
    }

    .js-plotly-plot .plotly .legend .traces {
      display: none !important;
    }
  }

  /* Mostra legendas em desktop */
  @media (min-width: 769px) {
    .js-plotly-plot .plotly .legend {
      display: block !important;
      font-size: 11px !important;
    }

    .js-plotly-plot .plotly .legend .traces {
      display: block !important;
      font-size: 11px !important;
    }
  }

  .modal-ajuda .modal-content {
    background-color: #1c1c1c;
    color: #eee;
    margin: 10% auto;
    padding: 20px;
    border-radius: 12px;
    width: 90%;
    max-width: 600px;
    max-height: 90vh; /* Limita altura máxima */
    overflow-y: auto; /* Permite rolagem vertical */
    -webkit-overflow-scrolling: touch; /* Melhora rolagem em iOS */
    scroll-behavior: smooth; /* Scroll suave */
    font-family: 'Inter', sans-serif;
    box-shadow: 0 0 20px #000;
  }

  .modal-principal .modal-content {
    background-color: #1c1c1c;
    color: #eee;
    margin: 5% auto;
    padding: 20px;
    border-radius: 12px;
    width: 95%;
    max-width: 1200px;
    max-height: 90vh; /* Limita altura máxima */
    overflow-y: auto; /* Permite rolagem vertical */
    -webkit-overflow-scrolling: touch; /* Melhora rolagem em iOS */
    scroll-behavior: smooth; /* Scroll suave */
    font-family: 'Inter', sans-serif;
    box-shadow: 0 0 20px #000;
  }

  .modal-ajuda .close {
    color: #aaa;
    float: right;
    font-size: 26px;
    cursor: pointer;
  }

  .modal-ajuda .close:hover {
    color: red;
  }

  .modal-principal .close {
    color: #aaa;
    float: right;
    font-size: 26px;
    cursor: pointer;
  }

  .modal-principal .close:hover {
    color: red;
  }

  .modal-ajuda h2 {
    color: #00E38C;
    margin-bottom: 15px;
  }

  .modal-ajuda h3 {
    color: #00E38C;
    margin-top: 20px;
    margin-bottom: 10px;
  }

  .modal-ajuda p {
    line-height: 1.6;
    margin-bottom: 10px;
  }

  .modal-principal h2 {
    color: #00E38C;
    margin-bottom: 15px;
  }

  .modal-principal h3 {
    color: #00E38C;
    margin-top: 20px;
    margin-bottom: 10px;
  }

  .modal-principal p {
    line-height: 1.6;
    margin-bottom: 10px;
  }

  /* Otimizações mobile para modal de ajuda */
  @media (max-width: 768px) {
    .modal-ajuda .modal-content {
      margin: 5% auto; /* Reduz margem superior */
      width: 95%; /* Ocupa mais largura */
      padding: 15px; /* Reduz padding */
    }
  }

  @media (max-width: 640px) {
    .modal-ajuda .modal-content {
      margin: 3% auto; /* Margem ainda menor */
      width: 98%; /* Quase toda a largura */
      padding: 12px; /* Padding menor */
    }
  }

  /* Otimizações mobile para modal principal */
  @media (max-width: 768px) {
    .modal-principal .modal-content {
      margin: 3% auto; /* Reduz margem superior */
      width: 98%; /* Ocupa mais largura */
      padding: 15px; /* Reduz padding */
    }
  }

  @media (max-width: 640px) {
    .modal-principal .modal-content {
      margin: 2% auto; /* Margem ainda menor */
      width: 99%; /* Quase toda a largura */
      padding: 12px; /* Padding menor */
    }
  }
  </style>

  <script src="{{ url_for('static', filename='js/graficos_lotofacil.js') }}"></script>

  <script>
    // Fallback para armazenar análises no localStorage caso não exista no JS global
    (function(){
      if (typeof window.armazenarAnalise !== 'function') {
        window.armazenarAnalise = function(tipo, dados) {
          try {
            const key = 'analisesSelecionadas_LF';
            const existentes = JSON.parse(localStorage.getItem(key)) || {};
            existentes[tipo] = dados;
            localStorage.setItem(key, JSON.stringify(existentes));
            console.log(`✅ Fallback armazenarAnalise (LF) salvou: ${tipo}`);
          } catch (e) {
            console.warn('⚠️ Fallback armazenarAnalise (LF) falhou:', e);
          }
        }
      }
    })();

    // Abertura/fechamento do modal Premium: controlado pelo graficos_lotofacil.js
  </script>

  <!-- Modal para Números do Cluster -->
  <div id="modal-numeros-cluster" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-card rounded-lg shadow-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto text-text relative">
      <h3 id="modal-numeros-cluster-titulo" class="text-primary text-2xl font-semibold mb-4 text-center">Números do Cluster</h3>
      <div id="modal-numeros-cluster-conteudo" class="grid grid-cols-5 sm:grid-cols-6 md:grid-cols-7 lg:grid-cols-8 gap-2 text-center text-lg font-bold">
      </div>
      <button id="fechar-modal-numeros-cluster" class="absolute top-4 right-4 text-textSecondary hover:text-primary transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>
</body>
</html>
</html>

